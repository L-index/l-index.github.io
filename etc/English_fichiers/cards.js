module({"@NextUtil":"@NextUtil","json!/common/js/JSON/Countries.json":"json!/asset/82bbf3f0be07c92d/common/js/JSON/Countries.json","@Model":"@Model","json!/common/js/JSON/Provinces.json":"json!/asset/1e80a06c565197b7/common/js/JSON/Provinces.json","@UiCore":"@UiCore","@Caman":"@Caman","@Widgets":"@Widgets","@Dialogs":"@Dialogs","@moment":"@moment","@Linkify":"@Linkify","@Checkout":"@Checkout","json!/common/js/JSON/States.json":"json!/asset/581385bf78983508/common/js/JSON/States.json","json!/common/pure/util/profile.json":"json!/asset/996b43a0c80f13b9/common/pure/util/profile.json","css!/build/withme/cards.css":"css!/asset/7a60aa51f187e340/build/withme/cards.css"},function(e){var t,i,a=(i=Handlebars.template,Handlebars.templates=Handlebars.templates||{},i({1:function(e,t,i,a){var n;return"\r\n            "+(0,this.escapeExpression)("function"==typeof(n=t.language||e&&e.language)?n.call(e,{name:"language",hash:{},data:a}):n)+"\r\n        "},3:function(e,t,i,a){var n;i=t.helperMissing;var s="\r\n            ";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Any",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"\r\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,r='<fieldset class="hostbar">\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+o((s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"LANGUAGE",{name:"i18n-g",hash:{},data:a}))+'</legend>\r\n    <section class="language flex-vc">\r\n        <div class="icon"></div>\r\n        <span>\r\n        ';return((n=t.if.call(e,e&&e.language,{name:"if",hash:{},fn:this.program(1,a),inverse:this.program(3,a),data:a}))||0===n)&&(r+=n),r+'\r\n        </span>\r\n    </section>\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+o((s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"OCCUPANCY",{name:"i18n-g",hash:{},data:a}))+'</legend>\r\n    <section class="occupancy flex-vc">\r\n        <div class="icon"></div>\r\n        <span class="occupants-row">\r\n            <span class="occupants">'+o("function"==typeof(s=t.occupancy||e&&e.occupancy)?s.call(e,{name:"occupancy",hash:{},data:a}):s)+'</span><span class="capacity">/'+o("function"==typeof(s=t.capacity||e&&e.capacity)?s.call(e,{name:"capacity",hash:{},data:a}):s)+'</span>&nbsp;<span class="users-word"></span>\r\n        </span>\r\n    </section>\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+o((s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"DESCRIPTION",{name:"i18n-g",hash:{},data:a}))+'</legend>\r\n    <section class="description">'+o("function"==typeof(s=t.description||e&&e.description)?s.call(e,{name:"description",hash:{},data:a}):s)+'</section>\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+o((s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"PARTICIPANTS",{name:"i18n-g",hash:{},data:a}))+"</legend>\r\n    <section class='chat-participants'></section>\r\n</fieldset>\r\n"},useData:!0})),n={everyCallback:function(e){return function(t){return e.apply(this,t)}},ensurePopulated:function(e,t){return function(i){return i.populated().then(e,t)}}},s={mixin:function(e){_.isArray(e)||(e=[].slice.call(arguments));var t=e[0],i=[],a=[];return _.each(e,function(e){if(e.initialize&&i.push(e.initialize),e.trackedEvents&&a.push(e.trackedEvents),e!==t){var n=t.dependencies||[];_.each(e.dependencies,function(e){-1===_.indexOf(n,e)&&n.push(e)}),_.extend(t,e,{dependencies:n})}}),i.length&&(t.initialize=1<i.length?function(){for(var e=Array.prototype.slice.call(arguments),t=i.length;0<t--;)i[t].apply(this,e)}:i[0]),a.length&&(t.trackedEvents=1<a.length?function(){for(var e=Array.prototype.slice.call(arguments),t=[],i=a.length;0<i--;)t=t.concat(a[i].apply(this,e));return t}:a[0]),t}},o=function(e){var t=e.Dialogs.AlloyAlertDialog;return t.extend("ReportUserDialog",{uiContextName:"report_dialog",className:"report-dialog",dependencies:["dialogManager","globalStartupModel","globalStringManager","Promise","restModelFactory"],initialize:function(e){this.__model=e.model,this.__dialogManager=e.dialogManager,this.__restModelFactory=e.restModelFactory,this.__startupModel=e.globalStartupModel,this.__stringManager=e.globalStringManager,this.__promise=e.Promise,this.__safetyReportUrl=this.__startupModel.get("safetyReportUrl"),e=_.extend({title:this.__stringManager.get(this.title),text:this.__stringManager.get(this.text),ok:this.__stringManager.get("report_ok_button"),termsOfService:!0,dropdown:{placeholder:this.__stringManager.get("report_reason_placeholder"),options:_.map(this.dropdownOptions,function(e){return{label:this.__stringManager.get(e.label),value:e.value}}.bind(this))}},e),t.prototype.initialize.call(this,e)},__onConfirm:function(){var t=this.getResult();this.__restModelFactory.createModel(this.__safetyReportUrl,e.UiCore.NodeModel,{reason:t.dropdown,relations:{content:this.__model.id}}).then(this.__confirmDialog.bind(this)).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this)).catch(function(e){this.__errorDialog(e).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this))}.bind(this))},hide:function(){this.reasonDropDown.__hide(),t.prototype.hide.call(this)},__confirmDialog:function(){return new this.__promise(function(e){var t=this.__dialogManager.alert({title:this.__stringManager.get("report_confirm_title"),text:this.__stringManager.get("report_confirm_text"),ok:this.__stringManager.get("report_confirm_done")}).finished;t.then(function(){e.resolve()}),t.catch(function(){e.resolve()})}.bind(this))},__errorDialog:function(e){return new this.__promise(function(e){var t=this.__dialogManager.alert({title:this.__stringManager.get("report_error_title"),text:this.__stringManager.get("report_error_text"),ok:this.__stringManager.get("report_error_done")}).finished;t.then(function(){e.resolve()}),t.catch(function(){e.resolve()})}.bind(this))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"]}),r=o.extend("ReportRoomDialog",{uiContextName:"report_room_dialog",className:"report-room-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager"],title:"report_room_title",text:"report_room_text",dropdownOptions:[{label:"report_room_reason_name",value:"name"},{label:"report_room_reason_description",value:"description"},{label:"report_room_reason_photo",value:"photo"}]}),l=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="profile-icon-placeholder"></div>\r\n'},useData:!0})}(),h=function(e){function t(e,t){var i=e.get("bootstrapParams").is_app;e.get("window").open(t,i?"_system":"_blank")}function i(e){return-1!==e.indexOf("iPad")||-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPod")}return{openExternal:t,externalizeA:function(e,i){var a=$(i),n=a.attr("href");a.attr("href",""),a.click(function(){return t(e,n),!1})},isAndroid:function(e){return-1!==e.get("window").navigator.userAgent.indexOf("Android")},isAndroidChrome:function(e){return-1!==(e=e.get("window").navigator.userAgent).indexOf("Android")&&-1!==e.indexOf("Chrome/")&&-1===e.indexOf("Version/")},isAndroidWebApp:function(e){return!(-1===(e=e.get("window")).navigator.userAgent.indexOf("Android")||!e.navigator.standalone)},isIOS:function(e){return i(e=e.get("window").navigator.userAgent)},isIOSSafari:function(e){return!(!i(e=e.get("window").navigator.userAgent)||-1!==e.indexOf("CriOS/"))&&(-1!==e.indexOf("Safari/")||-1!==e.indexOf("AppleWebKit/")&&-1===e.indexOf("Chrome/"))},getVersionIOS:function(e){return i(e=e.get("window").navigator.userAgent)?null===(e=/(iphone|ipad)(; CPU)? OS ((\d+)_(\d+)(_(\d+))?)/i.exec(e))?null:{raw:e[3],major:parseInt(e[4],10),minor:parseInt(e[5],10),revision:e[7]?parseInt(e[7],10):null}:null}}}(),d=function(e){var t=e.UiCore.UiContext;return t.extend("DetailParticipantListItem",{uiContextName:"detail_participant_list_item",className:"detail-participant-list-item",tagName:"li",dependencies:["loginManager"],initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},delete:function(){this.__profileIcon.delete(),t.prototype.delete.call(this)},render:function(){this.model.populated().then(function(){this.$el.html(e.template()),this.__profileIcon=this.createChildContext(e.Widgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.model.node}),e.MobileBrowser.isIOS(this.__serviceProvider)}.bind(this))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:l,MobileBrowser:h}),c=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("DetailParticipantList",{uiContextName:"detail_participants_list",className:"detail-participant-list",tagName:"ul",itemFactory:e.DetailParticipantListItem,initialize:function(e){this.itemFactory=e.itemFactory||this.itemFactory,t.prototype.initialize.call(this,e)}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],DetailParticipantListItem:d}),g=(t={UiCore:e["@UiCore"]}.UiCore.UiContext).extend("ContextMenu",{uiContextName:"context_menu",tagName:"ul",className:"context-menu",trackedEvents:function(){return[{type:"click",selector:"li",name:"context_menu_item",handler:"__chooseMenuItem",attributes:function(e){return{which:e.attr("data-menu-item")}}}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__items=IMVU.requireProperty(e,"items"),this.location=IMVU.requireProperty(e,"location"),this.__closeOnScroll=void 0===e.closeOnScroll||e.closeOnScroll,this.addToDOM()},render:function(){_.each(this.__items,function(e){var t=$("<li />");t.attr("data-menu-item",e.name).text(e.text).addClass(e.classNames).toggleClass("divider",!!e.divider),this.$el.append(t)}.bind(this))},__chooseMenuItem:function(e){var t=$(e.currentTarget).data("menu-item"),i=_.find(this.__items,function(e){return e.name===t}).handler;i&&i.call(this,e),this.trigger("item-chosen")},shouldCloseOnScroll:function(){return!this.__closeOnScroll}}),p=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<span class="by-line-text">\n    <span class="username"></span>\n</span>\n'},useData:!0})}(),u=function(e){var t=e.UiCore.UiContext;return t.extend("ByLineWidget",{className:"by-line-widget",uiContextName:"bylinewidget",tagName:"div",dependencies:["verbBy","model"],initialize:function(e){t.prototype.initialize.call(this,e),this.__hideOnlineStatus=!!e.hideOnlineStatus,this.__ignoreClicks=!!e.ignoreClicks,this.__hideUsername=!e.hasOwnProperty("hideUsername")||e.hideUsername,this.__useLargeProfile=!!e.useLargeProfile,this.__verbBy=IMVU.optionalProperty(e,"verbBy",null),this.addToDOM()},render:function(){this.$el.html(e.template()),this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".username"),user:this.model,hideIcon:!1,size:"medium",hideDisplay:!1,displayArgs:{size:"small",color:"dark",prefix:this.__verbBy},hideAtAvatar:this.__hideUsername,atAvatarArgs:{size:"small",color:"medium"}})}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:p}),m=function(e){return{dependencies:"contextMenuManager dialogManager featureAccessManager globalStringManager googleAnalytics modeManager Promise".split(" "),__getPrimaryAction:function(){var e=!!this.__roomModel.relations.chat,t=e?this.__serviceProvider.get("activeChats").has(this.__roomModel.getSingleEdge("chat"))?"SHOW ROOM":"JOIN ROOM":"CLOSED";return this.options.hideJoinButton?null:{key:"join",text:this.__globalStringManager.get(t),handler:this.__joinClicked.bind(this),disabled:!e}},__getSecondaryActions:function(){return[this.__featureAccessManager.canEditScenes()&&this.__roomModel.relations.owner===this.__myself.id?{key:"edit",text:this.__globalStringManager.get("EDIT ROOM"),handler:this.__onEditRoom.bind(this),disabled:!1}:{key:"more",text:this.__globalStringManager.get("MORE"),handler:this.__onShowActionMenu.bind(this),disabled:!1},this.__roomModel.relations.viewer_favorite_room?{key:"favorited",text:this.__globalStringManager.get("FAVORITED"),handler:this.__onToggleFavorite.bind(this,!1),disabled:!1}:{key:"favorite",text:this.__globalStringManager.get("FAVORITE"),handler:this.__onToggleFavorite.bind(this,!0),disabled:!1}]},__onEditRoom:function(){this.__modeManager.openMode({mode:{id:"decorate"},submode:{id:this.__roomModel.relations.scene}})},__onShowActionMenu:function(t){t.stopPropagation(),this.__contextMenuManager.toggleMenu(t,e.ContextMenu,{items:[{name:"report",text:"Report",handler:this.__reportAction.bind(this)}],displayOptions:{above:!1,right:!0}})},__reportAction:function(){this.__dialogManager.showDialog(e.ReportRoomDialog,{model:this.__roomModel})},__showOwner:function(){this.__hostedByBlock=this.createChildContext(e.ByLineWidget,{$parentElement:this.$(".hostbar"),model:this.track(this.__roomModel.getSingleEdge("owner")),verbBy:this.__globalStringManager.get("Hosted by")})},__showOccupants:function(){if(this.__roomModel.relations.chat){var t=this.track(this.__roomModel.getSingleEdge("chat"));t.populated().then(function(){return this.track(t.getEdgeCollection("participants")).populated()}.bind(this)).then(function(t){this.createChildContext(e.DetailParticipantList,{collection:t,$parentElement:this.$(".chat-participants"),showProfileIconOnly:!0});var i=function(){this.$("span.occupants").text(t.total_count),this.$("span.users-word").text(this.__globalStringManager.getPluralized("occupancy_user",{howMany:t.total_count}))}.bind(this);this.listenTo(t,"change:relations",i),i()}.bind(this))}},__commonRender:function(t){this.__roomModel.getSingleEdge("scene").populated().then(function(e){this.setForeground(IMVU.URI.build(t.get("rendered_image"),{width:this.__backgroundWidth,height:this.__backgroundHeight,cb:e.relations.shell_product}))}.bind(this)),this.setTitle(t.get("name")),this.__imageManager.loadAsBackgroundImage(this.$(".profile-icon, .user-cover-image"),t.get("themed_image_url")||t.get("image_url")),this.setInfo(e.template(t.toJSON())),"private"===t.get("privacy")&&this.$("span.capacity").hide(),this.setShields(_.filter([t.get("is_ap")?"ap":null,t.get("is_vip")?"vip":null])),this.__showOwner(),this.setActions(this.__getPrimaryAction(),this.__getSecondaryActions()),"private"===t.get("privacy")&&this.$(".btn-primary").attr("disabled","disabled"),this.listenTo(this.__roomModel,"change:relations",this.__onFavoriteRoomChange),this.__showOccupants()},__onFavoriteRoomChange:function(e,t){t.viewer_favorite_room!=e.viewer_favorite_room&&this.setActions(this.__getPrimaryAction(),this.__getSecondaryActions())},__onToggleFavorite:function(t){return t?this.__myself.getEdgeCollection("favorite_rooms").create({id:this.__roomModel.id}):this.__roomModel.getSingleEdge("viewer_favorite_room",e.UiCore.EdgeModel).destroy()},__joinClicked:function(){this.__roomModel.get("occupancy")>=this.__roomModel.get("capacity")?this.__dialogManager.alert({title:this.__globalStringManager.get("Room Full"),text:this.__globalStringManager.get("This room is currently full"),ok:this.__globalStringManager.get("OK")}):(this.__googleAnalytics.recordEnterChatRoom(this.__roomModel.id),this.__joinRoom())}}}({UiCore:e["@UiCore"],ContextMenu:g,ByLineWidget:u,ReportRoomDialog:r,DetailParticipantList:c,template:a}),f=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="card-header">\n    <img class="background">\n    <img class="foreground">\n</div>\n\n<div class="card-body">\n    <div class="shields"></div>\n    <div class="card-titles large-profile">\n        <div class="title enable-text-selection"></div>\n    </div>\n    <div class="card-description">\n        <div class="primary card-action-bar"></div>\n        <div class="secondary card-action-bar flex-direction-ltr"></div>\n        <div class="card-info-panel enable-text-selection"></div>\n    </div>\n</div>\n'},useData:!0})}(),v=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return" disabled"},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;return i='<button class="btn ',((n="function"==typeof(s=t.key||e&&e.key)?s.call(e,{name:"key",hash:{},data:a}):s)||0===n)&&(i+=n),((n=t.if.call(e,e&&e.disabled,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+='" data-action="',((n="function"==typeof(s=t.key||e&&e.key)?s.call(e,{name:"key",hash:{},data:a}):s)||0===n)&&(i+=n),i+='"><div class="icon"></div>',((n="function"==typeof(s=t.text||e&&e.text)?s.call(e,{name:"text",hash:{},data:a}):s)||0===n)&&(i+=n),i+"</button>"},useData:!0})}(),b=function(e){var t=e.UiCore.UiContext;return t.extend("Card",{uiContextName:"card_generic",className:"card",dependencies:["rest","imageManager","loginManager","Promise"],trackedEvents:function(){return[{type:"click",selector:".card-action-bar button",name:"button",handler:"__onClickAction",attributes:function(e){return{action:e.data("action"),eventID:e.data("id")?e.data("id"):""}}}]},initialize:function(e){this.__imageManager=e.imageManager,this.__rest=e.rest,this.__loginManager=e.loginManager,this.__Promise=e.Promise,this.__loginManager.isLoggedIn()&&(this.__myself=this.__loginManager.getCurrentUser()),this.userNode=e.userNode,this.title=e.title,this.showCloseX=e.showCloseX,t.prototype.initialize.call(this,e)},delete:function(){this.profileOutfitNode&&this.profileOutfitNode.off(void 0,void 0,this),t.prototype.delete.call(this)},render:function(){this.$el.html(e.template(this)),this.$(".card-body").scrollbar()},setForeground:function(e,t){var i=this.$(".foreground").attr("src")||"";this.__imageManager.load(this.$(".foreground"),e,{defaultImage:i,forceStaticImage:t})},setBackground:function(e,t){this.__imageManager.load(this.$(".background"),e,{forceStaticImage:t})},setShields:function(e){var t=this.$(".shields").empty();_.each(e,function(e){e=$('<button class="btn '+e+'" disabled></button>'),t.append(e)}.bind(this))},setThumbnail:function(e,t){this.__imageManager.load(this.$(".profile-icon img"),e,{forceStaticImage:t})},setTitle:function(e){this.$(".title").html(e)},setInfo:function(e){this.$(".card-info-panel").html(e)},setActions:function(e,t){var i=this.$(".primary.card-action-bar").empty(),a=this.$(".secondary.card-action-bar").empty();this.__actionHandlers={},null!=e&&this.__addActionButton(i,e),null!=t&&_.each(t,this.__addActionButton.bind(this,a)),this.model&&this.$("button").data("id",this.model.get("id"))},__addActionButton:function(t,i){i.handler&&(this.__actionHandlers[i.key]=i.handler),t.append(e.ActionButtonTemplate(i))},__onClickAction:function(e){var t=$(e.currentTarget).attr("data-action");this.__actionHandlers[t].call(this,e)}})}({UiCore:e["@UiCore"],template:f,ActionButtonTemplate:v}),y=function(e){var t=e.Card,i=t.extend("RoomCard",{uiContextName:"room_card",className:"card room-card",dependencies:["imageManager","modeManager","timer","featureAccessManager"],__backgroundWidth:500,__backgroundHeight:500,initialize:function(e){this.__cleanUp=[],t.prototype.initialize.call(this,_.extend(e,{showCloseX:!0})),this.defaultRoomImageUrl=e.defaultRoomImageUrl||"/common/withme/img/default_room_image.png",this.__myself=this.track(e.loginManager.getCurrentUser()),this.__featureAccessManager=e.featureAccessManager,this.addToDOM()},render:function(){this.model.populated().then(function(e){return this.__roomModel=e,t.prototype.render.call(this),this.__roomModel.populated()}.bind(this)).then(this.__commonRender.bind(this)).then(function(){this.$(".card-titles >.title").addClass("is-truncated")}.bind(this))},__joinRoom:function(){this.__modeManager.openMode({mode:{id:"chat"},submode:{id:this.__roomModel.id,forceJoin:!0,showAlways:!0}}),this.__serviceProvider.get("windowManager").removeWindow(this.__roomModel.id)},close:function(){this.__deck.hide()}});return e.Mixin.mixin(i.prototype,e.RoomDetailMixin),i}({UiCore:e["@UiCore"],Model:e["@Model"],Card:b,template:a,RoomDetailMixin:m,Mixin:s,promiseUtils:n}),C=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){return i=t.helperMissing,'\n        <section class="current_friend card-row"><div class="icon"></div><div class="text">'+(0,this.escapeExpression)((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"You are friends",{name:"i18n-g",hash:{},data:a}))+"</div></section>\n    "},3:function(){return'\n    <section class="current_room card-row"><div class="icon"></div><button class="btn ap"></button><div class="text"></div>\n        <div class="room-image"></div>\n    </section>\n    '},5:function(e,t,i,a){var n;return'\n        <section class="age card-row"><div class="icon"></div><div class="text">'+(0,this.escapeExpression)("function"==typeof(n=t.age||e&&e.age)?n.call(e,{name:"age",hash:{},data:a}):n)+"</div></section>\n    "},7:function(e,t,i,a){var n;return'\n        <section class="gender '+(i=this.escapeExpression)("function"==typeof(n=t.gender_class||e&&e.gender_class)?n.call(e,{name:"gender_class",hash:{},data:a}):n)+' card-row"><div class="icon"></div><div class="text">'+i("function"==typeof(n=t.gender||e&&e.gender)?n.call(e,{name:"gender",hash:{},data:a}):n)+"</div></section>\n    "},9:function(e,t,i,a){var n;return'\n        <section class="location card-row"><div class="icon"></div><div class="text is-truncated">'+(0,this.escapeExpression)("function"==typeof(n=t.location||e&&e.location)?n.call(e,{name:"location",hash:{},data:a}):n)+"</div></section>\n    "},11:function(e,t,i,a){var n;return'\n    <fieldset>\n        <legend class="system-info-header">TAGLINE</legend>\n        <section class="tagline">'+(0,this.escapeExpression)("function"==typeof(n=t.tagline||e&&e.tagline)?n.call(e,{name:"tagline",hash:{},data:a}):n)+"</section>\n    </fieldset>\n"},13:function(e,t,i,a){var n;return'\n<fieldset>\n    <legend class="system-info-header">INTERESTS</legend>\n    <section class="interests">'+(0,this.escapeExpression)("function"==typeof(n=t.interests||e&&e.interests)?n.call(e,{name:"interests",hash:{},data:a}):n)+"</section>\n</fieldset>\n"},15:function(e,t,i,a){var n;return i='\n<fieldset class="affinity">\n    <legend class="system-info-header">AFFINITY</legend>\n    ',((n=t.if.call(e,e&&e.relationship_status,{name:"if",hash:{},fn:this.program(16,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n    ",((n=t.if.call(e,e&&e.looking_for,{name:"if",hash:{},fn:this.program(18,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n</fieldset>\n"},16:function(e,t,i,a){var n;return'<section class="relationship card-row"><label>Relationship:</label> '+(0,this.escapeExpression)("function"==typeof(n=t.relationship_status||e&&e.relationship_status)?n.call(e,{name:"relationship_status",hash:{},data:a}):n)+"</section>"},18:function(e,t,i,a){var n;return'<section class="looking_for card-row"><label>Here for:</label> '+(0,this.escapeExpression)("function"==typeof(n=t.looking_for||e&&e.looking_for)?n.call(e,{name:"looking_for",hash:{},data:a}):n)+"</section>"},20:function(e,t,i,a){var n;return'\n<fieldset>\n    <legend class="system-info-header">MEMBER SINCE</legend>\n    <section class="member_since">'+(0,this.escapeExpression)("function"==typeof(n=t.member_since||e&&e.member_since)?n.call(e,{name:"member_since",hash:{},data:a}):n)+"</section>\n</fieldset>\n"},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i='<div class="vitals">\n    ',((n=t.if.call(e,e&&e.current_friend,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n    \n    ",((n=t.if.call(e,e&&e.current_room,{name:"if",hash:{},fn:this.program(3,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.age,{name:"if",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.gender,{name:"if",hash:{},fn:this.program(7,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n    \n    ",((n=t.if.call(e,e&&e.location,{name:"if",hash:{},fn:this.program(9,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n</div>\n\n",((n=t.if.call(e,e&&e.tagline,{name:"if",hash:{},fn:this.program(11,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.if.call(e,e&&e.interests,{name:"if",hash:{},fn:this.program(13,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.if.call(e,e&&e.any_affinity,{name:"if",hash:{},fn:this.program(15,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.if.call(e,e&&e.member_since,{name:"if",hash:{},fn:this.program(20,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i},useData:!0})}(),M=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n;return i='\n<div class="feed-item-container">\n    <div class="dummy"></div>\n    <div class="feed-item-photo">\n        <img class="cover-image"/>\n    </div>\n</div>\n',((n=t.if.call(e,e&&e.canSeeFeedCaptions,{name:"if",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n"},2:function(){return'\n    <div class="caption hidden" />\n'},4:function(e,t,i,a){var n;i=t.helperMissing;var s=this.escapeExpression,o='\n<div class="feed-item-container">\n    <div class="dummy"></div>\n    <div class="feed-item-text" ';return((n=t.if.call(e,e&&e.background_color,{name:"if",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+">\n        <div class='message'></div>\n        <div class=\"more-indicator\">"+s((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"See more",{name:"i18n-g",hash:{},data:a}))+"</div>\n    </div>\n</div>\n"},5:function(e,t,i,a){var n;return'style="background-color: #'+(0,this.escapeExpression)("function"==typeof(n=t.background_color||e&&e.background_color)?n.call(e,{name:"background_color",hash:{},data:a}):n)+'"'},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s=this.escapeExpression,o='<header class="feed-item-header-placeholder"></header>\n';return((n=t.if.call(e,e&&e.is_photo,{name:"if",hash:{},fn:this.program(1,a),inverse:this.program(4,a),data:a}))||0===n)&&(o+=n),o+'\n<footer class="feed-item-footer">\n    <ul class="action-bar-placeholder"></ul>\n    <ul class="extension-bar bar">\n        <li class="count-comments-container">\n            <span class="count-comments"></span>\n            <span class="comments-labels">\n                <span class="comments-text-singular">'+s((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Comment",{name:"i18n-g",hash:{},data:a}))+'</span>\n                <span class="comments-text-plural">'+s((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Comments",{name:"i18n-g",hash:{},data:a}))+'</span>\n            </span>\n        </li>\n        <li class="count-likes-container">\n            <span class="count-likes"></span>\n            <span class="likes-labels">\n                <span class="likes-text-singular">'+s((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Like",{name:"i18n-g",hash:{},data:a}))+'</span>\n                <span class="likes-text-plural">'+s((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Likes",{name:"i18n-g",hash:{},data:a}))+"</span>\n            </span>\n        </li>\n    </ul>\n</footer>\n"},useData:!0})}(),x=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="bar">\n    <div class="name-widget-goes-here"></div>\n</div>'},useData:!0})}(),k=function(e){var t=function(){return function(e){var t,i=+this;t=!e;var a=this.lang(),n=Math.round(Math.abs(i)/1e3),s=Math.round(n/60),o=Math.round(s/60),r=Math.round(o/24),l=Math.round(r/365);return(n=45>n&&["s",n]||1===s&&["m"]||45>s&&["mm",s]||1===o&&["h"]||22>o&&["hh",o]||1===r&&["d"]||345>=r&&["dd",r]||1===l&&["y"]||["yy",l])[2]=t,n[3]=0<i,n[4]=a,t=function(e,t,i,a,n){return n.relativeTime(t||1,!!i,e,a)}.apply({},n),e&&(t=this.lang().pastFuture(i,t)),t}}();return e.moment.lang("IOSRelativeTime",{relativeTime:{future:"in %s",past:"%s ago",s:"Just now",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:function(e){return 7>e?e+"d":Math.floor(e/7)+"w"},y:"1y",yy:"%dy"}}),e.moment.lang("en"),function(i){var a=e.moment.apply(this,Array.prototype.slice.call(arguments,1));return a.lang("IOSRelativeTime"),a.from=function(a,n){var s=t.call(e.moment.duration(this.diff(a)).lang(this.lang()._abbr),!n);return i.get("globalStringManager").getWithDefault(s,s)},a}}({moment:e["@moment"]}),w=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("Timestamp",{className:"timestamp-widget",uiContextName:"timestamp",tagName:"timestamp",dependencies:["timestampHelper","moment","timestamp"],initialize:function(e){i.prototype.initialize.call(this,e),this.__timestampHelper=e.timestampHelper,this.__moment=e.moment,this.__timestampHelper.setDifference(e.timestamp),this.addToDOM(),this.$el.attr("data-actual-date",this.__timestampHelper.now().toString())},render:function(){this.$el.text(this.__timestampHelper.formatTime())}})}(),S=function(t){var i={UiCore:e["@UiCore"],Timestamp:w}.Timestamp;return i.extend("FeedItemTimestamp",{className:"timestamp-widget feed-item-timestamp system-info-detail",uiContextName:"feed_item_timestamp",initialize:function(e){this.__includeAgo=!!e.includeAgo,i.prototype.initialize.call(this,e)},render:function(){this.$el.text(this.__timestampHelper.feedItem(this.__includeAgo))}})}(),U=function(e){var t=e.UiCore.UiContext;return t.extend("FeedItemHeader",{uiContextName:"feed_item_header",tagName:"header",className:"feed-item-header",dependencies:["featureAccessManager","timer"],initialize:function(e){t.prototype.initialize.call(this,e),this.__timer=e.timer,this.__featureAccessManager=e.featureAccessManager,this.__model=e.model,this.__ignoreUserClicks=!!e.ignoreUserClicks,this.__feedType=e.feedType,this.__viewType=e.viewType,this.addToDOM()},setUseCase:function(e){if(void 0!==e){if(this.__useCase=e,this.__dualName)switch(this.__useCase){case"FeedToggleToGrid":this.__dualName.setConfiguration("small-single-split-darkbg"),this.__dualName.drawIt();break;case"FeedToggleToColumn":this.__dualName.setConfiguration("small-single-lightbg"),this.__dualName.drawIt()}}else if(this.__useCase="FeedItemCard","grid"===this.__viewType)this.__useCase="FeedItemGrid";else switch(this.__feedType){case"subscribed_feed":case"recommended_feed":case"adult_feed":case"teen_feed":this.__useCase="FeedItemColumn";break;case"user_profile_card":this.__useCase="FeedItemUserProfile";break;default:"feed_detail_widget"!==this.__parentUiContext.uiContextName&&(this.__useCase="FeedItemUserProfile")}},shouldShowCaption:function(){return this.__useCase.match(/column$/i)||"FeedItemUserProfile"===this.__useCase},render:function(){this.model.populated().then(function(){this.$el.html(e.template),this.createChildContext(e.FeedItemTimestamp,{$parentElement:this.$(".bar"),timestamp:this.model.get("time")}),this.actor=this.model.getSingleEdge("actor"),this.actor.populated().then(function(){switch(this.setUseCase(),this.__useCase){case"FeedItemGrid":this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".name-widget-goes-here"),user:this.actor,configuration:"small-single-split-darkbg",ignoreClicks:this.__ignoreUserClicks});break;case"FeedItemColumn":this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".name-widget-goes-here"),user:this.actor,configuration:"small-single-lightbg",ignoreClicks:this.__ignoreUserClicks});break;case"FeedItemCard":this.__dualName=this.createChildContext(e.Widgets.DualName,{$parentElement:this.$(".name-widget-goes-here"),user:this.actor,configuration:"small-single-darkbg",ignoreClicks:this.__ignoreUserClicks});break;case"FeedItemUserProfile":this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".name-widget-goes-here"),user:this.actor,configuration:"small-single-lightbg",ignoreClicks:this.__ignoreUserClicks})}}.bind(this))}.bind(this))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],FeedItemTimestamp:S,IOSRelativeTime:k,template:x}),T=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){i=t.helperMissing;var n=this.escapeExpression;return'<div class="expanding-text-text" />\n<a class="helip hidden" data-more="'+n((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"...more",{name:"i18n-g",hash:{},data:a}))+'" data-less="'+n((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"...less",{name:"i18n-g",hash:{},data:a}))+'" />\n'},useData:!0})}(),D=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;return(n="function"==typeof(s=t.text||e&&e.text)?s.call(e,{name:"text",hash:{},data:a}):s)||0===n?n:""},useData:!0})}(),I=function(e){var t=e.UiCore.UiContext,i="imvu.com www.imvu.com secure.imvu.com avatars.imvu.com im.vu localhost.imvu.com help.imvu.com go.imvu.com".split(" "),a=["imvu.com","www.imvu.com","secure.imvu.com","localhost.imvu.com"];return t.extend("UserText",{className:"user-text",uiContextName:"user_text",EXTERNAL_LINK_WARNINGS_SUPPRESSED_KEY:"alloy.external_link_warnings.suppressed",dependencies:"Promise conversationHelpers dialogManager featureAccessManager globalStringManager modeManager prefsManager root text timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:"a",name:"user_text_link",handler:this.__onClickLink}]},initialize:function(e){t.prototype.initialize.call(this,e),this.text=String(e.text)||"",this.__dialogManager=e.dialogManager,this.__window=e.window,this.__prefsManager=e.prefsManager,this.__featureAccessManager=e.featureAccessManager,this.__globalStringManager=e.globalStringManager,this.__conversationHelpers=e.conversationHelpers,this.__modeManager=e.modeManager,this.__root=e.root,this.addToDOM()},delete:function(){t.prototype.delete.call(this)},render:function(t){t=t||!0,this.text=this.text.replace(/(?:\r\n|\r|\n)/g,"<br />"),t&&(this.text=this.text.replace(/<(?:.|\n)*?>/gm," ")),this.text=this.__conversationHelpers.sanitize(this.text),this.text=this.__conversationHelpers.collapseWhitespace(this.text),this.$el.html(e.template({text:this.text})),this.$el.linkify({target:"_blank"})},__isNextMode:function(e){var t=_.rest(e.pathname.split("/"));return this.__featureAccessManager.canSeeFixForUserTextUrl()?_.contains(a,e.hostname)&&1<t.length&&"next"===t[0]&&0<t[1].length:_.contains(a,e.hostname)&&1<t.length&&"next"===t[0]},__onClickLink:function(e){var t=e.target.href;this.__isNextMode(e.target)?(e.preventDefault(),this.__modeManager.openModeFromPath(e.target.pathname)):this.isExternalLink(e.target)&&!this.isExternalLinkWarningSuppressed()&&(e.preventDefault(),this.__dialogManager.confirm({title:this.__globalStringManager.get("visit_link_title"),text:this.__globalStringManager.get("visit_link_text"),checkbox:this.__globalStringManager.get("visit_link_checkbox"),checkedByDefault:!1,yes:this.__globalStringManager.get("visit_link_title"),no:this.__globalStringManager.get("Cancel")}).finished.then(function(e){e.checked&&this.suppressExternalLinkWarnings(),this.__window.open(t,"_blank")}.bind(this)))},isExternalLinkWarningSuppressed:function(){return this.__prefsManager.getBool(this.EXTERNAL_LINK_WARNINGS_SUPPRESSED_KEY,!1)},suppressExternalLinkWarnings:function(){this.__prefsManager.setBool(this.EXTERNAL_LINK_WARNINGS_SUPPRESSED_KEY,!0)},isExternalLink:function(e){return!_.contains(i,e.hostname)},waitForVisible:function(){return new this.__Promise(function(e){var t=10,i=function(){this.isVisible()?e.resolve():0<t?(t--,this.__timer.setTimeout(i.bind(this),500)):e.reject(Error("text never becomes visible"))};i.call(this)}.bind(this))},isVisible:function(){return this.$el.is(":visible")},isOverflowed:function(){return!(!this.isVisible()||!(Math.ceil(this.$el.innerWidth())<this.$el[0].scrollWidth||Math.ceil(this.$el.innerHeight())<this.$el[0].scrollHeight))},handleOverflow:function(){if(this.$el.text(this.text),this.isOverflowed()){if(!this.shortText){for(var e=this.text,t=e,i=0;this.isOverflowed();){if(i>this.text.length){e=this.text.substr(0,this.text.length/2);break}(t=e.replace(/\s+\S+$/,"..."))===e&&(t=(t=e.replace(/(\.\.\.)*$/,"")).replace(/.{1,3}$/,"...")),e=t,this.$el.text(e),this.$el.linkify({target:"_blank"}),i++}(t=e.replace(/(\s+\S+){1,2}$/,"..."))===e&&(t=(t=e.replace(/(\.\.\.)*$/,"")).replace(/.{1,6}$/,"...")),this.shortText=t}this.$el.text(this.shortText),this.$el.linkify({target:"_blank"})}else this.$el.linkify({target:"_blank"}),e=this.$el.html(),this.$el.html(e+"&nbsp;&nbsp;&nbsp;&nbsp;")}})}({UiCore:e["@UiCore"],template:D,Linkify:e["@Linkify"]}),P=function(e){var t=e.UiCore.UiContext;return t.extend("ExpandingText",{className:"expanding-text",uiContextName:"expanding_text",dependencies:["textValue"],trackedEvents:function(){return[{type:"click",selector:".helip",name:"expanding_text_helip_click",handler:"__onHelipClick"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template()),this.__expanding=this.createChildContext(e.UserText,{$replaceElement:this.$(".expanding-text-text"),text:this.__textValue}),this.__expanding.$el.addClass("expanding-text-text"),this.__expanding.waitForVisible().then(function(){this.__expanding.isOverflowed()&&(this.__expanding.handleOverflow(),this.$(".helip").removeClass("hidden"))}.bind(this))},changeText:function(e){this.__expanding.shortText=null,this.__expanding.text=e||"",this.__expanding.render(),this.__expanding.waitForVisible().then(function(){var e=!1;this.$el.hasClass("open")&&(e=!0,this.$el.toggleClass("open")),this.__expanding.isOverflowed()?this.$(".helip").removeClass("hidden"):this.$(".helip").addClass("hidden"),e&&this.$el.toggleClass("open")}.bind(this))},__onHelipClick:function(e){this.$el.toggleClass("open"),this.__expanding.handleOverflow(),this.trigger("openText")}})}({UiCore:e["@UiCore"],UserText:I,template:T}),E=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="main-container">\r\n    <div class="canvas-container container"><div class="image-container"></div><div class="canvas-footer"></div></div>\r\n    <div class="controls-container container"></div>\r\n</div>\r\n\r\n<script type="text/template" class="post-header-template">\r\n    <a class="back">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Back",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</a>\r\n    <a class="post">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"dialog_photobooth_post",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</a>\r\n<\/script>\r\n\r\n<script type="text/template" class="save-header-template">\r\n    <a class="save">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Save",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</a>\r\n<\/script>"},useData:!0})}(),A=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("UploadCurtain",{uiContextName:"upload_curtain",className:"upload-curtain",dependencies:["Promise","timer"],initialize:function(e){i.prototype.initialize.call(this,e),this.serviceProvider=e.serviceProvider,this.Promise=e.Promise,this.timer=e.timer,this.__completeDelay=e.completeDelay||1e3,this.addToDOM()},show:function(){this.$el.addClass("loading"),i.prototype.show.call(this)},complete:function(){return this.$el.removeClass("loading"),new this.Promise(function(e){this.__completeTimer=this.timer.setTimeout(function(){e.accept(),this.hide()}.bind(this),this.__completeDelay)}.bind(this))},delete:function(){this.timer.clearTimeout(this.__completeTimer)}})}(),N=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<img />\n<div class='expanded-photo'>\n    <img />\n</div>\n"},useData:!0})}(),L=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("FeedPhoto",{className:"feed-photo",uiContextName:"feed_photo",dependencies:["imageManager","model","timer"],initialize:function(e){t.prototype.initialize.call(this,e),this.__photoFadeDelay=e.photoFadeDelay||150,this.addToDOM()},delete:function(){t.prototype.delete.call(this),this.__timer.clearTimeout(this.__fadeTimer)},render:function(){this.$el.addClass("loading").html(e.template),this.__fadeTimer=this.__timer.setTimeout(function(){this.$el.addClass("fade")}.bind(this),this.__photoFadeDelay),this.model.populated().then(function(){return this.$el.css({"max-width":Math.max(this.model.get("payload.width"),this.model.get("payload.height"))+"px"}),this.__imageManager.load(this.$("img"),this.model.get("payload.url"),{})}.bind(this)).then(function(){this.$el.removeClass("loading")}.bind(this)).catch(function(){this.$el.removeClass("loading").addClass("error")}.bind(this))}})}({UiCore:e["@UiCore"],template:N}),R=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<div class='overlays'></div>\n<div class='loading-curtain'></div>"},useData:!0})}(),O=IMVU.BaseClass.extend("BaseComponentCanvasRenderer",{dependencies:["canvasContext","Promise"],initialize:function(e){this.__serviceProvider=e.serviceProvider,this.__canvasContext=e.canvasContext,this.__canvasSize=[e.canvasContext.canvas.width,e.canvasContext.canvas.height],this.__imageFactory=e.imageFactory||function(){return new Image},this.__Promise=e.Promise},__loadImage:function(e,t){var i=!t;return t=t||e,new this.__Promise(function(a){if(this.__image&&t===this.__currentImageUrl)return a.accept();this.__image&&(this.__image.src="",$(this.__image).off(),delete this.__image),this.__image=this.__imageFactory(),$(this.__image).on("load",function(){$(this.__image).off(),a.accept()}.bind(this)).on("error",function(){$(this.__image).off(),this.__currentImageUrl=null,a.reject()}.bind(this)),i&&(this.__image.crossOrigin="anonymous"),this.__image.src=e,this.__currentImageUrl=t}.bind(this))},render:function(e){},delete:function(){this.__image&&($(this.__image).off(),delete this.__image)}}),B=function(e){var t={BaseComponentCanvasRenderer:O}.BaseComponentCanvasRenderer;return t.extend("BackgroundCanvasRenderer",{initialize:function(e){t.prototype.initialize.call(this,e),this.__canvasFactory=e.canvasFactory||function(){return document.createElement("canvas")},this.__squashCache={}},__getSquashRatio:function(e){if(this.__squashCache[e])return this.__squashCache[e];var t=this.__image.naturalHeight;(i=this.__canvasFactory()).width=1,i.height=t,(i=i.getContext("2d")).drawImage(this.__image,0,0);for(var i=i.getImageData(0,0,1,t).data,a=1,n=t;0<n;n--)if(0!==i[4*(n-1)+3]){a=n/t;break}return this.__squashCache[e]=a},__isCustomBackground:function(e){return"data:"===e.imageUrl.substring(0,5)},render:function(e){if(!e.imageUrl)return this.__Promise.accept();var t=this.__isCustomBackground(e),i=t?e.customBackgroundToken:null;return this.__loadImage(e.imageUrl,i).then(function(){if(t){var a=0,n=0,s=this.__canvasSize[0];if(this.__image.width<this.__image.height?(s=this.__image.width,n=Math.floor((this.__image.height-s)/2)):(s=this.__image.height,a=Math.floor((this.__image.width-s)/2)),e.rotation){this.__canvasContext.save();var o=Math.floor(this.__canvasSize[0]/2);this.__canvasContext.translate(o,o),this.__canvasContext.rotate(e.rotation*Math.PI/180),this.__canvasContext.translate(-o,-o)}o=this.__getSquashRatio(i),this.__canvasContext.drawImage(this.__image,a,n,s,s,0,0,this.__canvasSize[0],this.__canvasSize[1]/o),e.rotation&&this.__canvasContext.restore()}else this.__canvasContext.drawImage(this.__image,0,0,this.__canvasSize[0],this.__canvasSize[1])}.bind(this))}})}(),F=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<div class='drag-area'></div>\n<div class='zoom-buttons'>\n    <div class='zoom in'></div>\n    <div class='zoom out'></div>\n</div>\n<div class=\"mode-indicator-icon\"><i class=\"pose-mode\" /></div>\n"},useData:!0})}(),H=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("DraggableOverlay",{trackedEvents:function(){return[{type:"mousedown",selector:".drag-area",name:"start_drag",handler:this.__handleDown},{type:"touchstart",selector:".drag-area",name:"start_drag",handler:this.__handleDown},{type:"mousemove",selector:".drag-area",name:"drag",handler:this.__handleMove,attributes:{repeats:1}},{type:"touchmove",selector:".drag-area",name:"drag",handler:this.__handleMove,attributes:{repeats:1}},{type:"mouseup",selector:".drag-area",name:"stop_drag",handler:this.__handleUp},{type:"touchend",selector:".drag-area",name:"stop_drag",handler:this.__handleUp},{type:"mouseout",selector:".drag-area",name:"stop_drag",handler:this.__handleUp}]},initialize:function(e){i.prototype.initialize.call(this,e),this.__temporarilyDisabledFilter=this.__dragging=!1},__pixelCoords:function(e){e=e.originalEvent.changedTouches?e.originalEvent.changedTouches[0]:e;var t=this.$el.offset();return[e.pageX-t.left,e.pageY-t.top]},__handleDown:function(e){e.preventDefault(),e.stopPropagation(),this.__dragging||(this.__dragging=!0,this.__$elSize=[this.$el.width(),this.$el.height()],this.__canvasModel.getLayerAttr("filter","disabled")||(this.__temporarilyDisabledFilter=!0,this.__canvasModel.setLayerAttrs("filter",{disabled:!0})),this.__startDrag(e))},__handleUp:function(e){e.stopPropagation(),this.__dragging&&(this.__dragging=!1,this.__temporarilyDisabledFilter&&(this.__temporarilyDisabledFilter=!1,this.__canvasModel.setLayerAttrs("filter",{disabled:!1})),this.__stopDrag(e))},__handleMove:function(e){e.preventDefault(),e.stopPropagation(),this.__dragging&&(this.__outOfBounds(this.__pixelCoords(e))?(this.__dragging=!1,this.__temporarilyDisabledFilter&&(this.__temporarilyDisabledFilter=!1,this.__canvasModel.setLayerAttrs("filter",{disabled:!1})),this.__stopDrag(e)):this.__drag(e))},__outOfBounds:function(e){return _.any(e,function(t,i){return 0>e[i]||e[i]>this.__$elSize[i]}.bind(this))},reset:function(){}})}(),z=function(e){var t=function(e,t,i){return Math.max(t,Math.min(i,e))},i=e.DraggableOverlay;return i.extend("AvatarOverlay",{uiContextName:"avatar_overlay",className:"avatar-overlay",dependencies:["canvasModel"],DRAG_LIMITS:{x:.06,y:.375},trackedEvents:function(){return i.prototype.trackedEvents.call(this).concat([{type:"click",selector:".zoom.in",name:"zoom_in",handler:this.__zoomIn},{type:"click",selector:".zoom.out",name:"zoom_in",handler:this.__zoomOut}])},initialize:function(e){i.prototype.initialize.call(this,e),this.__canvasModel=e.canvasModel,this.__dragLimits=e.dragLimits||this.DRAG_LIMITS,this.addToDOM(),this.__refreshZoomButtons()},__startDrag:function(e){this.__lastCoords=this.__pixelCoords(e)},__stopDrag:function(e){},__drag:function(e){e=this.__pixelCoords(e);var t=Math.round(e[0]-this.__lastCoords[0]),i=Math.round(e[1]-this.__lastCoords[1]);(t||i)&&this.__setPosition(this.__canvasModel.getLayerAttr("avatar","xPosition")+t/this.__$elSize[0],this.__canvasModel.getLayerAttr("avatar","yPosition")+i/this.__$elSize[1]),this.__lastCoords=e},__setPosition:function(e,i){var a=this.__canvasModel.getLayerAttr("avatar","scales"),n=this.__canvasModel.getLayerAttr("avatar","scaleIndex"),s=this.__dragLimits.x*a[n];a=this.__dragLimits.y*a[n];this.__canvasModel.setLayerAttrs("avatar",{xPosition:t(e,0-s,1+s),yPosition:t(i,0-a,1+a)})},__setZoom:function(e){this.__canvasModel.setLayerAttrs("avatar",{scaleIndex:t(e,0,this.__canvasModel.getLayerAttr("avatar","scales").length-1)}),this.__setPosition(this.__canvasModel.getLayerAttr("avatar","xPosition"),this.__canvasModel.getLayerAttr("avatar","yPosition")),this.__refreshZoomButtons()},__zoomIn:function(e){this.__setZoom(this.__canvasModel.getLayerAttr("avatar","scaleIndex")+1)},__zoomOut:function(e){this.__setZoom(this.__canvasModel.getLayerAttr("avatar","scaleIndex")-1)},__refreshZoomButtons:function(){var e=this.__canvasModel.getLayerAttr("avatar","scales"),t=this.__canvasModel.getLayerAttr("avatar","scaleIndex");e&&(this.$(".zoom.in").toggleClass("disabled",t===e.length-1),this.$(".zoom.out").toggleClass("disabled",0===t))},render:function(){this.$el.html(e.template)},reset:function(){this.__canvasModel.setLayerAttrs("avatar",{xPosition:this.__canvasModel.defaults.layers.avatar.xPosition,yPosition:this.__canvasModel.defaults.layers.avatar.xPosition,scaleIndex:this.__canvasModel.defaults.layers.avatar.scaleIndex}),this.__refreshZoomButtons()}})}({UiCore:e["@UiCore"],template:F,DraggableOverlay:H}),V=function(t){var i={Caman:e["@Caman"],BaseComponentCanvasRenderer:O}.BaseComponentCanvasRenderer;return i.extend("FilterCanvasRenderer",{initialize:function(e){this.Caman=e.Caman||Caman,i.prototype.initialize.call(this,e)},render:function(e){return new this.__Promise(function(t){if(!e.filterId)return t.accept();var i="#"+this.__canvasContext.canvas.id;switch(e.filterId){case 1:this.Caman(i,function(){this.reloadCanvasData(),this.greyscale().render(function(){return t.accept()})});break;case 2:this.Caman(i,function(){this.reloadCanvasData(),this.saturation(100).vibrance(-100).contrast(-10).sepia(60).vignette("30%",30).render(function(){return t.accept()})});break;case 3:this.Caman(i,function(){this.reloadCanvasData(),this.hue(25).render(function(){return t.accept()})});break;case 4:this.Caman(i,function(){this.reloadCanvasData(),this.noise(60).stackBlur(2).render(function(){return t.accept()})});break;case 5:this.Caman(i,function(){this.reloadCanvasData(),this.posterize(8).render(function(){return t.accept()})});break;case 6:this.Caman(i,function(){this.reloadCanvasData(),this.vintage(!0).render(function(){return t.accept()})});break;case 7:this.Caman(i,function(){this.reloadCanvasData(),this.lomo(!0).render(function(){return t.accept()})});break;case 8:this.Caman(i,function(){this.reloadCanvasData(),this.sinCity().render(function(){return t.accept()})});break;case 9:this.Caman(i,function(){this.reloadCanvasData(),this.vignette("40%",60).render(function(){return t.accept()})});break;case 10:this.Caman(i,function(){this.reloadCanvasData(),this.clip(25).contrast(9).exposure(27).render(function(){return t.accept()})});break;case 11:this.Caman(i,function(){this.reloadCanvasData(),this.exposure(19).vibrance(55).sharpen(95).clip(47).render(function(){return t.accept()})});break;case 12:this.Caman(i,function(){this.reloadCanvasData(),this.saturation(-50).contrast(40).posterize(6).render(function(){return t.accept()})});break;case 13:this.Caman(i,function(){this.reloadCanvasData(),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.greyscale(),this.filter.posterize(2)}),this.render(function(){return t.accept()})});break;case 14:this.Caman(i,function(){this.reloadCanvasData(),this.brightness(10),this.saturation(45),this.contrast(15),this.noise(50),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(100),this.copyParent(),this.filter.brightness(10),this.filter.contrast(15),this.filter.greyscale(),this.filter.posterize(2)}),this.stackBlur(1),this.render(function(){return t.accept()})});break;case 15:this.Caman(i,function(){this.reloadCanvasData(),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(100),this.copyParent(),this.filter.hue(25),this.filter.vignette("30%",80)}),this.render(function(){return t.accept()})});break;case 16:this.Caman(i,function(){this.reloadCanvasData(),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(100),this.copyParent(),this.filter.greyscale(),this.filter.vignette("40%",60)}),this.render(function(){return t.accept()})});break;case 17:this.Caman(i,function(){this.reloadCanvasData(),this.sharpen(100),this.render(function(){return t.accept()})});break;default:return t.accept()}}.bind(this))}})}(),W=function(e){var t=e.DraggableOverlay;return t.extend("PaintOverlay",{uiContextName:"paint_overlay",className:"paint-overlay",dependencies:["canvasModel","timer"],trackedEvents:function(){return t.prototype.trackedEvents.call(this).concat([{type:"click",selector:".undo",name:"undo",handler:this.__undo},{type:"click",selector:".clear",name:"clear",handler:this.__clear}])},initialize:function(e){t.prototype.initialize.call(this,e),this.__canvasModel=e.canvasModel,this.__restartThreshold=e.restartThreshold||300,this.timer=e.timer,this.addToDOM()},__coords:function(e){return{x:(e=this.__pixelCoords(e))[0]/this.__$elSize[0],y:e[1]/this.__$elSize[1]}},__startDrag:function(e){this.__canvasModel.recordPaintCommand("brush_start",this.__coords(e)),this.__canvasModel.setLayerAttrs("paint",{canvasChokehold:1})},__stopDrag:function(e){this.timer.clearTimeout(this.restartBrushTimeout),this.__canvasModel.recordPaintCommand("brush_stop",this.__coords(e)),this.__canvasModel.setLayerAttrs("paint",{canvasChokehold:0})},__drag:function(e){var t=this.__coords(e);this.timer.clearTimeout(this.restartBrushTimeout),this.__canvasModel.recordPaintCommand("brush_move",t),e=function(){this.__canvasModel.recordPaintCommand("brush_restart",t)}.bind(this,t),this.restartBrushTimeout=this.timer.setTimeout(e,this.__restartThreshold)},__findLastBrushstroke:function(){for(var e=this.__canvasModel.getLayerAttr("paint","commands"),t=null,i=e.length-1;0<=i;i--)if("brush_stop"===e[i].name&&null===t)t=i;else if("brush_start"===e[i].name)return[i,t]},__undo:function(){var e=this.__findLastBrushstroke();if(e){var t=this.__canvasModel.getLayerAttr("paint","commands");t.splice(e[0],1+e[1]-e[0]),this.__canvasModel.setLayerAttrs("paint",{commands:t}),this.__canvasModel.trigger("change")}},__clear:function(){for(var e=["set_color","set_width"],t=[],i=this.__canvasModel.getLayerAttr("paint","commands"),a=i.length-1;0<=a;a--){var n=i[a],s=e.indexOf(n.name);if(0<=s&&(t.unshift(n),e.splice(s,1),0===e.length))break}this.__canvasModel.setLayerAttrs("paint",{commands:t}),this.__canvasModel.trigger("change")},render:function(){this.$el.html(e.template)},reset:function(){this.__clear()},delete:function(){this.timer.clearTimeout(this.restartBrushTimeout),t.prototype.delete.call(this)}})}({template:function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<div class='drag-area'></div>\n<div class='edit-buttons'>\n    <div class='undo'></div>\n    <div class='clear'></div>\n</div>\n<div class=\"mode-indicator-icon\"><i class=\"scribble-mode\" /></div>\n"},useData:!0})}(),DraggableOverlay:H}),q=function(t){var i={UiCore:e["@UiCore"],BaseComponentCanvasRenderer:O}.BaseComponentCanvasRenderer;return i.extend("PaintCanvasRenderer",{initialize:function(e){i.prototype.initialize.call(this,e),this.__canvasContext.lineCap="round",this.__canvasContext.lineJoin="round",this.__paintedThru=0},incrementalRender:function(e){return this.__paint(e),this.__Promise.accept()},render:function(e){return this.__paintedThru=0,this.__paint(e),this.__Promise.accept()},__paint:function(e){for(var t=this.__paintedThru;t<e.commands.length;t++){var i=e.commands[t];this._commandHandlers[i.name].call(this,i.data,i.timestamp),this.__paintedThru=t+1}},__translateCoords:function(e){return{x:e.x*this.__canvasSize[0],y:e.y*this.__canvasSize[1]}},_commandHandlers:{set_width:function(e,t){this.width=e.width,this.__canvasContext.lineWidth=this.width},set_color:function(e,t){this.color=e.color,this.__canvasContext.fillStyle=this.color,this.__canvasContext.strokeStyle=this.color},brush_restart:function(e,t){this._commandHandlers.brush_stop.call(this,e,t),this._commandHandlers.brush_start.call(this,e,t)},brush_start:function(e,t){e=this.__translateCoords(e),this.__canvasContext.beginPath(),this.__canvasContext.arc(e.x,e.y,this.width/2,0,2*Math.PI,!1),this.__canvasContext.fill(),this.__canvasContext.beginPath(),this.__canvasContext.moveTo(e.x,e.y),this.lastPoint=this.lastAvgPoint=e,this.lastTime=t,this.__canvasContext.lineWidth=this.width,this.points=[e],this.avgPoints=[],this.velocities=[0,0,0,0,0]},brush_move:function(e,t){if(e=this.__translateCoords(e),null!==this.points){var i=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},a=function(e,a){var n=i(e,a),s=t-this.lastTime;return 0===s&&(s=1),n/s}.bind(this),n=function(e,i){var a=this.width;55>i?a=this.width:155>i?a=1.5*this.width:355>i&&(a=2*this.width),.5>Math.abs(this.__canvasContext.lineWidth-a)?this.__canvasContext.lineWidth=a:this.__canvasContext.lineWidth=0<this.__canvasContext.lineWidth-a?this.__canvasContext.lineWidth-.6:this.__canvasContext.lineWidth+.5,a={x:(this.lastPoint.x+e.x)/2,y:(this.lastPoint.y+e.y)/2},this.avgPoints.push(a),this.__canvasContext.quadraticCurveTo(this.lastPoint.x,this.lastPoint.y,a.x,a.y),this.__canvasContext.stroke(),this.__canvasContext.beginPath(),this.__canvasContext.moveTo(a.x,a.y),this.lastAvgPoint=a,this.lastPoint=e,this.lastTime=t}.bind(this);4>i(e,this.lastPoint)||(this.velocities.shift(),this.velocities.push(a(e,this.lastPoint)),a=_.reduce(this.velocities,function(e,t){return e+t},0),n(e,a/=this.velocities.length),this.points.push(e))}},brush_stop:function(e,t){e=this.__translateCoords(e),null!==this.points&&(this.__canvasContext.lineTo(e.x,e.y),this.__canvasContext.stroke(),this.points=null)}}})}(),j=function(e){var t=e.BaseComponentCanvasRenderer;return t.extend("AvatarCanvasRenderer",{AVATAR_IMAGE_SIZE:{width:1024,height:1024},dependencies:["restModelFactory"],initialize:function(e){t.prototype.initialize.call(this,e),this.restModelFactory=e.restModelFactory,this.__desiredImageSize=e.desiredImageSize||this.AVATAR_IMAGE_SIZE},__annotateRenderedImageUrl:function(e){return IMVU.URI.build(e.renderedImageUrl,{width:this.__desiredImageSize.width,height:this.__desiredImageSize.height,view:e.poseView||"",no_redirect:1,look:e.lookUrl})},__drawImageOnCanvas:function(e){var t=e.scales[e.scaleIndex],i=this.__image.width*t/this.__desiredImageSize.width;t=this.__image.height*t/this.__desiredImageSize.height;this.__canvasContext.drawImage(this.__image,e.xPosition*this.__canvasSize[0]-i/2,e.yPosition*this.__canvasSize[1]-t/2,i,t)},render:function(t){if(!t.renderedImageUrl)return this.__Promise.accept();var i=this.restModelFactory.readModel(this.__annotateRenderedImageUrl(t),e.UiCore.NodeModel);return i.populated().then(function(){return this.__loadImage(i.get("ssr_url"))}.bind(this)).then(function(){this.__drawImageOnCanvas(t)}.bind(this))}})}({UiCore:e["@UiCore"],BaseComponentCanvasRenderer:O}),G=function(e){var t=e.UiCore.UiContext;return t.extend("CanvasPresenter",{uiContextName:"canvas_presenter",className:"canvas-presenter",OUTPUT_IMAGE_SIZE:1024,CANVAS_ID:"photo-booth-canvas",dependencies:["Promise","canvasModel","timer"],initialize:function(i){t.prototype.initialize.call(this,i),this.__serviceProvider=i.serviceProvider,this.__Promise=i.Promise,this.__canvasModel=i.canvasModel,this.__ready=this.__refreshQueued=!1,this.__chokeholdLayer=null,this.__timer=i.timer,this.addToDOM(),this.__rendererFactories=i.rendererFactories||{background:e.BackgroundCanvasRenderer,avatar:e.AvatarCanvasRenderer,filter:e.FilterCanvasRenderer,paint:e.PaintCanvasRenderer},this.__renderers={},_.each(this.__rendererFactories,function(e,t){this.__renderers[t]=this.__serviceProvider.create(e,{canvasContext:this.__canvasContext})}.bind(this)),this.__refresh(),this.__canvasModel.on("change",this.__refresh,this)},render:function(){this.$el.addClass("loading"),this.$el.html(e.template),this.__createOverlays(),this.setOverlay("avatar"),this.__$canvas=$('<canvas id="'+this.CANVAS_ID+'" width="'+this.OUTPUT_IMAGE_SIZE+'" height="'+this.OUTPUT_IMAGE_SIZE+'" data-caman-hidpi-disabled="true"></canvas>'),this.__canvasContext=this.__$canvas.get(0).getContext("2d"),this.$el.append(this.__$canvas)},setOverlay:function(e){_.each(this.__overlays,function(t,i){t.$el.toggle(i===e)})},__createOverlays:function(){this.__overlays={},_.each({avatar:e.AvatarOverlay,paint:e.PaintOverlay},function(e,t){this.__overlays[t]=this.createChildContext(e,{$parentElement:this.$(".overlays"),canvasModel:this.__canvasModel})}.bind(this))},__clear:function(){this.__canvasContext.fillStyle="white",this.__canvasContext.fillRect(0,0,this.OUTPUT_IMAGE_SIZE,this.OUTPUT_IMAGE_SIZE)},ready:function(){return!!this.__ready||(_.every(["renderedImageUrl","poseView"],function(e){return this.__canvasModel.getLayerAttr("avatar",e)}.bind(this))&&(this.__ready=!0,this.$el.removeClass("loading")),this.__ready)},__refresh:function(){if(this.ready())if(this.__refreshing)this.__refreshQueued=!0;else{this.__refreshing=!0;var e,t=[];if(_.each(this.__canvasModel.get("layers"),function(e){t[e.zIndex]=e}.bind(this)),this.trigger("postable",!1),this.$el.addClass("refreshing"),null!==this.__chokeholdLayer&&t[this.__chokeholdLayer].canvasChokehold){var i=t[this.__chokeholdLayer];e=this.__renderers[i.type].incrementalRender(i)}else this.__clear(),this.__chokeholdLayer=null,e=this.__Promise.accept(),_.each(t,function(t,i){if(null===this.__chokeholdLayer){var a=this.__renderers[t.type];if(a&&!t.disabled){var n=function(){return a.render(t)};e=e.then(n,n)}t.canvasChokehold&&(this.__chokeholdLayer=i)}}.bind(this));e.then(this.__finishRefresh.bind(this),this.__finishRefresh.bind(this))}},__finishRefresh:function(){this.__refreshing=!1,this.$el.removeClass("refreshing"),this.__refreshQueued?(this.__refreshQueued=!1,this.__refresh()):this.trigger("postable",!0)},showIndicatorIcon:function(){this.$(".mode-indicator-icon").addClass("show"),this.__timer.clearTimeout(this.__indicatorIconTimerId),this.__indicatorIconTimerId=this.__timer.setTimeout(function(){this.$(".mode-indicator-icon").removeClass("show")}.bind(this),100)},toDataUrl:function(){return this.__$canvas.get(0).toDataURL("image/jpeg")},reset:function(){_.each(this.__overlays,function(e){e.reset()})},delete:function(){_.each(this.__renderers,function(e){e.delete()}),this.__timer.clearTimeout(this.__indicatorIconTimerId),t.prototype.delete.call(this)}})}({UiCore:e["@UiCore"],template:R,AvatarCanvasRenderer:j,BackgroundCanvasRenderer:B,FilterCanvasRenderer:V,PaintCanvasRenderer:q,AvatarOverlay:z,PaintOverlay:W}),Y=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="component-options">\n    <div class="component-option">\n\t<textarea tabindex="1" class="input-caption" maxlength="280" placeholder="Say something..." autofocus></textarea>\n    </div>\n</div>\n'},useData:!0})}(),X=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="simple-scroller-viewport"></div>\n<button class="btn btn-tertiary simple-scroller-right" disabled></button>\n<button class="btn btn-tertiary simple-scroller-left" disabled></button>'},useData:!0})}(),K=function(e){var t=0,i=e.UiCore.UiContext;return e.UiCore.UiContext.extend("SimpleScroller",{className:"simple-scroller disable-text-selection",uiContextName:"simple_scroller",keepGoingThreshold:50,dependencies:["$target","window","timer"],initialize:function(a){i.prototype.initialize.call(this,a),this.__instanceNumber=t++,this.__absoluteScrollBy=a.scrollBy||!1,this.__window=a.window,this.__autoRefresh=!!a.autoRefresh,this.__timer=a.timer,this.__$target=a.$target,this.__$target.parent(".simple-scroller-viewport").length||(this.template=a.template||e.template,this.addToDOM(),this._refreshScrollabilityCount=0,this.$(".simple-scroller-viewport").on("scroll.simple-scroller",this.refreshScrollability.bind(this)),this.$(".simple-scroller-left").on("click",this.scrollLeft.bind(this)),this.$(".simple-scroller-right").on("click",this.scrollRight.bind(this)),$(this.__window).on(this.__getEventNamespaceForThisInstance("resize"),this.refreshScrollability.bind(this)))},__getEventNamespaceForThisInstance:function(e){return e+".ss-"+this.__instanceNumber},delete:function(){$(this.__window).off(this.__getEventNamespaceForThisInstance("resize")),this.$(".simple-scroller-viewport").off(".simple-scroller"),this.__refreshTimer&&this.__timer.clearInterval(this.__refreshTimer),i.prototype.delete.call(this)},render:function(){this.$el.html(this.template),this.$(".simple-scroller-viewport").append(this.__$target),this.__$target.addClass("simple-scroller-target"),this.refreshScrollability(),this.__autoRefresh&&(this.__refreshTimer=this.__timer.setInterval(function(){this.$el.is(":visible")&&this.refreshScrollability()}.bind(this),300))},viewportWidth:function(){return this.$(".simple-scroller-viewport").outerWidth()},leftEdge:function(){return this.$(".simple-scroller-viewport").scrollLeft()},rightEdge:function(){return this.scrollWidth()-this.viewportWidth()-1},scrollWidth:function(){return this.$(".simple-scroller-viewport")[0].scrollWidth},scrollBy:function(){return this.__absoluteScrollBy||this.viewportWidth()/2},refreshLeftScrollability:function(){this.$(".simple-scroller-left").prop("disabled",0>=this.leftEdge())},refreshRightScrollability:function(){this.$(".simple-scroller-right").prop("disabled",this.leftEdge()>=this.rightEdge())},refreshScrollability:function(){this._refreshScrollabilityCount++,this.refreshLeftScrollability(),this.refreshRightScrollability()},scroll:function(e){this.$(".simple-scroller-viewport").animate({scrollLeft:"+="+e},150,this.refreshScrollability.bind(this))},scrollLeft:function(e){e=this.scrollBy(),this.leftEdge()-e<this.keepGoingThreshold&&(e*=2),this.scroll(-e)},scrollRight:function(e){e=this.scrollBy(),this.leftEdge()+e>this.rightEdge()-this.keepGoingThreshold&&(e*=2),this.scroll(e)},resetPosition:function(){this.$(".simple-scroller-viewport").scrollLeft(0),this.refreshScrollability()}})}({UiCore:e["@UiCore"],template:X}),Z=function(e){var t=e.BaseControlsPresenter;return t.extend("CaptionControlsPresenter",{uiContextName:"caption_controls_presenter",className:"caption-controls-presenter control-presenter",dependencies:[],initialize:function(e){t.prototype.initialize.call(this,e),this.__canvasPresenter=e.canvasPresenter,this.addToDOM()},render:function(){this.$el.html(e.template),e.NextUtil.DomHelper.enhanceTextarea(this.$(".input-caption"),280)}})}({BaseControlsPresenter:function(e){var t=e.UiCore.UiContext;return t.extend("BaseControlsPresenter",{activate:function(){this.show(),this.__scroller.refreshScrollability()},addToDOM:function(){t.prototype.addToDOM.call(this),this.__scroller=this.createChildContext(e.SimpleScroller,{$parentElement:this.$el,scrollBy:380,$target:this.$("ul")})},deactivate:function(){this.hide()},reset:function(){}})}({UiCore:e["@UiCore"],SimpleScroller:K}),NextUtil:e["@NextUtil"],template:Y}),J=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PhotoBoothCaptionDialog",{uiContextName:"photo_booth_caption_dialog",className:"photo-booth-caption-dialog dialog-type-B-flexible is-tall",dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:this.__post},{type:"click",selector:".save",name:"save",handler:this.__save},{type:"click",selector:".back",name:"back",handler:this.__back}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__mode=e.mode||"add",this.__stringManager=e.globalStringManager,this.title="edit"===this.__mode?this.__stringManager.get("dialog_photobooth_edit_title"):this.__stringManager.get("dialog_photobooth_caption_title"),this.__postCompleteDelay=e.postCompleteDelay||1e3,"edit"===this.__mode?this.model=e.model:this.__photoBooth=e.photoBooth,this.addToDOM()},postRender:function(){this.$(".dialog-body").html(e.template({})),"edit"===this.__mode?this.__postRenderEdit():this.__postRenderAdd()},__postRenderAdd:function(){this.__uploadCurtain=this.createChildContext(e.UploadCurtain,{$parentElement:this.$el,completeDelay:this.__postCompleteDelay}),this.$(".image-container").css("background-image","url("+this.__photoBooth.getImageUrl()+")"),this.createChildContext(e.CaptionControlsPresenter,{$parentElement:this.$(".controls-container")}),this.__photoBooth.on("exit",this.__photoBoothExit,this),this.__photoBooth.on("canPost",this.setPostStatus,this),this.setContent("auxHeader",this.$(".post-header-template").text())},__postRenderEdit:function(){this.createChildContext(e.FeedPhoto,_.extend({$parentElement:this.$(".canvas-container")},{model:this.model})),this.createChildContext(e.CaptionControlsPresenter,{$parentElement:this.$(".controls-container")}),this.$(".image-container").css("display","none"),this.$(".input-caption").val(this.model.get("payload.message")),this.$(".input-caption").trigger("refresh"),this.setContent("auxHeader",this.$(".save-header-template").text())},__post:function(){this.__uploadCurtain.show(),this.__photoBooth.post(this.$(".input-caption").val())},__photoBoothExit:function(){this.__uploadCurtain.hide(),this.promiseResolver.accept(),this.hide()},setPostStatus:function(e){this.$(".back").toggleClass("disabled",!e),this.$(".post").toggleClass("disabled",!e)},__save:function(){var e={payload:{id:this.model.relations.photo,message:this.$(".input-caption").val()},type:"photo"};this.model.save(e),this.hide()},__back:function(){this.hide()},delete:function(){t.prototype.delete.call(this)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:E,CanvasPresenter:G,CaptionControlsPresenter:Z,FeedPhoto:L,UploadCurtain:A}),Q=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="counts-container">\n    <a class="action-like-count">\n        <span class="count count-likes">0</span> Likes &#183;&nbsp;\n    </a>\n        <a class="action-comment-count">\n            <span class="count count-comments">0</span> Comments &#183;&nbsp;\n        </a>\n    <a class="action-tag-count">\n        <span class="count count-tags">0</span> Tags\n    </a>\n</div>\n<div class="actions-container bar">\n    <li class="action-more-container">\n        <button class="btn action-more">\n            ';return((n=(t.icon||e&&e.icon||i).call(e,"icon-more",{name:"icon",hash:{},data:a}))||0===n)&&(s+=n),s+='\n        </button>\n    </li>\n    <li class="action-like-container">\n        <a class="btn action-like">\n        <svg class="icon-like"><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-like-off"></svg>\n        <svg class="icon-liked"><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-like-on"></svg>\n        </a>\n    </li>\n    <li class="action-comment-container">\n        <a class="btn action-comment">\n            ',((n=(t.icon||e&&e.icon||i).call(e,"icon-comment-off",{name:"icon",hash:{},data:a}))||0===n)&&(s+=n),s+='\n        </a>\n    </li>\n    <li class="action-tag-container">\n        <a class="btn action-tag">\n            ',((n=(t.icon||e&&e.icon||i).call(e,"icon-tag",{name:"icon",hash:{},data:a}))||0===n)&&(s+=n),s+'\n        </a>\n    </li>\n    <li class="action-share-container">\n    </li> \n</div>'},useData:!0})}(),ee=function(t){var i={UiCore:e["@UiCore"],SafetyReportDialog:o}.SafetyReportDialog;return i.extend("ReportFeedItemDialog",{uiContextName:"report_feed_item_dialog",className:"report-feed-item-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager"],title:"report_post_title",text:"report_post_text",dropdownOptions:[],initialize:function(e){this.__model=e.model,this.dropdownOptions=[],"photo"===this.__model.get("type")?(this.dropdownOptions.push({label:"report_post_reason_inappropriate_image",value:"photo"}),this.__model.get("payload.message")&&this.dropdownOptions.push({label:"report_post_reason_inappropriate_caption",value:"caption"})):this.dropdownOptions.push({label:"report_post_reason_inappropriate_text",value:"text"}),i.prototype.initialize.call(this,e)}})}(),te=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PhotoBoothDialog",{uiContextName:"photo_booth_dialog",className:"photo-booth-dialog dialog-type-B-flexible is-tall",dependencies:["dialogManager","featureAccessManager","globalStringManager","modeManager"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:this.__post},{type:"click",selector:".next",name:"next",handler:this.__openCaptionDialog}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__stringManager=e.globalStringManager,this.title=e.title||this.__stringManager.get("dialog_photobooth_title"),this.__modeManager=e.modeManager,this.__overrideLookUrl=e.overrideLookUrl,_.has(this.__serviceProvider.services,"photoBooth")||_.has(e,"photoBooth")?(this.__photoBooth=e.photoBooth||this.__serviceProvider.get("photoBooth"),this.addToDOM()):module.run({PhotoBooth:"@PhotoBooth"},this.__completeInit.bind(this))},__completeInit:function(e,t){this.__photoBooth=this.__modeManager.createChildContext(e.PhotoBooth,{$parentElement:this.__modeManager.$el,overrideLookUrl:this.__overrideLookUrl}),this.__serviceProvider.register("photoBooth",this.__photoBooth),this.addToDOM()},postRender:function(){this.__photoBooth.attach(this.$(".dialog-body"),{overrideLookUrl:this.__overrideLookUrl}).then(function(){this.__featureAccessManager.canAddFeedCaptions()?this.setContent("auxHeader",this.$(".aux-header-template-2").text()):this.setContent("auxHeader",this.$(".aux-header-template").text())}.bind(this)),this.__photoBooth.on("exit",this.hide,this),this.__photoBooth.on("canPost",this.setPostStatus,this)},setPostStatus:function(e){this.$(".post").toggleClass("disabled",!e)},__post:function(){this.__photoBooth.post()},__openCaptionDialog:function(){this.__dialogManager.showDialog(e.PhotoBoothCaptionDialog,{photoBooth:this.__photoBooth}).finished.then(function(){this.hide()}.bind(this))},delete:function(){this.__photoBooth.detach(),this.__photoBooth.off(null,null,this),t.prototype.delete.call(this)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],PhotoBoothCaptionDialog:J}),ie={getTimeFormat:function(e,t){var i=Math.floor(e/3600),a=Math.floor(e/60)-60*i,n=e%60;t&&(n=n.toFixed(t));var s=10>n?"0":"";return i?i+":"+(10>a?"0":"")+a+":"+s+n:a+":"+s+n},formatCredits:function(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},zeroPad:function(e,t){return(Array(t).join("0")+e).substr(-t,t)},formatMini:function(e){for(var t=[{base:1e3,letter:"K"},{base:1e6,letter:"M"},{base:1e9,letter:"B"}],i=t.length-1;0<=i;i--){var a=t[i],n=a.base;if(e>=n)return(t=Math.floor(e/n))+((e=Math.floor((e-n*t)/(n/10)))?"."+e:"")+a.letter}return""+e}},ae=function(e){var t=e.UiCore.UiContext;return t.extend("FeedActionBar",{uiContextName:"feed_action_bar",tagName:"ul",className:"feed-action-bar bar",dependencies:"cardManager contextMenuManager dialogManager featureAccessManager globalStartupModel globalStringManager googleAnalytics loginManager modeManager platform rest restModelFactory timer".split(" "),trackedEvents:function(){return[{type:"click",selector:".action-more",name:"feed_item_menu",handler:this.__showActionMenu},{type:"click",selector:".action-tag",name:"feed_item_tag",handler:this.__triggerTags},{type:"click",selector:".action-tag-count",name:"feed_item_tag_count",handler:this.__triggerTagCount},{type:"click",selector:".action-like:not(.is-liked)",name:"feed_item_like",handler:this.__triggerLike},{type:"click",selector:".action-like.is-liked",name:"feed_item_like",handler:this.__triggerUnlike},{type:"click",selector:".action-like-count",name:"feed_item_like_count",handler:this.__triggerLikeCount},{type:"click",selector:".action-comment",name:"feed_item_comment",handler:this.__triggerComments},{type:"click",selector:".action-comment-count",name:"feed_item_comment_count",handler:this.__triggerCommentCount}]},initialize:function(e){this.uiAttributes={repeats:1},t.prototype.initialize.call(this,e),this.__imageManager=e.imageManager,this.__loginManager=e.loginManager,this.__modeManager=e.modeManager,this.__googleAnalytics=e.googleAnalytics,this.__contextMenuManager=e.contextMenuManager,this.__dialogManager=e.dialogManager,this.__globalStringManager=e.globalStringManager,this.__restModelFactory=e.restModelFactory,this.__reportUrl=e.globalStartupModel.get("safetyReportUrl"),this.__featureAccessManager=e.featureAccessManager,this.__rest=e.rest,this.__isAbbreviated=e.isAbbreviated,this.__feedType=e.feedType,this.__userProfileCard=!0===e.userProfileCard,this.__allCounts=new Backbone.Model({tags:0,likes:0,comments:0}),this.__allCounts.on("change",this.__onCountsChange,this),this.addToDOM(),this.model.on("change",this.__onModelChange,this)},delete:function(){t.prototype.delete.call(this),this.model.off(void 0,void 0,this),this.likedby&&this.likedby.off(void 0,void 0,this),this.commentsSummary&&this.commentsSummary.off(void 0,void 0,this),this.__timer.clearTimeout(this.__waitAtLeastTimeout)},__onCountsChange:function(){this.$(".action-tag-container, .action-tag-count").toggleClass("disabled",!this.__allCounts.get("tags")),this.$el.toggleClass("has-counts",0<this.__allCounts.get("tags")||0<this.__allCounts.get("likes")||0<this.__allCounts.get("comments"))},__postIsByMe:function(){return this.__loginManager.isLoggedIn()&&this.actor.id===this.__loginManager.getCurrentUser().id},__isStaff:function(){return!!this.__loginManager.isLoggedIn()&&this.__loginManager.getCurrentUser().get("is_staff")},__mayWhiteList:function(){return this.__featureAccessManager.hasWhitelistAccess()||this.__isStaff()},__isWhiteListed:function(){return void 0===this.model.relations.whitelist&&void 0!==this.model.relations.unwhitelist},__isUnWhiteListed:function(){return void 0!==this.model.relations.whitelist&&void 0===this.model.relations.unwhitelist},__getActionMenuItems:function(){var e=[];if(this.__postIsByMe())e.push({name:"delete",text:this.__globalStringManager.get("Delete"),handler:this.__deleteFeedItem.bind(this)}),this.__featureAccessManager.canAddFeedCaptions()&&"photo"===this.model.get("type")&&e.push({name:"edit",text:this.__globalStringManager.get("dialog_photobooth_edit_title"),handler:this.__editFeedItem.bind(this)});else{var t=(t=this.__modeManager.getCurrentMode())&&t.getCurrentSubmode()?t.getCurrentSubmode().id:void 0;this.__isWhiteListed()||"explore"===t||e.push({name:"report",text:this.__globalStringManager.get("Report"),handler:this.__reportFeedItem.bind(this)})}return this.__mayWhiteList()&&(this.__isUnWhiteListed()?e.push({name:"whitelist",text:this.__globalStringManager.get("Whitelist"),handler:this.__whitelist.bind(this)}):this.__isWhiteListed()&&e.push({name:"unwhitelist",text:this.__globalStringManager.get("Unwhitelist"),handler:this.__unwhitelist.bind(this)})),this.__whitelistedBy&&e.push({name:"whitelistedby",text:this.__globalStringManager.get("WhitelistedBy",{username:this.__whitelistedBy.get("username")}),handler:this.__onClickWhitelister.bind(this)}),e},__showActionMenu:function(t){t.stopPropagation(),this.__contextMenuManager.toggleMenu(t,e.ContextMenu,{items:this.__getActionMenuItems(),displayOptions:{above:!1,right:!0}})},__whitelist:function(){this.__rest.post(this.model.relations.whitelist,{}).then(function(){this.model.invalidate()}.bind(this)).catch(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("whitelist_error_title"),text:this.__globalStringManager.get("whitelist_error_text"),ok:this.__globalStringManager.get("OK")})}.bind(this))},__unwhitelist:function(){this.__rest.delete(this.model.relations.unwhitelist,{}).then(function(){this.model.invalidate()}.bind(this)).catch(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("whitelist_error_title"),text:this.__globalStringManager.get("unwhitelist_error_text"),ok:this.__globalStringManager.get("OK")})}.bind(this))},__invalidateRelatedFeedsAfterReporting:function(){this.__invalidateFeed(this.__loginManager.getCurrentUser(),"subscribed_feed"),this.__invalidateFeed(this.actor,"personal_feed")},__invalidateFeed:function(t,i){t.populated().then(function(){return t.getSingleEdge(i).populated()}.bind(this)).then(function(t){t.getEdgeCollection("elements",e.Model.FeedCollection).invalidate()}.bind(this))},__reportFeedItem:function(){this.__featureAccessManager.canReportFeedCaptions()?this.__dialogManager.showDialog(e.ReportFeedItemDialog,{model:this.model}).finished.then(function(e){}.bind(this)):this.__dialogManager.confirm({title:this.__globalStringManager.get("dialog_feed_report_post_title"),text:this.__globalStringManager.get("dialog_feed_report_post_text"),yes:this.__globalStringManager.get("Report"),no:this.__globalStringManager.get("Cancel"),termsOfService:!0}).finished.then(function(){this.__restModelFactory.createModel(this.__reportUrl,e.UiCore.NodeModel,{reason:this.model.get("type"),relations:{content:this.model.id}}).then(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("report_confirm_title"),text:this.__globalStringManager.get("report_confirm_text"),ok:this.__globalStringManager.get("report_confirm_done")}).finished.then(function(){this.trigger("item-reported")}.bind(this))}.bind(this),function(){this.__dialogManager.alert({title:this.__globalStringManager.get("report_error_title"),text:this.__globalStringManager.get("report_error_text"),ok:this.__globalStringManager.get("report_error_done")})}.bind(this))}.bind(this))},__deleteFeedItem:function(){this.__dialogManager.confirm({title:this.__globalStringManager.get("Delete Post"),text:this.__globalStringManager.get("Are you sure"),yes:this.__globalStringManager.get("Delete"),no:this.__globalStringManager.get("Cancel")}).finished.then(function(){this.model.destroy().then(function(){this.__modeManager.openMode({openDefaultView:!0,mode:{id:"feed"}})}.bind(this),function(){this.__dialogManager.alert({title:this.__globalStringManager.get("Network Error Title"),text:this.__globalStringManager.get("Network Error Text"),ok:this.__globalStringManager.get("Network Error Ok")})}.bind(this))}.bind(this))},__editFeedItem:function(){this.__dialogManager.showDialog(e.PhotoBoothCaptionDialog,{mode:"edit",model:this.model})},render:function(){var t=this.__allCounts.get("tags");this.model.populated().then(function(){this.__mayWhiteList()&&this.model.relations.whitelister&&this.model.getSingleEdge("whitelister").populated().then(function(e){this.__whitelistedBy=e}.bind(this)),this.actor=this.model.getSingleEdge("actor"),this.$el.html(e.template({canSeeShareWidget:this.__featureAccessManager.canSeeShareWidget()})),this.createChildContext(e.Widgets.SocialShare,{$parentElement:this.$(".action-share-container"),linkToCopy:this.__getShareLink()}),this.$el.toggleClass("is-abbreviated",!!this.__isAbbreviated),this.$(".action-tag-container, .action-tag-count").toggleClass("disabled",!t),this.__onModelChange(!1),this.$(".action-more").toggle(0<this.__getActionMenuItems().length).prop("disabled",!this.__loginManager.isLoggedIn())}.bind(this))},__onModelChange:function(){this.likedby&&this.likedby.off(void 0,void 0,this),this.likedby=this.model.searchEdgeCollection("liked_by",{limit:0},e.UiCore.EdgeCollection),this.likedby.on("add remove reset",this.__onLikeCollectionChange,this),this.__onLikeCollectionChange(),this.__isAbbreviated&&(this.commentsSummary&&this.commentsSummary.off(void 0,void 0,this),this.commentsSummary=this.model.getSummaryCollection("comments"),this.commentsSummary.on("update add remove reset",this.__onCommentsCollectionChange,this),this.__onCommentsCollectionChange(),"photo"===this.model.get("type")&&this.model.getSingleEdge("photo").populated().then(function(e){return e.getSingleEdge("photo_details").populated()}.bind(this)).then(function(e){this.__userTags=new IMVU.NamedCollection,_.each(e.get("users"),function(e){this.__userTags.add(this.__serviceProvider.create(IMVU.NamedModel,e))}.bind(this)),this.__allCounts.set("tags",this.__userTags.length),this.$(".count-tags").text(this.__userTags.length)}.bind(this)))},__onCommentsCollectionChange:function(){this.__allCounts.set("comments",this.commentsSummary.total_count)},__onLikeCollectionChange:function(){this.__allCounts.set("likes",this.likedby.total_count),this.$(".count-likes").text(e.FormatNumber.formatMini(this.likedby.total_count)),this.likedby.populated().then(function(){var e=null!==this.likedby.getMyEdge();if(!e&&this.__loginManager.isLoggedIn()){var t=this.__loginManager.getCurrentUser().id;_.each(this.likedby.models,function(i){i.node.id==t&&(e=!0)}.bind(this))}!0!==this.__pendingOptimisticLikeState&&!1!==this.__pendingOptimisticLikeState||(e=this.__pendingOptimisticLikeState,delete this.__pendingOptimisticLikeState),this.$(".action-like").toggleClass("is-liked",!!e)}.bind(this))},__waitAtLeast:function(e,t,i){0>(e-=new Date-t)&&(e=0),this.__timer.clearTimeout(this.__waitAtLeastTimeout),this.__waitAtLeastTimeout=this.__timer.setTimeout(i,e)},__triggerLike:function(){if(!this.__isLikeOrUnlikeInFlight){var e=new Date;this.__isLikeOrUnlikeInFlight=!0,this.__googleAnalytics.recordFeedItemAction("liked post"),this.__pendingOptimisticLikeState=!0,this.$(".action-like").addClass("is-liked"),this.model.like().catch(function(t){delete this.__pendingOptimisticLikeState,this.__waitAtLeast(1e3,e,function(){this.$(".action-like").removeClass("is-liked")}.bind(this))}.bind(this)).then(function(){this.__isLikeOrUnlikeInFlight=!1}.bind(this))}},__triggerUnlike:function(){if(!this.__isLikeOrUnlikeInFlight){var e=new Date;this.__isLikeOrUnlikeInFlight=!0,this.__googleAnalytics.recordFeedItemAction("unliked post"),this.__pendingOptimisticLikeState=!1,this.$(".action-like").removeClass("is-liked"),this.model.unlike().catch(function(t){delete this.__pendingOptimisticLikeState,this.__waitAtLeast(1e3,e,function(){this.$(".action-like").addClass("is-liked")}.bind(this))}.bind(this)).then(function(){this.__isLikeOrUnlikeInFlight=!1}.bind(this))}},__triggerLikeCount:function(){"mobile"===this.__platform?this.$(".action-like").hasClass("is-liked")?this.__triggerUnlike():this.__triggerLike():this.trigger("action-like-count")},__triggerComments:function(){this.trigger("action-comments")},__triggerCommentCount:function(){this.trigger("action-comment-count")},__triggerTags:function(){this.trigger("action-tags")},__triggerTagCount:function(){this.trigger("action-tag-count")},__onClickWhitelister:function(){this.__cardManager.showUserProfileCard({user:this.__whitelistedBy,context:"username",openContext:this})},__getShareLink:function(){var e=this.model.id.split("/");return this.__serviceProvider.get("siteRoot")+"feed/"+e.pop()}})}({UiCore:e["@UiCore"],Model:e["@Model"],Widgets:e["@Widgets"],template:Q,ContextMenu:g,FormatNumber:ie,PhotoBoothCaptionDialog:J,PhotoBoothDialog:te,ReportFeedItemDialog:ee}),ne=function(e){var t=e.UiCore.UiContext;return t.extend("FeedItem",{uiContextName:"feed_list_item",tagName:"article",className:"feed-item",dependencies:"contextMenuManager dialogManager featureAccessManager globalStartupModel globalStringManager googleAnalytics imageManager loginManager modeManager platform restModelFactory timer".split(" "),trackedEvents:function(){return[e.NextUtil.DomHelper.trackClickOrDouble({selector:".feed-item-container",clickName:"feed_item_click",doubleclickName:"feed_item_like",clickHandler:this.__triggerDetails.bind(this,!1),doubleclickHandler:this.__like}),{type:"click",selector:".count-comments, .comments-text-singular, .comments-text-plural",name:"feed_item_click",handler:this.__triggerDetails.bind(this,!1)},{type:"click",selector:".count-likes, .likes-text-singular, .likes-text-plural",name:"show_like_list",handler:this.__showLikeList}]},setViewType:function(e){this.__viewType=e},initialize:function(e){this.__featureAccessManager=e.featureAccessManager,this.uiAttributes={repeats:1},t.prototype.initialize.call(this,e),this.__imageManager=e.imageManager,this.__loginManager=e.loginManager,this.__modeManager=e.modeManager,this.__googleAnalytics=e.googleAnalytics,this.__dialogManager=e.dialogManager,this.__ignoreUserClicks=!!e.ignoreUserClicks,this.__feedType=e.feedType,this.__platform=e.platform,this.__timer=e.timer,this.__reportUrl=this.__globalStartupModel.get("safetyReportUrl"),this.__showHeader=IMVU.optionalProperty(e,"showHeader",!0),this.setViewType(e.viewType),this.addToDOM(),this.model.on("change",this.__onModelChange,this),this.on("shown",this.updateTextTruncation.bind(this))},delete:function(){t.prototype.delete.call(this),this.model.off(void 0,void 0,this),this.likedby&&this.likedby.off(void 0,void 0,this),this.commentsSummary&&this.commentsSummary.off(void 0,void 0,this)},updateTextTruncation:function(){"photo"!==this.model.node.get("type")&&e.NextUtil.DomHelper.truncateMultilineText(this.$(".message"),this.$(".more-indicator"))},setUseCase:function(e){void 0!==this.feedItemHeader&&(this.__featureAccessManager.canSeeFeedCaptions()&&this.$(".caption")[0]&&this.$(".caption").addClass("hidden"),this.feedItemHeader.setUseCase(e),this.__featureAccessManager.canSeeFeedCaptions()&&this.$(".caption")[0]&&this.$(".caption").toggleClass("hidden",!this.feedItemHeader.shouldShowCaption()))},render:function(){this.model.sorted()||this.$el.addClass("sorting"),this.model.populated().then(function(){this.actor=this.model.node.getSingleEdge("actor"),this.$el.removeClass("sorting");var t=(a=this.model.node).get("payload.message")||"",i="photo"===a.get("type"),a={id:a.id,img_src:a.get("payload.thumbnail_url"),is_photo:i,background_color:a.get("payload.background_color"),time:this.__serviceProvider.get("timestampHelper").formatSingleUnit(a.get("time")),canSeeFeedCaptions:this.__featureAccessManager.canSeeFeedCaptions()};this.$el.html(e.template(a)),this.$el.attr("data-item",a.id),this.__showHeader&&(this.feedItemHeader=this.createChildContext(e.FeedItemHeader,{model:this.model.node,$replaceElement:this.$(".feed-item-header-placeholder"),ignoreUserClicks:this.__ignoreUserClicks,feedType:this.__feedType,viewType:this.__viewType,isList:this.__isList}));var n=this.createChildContext(e.FeedActionBar,{model:this.model.node,$replaceElement:this.$(".action-bar-placeholder"),feedType:this.__feedType,imageManager:this.__imageManager,isAbbreviated:!0});n.on("action-tags",this.__showProducts.bind(this)),n.on("action-tag-count",this.__showProducts.bind(this)),n.on("action-comments",this.__triggerDetails.bind(this,!0)),n.on("action-comment-count",this.__triggerDetails.bind(this,!0)),n.on("action-like-count",this.__showLikeList.bind(this)),n.on("item-reported",this.__onItemReported.bind(this)),i||(this.__userText=this.createChildContext(e.UserText,{$parentElement:this.$(".feed-item-text .message"),text:t})),a.is_photo?(i=this.$(".feed-item-photo > img"),this.__imageManager.load(i,a.img_src,{}).then(function(){}.bind(this)).catch(function(){}.bind(this)),this.__featureAccessManager.canSeeFeedCaptions()&&(this.__caption=this.createChildContext(e.ExpandingText,{$parentElement:this.$(".caption"),textValue:t}),this.listenTo(this.__caption,"helip",this.__toggleCaption.bind(this)),this.feedItemHeader&&(this.feedItemHeader.setUseCase(),this.$(".caption").toggleClass("hidden",!this.feedItemHeader.shouldShowCaption())))):this.updateTextTruncation(),this.__onModelChange()}.bind(this))},__onItemReported:function(){this.$el.hide()},__onModelChange:function(){this.commentsSummary&&this.commentsSummary.off(void 0,void 0,this),this.commentsSummary=this.model.node.getSummaryCollection("comments"),this.commentsSummary.on("update add remove reset",this.__onCommentsCollectionChange,this),this.__onCommentsCollectionChange(),this.likedby&&this.likedby.off(void 0,void 0,this),this.likedby=this.model.node.searchEdgeCollection("liked_by",{limit:0},e.UiCore.EdgeCollection),this.likedby.on("update add remove reset",this.__onLikeCollectionChange,this),this.__onLikeCollectionChange(),this.__caption&&"photo"===this.model.node.get("type")&&this.__caption.changeText(this.model.node.get("payload.message"))},__refreshExtensionBar:function(){var e=!!(this.likedby&&0+this.likedby.total_count),t=!!(this.commentsSummary&&0+this.commentsSummary.total_count);1==this.commentsSummary.total_count?(this.$(".comments-text-singular").show(),this.$(".comments-text-plural").hide()):(this.$(".comments-text-singular").hide(),this.$(".comments-text-plural").show()),e?1==0+this.likedby.total_count?(this.$(".likes-text-singular").show(),this.$(".likes-text-plural").hide()):(this.$(".likes-text-singular").hide(),this.$(".likes-text-plural").show()):this.$(".likes-text-singular").hide(),this.$(".extension-bar").toggleClass("has-likes-or-comments",e||t)},__onCommentsCollectionChange:function(){this.$(".count-comments").text(e.FormatNumber.formatMini(this.commentsSummary.total_count)),this.__refreshExtensionBar()},__onLikeCollectionChange:function(){this.$(".count-likes").text(e.FormatNumber.formatMini(this.likedby.total_count)),this.likedby.populated().then(this.__refreshExtensionBar.bind(this))},__showLightbox:function(e){this.__dialogManager.showLightbox("FeedLightbox",_.extend({model:this.model.node,feedType:this.__feedType},e||{}))},__triggerDetails:function(e){this.__showLightbox({focusComments:!!e})},__showProducts:function(){this.__showLightbox({tab:"tags"})},__showLikeList:function(){this.__showLightbox({tab:"likes"})},__like:function(){this.model.node.like(),e.NextUtil.DomHelper.applyTemporaryClass(this.__timer,this.$(".feed-item-container"),"liking",1e3)},__toggleCaption:function(){this.$(".caption").toggleClass("open")}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],ContextMenu:g,ExpandingText:P,FeedActionBar:ae,FeedItemHeader:U,FormatNumber:ie,UserText:I,template:M}),se=function(e){var t=e.Widgets.AdsListPresenter;return t.extend("Feed",{uiContextName:"feed_list",className:"feed",tagName:"section",dependencies:["globalStringManager","Promise"],triggerNextPage:3,initialize:function(i){this.itemFactory=i.itemFactory||e.FeedItem,i.firstAdPositionInColumnView=8,i.showAdEveryNItemsInColumnView=7,i.firstAdAfterNRow=3,i.showAdAfterEveryNRowsInGridView=3,t.prototype.initialize.call(this,i)},onAdd:function(e){t.prototype.onAdd.apply(this,arguments),this.__setUseCase()},refresh:function(){this.collection.invalidate(),this.collection.reset()},onReset:function(e,i){var a=this.collection.length,n=function(){0===--a&&(t.prototype.onReset.call(this,e,i),this.__onScroll())}.bind(this);_.each(this.collection.models,function(e){e.populated().then(n,n)})},onInitError:function(){t.prototype.onInitError.call(this),this.trigger("initError")},onPageError:function(e){window.console.log("Feed Error:",e),t.prototype.onPageError.call(this,e),this.trigger("pageError")},setViewType:function(e){this.__viewType=e},__setUseCase:function(){void 0!==this.__viewType&&_.each(this.__childContexts,function(e){switch(this.__viewType){case"grid":e.setUseCase("FeedToggleToGrid");break;case"column":e.setUseCase("FeedToggleToColumn")}}.bind(this))},refreshSize:function(e){this.__maybePage(),this.setViewType(e),_.each(this.__childContexts,function(e){e.updateTextTruncation()}),this.__setUseCase(),e&&this.__rearrangeAdSlots(this.__viewType)},__emptyText:function(){return{standard:this.__globalStringManager.get("No posts"),concise:this.__globalStringManager.get("No posts")}},__refreshPage:function(){this.$(".collection-error").remove(),this.__noVisibilityChecks=!1,this.refresh()}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],FeedItem:ne}),oe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<a href="#" class="header-button save-profile">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Save",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</a>"},useData:!0})}(),re=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,r='\n<div class=\'profile\'>\n    <fieldset>\n        <div class="change-profile background-container">\n            <div class="profile-icon-placeholder"></div>\n            <form class="customProfileImage">\n                <label class="change-profile-image" for="custom-profile-image">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"change profile image",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</label>\n                <input class="change-profile-image-input" type="file" accept="image/*" name="custom-profile-image" id="custom-profile-image" />\n            </form>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'edit-profile-header\'>',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"name",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</legend>\n        <div class=\'edit-profile-attribute displayName\'>\n            <textarea id="display_name" type="text" class="value" placeholder="',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"display name",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+="\"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"age",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</legend>\n        <div class="edit-profile-attribute background-container show-label">\n            <input id=\'profile-checkbox-show-age\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_age" data-pref-default=1>\n            <label id="display-age-toggle" for=\'profile-checkbox-show-age\'>\n                <div>\n                    ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"show age",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+="<br>\n                    <span class='description'>"+o("function"==typeof(s=t.age_description||e&&e.age_description)?s.call(e,{name:"age_description",hash:{},data:a}):s)+' <a class="help-center" href="https://help.imvu.com" target="_blank">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"help center",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+=".</a></span>\n                </div>\n            </label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"gender",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+="</legend>\n        <div class='edit-profile-attribute gender show-label background-container'>\n            <input id='profile-checkbox-show-gender' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_gender\" data-pref-default=1><label for='profile-checkbox-show-gender'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"show gender",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</label>\n        </div>\n        <div class="separator"/>\n        <div class=\'edit-profile-attribute gender\'>\n            <select id="gender" class="value"></select>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'edit-profile-header\'>',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"location",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+="</legend>\n        <div class='edit-profile-attribute geo-location show-label background-container'>\n            <input id='profile-checkbox-show-geo-location' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_geo_location\" data-pref-default=1><label for='profile-checkbox-show-geo-location'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"show location",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</label>\n        </div>\n        <div class="separator"/>\n        <div class=\'edit-profile-attribute location background-container\' id="location"></div>\n        <div class=\'location-container hidden\'>\n            <div class=\'edit-profile-attribute country\'>\n                <select id="country" class="value"></select>\n            </div>\n             <div class="separator"/>\n            <div class=\'edit-profile-attribute state not-applicable\'>\n                <select id="state" class="value"></select>\n            </div>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'edit-profile-header\'>',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"bio",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</legend>\n        <div class=\'edit-profile-attribute tagline\'>\n            <textarea id="tagline" type="text" class="value" placeholder="',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"profile_bio",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+="\"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"interests",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</legend>\n        <div class=\'edit-profile-attribute interests\'>\n            <textarea id="interests" class="value" placeholder="',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"profile_interests",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+="\"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"affinity",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+="</legend>\n        <div class='edit-profile-attribute relationship_status affinity'>\n            <span class=\"descriptor\">",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"relationship",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+=':</span>\n            <select id="relationship_status" class="value"></select>\n        </div>\n        <div class="separator"/>\n        <div class=\'edit-profile-attribute looking_for affinity\'>\n            <span class="descriptor">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"here for",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+':</span>\n            <select id="looking_for" class="value"></select>\n        </div>\n    </fieldset>\n\n</div>\n'},3:function(e,t,i,a){var n;return i='\n<div class=\'profile\'>\n    <fieldset>\n        <legend class=\'system-info-header\'>Profile Photo</legend>\n        <div class="drawer-profile large-profile background-container">\n            <div class="profile-icon-placeholder"></div>\n            <div class=\'related-pref\'>\n                <form class="customProfileImage">\n                    <label class="change-icon change-profile-image" for="custom-profile-image">Change</label>\n                    <input class="change-profile-image-input" type="file" accept="image/*" name="custom-profile-image" id="custom-profile-image" />\n                </form>\n            </div>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Name</legend>\n        <div class=\'edit-profile-attribute displayName\'>\n            <textarea id="display_name" type="text" class="value" placeholder="Type something"></textarea>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend class=\'system-info-header\'>Avatar Name</legend>\n        <div class=\'edit-profile-attribute avatarName background-container\' id=\'username\'></div>\n    </fieldset>\n    <fieldset>\n        <legend class=\'system-info-header\'>Tagline</legend>\n        <div class=\'edit-profile-attribute tagline\'>\n            <textarea id="tagline" type="text" class="value" placeholder="Type something"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Chat Room</legend>\n        <div class="background-container">\n            <input id=\'profile-checkbox-show-chat-room\' type="checkbox" class="toggle-switch" data-pref="client.is_current_location_hidden" data-pref-invert=1><label for=\'profile-checkbox-show-chat-room\'>Show Chat Room Location</label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Age</legend>\n        <div class="edit-profile-attribute background-container age-container">\n            <div class=\'age\'></div>\n        </div>\n        <div class="edit-profile-attribute background-container show-label">\n            <input id=\'profile-checkbox-show-age\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_age" data-pref-default=1><label id="display-age-toggle" for=\'profile-checkbox-show-age\'>Show Age</label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Gender</legend>\n        <div class=\'edit-profile-attribute gender\'>\n            <select id="gender" class="value"></select>\n        </div>\n        <div class=\'edit-profile-attribute gender show-label background-container\'>\n            <input id=\'profile-checkbox-show-gender\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_gender" data-pref-default=1><label for=\'profile-checkbox-show-gender\'>Show Gender</label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Location</legend>\n        <div class=\'edit-profile-attribute country\'>\n            <select id="country" class="value"></select>\n        </div>\n        <div class=\'edit-profile-attribute state not-applicable\'>\n            <select id="state" class="value"></select>\n        </div>\n        ',((n=t.if.call(e,e&&e.canHideGeoLocation,{name:"if",hash:{},fn:this.program(4,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+'\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Interests</legend>\n        <div class=\'edit-profile-attribute interests\'>\n            <textarea id="interests" class="value" placeholder="Type something"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Affinity</legend>\n        <div class=\'edit-profile-attribute relationship_status affinity\'>\n            <span class="descriptor">Relationship:</span>\n            <select id="relationship_status" class="value"></select>\n        </div>\n\n        <div class=\'edit-profile-attribute looking_for affinity\'>\n            <span class="descriptor">Looking For:</span>\n            <select id="looking_for" class="value"></select>\n        </div>\n    </fieldset>\n\n</div>\n<footer class="dialog-footer">\n    <button class="btn btn-primary submit" disabled></button>\n</footer>\n'},4:function(){return"\n            <div class='edit-profile-attribute geo-location show-label background-container'>\n                <input id='profile-checkbox-show-geo-location' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_geo_location\" data-pref-default=1><label for='profile-checkbox-show-geo-location'>Show Location</label>\n            </div>\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i="",((n=t.if.call(e,e&&e.canSeeNewEditProfileDesign,{name:"if",hash:{},fn:this.program(1,a),inverse:this.program(3,a),data:a}))||0===n)&&(i+=n),i+'\n<option class="dropdown-item hidden"></option>\n\n'},useData:!0})}(),le=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<footer class="dialog-footer">\n    <a href="javascript:;" class="post footer-post-btn btn btn-primary"></a>\n</footer>'},useData:!0})}(),he=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="back-button"></div>'},useData:!0})}(),de=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("EditProfileImageDialog",{uiContextName:"edit_profile_image_dialog",className:"edit-profile-image-dialog dialog-type-B can-dismiss",dependencies:["globalStringManager","dialogManager","modeManager","timer"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:this.__post},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__stringManager=e.globalStringManager,this.title=this.__stringManager.get("dialog_edit_profile_image_title"),this.__file=IMVU.requireProperty(e,"file",null),this.__modeManager=e.modeManager,_.has(this.__serviceProvider.services,"editProfileImage")||_.has(e,"editProfileImage")?(this.__editProfileImage=e.editProfileImage||this.__serviceProvider.get("editProfileImage"),this.addToDOM()):module.run({EditProfile:"@EditProfileImage"},this.__completeInit.bind(this))},__completeInit:function(e,t){this.__editProfileImage=this.__modeManager.createChildContext(e.EditProfile,{$parentElement:this.__modeManager.$el}),this.__serviceProvider.register("editProfileImage",this.__editProfileImage),this.addToDOM()},postRender:function(){this.setContent("body",e.template),"mobile"===this.serviceProvider.get("platform")&&(this.$(".dialog-header").prepend(e.backButtonTemplate({})),this.$(".dialog-x").remove()),this.$post=this.$(".footer-post-btn").text(this.__stringManager.get("dialog_profile_image_edit_post")),this.__editProfileImage.attach(this.$(".dialog-body")),this.__editProfileImage.restoreScrollValues(),this.__editProfileImage.on("exit",this.hide,this),this.__editProfileImage.on("uploadError",this.__uploadError,this),this.__editProfileImage.on("canPost",this.setPostStatus,this),this.__editProfileImage.changeCustomProfile(this.__file)},__uploadError:function(){this.__timer.setTimeout(function(){this.promiseResolver.resolve(!0),this.__dialogManager.alert({title:this.__stringManager.get("dialog_edit_profile_invalid_image_title"),text:this.__stringManager.get("dialog_edit_profile_invalid_image_text")})}.bind(this),0)},setPostStatus:function(e){this.$post.toggleClass("disabled",!e)},__post:function(){this.__editProfileImage.post()},delete:function(){this.__editProfileImage.reset(),this.__editProfileImage.saveScrollValues(),this.__editProfileImage.detach(),this.__editProfileImage.off(null,null,this),t.prototype.delete.call(this)},__goBack:function(){this.promiseResolver.resolve(!0)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:le,backButtonTemplate:he}),ce=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="dropdown-label is-truncated"><span>&nbsp;</span></div>\n<div class="dropdown-option-list-container">\n    <div class="dropdown-scroll-up"></div>\n    <div class="dropdown-scroll-down"></div>\n    <ul class="dropdown-option-list">\n        <li class="dropdown-option is-truncated" data-value="" tabindex="-1"></li>\n    </ul>\n</div>\n'},useData:!0})}(),_e=function(e){function t(e){e=$(e.target).closest(".dropdown"),$(".dropdown").not(e).each(function(e,t){$(t).data("dropdown-instance").__hide()})}var i=e.UiCore.UiContext,a=e.NextUtil.Keys;return i.extend("Dropdown",{globalSetup:function(){document.addEventListener("click",t,!0),document.addEventListener("touchend",t,!0)},globalTearDown:function(){document.removeEventListener("click",t,!0),document.removeEventListener("touchend",t,!0)},uiContextName:"dropdown",className:"dropdown disable-text-selection",ITEM_HEIGHT:40,AUTO_SCROLL_BY:2,dependencies:["window","timer"],trackedEvents:function(){return[{type:"click",selector:".dropdown-label",name:"dropdown_label_click",handler:"toggleOpen"},{type:"click",selector:".dropdown-option",name:"dropdown_option_click",handler:"clickOption"},{type:"keydown",selector:"",name:"dropdown_keydown",handler:this.__onKeydown.bind(this,[])},{type:"mousemove",selector:".dropdown-option",name:"dropdown_option_mouseenter",handler:this.__onMousemove.bind(this,{x:0,y:0})},{type:"mouseenter",selector:".dropdown-label",name:"dropdown_label_mouseenter",handler:"__onMouseenterLabel"},{type:"mouseenter",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseenter",handler:"__onScrollUpMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseleave",handler:"__onScrollUpMouseleave"},{type:"mouseenter",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseenter",handler:"__onScrollDownMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseleave",handler:"__onScrollDownMouseleave"}]},__onMousemove:function(e,t){e.x==t.screenX&&e.y==t.screenY||(e.x=t.screenX,e.y=t.screenY,this.$el.focus(),this.setActiveElement($(t.target)))},__onBlur:function(e){this.$el.removeClass("is-open")},__onMouseenterLabel:function(e){this.$(".is-selected").removeClass("is-selected")},initialize:function(e){if(this.$select=IMVU.requireProperty(e,"$replaceElement"),!this.$select.is("select"))throw Error("$replaceElement must be a <select> element. got: "+this.$select[0].tagName);if(this.$select.closest("label").length)throw Error("do not wrap custom dropdowns with <label> tags; it disrupts event handling");i.prototype.initialize.call(this,e),this.window=e.window,this.timer=e.timer,this.boundingBox=e.boundingBox||this.getDefaultBoundingBox(),this.document=e.document||document,this.__keyArray=[],(this.dismissOnScroll=e.dismissOnScroll)&&$(e.dismissOnScroll).on("scroll.dropdown",function(){this.__hide()}.bind(this)),$(".dropdown-layer").length||$("body").append('<div class="dropdown-layer"/>'),this.$dropdownLayer=$(".dropdown-layer"),e.dimNoValue&&this.$el.addClass("dim-no-value"),this.$el.data("dropdown-instance",this),this.addToDOM()},delete:function(){this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray),this.dismissOnScroll&&$(this.dismissOnScroll).off("scroll.dropdown"),$(this.window).off("resize.dropdown"),i.prototype.delete.call(this)},__onHidden:function(){this.$el.is(":visible")&&this.remove(),i.prototype.__onHidden.apply(this,arguments)},getDefaultBoundingBox:function(){var e=this.$el.position().top-5*this.ITEM_HEIGHT,t=e+11*this.ITEM_HEIGHT;return 0>e&&(e=0),t>$(this.window).height()&&(t=$(this.window).height()),{x:0,y:e,w:$(this.window).width(),h:t-e}},render:function(){this.$placeholder=$("<div/>"),this.$el.html(e.template),this.$label=this.$(".dropdown-label"),this.$optionList=this.$(".dropdown-option-list"),this.$optionListContainer=this.$(".dropdown-option-list-container");var t=this.$optionList.find(".dropdown-option");this.$select.addClass("is-enhanced"),this.refreshLabel(this.$select.find(":selected")),t.remove(),this.$select.children().each(function(e,i){var a=t.clone(!0);a.text($(i).text()),a.attr("data-text",$(i).text().toLowerCase()),a.attr("data-value",$(i).val()),this.$optionList.append(a)}.bind(this)),this.$el.addClass(this.$select[0].className).removeClass("dropdown-template").addClass("dropdown"),this.$label.append(this.$select),this.$el.attr("tabindex",this.$select.attr("tabindex")||"0"),this.$select.attr("tabindex",-1),this.$optionList.on("scroll",this.__onScroll.bind(this)),this.$select.on("change",this.__changedOption.bind(this)),this.$el.addClass("is-ready")},__fullHeight:function(){return this.$select.children().length*this.ITEM_HEIGHT},__getSelectedIndex:function(){return this.$select[0].selectedIndex},__getTopEdgeInViewport:function(e){return e.offset().top-$(this.document).scrollTop()},__getComputedInfo:function(){var e=this.__getTopEdgeInViewport(this.$el),t=this.__fullHeight(),i=this.__getSelectedIndex()*this.ITEM_HEIGHT,a=this.getDefaultBoundingBox().y,n=this.getDefaultBoundingBox().y+this.getDefaultBoundingBox().h,s=e-i,o=s+t,r=0;return s<a&&(s=a),o>n&&(r=o-n,o=n,s>a&&(s-=Math.min(s-a,r))),{projectedTopDiff:s-e,computedHeight:o-s,selectedTop:i,maxTop:a,maxBottom:n,fullHeight:t}},__refreshScrollers:function(){var e=this.$optionList[0].scrollHeight-this.$optionList.innerHeight(),t=0<this.$optionList.scrollTop();e=Math.round(this.$optionList.scrollTop())<e;this.$el.toggleClass("can-scroll-up",t).toggleClass("can-scroll-down",e)},isOpen:function(){return this.$el.hasClass("is-open")},__hide:function(){this.isOpen()&&($(this.window).off("resize.dropdown"),this.$el.removeClass("is-open"),this.$placeholder.before(this.$el).detach(),this.$el.removeAttr("style"))},__show:function(){if(!this.isOpen()){$(this.window).on("resize.dropdown",t);var e=this.$el.offset(),i=this.$el.width(),a=this.$el.height(),n=this.$el.css("margin-left"),s=this.$el.css("margin-right"),o=this.$el.css("margin-top"),r=this.$el.css("margin-bottom"),l=this.$el.css("float");this.$placeholder.css({width:i,height:a,"margin-left":n,"margin-right":s,"margin-top":o,"margin-bottom":r,float:l}),this.$el.addClass("is-open").css({top:this.__getTopEdgeInViewport(this.$el),left:e.left,width:i,height:a,"margin-left":0,"margin-right":0,"margin-top":0,"margin-bottom":0}),this.$el=this.$el.before(this.$placeholder).detach(),this.$dropdownLayer.append(this.$el)}},toggleOpen:function(e){return this.isOpen()?this.__hide():(this.__show(),e=this.__getComputedInfo(),this.$optionListContainer.css({top:e.projectedTopDiff,height:e.computedHeight}),this.$el.focus(),e=e.selectedTop+e.projectedTopDiff,this.$optionList.scrollTop(e),this.__lastScrollTop=e,this.setActiveElement(this.$(".dropdown-option").eq(this.__getSelectedIndex())),this.__refreshScrollers()),!1},refreshLabel:function(e){this.$label.find("> span").text(e.text()).toggleClass("no-value",""===e.val())},clickOption:function(e){this.__hide(),this.$select.val($(e.target).attr("data-value")),this.$select.trigger("change"),t(e)},selectByValue:function(e){this.$(".is-selected").removeClass("is-selected"),this.$('.dropdown-option[data-value="'+e+'"]').addClass("is-selected"),this.$("select").val(e),e=this.$("select").find(":selected"),this.refreshLabel(e)},val:function(){return this.$("select").val()},__changedOption:function(e){e=$(e.target).find(":selected"),this.refreshLabel(e)},__maybeScrollOptionIntoView:function(e,t){if(e[0]){var i=this.$el.hasClass("can-scroll-up"),a=this.$el.hasClass("can-scroll-down"),n=this.$optionList,s=n.height(),o=n.offset().top,r=o+s,l=e.outerHeight(),h=e.offset().top,d=h+l,c=h-o+n.scrollTop(),_=s/2-l/2*3;h<o+(i?l:0)?(t&&(c-=_),n.scrollTop(c-(i?this.ITEM_HEIGHT:0))):d>r-(a?l:0)&&(t&&(c+=_),n.scrollTop(c-(s-l)+(a?l:0)))}},__open:function(t){return this.isOpen()&&this.$select.val(this.$optionList.find(".is-selected").attr("data-value")).change(),this.toggleOpen(t),t=this.$optionList.children().eq(this.$select[0].selectedIndex),e.NextUtil.DomHelper.radioClass(t,"is-selected"),t},__moveSelection:function(t){return 0>(t=this.$optionList.children().index(this.$optionList.find(".is-selected"))+t)?t=0:t>this.$select.children().length-1&&(t=this.$select.children().length-1),t=this.$optionList.children().eq(t),e.NextUtil.DomHelper.radioClass(t,"is-selected"),t},setActiveElement:function(t){this.__activeElement=t,e.NextUtil.DomHelper.radioClass(t,"is-selected")},__onKeydown:function(i,n){if(!this.isOpen()&&a.is(n,"VK_ENTER")||!this.isOpen()&&a.is(n,"VK_DOWN"))t(this.$el),this.__open(n);else{var s=this.__activeElement&&this.__activeElement.parent()[0]===this.$optionList[0]?this.__activeElement:this.$(".dropdown-option").first();if(a.is(n,"VK_DOWN"))this.__maybeScrollOptionIntoView(s.next()),s.next()[0]&&this.setActiveElement(s.next());else if(a.is(n,"VK_UP"))this.__maybeScrollOptionIntoView(s.prev()),s.prev()[0]&&this.setActiveElement(s.prev());else if(a.is(n,"VK_ENTER"))this.__hide(),this.$select.val(this.__activeElement.attr("data-value")),this.$select.trigger("change"),t(n);else if(a.is(n,"VK_ESC"))t(this.$el);else{var o=a.getAlphaNumericChar(n);if(!1!==o){var r=s[0];this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray),i.push(o);var l=i.join("").toLowerCase();for(this.__keyValueArray=this.timer.setTimeout(function(){i.length=0}.bind(this),1e3);r.nextSibling;)if(r=r.nextSibling,(o=$(r)).attr("data-text")[0]&&e.NextUtil.string.startsWith(o.attr("data-text"),l))return this.isOpen()||this.toggleOpen(n),this.setActiveElement(o),void this.__maybeScrollOptionIntoView(o,o[0]!=s[0].nextSibling&&o[0]!=s[0].prevSibling);for(r=this.$(".dropdown-option")[0];r&&r!=s[0];){if((o=$(r)).attr("data-text")[0]&&e.NextUtil.string.startsWith(o.attr("data-text"),l)){this.isOpen()||this.toggleOpen(n),this.setActiveElement(o),this.__maybeScrollOptionIntoView(o,o[0]!=s[0].nextSibling&&o[0]!=s[0].prevSibling);break}r=r.nextSibling}}}}},__onScroll:function(e){e=this.$optionList.scrollTop(),this.__refreshScrollers(),this.__lastScrollTop=e},__doScrollUp:function(e,t){var i=this.__getComputedInfo(),a=void 0===t?this.AUTO_SCROLL_BY:t;if(this.$optionListContainer.offset().top+this.$optionListContainer.height()+a<i.maxBottom){var n=this.$optionListContainer.height()+a;n>i.fullHeight&&(n=i.fullHeight),this.$optionListContainer.css({height:n}),this.$optionList[0].scrollTop-=a,this.__refreshScrollers(this.$dropdown)}else void 0===t&&(this.$optionList[0].scrollTop-=this.AUTO_SCROLL_BY)},__onScrollUpMouseenter:function(e){this.timer.clearInterval(this.__autoScrollInterval),this.__autoScrollIntervalCounter=0,this.__autoScrollInterval=this.timer.setInterval(function(){this.__doScrollUp(e)}.bind(this),1)},__onScrollUpMouseleave:function(e){this.timer.clearInterval(this.__autoScrollInterval)},__doScrollDown:function(e,t){var i=this.__getComputedInfo(),a=void 0===t?this.AUTO_SCROLL_BY:t;if((s=this.$optionListContainer.offset().top-a)>i.maxTop){var n=this.$optionListContainer.height()+a,s=this.$optionListContainer.position().top-a;n>i.fullHeight?n=i.fullHeight:this.$optionListContainer.css({top:s}),this.$optionListContainer.css({height:n}),this.$optionList[0].scrollTop+=a,this.__refreshScrollers(this.$dropdown)}else void 0===t&&(this.$optionList[0].scrollTop+=this.AUTO_SCROLL_BY)},__onScrollDownMouseenter:function(e){this.timer.clearInterval(this.__autoScrollDownInterval),this.__autoScrollDownIntervalCounter=0,this.__autoScrollDownInterval=this.timer.setInterval(function(){this.__doScrollDown(e)}.bind(this),1)},__onScrollDownMouseleave:function(e){this.timer.clearInterval(this.__autoScrollDownInterval)}})}({UiCore:e["@UiCore"],template:ce,NextUtil:e["@NextUtil"]}),ge=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("EditProfileDialog",{uiContextName:"edit_profile_dialog",className:"edit-profile-dialog dialog-type-B",dependencies:"dialogManager featureAccessManager globalStringManager loginManager platform prefsManager Promise".split(" "),trackedEvents:function(){return[{type:"change",selector:".change-profile-image-input",name:"change_profile_image",handler:this.__changeProfileImage},{type:"click",selector:"button.submit",name:"submit",handler:this.__submitChanges},{type:"click",selector:"button.cancel",name:"cancel",handler:this.__cancel},{type:"click",selector:".save-profile",name:"submit",handler:this.__submitChanges},{type:"change",selector:"#country",name:"country",handler:this.__handleCountryChange},{type:"change",selector:"#state",name:"state",handler:this.__handleFieldChange},{type:"click",selector:"#location",name:"location",handler:this.__showLocationDropdown},{type:"change",selector:"#gender",name:"gender",handler:this.__handleFieldChange},{type:"change",selector:"#looking_for",name:"looking_for",handler:this.__handleFieldChange},{type:"change",selector:"#relationship_status",name:"relationship_status",handler:this.__handleFieldChange},{type:"input",selector:"#display_name",name:"display_name",handler:this.__handleFieldChange,repeats:1},{type:"input",selector:"#interests",name:"interests",handler:this.__handleFieldChange,repeats:1},{type:"input",selector:"#tagline",name:"tagline",handler:this.__handleFieldChange,repeats:1},{type:"change",selector:"input[data-pref]",name:"preference",handler:this.__handleFieldChange,attributes:function(e){return{pref:e.data("pref")}}}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__stringManager=i.globalStringManager,this.__myself=i.loginManager.getCurrentUser(),this.__curtainDelay=i.curtainDelay||700,this.__canSeeNewEditProfileDesign=this.__featureAccessManager.canSeeProfileLightbox(),this.title=this.__stringManager.get("dialog_edit_profile_title"),this.userFieldsToPopulate="country state gender looking_for relationship_status tagline".split(" "),this.addToDOM(),this.__canSeeNewEditProfileDesign&&(this.$el.addClass("new-design"),this.$(".dialog-header").append(e.SaveButtonTemplate()),i=738<$(this.__window).width(),"desktop"===this.__platform||i)&&(this.$(".dialog-header").before(e.SaveButtonTemplate()),this.$(".dialog-x").addClass("cancel-button").text(this.__globalStringManager.get("Cancel")),this.$(".dialog-header").before(this.$(".dialog-title").addClass("title-outside")),this.$(".dialog-header").before(e.SaveButtonTemplate()),this.$(".dialog-container").addClass("no-header"))},postRender:function(){this.setContent("body",e.template({canSeeNewEditProfileDesign:this.__canSeeNewEditProfileDesign,age_description:this.__globalStringManager.get("age_description",{age:this.__myself.get("age")})})),this.$(".profile").scrollbar(),this.__setupDropDowns(),this.__canSeeNewEditProfileDesign?(e.NextUtil.DomHelper.enhanceTextarea(this.$("#tagline"),100,45),e.NextUtil.DomHelper.enhanceTextarea(this.$("#interests"),256,64),e.NextUtil.DomHelper.enhanceTextarea(this.$("#display_name"),30,45)):(e.NextUtil.DomHelper.enhanceTextarea(this.$("#tagline"),100),e.NextUtil.DomHelper.enhanceTextarea(this.$("#interests"),256),e.NextUtil.DomHelper.enhanceTextarea(this.$("#display_name"),30)),this.__uploadCurtain=this.createChildContext(e.UploadCurtain,{$parentElement:this.$el,completeDelay:this.__curtainDelay}),this.__myself.populated().then(function(){this.__profileIcon=this.createChildContext(e.Widgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.__myself}),this.__myself.get("is_adult")||this.$("#display-age-toggle").remove(),this.$(".age").text(this.__myself.get("age")),this.__populateUserFields(),this.__handleCountryChange(),this.__toggleHasChanges(!1)}.bind(this)),this.__prefsManager.populated().then(function(){this.__populatePrefs(),this.__toggleHasChanges(!1)}.bind(this))},__populatePrefs:function(){this.$("input[data-pref]").each(function(e,t){var i=$(t),a=this.__prefsManager.getBool(i.attr("data-pref"),!!i.attr("data-pref-default"));i.attr("data-pref-invert")&&(a=!a),i.prop("checked",a)}.bind(this))},__populateUserFields:function(){_.each(this.userFieldsToPopulate,function(e){var t=this.__myself.get(e);""!==t&&this.$("select#"+e).val(t).trigger("change")}.bind(this)),this.$("#username").text(this.__myself.get("username").replace("Guest_","")).trigger("input"),this.$("#location").text(this.__myself.get("country")+(this.__myself.get("state")?" - "+this.__myself.get("state"):"")),_.each(["display_name","interests","tagline"],function(e){""!==this.__myself.get(e)&&this.$("#"+e).val(this.__myself.get(e)).trigger("input")}.bind(this))},__setupDropDowns:function(){_.each(this.userFieldsToPopulate,function(t){var i=this.$("select#"+t);i.length&&(_.each(e.profileJSON[t],function(e,t){var a=this.$(".dropdown-item").clone().removeClass("hidden dropdown-item");i.append(a.attr("value",t).text(e))}.bind(this)),this.createChildContext(e.Dropdown,{$replaceElement:i,dismissOnScroll:this.$(".profile")}))}.bind(this))},__getPostData:function(){var e={gender:this.$("#gender").val(),country:this.$("#country").val(),relationship_status:this.$("#relationship_status").val(),looking_for:this.$("#looking_for").val(),interests:this.$("#interests").val(),tagline:this.$("#tagline").val(),display_name:this.$("#display_name").val()};return this.__countryIsUSA()&&(e.state=this.$("#state").val()),e},__changeProfileImage:function(t){this.__dialogManager.showDialog(e.EditProfileImageDialog,{file:t.target.files[0]}),this.$(".customProfileImage")[0].reset()},__submitChanges:function(){this.__removeMultipleConsecutiveSpaces(this.$("#display_name")),this.__uploadCurtain.show();var e=[this.__myself.save(this.__getPostData(),{error:this.__myself.invalidate.bind(this.__myself)})];this.$("input[data-pref]").each(function(t,i){var a=(s=$(i)).attr("data-pref"),n=s.prop("checked"),s=!!s.attr("data-pref-invert");e.push(this.__prefsManager.setBool(a,s?!n:n))}.bind(this)),this.__Promise.every(e).then(function(){this.__toggleHasChanges(!1),this.__uploadCurtain.complete()}.bind(this)).catch(function(e){var t=this.__stringManager.get("dialog_generic_save_error_text"),i="msg_blank msg_display_name_not_string msg_display_name_length msg_display_name_inappropriate msg_display_name_registered msg_display_name_wrapping_spaces msg_display_name_at_sign msg_display_name_persona msg_display_name_multiple_spaces".split(" ");e.message&&-1<i.indexOf(e.message)&&(t=this.__stringManager.get("edit_profile_error_"+e.message,{minimum:"1",maximum:"30"})),this.__uploadCurtain.hide(),this.__dialogManager.alert({title:this.__stringManager.get("dialog_generic_save_error_title"),text:t,ok:this.__stringManager.get("dialog_generic_save_error_ok")})}.bind(this)),this.__canSeeNewEditProfileDesign&&this.hide()},__toggleHasChanges:function(e){this.$("button.submit").prop("disabled",!e).text(e?this.__stringManager.get("dialog_edit_profile_save_changes"):this.__stringManager.get("dialog_edit_profile_saved"))},__handleFieldChange:function(){""!==this.$("#display_name").val()?this.__toggleHasChanges(!0):this.$("button.submit").prop("disabled",!0).text(this.__stringManager.get("dialog_edit_profile_save_changes"))},__removeMultipleConsecutiveSpaces:function(e){e.val(e.val().replace(/\s\s+/g," "))},__cancel:function(){this.hide(),this.promiseResolver.reject()},__countryIsUSA:function(){return"US"===this.$("#country").val()},__handleCountryChange:function(){this.$(".edit-profile-attribute.state").toggleClass("not-applicable",!this.__countryIsUSA()),this.__handleFieldChange()},__showLocationDropdown:function(){this.$("#location").toggleClass("hidden",!0),this.$(".location-container").toggleClass("hidden",!1)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],Widgets:e["@Widgets"],NextUtil:e["@NextUtil"],template:re,profileJSON:e["json!/common/pure/util/profile.json"],Dropdown:_e,UploadCurtain:A,EditProfileImageDialog:de,SaveButtonTemplate:oe}),pe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){return i=t.helperMissing,'<div class="subheader">\n    '+(0,this.escapeExpression)((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"WISHLIST",{name:"i18n-g",hash:{},data:a}))+'\n    <hr>\n</div>\n<div class="id-searchbox"></div>\n<div class="wish-list-container-container">\n    <div class="wish-list-container is-list">\n</div>'},useData:!0})}(),ue=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return'<form class="search">\n    <input type="text" placeholder="'+(0,this.escapeExpression)("function"==typeof(n=t.placeholder||e&&e.placeholder)?n.call(e,{name:"placeholder",hash:{},data:a}):n)+'">\n    <button class="btn btn-small" type="reset"></button>\n    <button class="btn btn-small" type="submit"></button>\n</form>'},useData:!0})}(),me=function(e){var t=e.UiCore.UiContext;return t.extend("SearchWidget",{uiContextName:"search_widget",className:"search-widget",dependencies:["stringManager"],initialize:function(i){this.__filterList=i.filterList,this.__stringManager=i.stringManager,this.__placeholder=this.__stringManager.get(i.placeholder),this.model=i.model||i.serviceProvider.create(e.Model.FilterModel,i.filterList,{}),t.prototype.initialize.call(this,i),this.addToDOM(),this.setInputToReflectModel(),i.showCategoryPlaceholder&&(this.__updateCategoryPlaceholder(),this.listenTo(this.model,"change:category",this.__updateCategoryPlaceholder))},setInputToReflectModel:function(){this.$('input[type="text"]').val(this.model.get("filter_text"))},render:function(){this.$el.html(e.template({placeholder:this.__placeholder}))},__updateCategoryPlaceholder:function(){var e=this.__placeholder;"all"!==this.model.get("category")&&-1===this.model.get("category").indexOf("user-")&&(e=this.__stringManager.get("search_box_category",{category:this.__stringManager.get("cat_"+this.model.get("category"))})),this.$('input[type="text"]').attr("placeholder",e)}})}({UiCore:e["@UiCore"],Model:e["@Model"],NextUtil:e["@NextUtil"],template:ue}),fe=function(e){var t=e.SearchWidget;return t.extend("SearchBoxWidget",{uiContextName:"search_box_widget",className:"search-widget search-box-widget",dependencies:["stringManager"],trackedEvents:function(){return[{type:"click",selector:'button[type="submit"]',name:"submit_search",handler:"__onSubmitSearch"},{type:"click",selector:'button[type="reset"]',name:"reset",handler:"resetSearch"},{type:"keyup",selector:'input[type="text"]',name:"submit_search",handler:"__onKeyup",allowBubble:!0}]},setInputToReflectModel:function(){t.prototype.setInputToReflectModel.call(this),this.__updateResettable()},__val:function(){return $.trim(this.$('input[type="text"]').val())},__onSubmitSearch:function(e){e.preventDefault(),this.__submit(),this.__updateResettable()},__onKeyup:function(t){t.preventDefault(),t.keyCode===e.NextUtil.Keys.VK_ENTER&&(this.__recordEvent("click",{name:"submit_search",pressed_enter:1}),this.__submit()),this.__updateResettable()},__submit:function(){var e=this.__val();e!==this.model.get("filter_text")&&this.model.set("filter_text",e)},__updateResettable:function(){var e=this.__val();this.$el.toggleClass("resettable",0<e.length&&e===this.model.get("filter_text"))},resetSearch:function(){this.$('input[type="text"]').val(""),this.model.set("filter_text",""),this.$('input[type="text"]').removeClass("is-filled"),this.__updateResettable()}})}({NextUtil:e["@NextUtil"],SearchWidget:me}),ve=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<button class="btn ap ap-badge"></button>'},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;i=this.escapeExpression;var o=t.helperMissing,r='<div class="product-img">\n    <img class="cover-image">\n    ';return((n=t.if.call(e,e&&e.isAp,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(r+=n),r+'\n</div>\n<div class="product-info">\n    <div class="product-name">'+i("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:a}):s)+'</div>\n    <div class="created-by">'+i((s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"created_by_user",{name:"i18n-g",hash:{user:e&&e.creatorName},data:a}))+'</div>\n    <div class="price-info">\n        <div class="price-credits">'+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:a}):s)+"</div>\n    </div>\n</div>\n"},useData:!0})}(),be=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("WishListItem",{className:"wishlist-item",uiContextName:"wishlist_item",tagName:"div",dependencies:["imageManager","loginManager","globalStringManager"],trackedEvents:function(){return[]},initialize:function(e){t.prototype.initialize.call(this,e),this.__myself=e.loginManager.getCurrentUser(),this.addToDOM()},setImage:function(e,t,i){t&&i&&(e=IMVU.URI.build(e,{width:i,height:t})),this.__imageManager.load(this.$("img"),e,{container:this.$el})},render:function(){this.model.populated().then(function(t){this.$el.html(e.template({name:t.get("product_name"),creatorName:t.get("creator_name"),isAp:"AP"===t.get("rating"),price:t.get(this.__myself.get("isVip")?"discount_price":"product_price")})),this.setImage(t.get("preview_image"),100,100),this.$el.data("node",t)}.bind(this))}})}({UiCore:e["@UiCore"],template:ve}),ye=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("WishlistCollectionPresenter",{className:"wish-list",uiContextName:"wish_list",itemFactory:e.WishlistItem,dependencies:["globalStringManager"],initialize:function(e){this.__globalStringManager=e.globalStringManager,t.prototype.initialize.call(this,e)},__emptyText:function(){return{standard:this.__globalStringManager.get("no_wishlist_results"),concise:this.__globalStringManager.get("no_wishlist_results_concise")}}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],WishlistItem:be}),Ce=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){return i=t.helperMissing,'<div class="id-go-to-shop btn-primary">'+(0,this.escapeExpression)((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"GO TO SHOP",{name:"i18n-g",hash:{},data:a}))+"</div>"},useData:!0})}(),Me=function(e){var t=function(t){return t.extend("ItemPickerDialogWishlistCollectionPresenter",{initialize:function(i){this.__isBaseWishlistEmpty=i.isBaseWishlistEmpty,this.__giftee=i.giftee,this.__updateEmpty=function(){t.prototype.__updateEmpty.call(this),i.updateEmptyCallback.call(this,this.__isBaseWishlistEmpty())},e.WishlistCollectionPresenter.prototype.initialize.call(this,i)},__emptyText:function(){return this.__isBaseWishlistEmpty()?{standard:this.__globalStringManager.get("no wishlist_items_upsell",{user:this.__giftee.get("display_name")}),concise:this.__globalStringManager.get("No wishlist items")}:t.prototype.__emptyText.call(this)}})}(e.WishlistCollectionPresenter),i=e.Dialogs.AlloyModalDialog;return i.extend("ItemPickerDialog",{uiContextName:"itempicker_dialog",className:"itempicker-dialog dialog-type-B",dependencies:["loginManager","globalStringManager","dialogManager","modeManager","model"],trackedEvents:function(){return[{type:"click",selector:".wishlist-item",name:"wishlist_picker_checkout",handler:this.__checkout.bind(this)},{type:"click",selector:".id-go-to-shop",name:"wishlist_picker_shopupsell",handler:this.__modeManager.openMode.bind(this.__modeManager,{mode:{id:"shop"}})}]},initialize:function(t){this.__filterModel=t.serviceProvider.create(e.Model.FilterModel,["filter_text"],{}),this.title=t.globalStringManager.get("Send Gift"),i.prototype.initialize.call(this,t),this.__myself=this.track(t.loginManager.getCurrentUser()),t.model.populated().then(function(){this.baseWishlistSummary=t.model.searchEdgeCollection("wishlist",{filter:IMVU.URI.buildQuery({cat:[106,108,3088,425]}),limit:0},e.Model.ProductEdgeCollection),this.baseWishlistSummary.populated().then(this.addToDOM.bind(this))}.bind(this))},render:function(){i.prototype.render.call(this),this.setContent("body",e.template),this.__createList(!0),this.$(".wish-list-container").scrollbar(),this.listenTo(this.__filterModel,"change:filter_text",this.__createList.bind(this,!1))},__displayUpSellButton:function(t){this.__$upSellButton||(this.__$upSellButton=$(e.upsellButtonTemplate())),this.__$upSellButton.toggle(t),this.$el.append(this.__$upSellButton)},__isBaseWishlistEmpty:function(){return 0===this.baseWishlistSummary.total_count},__createList:function(i){this.__wishlistPresenter&&this.__wishlistPresenter.delete();var a=["wishlist",{filter:IMVU.URI.buildQuery({cat:[106,108,3088,425],keywords:this.__filterModel.get("filter_text")},{prune:!0})},e.Model.ProductEdgeCollection];i&&this.model.searchEdgeCollection.apply(this.model,a).enumerated().then(function(t){t.length&&this.createChildContext(e.SearchBox,{$replaceElement:this.$(".id-searchbox"),placeholder:"Search Wishlist",model:this.__filterModel,stringManager:this.__globalStringManager})}.bind(this)),this.__wishlistPresenter=this.createChildContext(t,{collection:this.model.searchEdgeCollection.apply(this.model,a),$parentElement:this.$(".wish-list-container"),scroller:this.$(".wish-list-container"),updateEmptyCallback:this.__displayUpSellButton.bind(this),isBaseWishlistEmpty:this.__isBaseWishlistEmpty.bind(this),giftee:this.model})},__checkout:function(t){this.__dialogManager.showDialog(e.Checkout.GiftingDialog,{product:$(t.currentTarget).data("node"),recipient:this.model}).finished.then(function(e){e||this.promiseResolver.resolve()}.bind(this)).catch(function(){this.promiseResolver.reject()}.bind(this))},postRender:function(){}})}({UiCore:e["@UiCore"],Checkout:e["@Checkout"],Dialogs:e["@Dialogs"],WishlistCollectionPresenter:ye,template:pe,Model:e["@Model"],SearchBox:fe,upsellButtonTemplate:Ce}),xe=function(e){var t=e.Dialogs.AlloyConfirmDialog;return t.extend("ReportUserDialog",{uiContextName:"report_user_dialog",className:"report-user-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager","loginManager"],initialize:function(i){this.__model=i.model,this.__dialogManager=i.dialogManager,this.__restModelFactory=i.restModelFactory,this.__startupModel=i.globalStartupModel,this.__stringManager=i.globalStringManager,i=_.extend({title:this.__stringManager.get("unblock_person_title"),html:this.__stringManager.get("unblock_person_html",{username:this.__model.get("display_name")}),yes:this.__stringManager.get("unblock_person_unblock"),no:this.__stringManager.get("unblock_person_cancel")},i),t.prototype.initialize.call(this,i),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__blockedUsers=this.track(this.__myself.getEdgeCollection("blocked",e.UiCore.EdgeCollectionModel))},__onConfirm:function(){this.__blockedUsers.populated().then(function(){return this.__blockedUserModel=this.__blockedUsers.find(function(e){return this.__model.id===e.node.id}.bind(this)),this.__blockedUserModel.edge.destroy()}.bind(this)).then(this.__confirmDialog.bind(this)).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this)).catch(function(e){this.__errorDialog(e).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this))}.bind(this))},__confirmDialog:function(){return this.__dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("unblock_person_confirm_title"),text:this.__stringManager.get("unblock_person_confirm_text",{username:this.__model.get("display_name")}),ok:this.__stringManager.get("unblock_person_confirm_done")}).finished},__errorDialog:function(t){return this.__dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("unblock_person_error_title"),text:this.__stringManager.get("unblock_person_error_text"),ok:this.__stringManager.get("unblock_person_error_done")}).finished}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"]}),ke=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="content">\n    <div class="private-rooms">\n        <div class="room-list-header">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"My Private Rooms",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n        <div class="my-private-room-list-placeholder"></div>\n    </div>\n    <div class="public-rooms">\n        <div class="room-list-header">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"My Public Rooms",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n        <div class="my-public-room-list-placeholder"></div>\n    </div>\n</div>\n\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary continue" disabled>',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Continue",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+' <span class="icon icon-page-right"></span></button>\n<\/script>'},useData:!0})}(),we=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n;i=t.helperMissing;var s="(";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"FULL",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+")"},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;return i='<div class="tile-thumbnail">\n    <div class="cover-image"></div>\n</div>\n<div class="tile-footer">\n    <div class="tile-name is-truncated">'+(i=this.escapeExpression)("function"==typeof(n=null==(n=null==(n=e&&e.data)||!1===n?n:n.node)||!1===n?n:n.name)?n.apply(e):n)+'</div>\n    <div class="room-tile-occupancy">\n        <span class="icon-person"><svg viewBox="0 0 32 32"><path d="M19 23.3V22c3-1 4.8-3.8 4.8-9.2 0-5.2-3.5-8.5-8-8.5S8 7.6 8 12.8c0 5.4 2 8.3 4.8 9.3v1.4H9.4c-3.2 0-6 3-6.2 6.6v2h25.4v-2c0-3.7-3-6.6-6.2-6.7H19z"/></svg></span>\n        '+i("function"==typeof(s=t.occupancy||e&&e.occupancy)?s.call(e,{name:"occupancy",hash:{},data:a}):s)+"/"+i("function"==typeof(n=null==(n=null==(n=e&&e.data)||!1===n?n:n.node)||!1===n?n:n.capacity)?n.apply(e):n)+" ",((n=t.if.call(e,e&&e.isFull,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n    </div>\n</div>\n"},useData:!0})}(),$e=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="tile-thumbnail">\n    <img src="/common/withme/img/default_room_image.png" alt="room background image" />\n</div>\n<div class="tile-footer">\n    <div class="tile-name is-truncated">Night Time Noir</div>\n    <div class="tile-info">\n        <span class="icon-person"><svg viewBox="0 0 32 32"><path d="M19 23.3V22c3-1 4.8-3.8 4.8-9.2 0-5.2-3.5-8.5-8-8.5S8 7.6 8 12.8c0 5.4 2 8.3 4.8 9.3v1.4H9.4c-3.2 0-6 3-6.2 6.6v2h25.4v-2c0-3.7-3-6.6-6.2-6.7H19z"/></svg></span>\n        0/10\n    </div>\n</div>\n'},useData:!0})}(),Se=function(e){var t=e.UiCore.UiContext;return t.extend("ResponsiveTileListItem",{uiContextName:"responsive_tile_list_item",className:"responsive-tile-list-item",tagName:"li",dependencies:["timer"],trackedEvents:function(){return[{type:"click",name:"list_item_on_click",handler:this.__onClick}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM(),this.__setHeightTimeout=this.__timer.setTimeout(function(){this.$(".tile-thumbnail").height(this.$(".tile-thumbnail").width())}.bind(this),0)},render:function(){this.$el.html(e.template)},delete:function(){this.__timer.clearTimeout(this.__setHeightTimeout),t.prototype.delete.call(this)},__onClick:function(){this.$el.hasClass("disabled")||(e.NextUtil.DomHelper.radioClass(this.$el,"is-selected"),this.trigger("item_selected",this.model))},__disableFilter:function(e){this.model.node.get(e.key)===e.value&&this.$el.addClass("disabled")}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:$e}),Ue=function(e){var t=e.ResponsiveTileListItem;return t.extend("ResponsiveRoomTileListItem",{uiContextName:"responsive_room_tile_list_item",className:"responsive-room-tile-list-item responsive-tile-list-item",dependencies:["imageManager","loginManager","model"],initialize:function(e){t.prototype.initialize.call(this,e),this.defaultRoomImageUrl=e.defaultRoomImageUrl||"/common/withme/img/default_room_image.png",this.addToDOM()},render:function(){this.model.populated().then(function(){this.$el.html(e.template({data:this.model.toJSON(),occupancy:this.model.node.get("occupancy")?this.model.node.get("occupancy"):0,isFull:10===parseInt(this.model.node.get("occupancy"))})),this.__loadImage()}.bind(this)),this.listenTo(this.__parentUiContext,"disable",this.__disableFilter)},__loadImage:function(e){e=""===this.model.node.get("image_url")||"//ssluserimages-a.akamaihd.net/imvufiles/rooms/image/default_332.jpg"===this.model.node.get("image_url")?this.model.node.get("themed_image_url")||this.model.node.get("rendered_image"):this.model.node.get("themed_image_url")||this.model.node.get("image_url")||this.model.node.get("rendered_image"),this.__imageManager.loadAsBackgroundImage(this.$(".cover-image"),e,{container:this.$el,defaultImage:this.defaultRoomImageUrl})}})}({UiCore:e["@UiCore"],ResponsiveTileListItem:Se,template:we}),Te=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="no-results notation no-public-room">\n    ';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"no_my_public_rooms",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+=' \n    <span class="icon icon-tooltip-icon"></span>\n</div> \n\n<div class="tooltip-content">\n    <div class="tooltip-body">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"my_public_rooms_tooltip",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n</div>"},useData:!0})}(),De=function(t){var i={Dialogs:e["@Dialogs"]}.Dialogs.AlloyModalDialog;return i.extend("TooltipDialog",{uiContextName:"tooltip_dialog",className:"tooltip-dialog dialog-type-B text-close",trackedEvents:function(){return this.__customTrackedEvents},initialize:function(e){this.__customTrackedEvents=e.trackedEvents||[],i.prototype.initialize.call(this,e),this.title=e.title,this.__tooltipContent=e.tooltipContent,this.addToDOM()},postRender:function(){this.setContent("body",this.__tooltipContent)}})}(),Ie=function(e){var t=e.UiCore.UiContext;return t.extend("Tooltip",{className:"tooltip",uiContextName:"tooltip",dependencies:["dialogManager","timer","tooltipLayer","window"],trackedEvents:function(){return[{type:"click",selector:"a",name:"link_click",handler:"__clickedLink",allowBubble:!0}].concat(this.__customTrackedEvents)},__installTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.on("mouseenter.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.$target.off("mouseleave.tooltip")}.bind(this)),this.__tooltipLayer.$el.on("mouseleave.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=this.__timer.setTimeout(function(){this.setVisible(!1),this.__timer.clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=this.__timer.setTimeout(function(){this.__hide(),this.__installTargetMouseleave()}.bind(this),125)}.bind(this),250)}.bind(this))},__removeTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.off(".tooltip")},initialize:function(e){this.$tooltip=IMVU.requireProperty(e,"$replaceElement"),this.$target=IMVU.requireProperty(e,"$tooltipTarget"),this.tooltipTitle=IMVU.optionalProperty(e,"title",!1),this.__tooltipStyle=IMVU.optionalProperty(e,"tooltipStyle","default"),this.__customTrackedEvents=e.trackedEvents||[],t.prototype.initialize.call(this,e),this.$body=$("body"),this.$globalNav=$("nav.global-nav:visible"),"mobile"===this.__serviceProvider.get("platform")?this.$target.on("click.tooltip",function(e){e.stopPropagation(),this.__openTooltipDialog()}.bind(this)):this.$target.on("mouseenter.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.__timer.clearTimeout(this.__targetFadeinTimeout),this.__installTargetMouseleave(),this.__targetFadeinTimeout=this.__timer.setTimeout(function(){this.setVisible(!0),this.__show()}.bind(this),250)}.bind(this)),"snug"===this.__tooltipStyle&&this.$el.addClass("tooltip-snug"),this.$el.append(this.$tooltip),this.setParentUiContext(this.__tooltipLayer),this.__tooltipLayer.$el.append(this.$el)},setVisible:function(e){this.$el.toggleClass("tooltip-open",!!e)},__installTargetMouseleave:function(){this.$target.on("mouseleave.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__targetTimeout=this.__timer.setTimeout(function(){this.setVisible(!1),this.__timer.clearTimeout(this.__targetTimeout),this.__targetTimeout=this.__timer.setTimeout(function(){this.__hide()}.bind(this),125)}.bind(this),250)}.bind(this))},__show:function(){this.__installTooltipLayerEventHandlers(),this.__trackTooltip(),$(this.__window).on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this)),this.$body.find(".transparent-overlay").on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this))},__trackTooltip:function(){var e=this.$globalNav.height(),t=this.$target[0].getBoundingClientRect().top,i=this.$target[0].getBoundingClientRect().left,a=$(window).width()-(i+this.$target.outerWidth()/2),n=this.$el[0].offsetWidth;0<this.$target.parents(".dialog-manager").length&&(e=0),i=a>n?i+this.$target.width()/2:i+this.$target.width()/2-n,this.$el.css({"margin-top":Math.max(t,e),"margin-left":i})},__hide:function(){this.__removeTooltipLayerEventHandlers(),this.setVisible(!1)},__openTooltipDialog:function(){return this.__dialogManager.showDialog(e.TooltipDialog,{title:this.tooltipTitle||this.$target.text(),tooltipContent:this.$tooltip.html(),trackedEvents:this.__customTrackedEvents})},delete:function(){this.$el.removeAttr("style"),this.__timer.clearTimeout(this.__targetFadeinTimeout),this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.$target.off(".tooltip"),this.__removeTooltipLayerEventHandlers(),$(this.__window).off("scroll.tooltip"),this.$body.find(".transparent-overlay").off("scroll.tooltip"),t.prototype.delete.call(this)},__clickedLink:function(){this.__hide()}})}({UiCore:e["@UiCore"],TooltipDialog:De}),Pe=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("ResponsiveTileList",{uiContextName:"responsive_tile_list",className:"responsive-tile-list",triggerNextPage:3,initialize:function(i){this.itemFactory=IMVU.optionalProperty(i,"itemFactory",e.ResponsiveTileListItem),this.__emptyTemplate=IMVU.optionalProperty(i,"emptyTemplate",!1),this.__user=i.user?i.user:null,t.prototype.initialize.call(this,i),this.$el.toggleClass("two-columns",400>this.$el.width())},__updateEmpty:function(){this.__emptyTemplate?0!==this.collection.models.length||this.__$empty?this.collection.models.length&&this.__$empty&&(this.__$empty.remove(),this.__$empty=null):(this.__$empty=$(this.__emptyTemplate({})),this.$el.append(this.__$empty),this.__$empty.find(".icon-tooltip-icon")&&this.createChildContext(e.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".icon-tooltip-icon")})):t.prototype.__updateEmpty.call(this)}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],ResponsiveTileListItem:Se,Tooltip:Ie}),Ee=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="no-results notation no-private-room">\n    ';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"no_my_private_rooms",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+=' \n    <span class="icon icon-tooltip-icon"></span>\n</div> \n\n<div class="tooltip-content">\n    <div class="tooltip-body">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"my_private_rooms_tooltip",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n</div>"},useData:!0})}(),Ae=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("ChooseRoomDialog",{uiContextName:"choose_room_dialog",className:"choose-room-dialog dialog-type-B is-padded",dependencies:"chatManager dialogManager globalStringManager globalStartupModel loginManager modeManager Promise rest restModelFactory user".split(" "),trackedEvents:function(){return[{type:"click",selector:"button.continue",name:"choose_room",handler:"__continue"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("choose_room_dialog_title"),this.__myself=this.__loginManager.getCurrentUser(),this.addToDOM()},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text()),this.__myself.populated().then(function(){return this.__publicCollection=this.__restModelFactory.searchCollection(this.__myself.relations.managed_rooms,{privacy:"public"},e.UiCore.EdgeCollection),this.__privateCollection=this.__restModelFactory.searchCollection(this.__myself.relations.managed_rooms,{privacy:"private"},e.UiCore.EdgeCollection),this.__Promise.every([this.__publicCollection.populated(),this.__privateCollection.populated()])}.bind(this)).then(function(){this.__myPrivateRooms=this.createChildContext(e.ResponsiveTileList,{$replaceElement:this.$(".my-private-room-list-placeholder"),collection:this.__privateCollection,itemFactory:e.ResponsiveRoomTileListItem,emptyTemplate:e.ResponsivePrivateRoomEmptyTemplate}),this.listenTo(this.__myPrivateRooms,"item_selected",this.__selectRoom),this.__myPublicRooms=this.createChildContext(e.ResponsiveTileList,{$replaceElement:this.$(".my-public-room-list-placeholder"),collection:this.__publicCollection,itemFactory:e.ResponsiveRoomTileListItem,emptyTemplate:e.ResponsivePublicRoomEmptyTemplate}),this.listenTo(this.__myPublicRooms,"item_selected",this.__selectRoom),this.__user.get("is_ap")||(this.__myPrivateRooms.trigger("disable",{key:"content_rating",value:"AP"}),this.__myPublicRooms.trigger("disable",{key:"content_rating",value:"AP"})),this.$(".dialog-body .content").scrollbar()}.bind(this)).catch(function(){}.bind(this))},__selectRoom:function(e){("AP"!==e.node.get("content_rating")||this.__user.get("is_ap"))&&(this.__roomModel=e.node,this.$("button.continue").prop("disabled",!1))},__continue:function(){this.__roomModel&&(this.__modeManager.openMode({mode:{id:"chat"},submode:{id:this.__roomModel.id,forceJoin:!0,showAlways:!0}}),this.__serviceProvider.get("windowManager").removeWindow(this.__roomModel.id),this.__chatManager.inviteUserToRoom(this.__roomModel,this.__user))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:ke,ResponsiveTileList:Pe,ResponsiveRoomTileListItem:Ue,ResponsivePublicRoomEmptyTemplate:Te,ResponsivePrivateRoomEmptyTemplate:Ee}),Ne=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="upgrade-products">\n    <div class="products"></div>\n</div>\n<footer class="dialog-footer"></footer>'},useData:!0})}(),Le=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<button class="btn btn-primary buy-now" disabled>';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"CHECKOUT",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</button>"},useData:!0})}(),Re=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="alert-message">\n';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"already_have_vip_subscription_text_before_link",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n<a href="https://help.imvu.com" target="_blank">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"already_have_vip_subscription_text_link",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</a>\n",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"already_have_vip_subscription_text_after_link",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"\n</div>"},useData:!0})}(),Oe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,r='\n            <div class="order-row order-total-row">\n                <div class="order-row-name">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Total",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+" ("+o("function"==typeof(s=t.itemCount||e&&e.itemCount)?s.call(e,{name:"itemCount",hash:{},data:a}):s)+')</div>\n                <div class="order-row-amount">$<span class="order-total"></span></div>\n            </div>\n            '},3:function(e,t,i,a){var n;i=t.helperMissing;var s="\n        <div class=\"vip-block\">\n            <input id='vip-checkbox' class=\"vip checkbox\" tabindex='13' type=\"checkbox\"><label for='vip-checkbox'>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"I agree to the VIP",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</label> <a class="vip-terms-link vip-toc-link tooltip-target">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Terms and Conditions",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</a>\n            <div class="vip-toc-tooltip">\n                <div class="tooltip-header">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_dialog_title",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n                <div class="tooltip-body">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_dialog_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n            </div>\n        </div>\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,r='<div class="content-container">\n    <div class="error-block">\n        <ul>\n            <li class="error-message invalid-product">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_invalid_product",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</li>\n            <li class="error-message vip-checkbox-missing">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</li>\n        </ul>\n    </div>\n    <div class="padded-content-container">\n        <div class="order-block">\n            <legend class="system-info-header">\n                ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Cart",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='\n            </legend>\n            <div class="order-list-placeholder"></div>\n            ',((n=t.if.call(e,e&&e.showTotal,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(r+=n),r+="\n        </div>\n        ",((n=t.if.call(e,e&&e.hasVip,{name:"if",hash:{},fn:this.program(3,a),inverse:this.noop,data:a}))||0===n)&&(r+=n),r+='\n        <div class="payment-block">\n            <legend class="system-info-header">\n                ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Payment Method",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='\n            </legend>\n            <div class="savedcard-container"></div>\n            <div class="action-row add-credit-card"><div class="icon-payment-cc icon"></div> ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Check Out With New Credit Card",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+=' <div class="right-arrow"></div></div>\n            <div class="action-row paypal-checkout"><svg class="paypal-icon" width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><g fill="none"><path d="M3.15 18.146H1.227a.267.267 0 0 0-.264.227L.187 23.33a.16.16 0 0 0 .16.186h.916a.267.267 0 0 0 .264-.227l.21-1.338A.267.267 0 0 1 2 21.726h.608c1.265 0 1.996-.617 2.186-1.837.086-.536.004-.955-.245-1.25-.274-.322-.758-.493-1.4-.493zm.22 1.81c-.104.694-.63.694-1.14.694h-.29l.203-1.295a.16.16 0 0 1 .158-.136h.134c.347 0 .674 0 .844.198.1.12.13.295.093.54zm5.522-.022h-.92a.16.16 0 0 0-.16.136l-.04.26-.064-.095c-.2-.29-.643-.388-1.086-.388-1.017 0-1.885.775-2.054 1.86-.088.544.037 1.06.343 1.423.28.333.682.47 1.16.47.82 0 1.273-.53 1.273-.53l-.04.258a.16.16 0 0 0 .157.187h.828a.267.267 0 0 0 .264-.227l.497-3.168a.16.16 0 0 0-.158-.186zM7.61 21.736a1.027 1.027 0 0 1-1.04.883c-.266 0-.48-.087-.616-.25-.136-.162-.188-.393-.145-.65.082-.525.506-.89 1.03-.89.26 0 .474.086.614.25.14.167.195.4.155.656zm6.18-1.802h-.923a.267.267 0 0 0-.22.118l-1.276 1.89-.54-1.816a.268.268 0 0 0-.256-.192h-.91a.16.16 0 0 0-.15.213l1.018 3.007-.958 1.36a.16.16 0 0 0 .13.254h.924c.088 0 .17-.043.22-.116l3.074-4.465a.16.16 0 0 0-.13-.253z" fill="#253B80"/><path d="M16.852 18.146H14.93a.267.267 0 0 0-.263.227l-.777 4.956a.16.16 0 0 0 .158.185h.986c.09 0 .17-.067.184-.16l.22-1.404a.267.267 0 0 1 .264-.225h.608c1.266 0 1.996-.617 2.187-1.837.086-.535.003-.954-.246-1.248-.27-.323-.755-.494-1.4-.494zm.22 1.81c-.103.694-.63.694-1.14.694h-.29l.204-1.295a.16.16 0 0 1 .158-.136h.133c.347 0 .674 0 .843.198.1.12.132.295.093.54zm5.522-.022h-.92a.16.16 0 0 0-.157.136l-.04.26-.066-.095c-.198-.29-.642-.388-1.085-.388-1.017 0-1.885.775-2.054 1.86-.086.544.038 1.06.344 1.423.28.333.68.47 1.158.47.82 0 1.274-.53 1.274-.53l-.04.258a.16.16 0 0 0 .157.187h.83a.267.267 0 0 0 .262-.227l.498-3.168a.16.16 0 0 0-.16-.186zm-1.282 1.802a1.027 1.027 0 0 1-1.038.883c-.267 0-.48-.087-.618-.25-.136-.162-.187-.393-.144-.65.083-.525.507-.89 1.03-.89.262 0 .474.086.614.25.14.167.196.4.156.656zm2.366-3.454l-.788 5.047a.16.16 0 0 0 .158.185h.792a.267.267 0 0 0 .264-.227l.778-4.956a.16.16 0 0 0-.158-.186h-.888a.16.16 0 0 0-.158.136z" fill="#179BD7"/><path d="M10.47 15.845l.285-1.806-.633-.016H7.098L9.2.702a.172.172 0 0 1 .17-.146h5.1c1.69 0 2.86.353 3.47 1.048.285.326.467.667.555 1.042.092.393.094.863.004 1.437l-.008.04v.37l.286.16c.24.13.432.275.58.442.244.28.402.633.47 1.053.068.432.045.947-.068 1.53-.13.67-.342 1.25-.626 1.73-.262.44-.596.803-.992 1.085a4.024 4.024 0 0 1-1.336.603 6.662 6.662 0 0 1-1.67.193h-.396c-.284 0-.56.1-.776.284-.217.187-.36.443-.404.722l-.03.163-.502 3.18-.023.118c-.006.037-.016.055-.032.068a.084.084 0 0 1-.052.02h-2.45z" fill="#253B80"/><path d="M19.048 4.167a8.915 8.915 0 0 1-.052.3c-.673 3.45-2.973 4.643-5.91 4.643H11.59c-.36 0-.662.26-.718.615l-.765 4.857-.217 1.376a.383.383 0 0 0 .377.443h2.653a.638.638 0 0 0 .63-.537l.027-.135.5-3.17.03-.174a.638.638 0 0 1 .63-.54h.398c2.57 0 4.582-1.042 5.17-4.062.246-1.26.12-2.315-.53-3.055a2.536 2.536 0 0 0-.727-.56z" fill="#179BD7"/><path d="M18.345 3.886a5.303 5.303 0 0 0-.654-.145 8.307 8.307 0 0 0-1.318-.095h-3.995a.634.634 0 0 0-.63.54l-.85 5.383-.025.157a.726.726 0 0 1 .718-.615h1.496c2.937 0 5.237-1.193 5.91-4.644.02-.102.037-.202.052-.3a3.584 3.584 0 0 0-.703-.28z" fill="#222D65"/><path d="M11.747 4.184a.635.635 0 0 1 .63-.538h3.995c.474 0 .916.03 1.32.096a5.303 5.303 0 0 1 .804.192c.198.065.382.143.552.233.2-1.276 0-2.144-.69-2.93C17.596.37 16.223 0 14.468 0H9.37a.73.73 0 0 0-.72.616l-2.123 13.46a.438.438 0 0 0 .432.506h3.147l.79-5.014.85-5.384z" fill="#253B80"/></g></svg> ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Check Out With PayPal",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+=' <div class="right-arrow"></div></div>\n            <div class="info-row">\n                ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"original_store_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+=' <br><a class="core-store-link" href="/store/index/?platform='+o("function"==typeof(s=t.platformId||e&&e.platformId)?s.call(e,{name:"platformId",hash:{},data:a}):s)+'" target="_blank">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"original_store_link_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</a>\n            </div>\n        </div>\n    </div>\n</div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BUY",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+=' <span class="item-count"></span> ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ITEM FOR",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+' $<span class="order-total"></span></button>\n<\/script>\n'},useData:!0})}(),Be=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n,s;i=this.escapeExpression;var o='\n    <div class="order-row">\n        <div class="order-item">\n            ';return((n=t.if.call(e,e&&e.image,{name:"if",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+'\n            <div class="item-info">\n                <div class="item-name">'+i("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:a}):s)+'</div>\n                <div class="product-price">$'+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:a}):s)+"</div>\n            </div>\n        </div>\n    </div>\n"},2:function(e,t,i,a){var n;return'\n            <div class="image-container"><img src="'+(0,this.escapeExpression)("function"==typeof(n=t.image||e&&e.image)?n.call(e,{name:"image",hash:{},data:a}):n)+'"></div>\n            '},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return(n=t.each.call(e,e&&e.cart,{name:"each",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n?n:""},useData:!0})}(),Fe=function(e){var t=e.UiCore.UiContext;return t.extend("OrderList",{className:"order-list",uiContextName:"orderlist",initialize:function(e){t.prototype.initialize.call(this,e),this.__cart=IMVU.requireProperty(e,"cart"),this.addToDOM()},render:function(){_.each(this.__cart,function(e){e.price=parseFloat(e.price).toFixed(2),e.image&&-1===e.image.indexOf("/")&&(e.image="/common/withme/img/store/"+e.image)}),this.$el.html(e.template({cart:this.__cart}))}})}({UiCore:e["@UiCore"],template:Be}),He=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e){var t=this.escapeExpression;return'\n                        <option value="'+t("function"==typeof e?e.apply(e):e)+'">'+t("function"==typeof e?e.apply(e):e)+"</option>\n                        "},3:function(){return' checked="checked" '},5:function(e,t,i,a){var n;return'\n                    <option value="'+(t=this.escapeExpression)("function"==typeof(n=null==a||!1===a?a:a.key)?n.apply(e):n)+'">'+t("function"==typeof e?e.apply(e):e)+"</option>\n                    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="content-container">\n    <div class="error-block">\n        <ul>\n            <li class="error-message field-missing">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_field_missing",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message cardnumber-invalid">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_card_number_invalid",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message exp-date-expired">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_exp_date_expired",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message security-code-invalid">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_security_code_invalid",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message zip-invalid">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_zip_invalid",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message postal-invalid">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_postal_invalid",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message vip-checkbox-missing">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message cardname-invalid">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_invalid_cc_name",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n        </ul>\n    </div>\n    <div class="payment-block">\n        <legend class="system-info-header">\n            ',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Payment Method",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n        </legend>\n\n        <div class="input-row card-number-container">\n            <div class="input-label">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Credit Card Number",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n            <input class=\'cardnumber\' tabindex=\'1\' required maxlength=\'20\' placeholder=\'XXXX-XXXX-XXXX-XXXX\'> \n            <div class="cardimages-container">\n                <div class="cardimage mastercard icon icon-cc-mastercard"></div> \n                <div class="cardimage visa icon icon-cc-visa"></div> \n                <div class="cardimage americanexpress icon icon-cc-amex"></div> \n                <div class="cardimage discover icon icon-cc-discover"></div> \n                <div class="cardimage jcb icon icon-cc-jcb"></div>\n            </div>\n        </div>\n        <div class="input-row">\n            <div class="half-row">\n                <div class="exp-date input-container">\n                    <div class="input-label">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Expiration",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</div>\n                    <div class='exp-date-container input-container'>\n                        <select class='exp-month' tabindex='2' required >\n                        <option selected value=\"\">",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Month",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</option>\n                        ",((n=t.each.call(e,e&&e.monthRange,{name:"each",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+="\n                        </select>\n                    </div>\n                    <div class='exp-date-container input-container'>\n                        <select class='exp-year' tabindex='3' required >\n                        <option selected value=\"\">",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Year",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</option>\n                        ",((n=t.each.call(e,e&&e.yearRange,{name:"each",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+="\n                        </select>\n                    </div>\n                </div>\n            </div>\n            <div class='input-container'>\n                <div class=\"input-label\">",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Security",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n                <div class="security-code-row">\n                    <input class=\'security-code\' tabindex=\'4\' required maxlength=\'4\' placeholder="CSC">\n                    <div class="icon icon-tooltip-icon security-code-help-link"></div>\n                    <div class="security-code-tooltip">\n                        <div class="tooltip-header">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"security_code_help_title",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n                        <div class="tooltip-body">\n                            <div class="icon icon-payment-csc"></div>\n                            <div>',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"security_code_help_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="input-row">\n            <input id=\'save-for-later-checkbox\' class="save-for-later checkbox" tabindex=\'13\' type="checkbox" \n            ',((n=t.if.call(e,e&&e.saveCard,{name:"if",hash:{},fn:this.program(3,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+=" ><label for='save-for-later-checkbox'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Save For Later",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</label>\n        </div>\n    </div>\n    <div class="billing-address-block">\n        <legend class="system-info-header">\n            ',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Billing Information",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="\n        </legend>\n        <div class=\"input-row\">\n            <input class='name-on-card' maxlength='50' tabindex='5' required placeholder='",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Name on Card",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='address' maxlength='50' tabindex='6' required placeholder='",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Address",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='city' maxlength='20' tabindex='7' required placeholder='",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"City",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="'>\n            <div class='us-fields state-province-container input-container'>\n                <select class='state' tabindex='8' >\n                    <option selected value=\"\">",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"State",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</option>\n                    ",((n=t.each.call(e,e&&e.states,{name:"each",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+="\n                </select>\n            </div>\n            <div class='non-us-fields ca-province state-province-container input-container'>\n                <select class='province' tabindex='10'>\n                    <option selected value=\"\">",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Province",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</option>\n                    ",((n=t.each.call(e,e&&e.provinces,{name:"each",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+="\n                </select>\n            </div>\n            <input class='us-fields zip' maxlength='5' tabindex='9' placeholder='",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Zipcode",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="'>\n            <input class='non-us-fields postal' maxlength='12' tabindex='11' placeholder='",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Postal Code",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="'>\n            <div class='country-container input-container us'>\n                <select class='country' tabindex='12' required>\n                    <option value=''>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Country",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</option>\n                    ",((n=t.each.call(e,e&&e.countries,{name:"each",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+='\n                </select>\n            </div>\n        </div>\n    </div>\n</div>    \n\n<footer class="dialog-footer">\n    <button class="btn btn-primary continue-checkout">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Continue to Checkout",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</button>\n</footer>\n"},useData:!0})}(),ze=function(e){var t=[{name:"americanexpress",pattern:/^3[47]/},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/},{name:"visa",pattern:/^4/},{name:"mastercard",pattern:/^5[1-5]/},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/}];return{getType:function(e){for(var i=0;i<t.length;i++){var a=t[i];if(e.match(a.pattern))return a.name}return null},passesChecksum:function(e){for(var t=0,i=!1,a=e.length-1;0<=a;a--){var n=e.charAt(a);n=parseInt(n,10);i&&(9<(n*=2)&&(n-=9)),t+=n,i=!i}return 0==t%10}}}(),Ve=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="back-button"></div>'},useData:!0})}(),We=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="content-container">\n    <div class="content-container-content">\n        <legend class="system-info-header">\n            ';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Payment Method",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n        </legend>\n        <div class="info-block">\n            <div class="billing-info"></div>\n        </div>\n        <legend class="system-info-header">\n            ',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Cart",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n        </legend>\n        <div class="order-block">\n            <div class="order-list"></div>\n        </div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BUY",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+=' <span class="item-count"></span> ',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ITEM FOR",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+' $<span class="order-total"></span></button>\n<\/script>'},useData:!0})}(),qe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n,s,o='\n<div class="info-line address">'+(i=this.escapeExpression)("function"==typeof(s=t.address||e&&e.address)?s.call(e,{name:"address",hash:{},data:a}):s)+'</div>\n<div class="info-line">'+i("function"==typeof(s=t.city||e&&e.city)?s.call(e,{name:"city",hash:{},data:a}):s)+", ";return((n=t.if.call(e,e&&e.state,{name:"if",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+=" ",((n=t.if.call(e,e&&e.postal_code,{name:"if",hash:{},fn:this.program(4,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+i("function"==typeof(s=t.country||e&&e.country)?s.call(e,{name:"country",hash:{},data:a}):s)+"</div>\n"},2:function(e,t,i,a){var n;return" "+(0,this.escapeExpression)("function"==typeof(n=t.state||e&&e.state)?n.call(e,{name:"state",hash:{},data:a}):n)+" "},4:function(e,t,i,a){var n;return" "+(0,this.escapeExpression)("function"==typeof(n=t.postal_code||e&&e.postal_code)?n.call(e,{name:"postal_code",hash:{},data:a}):n)+", "},6:function(e,t,i,a){var n,s;i=this.escapeExpression;var o=t.helperMissing,r='\n<div class="info-line card-type">'+i("function"==typeof(s=t.card_type||e&&e.card_type)?s.call(e,{name:"card_type",hash:{},data:a}):s)+" ";return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"ending in",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+" -"+i("function"==typeof(s=t.last_four_digits||e&&e.last_four_digits)?s.call(e,{name:"last_four_digits",hash:{},data:a}):s)+"</div>\n"},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;return i='<div class="info-line name-on-card">'+(i=this.escapeExpression)("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:a}):s)+"</div>\n",((n=t.if.call(e,e&&e.address,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n",((n=t.if.call(e,e&&e.last_four_digits,{name:"if",hash:{},fn:this.program(6,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i},useData:!0})}(),je=function(e){var t=e.UiCore.UiContext;return t.extend("BillingInfo",{className:"billing-info",uiContextName:"billing_info",dependencies:["globalStringManager"],initialize:function(i){t.prototype.initialize.call(this,i),this.__billingInfo=IMVU.requireProperty(i,"billingInfo"),this.__CCValidator=e.CCValidator,this.addToDOM()},render:function(){var t="",i="";this.__billingInfo.credit_card&&(t=this.__CCValidator.getType(this.__billingInfo.credit_card),i=this.__billingInfo.credit_card.substring(this.__billingInfo.credit_card.length-4)),this.$el.html(e.template({name:this.__billingInfo.name,address:this.__billingInfo.address,city:this.__billingInfo.city,state:this.__billingInfo.state,postal_code:this.__billingInfo.postal_code,country:this.__billingInfo.country,card_type:this.__globalStringManager.get("card_type_"+(t||"other")),last_four_digits:i}))}})}({UiCore:e["@UiCore"],template:qe,CCValidator:ze}),Ge=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s="<div class='alert-message'>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_pending_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+=" <a target='_blank' href='/next/settings/order'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_pending_link_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</a>.</div>\n<div class='alert-message'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_pending_after_link_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n"},useData:!0})}(),Ye=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s="<div class='alert-message'>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_unknown_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+=" <a target='_blank' href='/next/settings/order'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_unknown_link_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</a>.</div>\n<div class='alert-message'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_unknown_after_link_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n"},useData:!0})}(),Xe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,r='<div class="content-container">\n    <div class="info-block message">\n        <div class="title">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"order_thankyou",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='</div>\n        <div class="text">'+o("function"==typeof(s=t.status_message||e&&e.status_message)?s.call(e,{name:"status_message",hash:{},data:a}):s)+'</div>\n    </div>\n    <legend class="system-info-header">\n        ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BILLED TO",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='\n    </legend>\n    <div class="info-block">\n        <div class="billing-info"></div>\n    </div>\n    <legend class="system-info-header">\n        ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"YOUR ORDER",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+='\n    </legend>\n    <div class="order-block">\n        <div class="order-list"></div>\n    </div>\n    <div class="info-block">\n        <div>',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Order",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+=" #"+o("function"==typeof(s=t.order_id||e&&e.order_id)?s.call(e,{name:"order_id",hash:{},data:a}):s)+"</div>\n        <div>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Purchase date",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+=": "+o("function"==typeof(s=t.order_date||e&&e.order_date)?s.call(e,{name:"order_date",hash:{},data:a}):s)+'</div>\n        <div class="order-total">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"TOTAL",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+" $"+o("function"==typeof(s=t.order_total||e&&e.order_total)?s.call(e,{name:"order_total",hash:{},data:a}):s)+"</div>\n    </div>\n</div>"},useData:!0})}(),Ke=function(e){var t=e.Dialogs.AlloyAlertDialog;return t.extend("PaymentSuccessDialog",{uiContextName:"payment_success_dialog",className:"payment-success-dialog dialog-type-B",dependencies:"billingInfo globalStringManager loginManager orderResponse originalCart timestampHelper".split(" "),__recordShown:!0,initialize:function(i){this.__stringManager=i.globalStringManager,this.__billingInfo=i.billingInfo,this.__orderResponse=i.orderResponse,this.__originalCart=i.originalCart,i.title=this.__stringManager.get("payment_success_title"),i.ok=this.__stringManager.get("payment_success_button"),this.__CCValidator=e.CCValidator,t.prototype.initialize.call(this,i),this.$el.removeClass("can-dismiss"),this.__loginManager.getCurrentUser().invalidate()},postRender:function(){t.prototype.postRender.call(this),this.__orderResponse.populated().then(function(){this.__cart=this.__filterCart();var t=this.__timestampHelper.orderDate(this.__orderResponse.get("order_date"));this.$(".id-body-contents").html(e.template({order_date:t,order_id:this.__orderResponse.get("order_id"),order_total:this.__orderTotal.toFixed(2),status_message:this.__stringManager.get("order_status_message",{product:this.__getProduct()})})),this.createChildContext(e.BillingInfo,{$replaceElement:this.$(".billing-info"),billingInfo:this.__billingInfo}),this.createChildContext(e.OrderList,{$replaceElement:this.$(".order-list"),cart:this.__originalCart}),this.$(".content-container").scrollbar()}.bind(this))},__filterCart:function(){var e=[];return this.__orderTotal=0,_.each(this.__originalCart,function(t){var i={};i.price=t.price,i.name=t.name,e.push(i),this.__orderTotal+=parseFloat(i.price)}.bind(this)),e},__getProduct:function(){var e=!1,t=!1;return _.each(this.__orderResponse.get("cart"),function(i){-1<i.product_name.toLowerCase().indexOf("credit")&&(t=!0),-1<i.product_name.toLowerCase().indexOf("vip")&&(e=!0)}.bind(this)),e&&t?this.__stringManager.get("Credits")+this.__stringManager.get("and")+this.__stringManager.get("VIP"):e&&!t?this.__stringManager.get("VIP"):!e&&t?this.__stringManager.get("Credits"):void 0}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:Xe,CCValidator:ze,OrderList:Fe,BillingInfo:je}),Ze=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s="<div class='alert-message'>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_processing_error_text_1",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</div>\n<div class='alert-message'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_processing_error_text_2",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</div>\n<div class='alert-message'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_processing_error_text_3",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+" <a target='_blank' href='https://help.imvu.com'>www.imvu.com/help</a>.</div>\n"},useData:!0})}(),Je=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PaymentBaseDialog",{uiContextName:"payment_base_dialog",className:"payment-base-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager leanplum loginManager prefsManager restModelFactory window".split(" "),initialize:function(e){t.prototype.initialize.call(this,e),this.__context=IMVU.optionalProperty(e,"context",null),this.__orderPostUrl=this.__globalStartupModel.get("accountOrdersUrl"),this.__loginManager.isLoggedIn()||(this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot),this.__orderSuccess=!1},delete:function(){this.__closePaypalWindow(),this.promiseResolver&&this.promiseResolver.resolve(this.__orderSuccess),t.prototype.delete.call(this)},__destroy:function(){this.hide(),this.delete()},__filterCart:function(){var e=[];return _.each(this.__cart,function(t){var i={};i.price=t.price,i.sku=t.sku,i.pid=t.pid,i.type=t.type,e.push(i)}.bind(this)),e},__setProcessing:function(e){this.$(".buy-now").prop("disabled",e),this.$(".add-credit-card").prop("disabled",e),this.$(".paypal-checkout").prop("disabled",e),this.$el.toggleClass("loading",e),this.$(".payment-input").prop("disabled",e),this.$(".dialog-x").prop("disabled",e)},__openPaypalWindow:function(){this.__closePaypalWindow(),this.__paypalWindow=this.__window.open("/paypal/loading/","_blank")},__closePaypalWindow:function(){this.__paypalWindow&&(this.__paypalWindow.close(),this.__paypalWindow=null)},__displayPaypalOrderUpdate:function(){if(this.stopListening(this.__paypalOrderResponse),this.__closePaypalWindow(),!this.__orderStatus)switch(this.__orderStatus=this.__paypalOrderResponse.get("status"),this.__orderStatus){case"attempted":case"abandoned":break;case"external review":case"review":this.__displayPendingOrderDialog();break;case"validating":case"waiting for payment":case"being delivered":case"approved":case"paid":case"delivered":this.__displayPaypalSuccessDialog();break;case"rejected":case"failed cc check":case"blocked":this.__displayProcessingErrorDialog();break;default:this.__displayUnknownOrderDialog()}},__submitOrder:function(t){this.__restModelFactory.createModel(this.__orderPostUrl,e.UiCore.NodeModel,t).then(function(e){this.__setProcessing(!1),t.paypal_payment?"review"!==e.get("status")&&e.get("paypal_url")?this.__paypalWindow&&!this.__paypalWindow.closed&&(this.__paypalOrderResponse=e,this.__paypalWindow.location.href="https://www.paypal.com/cgi-bin/webscr?cmd=_express-checkout&useraction=commit&token="+e.get("paypal_url"),this.listenTo(this.__paypalOrderResponse,"change",this.__displayPaypalOrderUpdate)):(this.__leanplum.recordEvent("payment_error",{error:"paypal_error",type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__displayProcessingErrorDialog(),this.__closePaypalWindow()):(this.__displayPaymentSuccessDialog(t,e),t.cc_payment&&this.__prefsManager.populated().then(function(){var e=this.__prefsManager.getBool("next.payment.creditcard.save_card.disable"),i=!t.cc_payment.save_card;i!==e&&this.__prefsManager.setBool("next.payment.creditcard.save_card.disable",i)}.bind(this)))}.bind(this)).catch(function(e){switch(this.__setProcessing(!1),this.__closePaypalWindow(),e.error&&"Not authorized for request"===e.error.message&&(this.__leanplum.recordEvent("payment_error",{error:"not authorized",type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot),this.__errorType="Unknown",e.error&&e.error.error&&(this.__errorType=e.error.error,this.__errorMessage=e.error.message),this.__leanplum.recordEvent("payment_error",{error:this.__errorType,type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__errorType){case"ACCOUNT_ORDER_PENDING":t.paypal_payment?this.__displayProcessingErrorDialog():this.__displayPendingOrderDialog();break;case"ACCOUNT_ORDER_PRICE_DISCREPANCY":case"ACCOUNT_ORDER_INVALID_STORE_PRODUCT":case"ACCOUNT_ORDER_EMPTY_CART":this.__displayInvalidPriceDialog();break;case"ACCOUNT_ORDER_FAILURE":case"ACCOUNT_ORDER_INVALID_COUNTRY_CODE":case"INBOUND VALIDATION-001":case"ACCOUNT_ORDER_INVALID_CARD_NUMBER":this.__displayFailedOrderDialog();break;case"ACCOUNT_ORDER_BLOCKED":case"ACCOUNT_ORDER_PAYPAL_SUBMIT_PAYMENT":case"ACCOUNT_ORDER_PAYPAL_PAYMENT_INFO":this.__displayProcessingErrorDialog();break;default:this.__displayUnknownOrderDialog()}}.bind(this))},__displayPaypalSuccessDialog:function(){this.__displayPaymentSuccessDialog({paypal_payment:!0},this.__paypalOrderResponse)},__displayPaymentSuccessDialog:function(t,i){var a;return this.__leanplum.recordEvent("payment_success",{type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__orderSuccess=!0,t.cc_payment?a=t.cc_payment:t.paypal_payment?a={name:"Paypal"}:t.saved_cc_payment&&(a={card_type:this.__selectedCard.get("card_type"),name:this.__selectedCard.get("name"),last_four_digits:this.__selectedCard.get("card_last_digits")}),this.__dialogManager.showDialog(e.PaymentSuccessDialog,{billingInfo:a,orderResponse:i,originalCart:this.__cart}).finished.then(function(e){this.__checkForVerifiedEmailAndExit()}.bind(this)).catch(function(e){this.__checkForVerifiedEmailAndExit()}.bind(this))},__checkForVerifiedEmailAndExit:function(){this.__loginManager.getCurrentUser().populated().then(function(e){e.get("is_email_verified")?this.__destroy():this.__displayEmailVerificationDialog()}.bind(this))},__displayEmailVerificationDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("verify_email_dialog_title"),text:this.__globalStringManager.get("verify_email_dialog_text")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayInvalidPriceDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_invalid_price_title"),text:this.__globalStringManager.get("payment_invalid_price_text"),ok:this.__globalStringManager.get("payment_invalid_price_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayFailedOrderDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_failed_title"),text:this.__globalStringManager.get("payment_failed_text"),ok:this.__globalStringManager.get("payment_failed_button")}).finished},__displayUnknownOrderDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_unknown_title"),html:e.UnknownOrderDialog({}),ok:this.__globalStringManager.get("payment_unknown_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayProcessingErrorDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_processing_error_title"),html:e.ProcessingErrorDialog({}),ok:this.__globalStringManager.get("payment_processing_error_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayPendingOrderDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_pending_title"),html:e.PendingOrderDialog({}),ok:this.__globalStringManager.get("payment_pending_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],PaymentSuccessDialog:Ke,PendingOrderDialog:Ge,ProcessingErrorDialog:Ze,UnknownOrderDialog:Ye}),Qe=function(e){var t=e.PaymentBaseDialog;return t.extend("CreditCardPaymentReviewDialog",{uiContextName:"credit_card_payment_review_dialog",className:"credit-card-payment-review-dialog dialog-type-B",dependencies:"globalStartupModel globalStringManager dialogManager channel billingInfo cart orderTotal itemCount restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-now",name:"buy_now",handler:this.__creditCardCheckout},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(e){t.prototype.initialize.call(this,e),this.$el.removeClass("can-dismiss"),this.title=this.__globalStringManager.get("credit_card_review_title"),this.addToDOM()},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend(e.backButtonTemplate({})),this.setContent("body",e.template),this.setContent("footer",this.$(".dialog-footer-template").text()),this.createChildContext(e.BillingInfo,{$replaceElement:this.$(".billing-info"),billingInfo:this.__billingInfo}),this.createChildContext(e.OrderList,{$replaceElement:this.$(".order-list"),cart:this.__cart}),this.$(".order-total").text(this.__orderTotal.toFixed(2)),this.$(".item-count").text(this.__itemCount),this.$(".content-container").scrollbar()},__creditCardCheckout:function(){this.__setProcessing(!0);var e={cart:this.__filterCart(),channel:this.__channel,payment_method:"cc_payment",cc_payment:this.__billingInfo};this.__submitOrder(e)},__goBack:function(){this.hide(),this.promiseResolver.reject()}})}({UiCore:e["@UiCore"],PaymentBaseDialog:Je,template:We,CCValidator:ze,OrderList:Fe,BillingInfo:je,backButtonTemplate:Ve}),et=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s="<div class='alert-message'><img src='/catalog/web_images/veri_code.gif'></div>\n\n<div class='alert-message'>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"security_code_help_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n"},useData:!0})}(),tt=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("AddCreditCardDialog",{uiContextName:"add_credit_card_dialog",className:"add-credit-card-dialog dialog-type-B",dependencies:"channel cart dialogManager featureAccessManager globalStringManager itemCount leanplum loginManager orderTotal prefsManager timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:".continue-checkout",name:"continue_checkout",handler:this.__continueCheckout},{type:"keyup",selector:".cardnumber",name:"changing_cardnumber",handler:this.__isBlankCardNumber},{type:"blur",selector:".cardnumber",name:"changed_cardnumber",handler:this.__validateCardNumber},{type:"change",selector:".exp-month",name:"change_exp_month_select",handler:this.__validateExpMonth},{type:"change",selector:".exp-year",name:"change_exp_year_select",handler:this.__validateExpYear},{type:"keyup",selector:".security-code",name:"changing_security_code",handler:this.__isBlankSecurityCode},{type:"blur",selector:".security-code",name:"changed_security_code",handler:this.__validateSecurityCode},{type:"keyup",selector:".name-on-card",name:"changing_name",handler:this.__isBlankNameOnCard},{type:"blur",selector:".name-on-card",name:"changed_name",handler:this.__validateNameOnCard},{type:"keyup",selector:".address",name:"changing_address",handler:this.__isBlankAddress},{type:"blur",selector:".address",name:"changed_address",handler:this.__validateAddress},{type:"keyup",selector:".city",name:"change_city",handler:this.__isBlankCity},{type:"blur",selector:".city",name:"change_city",handler:this.__validateCity},{type:"change",selector:".state",name:"change_state_select",handler:this.__validateState},{type:"keyup",selector:".zip",name:"changing_zip",handler:this.__isBlankZip},{type:"blur",selector:".zip",name:"changed_zip",handler:this.__validateZip},{type:"change",selector:".province",name:"change_province_select",handler:this.__validateProvince},{type:"keyup",selector:".postal",name:"changing_postal",handler:this.__isBlankPostal},{type:"blur",selector:".postal",name:"changed_postal",handler:this.__validatePostal},{type:"change",selector:".country",name:"change_country_select",handler:this.__validateCountry},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(i){t.prototype.initialize.call(this,i),this.shouldFocusOnPrimaryButton=!1,i.loginManager.isLoggedIn()||(this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot),this.title=this.__globalStringManager.get("Add New Credit Card"),this.__monthRange="01 02 03 04 05 06 07 08 09 10 11 12".split(" "),this.__getYearRange(),this.__states=e.StateMap,this.__provinces=e.ProvinceMap,this.__countries=e.CountryMap,this.__CCValidator=e.CCValidator,this.__missingFields=[],this.addToDOM()},delete:function(){t.prototype.delete.call(this),this.__tooltip&&this.__tooltip.delete()},__destroy:function(){this.hide(),this.delete()},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend(e.backButtonTemplate({})),this.__prefsManager.populated().then(function(){this.setContent("body",e.template,{monthRange:this.__monthRange,yearRange:this.__yearRange,states:this.__states,provinces:this.__provinces,countries:this.__countries,saveCard:!this.__prefsManager.getBool("next.payment.creditcard.save_card.disable")}),this.$(".non-us-fields").hide(),this.$('.country option[value="US"]').prop("selected",!0),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".exp-month")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".exp-year")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".state")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".province")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".country")}),this.$(".content-container").scrollbar(),this.__tooltip=this.serviceProvider.create(e.Tooltip,{$replaceElement:this.$(".security-code-tooltip"),$tooltipTarget:this.$(".security-code-help-link")})}.bind(this))},__getYearRange:function(){this.__yearRange=[];for(var e=this.__timer.getDate().getFullYear(),t=0;20>t;t++)this.__yearRange.push(t+e)},__validateInputs:function(){this.__validateCardNumber(),this.__validateSecurityCode(),this.__validateExpMonth(),this.__validateExpYear(),this.__validateNameOnCard(),this.__validateCardName(),this.__validateAddress(),this.__validateCity(),this.__validateCountry(),"US"===this.$(".country select").val()?(this.__validateZip(),this.__validateState()):"CA"===this.$(".country select").val()&&(this.__validatePostal(),this.__validateProvince())},__errorIfBlank:function(e,t){var i=t?""===this.$("."+e+" select").val():""===this.$("."+e).val().trim();return this.__updateMissingFields(e,i),i},__updateMissingFields:function(e,t){this.$("."+e).toggleClass("payment-error",t);var i=this.__missingFields.indexOf(e);t&&0>i?this.__missingFields.push(e):!t&&-1<i&&this.__missingFields.splice(i,1),this.$(".field-missing").toggleClass("error-visible",0!==this.__missingFields.length)},__isBlankCardNumber:function(e){-1<this.__missingFields.indexOf("cardnumber")&&this.__errorIfBlank("cardnumber"),this.__displayCardIcon(this.$(".cardnumber").val()),this.__updateErrorStatus()},__validateCardNumber:function(){if(this.__errorIfBlank("cardnumber"))this.$(".cardnumber-invalid").removeClass("error-visible");else{this.__leanplum.recordEvent("add_cc_cc_change");var e=this.$(".cardnumber").val().replace(/[ \-]/g,"");e.match(/^\d{13,16}$/)&&this.__CCValidator.passesChecksum(e)?(this.$(".cardnumber-invalid").removeClass("error-visible"),this.$(".cardnumber").removeClass("payment-error")):(this.$(".cardnumber-invalid").addClass("error-visible"),this.$(".cardnumber").addClass("payment-error"))}this.__updateErrorStatus()},__validateCardName:function(){var e=this.$(".name-on-card").val().trim(),t=e.trim().split(/\s+/).length;/\d/.test(e)||2>t?(this.$(".cardname-invalid").addClass("error-visible"),this.$(".name-on-card").addClass("payment-error")):(this.$(".cardname-invalid").removeClass("error-visible"),this.$(".name-on-card").removeClass("payment-error")),this.__updateErrorStatus()},__displayCardIcon:function(e){(e=this.__CCValidator.getType(e))?(this.$(".cardimage").addClass("card-number-present"),this.$(".cardimage."+e).addClass("card-type-active")):(this.$(".cardimage").removeClass("card-number-present"),this.$(".cardimage").removeClass("card-type-active")),this.__updateErrorStatus()},__isBlankSecurityCode:function(){-1<this.__missingFields.indexOf("security-code")&&this.__errorIfBlank("security-code"),this.__updateErrorStatus()},__validateSecurityCode:function(){this.__errorIfBlank("security-code")?this.$(".security-code-invalid").removeClass("error-visible"):(this.__leanplum.recordEvent("add_cc_security_code_change"),this.$(".security-code").val().trim().match(/^\d\d\d\d?$/)?(this.$(".security-code-invalid").removeClass("error-visible"),this.$(".security-code").removeClass("payment-error")):(this.$(".security-code-invalid").addClass("error-visible"),this.$(".security-code").addClass("payment-error"))),this.__updateErrorStatus()},__validateExpMonth:function(){this.__errorIfBlank("exp-month",!0)||(this.__leanplum.recordEvent("add_cc_exp_month_change"),this.__validateExpDate()),this.__updateErrorStatus()},__validateExpYear:function(){this.__errorIfBlank("exp-year",!0)||(this.__leanplum.recordEvent("add_cc_exp_year_change"),this.__validateExpDate()),this.__updateErrorStatus()},__validateExpDate:function(){var e=parseInt(this.$(".exp-year select").val(),10),t=parseInt(this.$(".exp-month select").val(),10);if(0<e&&0<t){var i=(a=this.__timer.getDate()).getFullYear(),a=a.getMonth()+1;i>e||i===e&&a>t?(this.$(".exp-date-expired").addClass("error-visible"),this.$(".exp-month").addClass("payment-error"),this.$(".exp-year").addClass("payment-error")):(this.$(".exp-date-expired").removeClass("error-visible"),this.$(".exp-month").removeClass("payment-error"),this.$(".exp-year").removeClass("payment-error"))}else this.$(".exp-date-expired").removeClass("error-visible");this.__updateErrorStatus()},__isBlankNameOnCard:function(){-1<this.__missingFields.indexOf("name-on-card")&&this.__errorIfBlank("name-on-card"),this.__updateErrorStatus()},__validateNameOnCard:function(){this.__errorIfBlank("name-on-card"),this.__updateErrorStatus()},__isBlankAddress:function(){-1<this.__missingFields.indexOf("address")&&this.__errorIfBlank("address"),this.__updateErrorStatus()},__validateAddress:function(){this.__errorIfBlank("address"),this.__leanplum.recordEvent("add_cc_address_change"),this.__updateErrorStatus()},__isBlankCity:function(){-1<this.__missingFields.indexOf("city")&&this.__errorIfBlank("city"),this.__updateErrorStatus()},__validateCity:function(){this.__errorIfBlank("city"),this.__updateErrorStatus()},__validateState:function(){this.__errorIfBlank("state",!0),this.__leanplum.recordEvent("add_cc_state_change"),this.__updateErrorStatus()},__validateProvince:function(){this.__errorIfBlank("province",!0),this.__leanplum.recordEvent("add_cc_province_change"),this.__updateErrorStatus()},__isBlankZip:function(){-1<this.__missingFields.indexOf("zip")&&this.__errorIfBlank("zip"),this.__updateErrorStatus()},__validateZip:function(){this.__errorIfBlank("zip")?this.$(".zip-invalid").removeClass("error-visible"):(this.__leanplum.recordEvent("add_cc_zip_change"),this.$(".zip").val().trim().match(/^\d\d\d\d\d$/)?(this.$(".zip-invalid").removeClass("error-visible"),this.$(".zip").removeClass("payment-error")):(this.$(".zip-invalid").addClass("error-visible"),this.$(".zip").addClass("payment-error"))),this.__updateErrorStatus()},__isBlankPostal:function(){"CA"===this.$(".country select").val()&&-1<this.__missingFields.indexOf("postal")&&this.__errorIfBlank("postal"),this.__updateErrorStatus()},__validatePostal:function(){"CA"===this.$(".country select").val()&&(this.__leanplum.recordEvent("add_cc_postal_change"),this.__errorIfBlank("postal")?this.$(".postal-invalid").removeClass("error-visible"):this.$(".postal").val().trim().match(/^[A-Za-z]\d[A-Za-z]\s*\d[A-Za-z]\d$/)?(this.$(".postal-invalid").removeClass("error-visible"),this.$(".postal").removeClass("payment-error")):(this.$(".postal-invalid").addClass("error-visible"),this.$(".postal").addClass("payment-error"))),this.__updateErrorStatus()},__validateCountry:function(){this.__leanplum.recordEvent("add_cc_country_change"),this.$(".zip-invalid").removeClass("error-visible"),this.$(".postal-invalid").removeClass("error-visible"),this.__updateMissingFields("zip",!1),this.__updateMissingFields("state",!1),this.__updateMissingFields("postal",!1),this.__updateMissingFields("province",!1),this.__errorIfBlank("country",!0),"US"===this.$(".country select").val()?(this.$(".us-fields").show(),this.$(".non-us-fields").hide(),this.$(".country-container").addClass("us"),this.$(".postal").val(""),this.$('.ca-province option[value=""]').prop("selected",!0)):(this.$(".country-container").removeClass("us"),this.$(".us-fields").hide(),this.$(".zip").val(""),this.$('.state option[value=""]').prop("selected",!0),this.$(".non-us-fields").show(),"CA"===this.$(".country select").val()?(this.$(".ca-province").show(),this.$(".country-container").addClass("canada"),this.$(".postal").removeClass("intl")):(this.$(".postal").addClass("intl"),this.$(".ca-province").hide(),this.$('.ca-province option[value=""]').prop("selected",!0),this.$(".country-container").removeClass("canada"))),this.__updateErrorStatus()},__updateErrorStatus:function(){this.$(".error-block").toggleClass("has-error",0<this.$(".error-visible").length)},__continueCheckout:function(){this.__validateInputs(),0<this.$(".payment-error").length?this.$(".dialog-body").scrollTop(0):this.__dialogManager.showDialog(e.CreditCardPaymentReviewDialog,{billingInfo:this.__getBillingInfo(),channel:this.__channel,cart:this.__cart,orderTotal:this.__orderTotal,itemCount:this.__itemCount}).finished.then(function(e){this.promiseResolver.accept(),this.__destroy()}.bind(this)).catch(function(e){}.bind(this))},__getBillingInfo:function(){var e=this.$(".country select").val(),t=this.$(".state select").val(),i=this.$(".zip").val().trim();return"CA"===e?(t=this.$(".province select").val(),i=this.$(".postal").val().trim()):"US"!==e&&(t="",i=this.$(".postal").val().trim()),{name:this.$(".name-on-card").val().trim(),address:this.$(".address").val().trim(),city:this.$(".city").val().trim(),state:t,postal_code:i,country:e,credit_card:this.$(".cardnumber").val().replace(/[ \-]/g,""),exp_month:this.$(".exp-month select").val(),exp_year:this.$(".exp-year select").val(),cvc:this.$(".security-code").val().trim(),save_card:this.$("#save-for-later-checkbox").prop("checked")}},__goBack:function(){this.hide(),this.promiseResolver.reject()}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:He,SecurityCodeHelpDialog:et,CountryMap:e["json!/common/js/JSON/Countries.json"],StateMap:e["json!/common/js/JSON/States.json"],ProvinceMap:e["json!/common/js/JSON/Provinces.json"],Dropdown:_e,CCValidator:ze,Tooltip:Ie,CreditCardPaymentReviewDialog:Qe,backButtonTemplate:Ve}),it=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s,o=this.escapeExpression;return i=t.helperMissing,o='<div class="card-row">\n    <div class="card-wrap">\n        <div class="card-info">\n            <div class="number">XXXX-XXXX-XXXX-'+o("function"==typeof(s=t.cardNumber||e&&e.cardNumber)?s.call(e,{name:"cardNumber",hash:{},data:a}):s)+'</div>\n            <div><span class="type">'+o("function"==typeof(s=t.type||e&&e.type)?s.call(e,{name:"type",hash:{},data:a}):s)+'</span></div>\n        </div>\n        <div class="primary">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Primary",{name:"i18n-g",hash:{},data:a}))||0===n)&&(o+=n),o+='</div>\n        <div class="context">\n            <span class="icon icon-action-more context-menu-button"></span>\n        </div>\n    </div>\n    <div class="primary">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Primary",{name:"i18n-g",hash:{},data:a}))||0===n)&&(o+=n),o+"</div>\n</div>"},useData:!0})}(),at=function(e){var t=e.UiCore.UiContext;return t.extend("SavedCreditCardListItem",{className:"saved-credit-card-list-item",uiContextName:"saved_credit_card_list_item",tagName:"li",dependencies:"context contextMenuManager dialogManager globalStringManager rest selectedCard".split(" "),trackedEvents:function(){return[{type:"click",name:"select_card",handler:this.__selectCard},{type:"click",name:"show_context_menu",selector:".context-menu-button",handler:this.__showContextMenu}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM(),this.listenTo(this.model,"select",this.__selectCard)},render:function(){this.model.populated().then(function(){var t=this.model.get("card_type")?this.model.get("card_type"):"other";this.__cardTypeString=this.__globalStringManager.get("card_type_"+t),this.$el.html(e.template({cardNumber:this.model.get("card_last_digits"),type:this.__cardTypeString})),this.model.get("is_primary")&&this.$el.addClass("is-primary"),null!==this.__selectedCard&&this.model.get("is_primary")&&this.__selectCard()}.bind(this))},__showContextMenu:function(t){var i=this.model.get("is_primary")?[{name:"delete_card",text:this.__globalStringManager.get("Delete"),handler:this.__deleteCard.bind(this)}]:[{name:"make_primary",text:this.__globalStringManager.get("Make Primary"),handler:this.__makePrimary.bind(this)},{name:"delete_card",text:this.__globalStringManager.get("Delete"),handler:this.__deleteCard.bind(this)}];this.__contextMenuManager.showMenu(t,e.ContextMenu,{items:i,displayOptions:{above:!1,right:!1}})},__selectCard:function(){e.NextUtil.DomHelper.radioClass(this.$el,"selected-card"),null!==this.__selectedCard&&(this.__selectedCard.set({id:parseInt(this.model.id.match(/\d+/)[0].replace("saved_card-","")),card_type:this.__cardTypeString,name:this.model.get("name"),card_last_digits:this.model.get("card_last_digits")}),this.__selectedCard.trigger("selected"))},__makePrimary:function(){this.$el.hasClass("is-primary")||this.model.save({default:!0}).then(function(){this.$el.addClass("is-primary")}.bind(this))},__deleteCard:function(){this.__dialogManager.confirm({title:this.__globalStringManager.get("Delete Payment Method"),text:this.__globalStringManager.get("Are you sure you want to delete this payment method?"),yes:this.__globalStringManager.get("Delete"),no:this.__globalStringManager.get("Cancel")}).finished.then(function(){this.__selectedCard&&null!==this.__selectedCard.get("id")&&this.__selectedCard.get("id")===parseInt(this.model.id.match(/\d+/)[0].replace("saved_card-",""))&&(this.__selectedCard=new IMVU.NamedModel({id:null}),this.__context.trigger("selected_card_deleted")),this.__rest.delete(this.model.id),this.__context.trigger("card_deleted"),this.delete()}.bind(this))}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:it,ContextMenu:g}),nt=function(e){var t=e.UiCore.ListPresenter;return t.extend("SavedCreditCardList",{className:"saved-credit-card-list",uiContextName:"saved_credit_card_list",tagName:"ul",itemFactory:e.SavedCreditCardListItem,dependencies:["globalStringManager"],initialize:function(e){t.prototype.initialize.call(this,e),this.__showEmptyText=IMVU.optionalProperty(e,"showEmptyText",!1)},__emptyText:function(){if(this.$el.addClass("is-empty"),this.__showEmptyText)return{standard:this.__globalStringManager.get("No Saved Card"),concise:this.__globalStringManager.get("No Saved Card")}}})}({UiCore:e["@UiCore"],SavedCreditCardListItem:at}),st=function(e){var t=e.PaymentBaseDialog;return t.extend("PaymentDialog",{uiContextName:"payment_dialog",className:"payment-dialog dialog-type-B",dependencies:"cart dialogManager globalStringManager globalStartupModel googleAnalytics leanplum platform restModelFactory".split(" "),trackedEvents:function(){return[{type:"change",selector:".vip",name:"vip_checkbox_changed",handler:"__validateVipCheckbox"},{type:"click",selector:".core-store-link",name:"go_to_core_store",handler:"__goToCoreStore",allowBubble:!0},{type:"click",selector:".add-credit-card",name:"add_credit_card",handler:"__addCreditCard"},{type:"click",selector:".paypal-checkout",name:"paypal_checkout",handler:"__paypalCheckout"},{type:"click",selector:".buy-now",name:"buy_now",handler:"__creditCardCheckout"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("payment_dialog_title"),this.shouldFocusOnPrimaryButton=!1,this.__channel=IMVU.optionalProperty(e,"channel","unknown"),this.__platformId=(this.__isMobile="mobile"===this.__platform)?10:9,this.__selectedCard=new IMVU.NamedModel({id:null}),this.listenTo(this.__selectedCard,"selected",this.__toggleCheckoutButton.bind(this,!0)),this.listenTo(this,"selected_card_deleted",this.__toggleCheckoutButton.bind(this,!1)),this.addToDOM()},postRender:function(){this.__validateCart(),this.setContent("body",e.template,{hasVip:this.__hasVip,platformId:this.__platformId,itemCount:this.__cart.length,showTotal:1<this.__cart.length}),this.setContent("footer",this.$(".dialog-footer-template").text()),this.__invalidProduct?(this.$(".buy-now").prop("disabled",!0),this.$(".invalid-product").addClass("error-visible")):this.createChildContext(e.OrderList,{$replaceElement:this.$(".order-list-placeholder"),cart:this.__cart}),this.__toggleCheckoutButton(!1),this.__savedCreditCards=this.track(this.__restModelFactory.readCollection(this.__globalStartupModel.get("savedCreditCardUrl"),e.UiCore.NodeCollection)),this.listenTo(this.__savedCreditCards,"reset",this.__loadSavedCard),this.__loadSavedCard(),this.$(".order-total").text(this.__orderTotal.toFixed(2)),this.$(".item-count").text(this.__itemCount),this.__hasVip&&this.createChildContext(e.Tooltip,{$replaceElement:this.$(".vip-toc-tooltip"),$tooltipTarget:this.$(".vip-toc-link")}),this.$(".content-container").scrollbar()},__toggleCheckoutButton:function(e){this.$(".buy-now").prop("disabled",!e)},__validateCart:function(){return this.__itemCount=this.__orderTotal=0,this.__invalidProduct=this.__hasVip=!1,0===this.__cart.length&&(this.__invalidProduct=!0),_.each(this.__cart,function(e){!e.name||!e.sku||!e.price||0>e.price?this.__invalidProduct=!0:0<e.sku.indexOf(".vip.")&&(this.__hasVip=!0),this.__itemCount++,this.__orderTotal+=e.price,e.price=e.price.toFixed(2)}.bind(this)),!this.__invalidProduct},__validateVipCheckbox:function(){this.$(".vip").prop("checked")?(this.$(".vip-checkbox-missing").removeClass("error-visible"),this.$(".vip-block label").removeClass("payment-error")):(this.$(".vip-checkbox-missing").addClass("error-visible"),this.$(".vip-block label").addClass("payment-error")),this.__updateErrorStatus()},__updateErrorStatus:function(){this.$(".error-block").toggleClass("has-error",0<this.$(".error-visible").length)},__scrollTop:function(){this.$(".content-container").scrollTop(0)},__creditCardCheckout:function(){this.__hasVip&&this.__validateVipCheckbox(),0<this.$(".payment-error").length?this.__scrollTop():(this.__leanplum.recordEvent("dollar_store_buy_start",{type:this.__cart[0].type,sku:this.__cart[0].sku,price:this.__cart[0].price,pid:this.__cart[0].pid}),this.__googleAnalytics.recordDollarStore("buy",this.__cart[0].sku),this.__setProcessing(!0),this.__submitOrder(this.__createSavedCreditCardOrder()))},__createSavedCreditCardOrder:function(){return{cart:this.__filterCart(),channel:this.__channel,payment_method:"saved_cc_payment",saved_cc_payment:{id:this.__selectedCard.get("id")}}},__paypalCheckout:function(){this.__hasVip&&this.__validateVipCheckbox(),0<this.$(".payment-error").length?this.__scrollTop():(this.__setProcessing(!0),this.__openPaypalWindow(),this.__submitOrder({cart:this.__filterCart(),channel:this.__channel,payment_method:"paypal_payment",paypal_payment:{}}))},__goToCoreStore:function(){},__loadSavedCard:function(){this.__savedCreditCards.populated().then(function(){this.$(".savedcard-container").html("");var t=_.filter(this.__savedCreditCards.models,function(e){return"co"!==e.attributes.system}.bind(this));t=new IMVU.NamedCollection(t);this.__savedCard=this.createChildContext(e.SavedCreditCardList,{$parentElement:this.$(".savedcard-container"),collection:t,context:this,selectedCard:this.__selectedCard});var i=!1;_.each(t.models,function(e){e.get("is_primary")&&(i=!0)}),!i&&0<t.models.length&&t.models[0].trigger("select")}.bind(this))},__addCreditCard:function(){if(this.__hasVip&&this.__validateVipCheckbox(),!(0<this.$(".payment-error").length))return this.__dialogManager.showDialog(e.AddCreditCardDialog,{channel:this.__channel,cart:this.__cart,orderTotal:this.__orderTotal,itemCount:this.__itemCount}).finished.then(function(e){this.promiseResolver.accept(),this.__destroy()}.bind(this)).catch(function(e){}.bind(this));this.__scrollTop()}})}({UiCore:e["@UiCore"],PaymentBaseDialog:Je,AddCreditCardDialog:tt,Dropdown:_e,OrderList:Fe,SavedCreditCardList:nt,Tooltip:Ie,template:Oe}),ot=function(e){var t=e.UiCore.UiContext;return t.extend("CheckoutButton",{uiContextName:"checkout_button",className:"inline-purchase-checkout-button",dependencies:["globalStringManager","dialogManager","loginManager"],trackedEvents:function(){return[{type:"click",selector:".buy-now",name:"store_checkout",handler:this.__storeCheckout}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__stringManager=i.globalStringManager,this.__formatNumber=e.FormatNumber,this.dialogManager=i.dialogManager,this.__selectedCredit=IMVU.optionalProperty(i,"selectedCredit",new IMVU.NamedModel({price:0})),this.__selectedVip=IMVU.optionalProperty(i,"selectedVip",new IMVU.NamedModel({price:0})),this.__context=IMVU.optionalProperty(i,"context",null),this.listenTo(this.__selectedCredit,"change",this.__updateCheckoutButton),this.listenTo(this.__selectedVip,"change",this.__updateCheckoutButton),this.addToDOM(),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__updateCheckoutButton()},render:function(){this.$el.html(e.template())},__updateCheckoutButton:function(){var e;this.__getNumber()?(this.$("button.buy-now").prop("disabled",!1),e=1===this.__getNumber()?this.__stringManager.get("checkout_dialog_buy_now_message_singular",{totalCredits:"$"+this.__formatNumber.formatCredits(this.__getTotalPrice())}):this.__stringManager.get("checkout_dialog_buy_now_message_plural",{howMany:this.__getNumber(),totalCredits:"$"+this.__formatNumber.formatCredits(this.__getTotalPrice())}),this.$("button.buy-now").text(e)):(this.$("button.buy-now").prop("disabled",!0),this.$("button.buy-now").text(this.__stringManager.get("CHECKOUT")))},__getNumber:function(){var e=0;return 0<this.__selectedCredit.get("price")&&e++,0<this.__selectedVip.get("price")&&e++,e},__getTotalPrice:function(){return(this.__selectedCredit.get("price")+this.__selectedVip.get("price")).toFixed(2)},__storeCheckout:function(){this.$("button.buy-now").prop("disabled",!0),this.__myself.populated().then(function(t){if(t.get("is_on_hold"))return this.dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("payment_failed_account_holdon_title"),text:this.__stringManager.get("payment_failed_account_holdon_text"),ok:this.__stringManager.get("payment_failed_account_holdon_button")}).finished.then(function(){this.__context&&this.__context.destroy()}.bind(this));0<this.__selectedVip.get("price")&&this.__myself.get("is_vip")?this.__myself.getEdgeCollection("vip_subscriptions").populated().then(function(t){for(var i=!1,a=0;a<t.models.length;a++){var n=t.models[a].node;n.get("date_stopped")||n.relations.buyer!==this.__myself.id||n.relations.recipient!==this.__myself.id||(i=!0)}if(i)return this.dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("already_have_vip_subscription_title"),html:e.AlreadyHaveVipDialog({}),ok:this.__stringManager.get("already_have_vip_subscription_button")}).finished.then(function(){this.__context&&this.__context.destroy()}.bind(this));this.__checkout()}.bind(this)):this.__checkout()}.bind(this))},__checkout:function(){var t=[];return _.each([this.__selectedCredit,this.__selectedVip],function(e){e.get("price")&&t.push({pid:e.get("pid"),sku:e.get("sku"),name:e.get("name"),original_price:e.get("original_price"),price:e.get("price"),type:e.get("type"),frequency_code:e.get("frequency_code"),image:e.get("image")})}),this.dialogManager.showDialog(e.PaymentDialog,{cart:t,channel:"next-inline",context:this.__context}).finished.then(function(){this.__context&&(this.__context.purchaseComplete=!0,this.__context.destroy())}.bind(this)).catch(function(){this.__context&&this.__context.includeBuyCredits&&this.__context.trigger("refresh_items",!0),this.$("button.buy-now").prop("disabled",!1)}.bind(this))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:Le,AlreadyHaveVipDialog:Re,FormatNumber:ie,PaymentDialog:st}),rt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<a class="back-button">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Back",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</a>"},useData:!0})}(),lt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n;return'\n    <legend class="system-info-header">'+(0,this.escapeExpression)("function"==typeof(n=t.titleText||e&&e.titleText)?n.call(e,{name:"titleText",hash:{},data:a}):n)+"</legend>\n"},3:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <div class="vip-description">\n        <div class="crown-icon">\n            <svg class="image" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 80 80" class="color-gold" fill-rule="evenodd"><path d="M58 17.272a2.218 2.218 0 0 0-4.434 0c0 .594.234 1.128.612 1.524l-6.216 6.108a.422.422 0 0 1-.681-.129l-6.033-13.698a2.212 2.212 0 0 0 1.017-1.86 2.218 2.218 0 0 0-4.437 0c0 .78.405 1.464 1.017 1.86l-6.033 13.698a.422.422 0 0 1-.681.129l-6.267-6.156c.351-.393.57-.906.57-1.476a2.218 2.218 0 0 0-4.434 0 2.21 2.21 0 0 0 1.992 2.196c.351 2.916 1.941 16.161 1.98 16.212.549 1.272 6.633 2.274 14.076 2.274 7.44 0 13.524-1.002 14.073-2.274.039-.051 1.632-13.326 1.98-16.224A2.208 2.208 0 0 0 58 17.272M24.71 70.81h-3.836L10.633 46h4.786l7.426 18.933L30.235 46h4.68L24.71 70.81zm14.674-.177V46h4.329v24.633h-4.329zm20.13-7.917h-4.892v7.918h-4.328V46h9.712c5.772 0 9.36 3.272 9.36 8.305 0 5.525-4.433 8.41-9.852 8.41zm.14-12.774h-5.032v8.868h5.033c3.272 0 5.313-1.83 5.313-4.4v-.07c0-2.885-2.076-4.398-5.313-4.398z"/></svg>\n        </div>\n        <div class="title">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_title",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n        <div class="sentence">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_sentence",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</div>\n        ",((n=t.if.call(e,e&&e.showLearnLink,{name:"if",hash:{},fn:this.program(4,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+"\n    </div>\n"},4:function(e,t,i,a){var n;i=t.helperMissing;var s='\n            <div class="learn-link-outer">\n                <div class="learn-link-inner">\n                    ';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_learn_link",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"\n                </div>\n            </div>\n        "},6:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <legend class="system-info-header">\n        ';return((n=t.if.call(e,e&&e.isInCreditDialog,{name:"if",hash:{},fn:this.program(7,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+="\n        ",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"UPGRADES",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"\n    </legend>\n"},7:function(e,t,i,a){var n;i=t.helperMissing;var s="\n            ";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"RECOMMENDED",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i="",((n=t.if.call(e,e&&e.titleShow,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n",((n=t.if.call(e,e&&e.clubSubscriptionShow,{name:"if",hash:{},fn:this.program(3,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n",((n=t.unless.call(e,e&&e.titleShow,{name:"unless",hash:{},fn:this.program(6,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n"},useData:!0})}(),ht=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <div class="promo-banner sale">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"SALE",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+'<div class="triangle"></div></div>\n'},3:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <div class="promo-banner most-popular">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"MOST POPULAR",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+'<div class="triangle"></div></div>\n'},5:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <div class="promo-banner best-value">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BEST VALUE",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+'<div class="triangle"></div></div>\n'},7:function(e,t,i,a){var n,s;i=this.escapeExpression;var o=t.helperMissing,r='\n    <div class="item-info">\n        <div class="image-container"><span class="helper"></span><img></div>\n    </div>\n    <div class="item-price">\n        <div class="subscription-title">'+i("function"==typeof(s=t.description||e&&e.description)?s.call(e,{name:"description",hash:{},data:a}):s)+'</div>\n        <div class="prices">\n            <div class="show-price">\n            ';return((n=t.if.call(e,e&&e.has_discount,{name:"if",hash:{},fn:this.program(8,a),inverse:this.noop,data:a}))||0===n)&&(r+=n),r+="\n            $"+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:a}):s)+'\n            </div>\n            <div class="show-active">\n                ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"ACTIVE",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+"\n            </div>\n        </div>\n    </div>\n"},8:function(e,t,i,a){var n;return'\n                <span class="original-price">$'+(0,this.escapeExpression)("function"==typeof(n=t.original_price||e&&e.original_price)?n.call(e,{name:"original_price",hash:{},data:a}):n)+"</span>\n            "},10:function(e,t,i,a){var n,s;i=this.escapeExpression;var o=t.helperMissing,r='\n    <div class="item-info">\n        <div class="image-container"><img></div>\n        '+i("function"==typeof(s=t.itemLabels||e&&e.itemLabels)?s.call(e,{name:"itemLabels",hash:{},data:a}):s)+'\n        <div class="check-mark check-mark-hidden">\n            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25">\n                <path fill="#404040" fill-rule="evenodd" d="M11.082 15.579l-3.536-3.536-1.414 1.414 4.243 4.243.707.707 8.485-8.485-1.414-1.415-7.071 7.072zM12.5 22.5c-5.523 0-10-4.477-10-10s4.477-10 10-10 10 4.477 10 10-4.477 10-10 10z"/>\n            </svg>\n        </div>\n    </div>\n    <div class="item-price">\n        <div class="show-price">\n        ';return((n=t.if.call(e,e&&e.has_discount,{name:"if",hash:{},fn:this.program(11,a),inverse:this.noop,data:a}))||0===n)&&(r+=n),r+="\n        $"+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:a}):s)+'\n        </div>\n        <div class="show-active">\n            ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"ACTIVE",{name:"i18n-g",hash:{},data:a}))||0===n)&&(r+=n),r+"\n        </div>\n    </div>\n"},11:function(e,t,i,a){var n;return'\n            <span class="original-price">$'+(0,this.escapeExpression)("function"==typeof(n=t.original_price||e&&e.original_price)?n.call(e,{name:"original_price",hash:{},data:a}):n)+"</span>\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i='<div class="wrapper">  \n\n',((n=t.if.call(e,e&&e.is_sale,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.if.call(e,e&&e.is_popular,{name:"if",hash:{},fn:this.program(3,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.if.call(e,e&&e.is_best,{name:"if",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.if.call(e,e&&e.showRows,{name:"if",hash:{},fn:this.program(7,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.unless.call(e,e&&e.showRows,{name:"unless",hash:{},fn:this.program(10,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n</div>\n"},useData:!0})}(),dt=function(e){var t=e.UiCore.UiContext;return t.extend("BuyUpgradeListItem",{uiContextName:"buy_upgrade_list_item",tagName:"article",className:"buy-upgrade-list-item",dependencies:"globalStringManager imageManager loginManager model googleAnalytics window".split(" "),trackedEvents:function(){return[{type:"click",name:"choose_upgrade_item",handler:"__onClickItem"}]},initialize:function(e){this.__width=void 0===e.width?"":e.width,""!==this.__width&&(this.__width="width-"+this.__width),this.__selectedVip=IMVU.requireProperty(e,"selectedVip"),this.__style=IMVU.optionalProperty(e,"style",""),this.__model=e.model,this.__globalStringManager=e.globalStringManager,this.__imageManager=e.imageManager,this.__isInStore=IMVU.optionalProperty(e,"isInStore",!1),this.__context=IMVU.optionalProperty(e,"context",null),this.__isResponsive=IMVU.optionalProperty(e,"isResponsive",!1),t.prototype.initialize.call(this,e),this.__itemLabels=void 0===e.itemLabels?"SUBSCRIPTION":e.itemLabels,this.__itemLabels=this.__globalStringManager.get(this.__itemLabels),this.__scheme=void 0===e.scheme?"":e.scheme,this.__width=void 0===e.width?"":e.width,this.__platform=this.__serviceProvider.get("platform"),this.__myself=this.__loginManager.getCurrentUser(),this.__isActive=!1,this.$el.toggleClass("is-responsive-tile-list-item",this.__isResponsive),this.addToDOM()},render:function(){t.prototype.render.call(this),this.__myself.populated().then(function(){return this.__model.populated()}.bind(this)).then(function(){this.__hasDiscount=this.__model.get("original_price")>this.__model.get("independent_purchase_price");var t=!1;switch("in-dialog"!==this.__style||"mobile"!==this.__platform||this.__isResponsive||(t=!0,this.__scheme="rows"),this.$el.html(e.template({has_discount:this.__hasDiscount,original_price:this.__model.get("original_price").toFixed(2),price:this.__model.get("independent_purchase_price").toFixed(2),is_sale:this.__hasDiscount,is_best:!this.__hasDiscount&&this.__model.get("best"),is_popular:!this.__hasDiscount&&!this.__model.get("best")&&this.__model.get("popular"),showRows:t,description:this.__globalStringManager.get("vip_sbuscription_freq_"+this.__model.get("frequency_code")),itemLabels:this.__itemLabels})),this.__imageManager.load(this.$(".image-container > img"),this.__getImageSrc(this.__model.get("image"))),(this.__hasDiscount||this.__model.get("best")||this.__model.get("popular"))&&this.$el.addClass("has-promo"),this.__myself.get("is_vip")&&this.$el.addClass("clickblocked"),this.__setChecked(!1),"width140"!==this.__width||this.__isResponsive||(this.$el.addClass("width140"),this.$el.addClass("height180"),this.$(".item-info").addClass("width140"),this.$(".item-info").addClass("height140")),this.__modelFrequency="",this.__model.get("frequency_code")){case this.constructor.VIP_MONTHLY:this.__modelFrequency="monthly";break;case this.constructor.VIP_QUARTERLY:this.__modelFrequency="quarterly";break;case this.constructor.VIP_YEARLY:this.__modelFrequency="yearly"}this.__checkForActiveSubscription(),this.listenTo(this.__myself,"change:vip_expires",this.__checkForActiveSubscription)}.bind(this))},__checkForActiveSubscription:function(){this.__myself.get("is_vip")?(this.__vipSubscriptions||(this.__vipSubscriptions=this.__myself.getEdgeCollection("vip_subscriptions")),this.__vipSubscriptions.populated().then(function(e){this.__vipNode=null,this.__isActive=!1,this.__subscriptionFrequency="";for(var t=0;t<e.models.length;t++){var i=e.models[t].node;i.get("date_stopped")||i.relations.buyer!==this.__myself.id||i.relations.recipient!==this.__myself.id||i.get("frequency")!==this.__modelFrequency||(this.__vipNode=i,this.__isActive=!0)}this.$el.toggleClass("active",this.__isActive),this.$el.removeClass("clickblocked"),this.__vipNode&&this.listenTo(this.__vipNode,"change:date_stopped",this.__subscriptionCancelled)}.bind(this))):(this.$el.removeClass("active"),this.$el.removeClass("clickblocked"))},__subscriptionCancelled:function(){this.stopListening(this.__vipNode),this.__vipNode=null,this.__isActive=!1,this.$el.removeClass("active"),this.$el.removeClass("clickblocked")},__getImageSrc:function(e){return"/common/withme/img/store/"+e},__setChecked:function(e){if(this.$el.toggleClass("selected-item",e),"white_charcoal"===this.__scheme){this.$el.siblings().find(".check-mark").addClass("check-mark-hidden"),this.$el.siblings().removeClass("selected-item"),this.$el.siblings().find(".item-price").removeClass("item-price-charcoal"),this.$el.siblings().find(".item-price").addClass("item-price-white");var t=this.$(".item-price");!0===e?(this.$(".check-mark").removeClass("check-mark-hidden"),t.hasClass("item-price-white")&&t.removeClass("item-price-white"),t.addClass("item-price-charcoal")):(this.$(".check-mark").addClass("check-mark-hidden"),t.hasClass("item-price-charcoal")&&t.removeClass("item-price-charcoal"),t.addClass("item-price-white"))}},__onClickItem:function(){this.__isActive||this.$el.hasClass("clickblocked")||"vip"!==this.__model.get("type")||(this.__isInStore?(this.__selectedVip.set({name:this.__model.get("title"),price:this.__model.get("independent_purchase_price"),original_price:this.__model.get("original_price"),sku:this.__model.get("sku"),pid:this.__model.get("pid"),frequency_code:this.__model.get("frequency_code"),type:this.__model.get("type"),image:this.__model.get("image")}),this.__googleAnalytics.recordDollarStore("view",this.__model.get("sku")),this.__selectedVip.trigger("click")):(this.$el.toggleClass("selected-item"),this.$el.hasClass("selected-item")?(this.__setChecked(!0),e.NextUtil.DomHelper.radioClass(this.$el,"selected-item"),this.__selectedVip.set({name:this.__model.get("title"),price:this.__model.get("independent_purchase_price"),original_price:this.__model.get("original_price"),sku:this.__model.get("sku"),pid:this.__model.get("pid"),frequency_code:this.__model.get("frequency_code"),type:this.__model.get("type"),image:this.__model.get("image")}),this.__context&&this.__context.trigger("add_vip_item",!0)):(this.__setChecked(!1),this.__selectedVip.set({price:0}),this.__context&&this.__context.trigger("add_vip_item",!1))))}},{VIP_MONTHLY:2,VIP_QUARTERLY:4,VIP_YEARLY:5})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:ht}),ct=function(e){var t=e.UiCore.ListPresenter;return t.extend("BuyUpgradeList",{uiContextName:"buy_upgrade_list",className:"buy-upgrade-list",tagName:"section",dependencies:["featureAccessManager","globalStringManager","modeManager"],trackedEvents:function(){return[{type:"click",selector:".learn-link-inner",name:"vip_description_learn_link",handler:"__onClickLearnLink"}]},itemFactory:e.BuyUpgradeListItem,initialize:function(i){t.prototype.initialize.call(this,i),this.__width=void 0===i.width?"":i.width,this.__style=IMVU.optionalProperty(i,"style",""),this.__isResponsive=IMVU.optionalProperty(i,"isResponsive",!1),this.__titleShow=-1===["in-dialog","in-credit-dialog"].indexOf(this.__style)||void 0!==i.titleText,this.__titleText=void 0===i.titleText?"UPGRADE TO VIP":i.titleText,this.__titleText=this.__globalStringManager.get(this.__titleText),this.__clubSubscriptionShow=(-1===["in-dialog","in-credit-dialog"].indexOf(this.__style)||!0===i.clubSubscriptionShow)&&!1!==i.clubSubscriptionShow,this.__showLearnLink=this.__featureAccessManager.canSeeVipUpsell(),this.__scheme=void 0===i.scheme?"":i.scheme,this.__bottomPadding=!0===i.bottomPadding,this.$el.toggleClass("is-responsive-tile-list",this.__isResponsive),this.$el.toggleClass("two-columns",400>this.$el.width()),this.$el.prepend(e.template({width:this.__width,titleShow:this.__titleShow,titleText:this.__titleText,clubSubscriptionShow:this.__clubSubscriptionShow,showLearnLink:this.__showLearnLink,itemLabels:i.itemLabels,isInCreditDialog:"in-credit-dialog"===this.__style,scheme:this.__scheme})),this.__bottomPadding&&this.$el.addClass("bottom-padding")},__onClickLearnLink:function(e){this.__modeManager.openMode({mode:{id:"store"},submode:{id:"vip"}})}})}({UiCore:e["@UiCore"],BuyUpgradeListItem:dt,template:lt}),_t=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("BuyUpgradeDialog",{uiContextName:"buyupgrade_dialog",className:"buyupgrade-dialog dialog-type-B",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager Promise restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-upgrade-now",name:"buy_upgrade",handler:this.__buyUpgradeNow},{type:"click",selector:".back-button",name:"go_back",handler:this.__goBack}]},initialize:function(i){t.prototype.initialize.call(this,i),this.purchaseComplete=!1,this.Promise=i.Promise,this.serviceProvider=i.serviceProvider,this.dialogManager=i.dialogManager,this.__stringManager=i.globalStringManager,this.restModelFactory=i.restModelFactory,this.__platform=this.__serviceProvider.get("platform"),this.__formatNumber=e.FormatNumber,this.__storeCatalogUrl=i.globalStartupModel.get("storeCatalogUrl"),this.__storeCatalog=this.restModelFactory.readModel(this.__storeCatalogUrl,e.UiCore.NodeModel),this.title=this.__stringManager.get("buyupgrade_title"),this.__selectedProduct=new IMVU.NamedModel,this.addToDOM()},destroy:function(){this.promiseResolver&&this.promiseResolver.resolve(this.purchaseComplete),this.hide(),this.delete()},postRender:function(){this.setContent("body",e.template),this.createChildContext(e.CheckoutButton,{$parentElement:this.$(".dialog-footer"),selectedVip:this.__selectedProduct,globalStringManager:this.__stringManager,context:this}),this.__storeCatalog.populated().then(function(e){return e.getEdgeCollection("items").populated()}.bind(this)).then(function(t){var i=new IMVU.NamedCollection;_.each(t.models,function(e){"vip"===(e=e.edge).get("type")&&i.add(e)}.bind(this)),("mobile"!==this.__platform||this.__featureAccessManager.canSeeResponsiveList())&&this.$(".dialog-body").addClass("list-like-submode"),this.createChildContext(e.BuyUpgradeList,{$parentElement:this.$(".products"),collection:i,selectedVip:this.__selectedProduct,clubSubscriptionShow:!0,itemLabels:"MEMBERSHIP",scheme:"white_charcoal",width:"width140",style:"in-dialog",isResponsive:!!this.__featureAccessManager.canSeeResponsiveList()}),this.$(".upgrade-products").scrollbar()}.bind(this))},__goBack:function(){this.destroy()}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],Model:e["@Model"],template:Ne,backButtonTemplate:rt,FormatNumber:ie,BuyUpgradeList:ct,CheckoutButton:ot}),gt=function(e){var t=e.Dialogs.AlloyConfirmDialog;return t.extend("ReportUserDialog",{uiContextName:"report_user_dialog",className:"report-user-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager","loginManager"],initialize:function(i){this.__model=i.model,this.__dialogManager=i.dialogManager,this.__restModelFactory=i.restModelFactory,this.__startupModel=i.globalStartupModel,this.__stringManager=i.globalStringManager,i=_.extend({title:this.__stringManager.get("block_person_title"),html:this.__stringManager.get("block_person_html",{username:this.__model.get("display_name").replace("Guest_","")}),yes:this.__stringManager.get("block_person_block"),no:this.__stringManager.get("block_person_cancel")},i),t.prototype.initialize.call(this,i),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__blockedUsers=this.track(this.__myself.getEdgeCollection("blocked",e.UiCore.EdgeCollectionModel))},__onConfirm:function(){this.__blockedUsers.populated().then(function(){return this.__blockedUsers.create({id:this.__model.id})}.bind(this)).then(this.__confirmDialog.bind(this)).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this)).catch(function(e){this.__errorDialog(e).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this))}.bind(this))},__confirmDialog:function(){return this.__dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("block_person_confirm_title"),text:this.__stringManager.get("block_person_confirm_text",{username:this.__model.get("display_name").replace("Guest_","")}),ok:this.__stringManager.get("block_person_confirm_done")}).finished},__errorDialog:function(t){return this.__dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("block_person_error_title"),text:this.__stringManager.get("block_person_error_text"),ok:this.__stringManager.get("block_person_error_done")}).finished}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"]}),pt=o.extend("ReportUserDialog",{uiContextName:"report_user_dialog",className:"report-user-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager"],title:"report_user_title",text:"report_user_text",reportButton:"report_user_report",dropdownOptions:[{label:"report_user_reason_inappropriate_name",value:"name"},{label:"report_user_reason_inappropriate_image",value:"photo"},{label:"report_user_reason_inappropriate_tagline",value:"tagline"},{label:"report_user_reason_inappropriate_interest",value:"interest"}]});return{RoomCard:y,UserProfileCard:function(e){var t=e.Card;return t.extend("UserProfileCard",{uiContextName:"user_profile_card",className:"card user-profile-card",dependencies:"chatManager contextMenuManager dialogManager featureAccessManager friendManager globalStringManager globalStartupModel googleAnalytics imageManager loginManager modeManager prefsManager Promise rest restModelFactory user webGL window windowManager".split(" "),trackedEvents:function(){return t.prototype.trackedEvents.call(this).concat([{type:"click",selector:".current_room .text, .current_room .room-image",name:"current_room",handler:"__joinRoom"},{type:"click",selector:"button.vip",name:"button_vip",handler:"__openVIPDialog"}])},initialize:function(i){_.extend(i,{userNode:i.user,showCloseX:!0,buttons:this.buttons}),t.prototype.initialize.call(this,i),this.__promise=i.Promise,this.__openContext=i.openContext,this.__modeManager=i.modeManager,this.__friendManager=i.friendManager,this.__contextMenuManager=i.contextMenuManager,this.__prefsManager=i.prefsManager,this.__imageManager=i.imageManager,this.__window=i.window,this.__serviceProvider=i.serviceProvider,this.__chatManager=i.chatManager,this.__user=i.user,this.__profileImage=i.profileImage,this.__stringManager=i.globalStringManager,this.__rest=i.rest,this.__restModelFactory=i.restModelFactory,this.__webGL=i.webGL,this.__dialogManager=i.dialogManager,this.__googleAnalytics=i.googleAnalytics,this.__feedItemFactory=i.feedItemFactory||e.FeedItem,this.__featureAccessManager=i.featureAccessManager,this.__deck=i.deck,this.__activeChat=IMVU.optionalProperty(i,"activeChat",null),this.__blockedUserModel=null,this.__windowManager=i.windowManager,(this.__requiresActiveChat=!!i.requiresActiveChat)&&(this.__activeChat=this.__serviceProvider.get("activeChat")),this.buttons=[{cssClass:"friend",text:"Friend"},{cssClass:"unfriend",text:"Unfriend"},{cssClass:"decline",text:"Decline"},{cssClass:"accept",text:"Accept"},{cssClass:"sent",text:"Requested"},{cssClass:"invite",text:"Invite"},{cssClass:"block",text:"Block"}],"message"!==this.__openContext&&this.buttons.push({cssClass:"message",text:"Message"}),this.__myself=this.track(i.loginManager.getCurrentUser()),this.addToDOM()},__canSeeActions:function(){if(this.__openContext){for(var e=this.__openContext,t=["chat_now_submode","room_instance_submode"];e&&-1===t.indexOf(e.uiContextName);)e=e.getParentUiContext();return e&&this.__webGL.use3d()&&this.__activeChat}return!1},close:function(){this.__deck.hide()},delete:function(){t.prototype.delete.call(this),this.__user&&this.__user.off(void 0,void 0,this)},render:function(){t.prototype.render.call(this),this.$(".card-titles .title").addClass("flex-vc").removeClass("title").append('<div class="username"></div>'),this.__showProfile(),this.__user.on("change reset change:relations",this.__showProfile,this)},__initializeFeed:function(){this.__feedInitialized||(this.$el.addClass("loading-feed"),this.$(".card-body").on("scroll.initializeFeed",this.__maybeShowFeed.bind(this)),this.__maybeShowFeed(),this.__feedInitialized=!0)},__showFeed:function(){var t=this.__user.getSingleEdge("personal_feed");t.populated().then(function(){var i=this.__globalStartupModel.get("userEndpoint");this.__restModelFactory.multiGetSetMultiFetchParams(this.__globalStartupModel.get("multiFetchUrl"),this.__globalStartupModel.get("multiFetchBatchSize"));for(var a=t.getEdgeCollection("elements",e.Model.FeedCollection).models,n=Object.keys(a),s=n.length,o=0;o<s;o++){var r=n[o];this.__restModelFactory.multiGetQueueElement(i,a[r].node.relations.actor),void 0!==(r=a[r].node.relations.photo)&&this.__restModelFactory.multiGetQueueElement("photo",r)}this.__restModelFactory.multiGetRequest(i,e.UiCore.NodeModel),this.__restModelFactory.multiGetReset(i),this.__restModelFactory.multiGetRequest("photo",e.UiCore.NodeModel),this.__restModelFactory.multiGetReset("photo"),this.$el.removeClass("loading-feed"),this.__feed=this.createChildContext(e.Feed,{$parentElement:this.$(".card-body"),collection:this.track(t.getEdgeCollection("elements",e.Model.FeedCollection)),scroller:this.$(".card-body"),itemFactory:this.__feedItemFactory,ignoreUserClicks:!0,feedType:"user_profile_card",userProfileCard:!0,showAds:!1})}.bind(this))},__maybeShowFeed:function(){var e=this.$(".card-body").children().last(),t=this.$el.offset().top+this.$el.height();e.offset().top+e.height()<=t&&(this.$(".card-body").off("scroll.initializeFeed"),this.__showFeed())},__showProfile:function(){this.__user.populated().then(function(){return this.__prefsManager.populated()}.bind(this)).then(function(){return this.__blockedUsers=this.track(this.__myself.getEdgeCollection("blocked",e.UiCore.EdgeCollectionModel)),this.__blockedUsers.populated()}.bind(this)).then(function(){this.__blockedUserModel=this.__blockedUsers.find(function(e){return this.__user.id===e.node.id}.bind(this)),this.setForeground("/common/withme/img/loading_avatar.png"),0<this.$(".card-titles .username").length&&(this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".card-titles .username"),user:this.__user,configuration:"large-dual-darkbg",shouldWrap:!0,ignoreClicks:!0}));var t,i=this.__user.get("online"),a=0!==this.__user.get("persona_type");this.__user===this.__myself?t={key:"edit_profile",text:this.__stringManager.get("Edit Profile"),handler:this.__editProfile}:a||this.__user.relations.viewer_friend||(this.__user.relations.viewer_outbound_friend_request?t={key:"friend_request_sent",text:this.__stringManager.get("Friend Request Sent"),handler:null}:this.__user.relations.viewer_inbound_friend_request?0===this.$("button.friend_accept").length&&(t={key:"friend_accept",text:this.__stringManager.get("Accept Friend Request"),handler:this.__friendAction}):t=this.__blockedUserModel?{key:"unblock",text:this.__stringManager.get("Unblock"),handler:this.__unBlockAction}:{key:"friend_send",text:this.__stringManager.get("Add Friend"),handler:this.__friendAction});var n=[];this.shown={age:!0,gender:!0,ap:!0,av:!0,staff:!0,vip:!0},this.__user!==this.__myself?(n=[{key:"more",text:this.__stringManager.get("More"),handler:this.__moreAction,disabled:a},{key:"gift",text:this.__stringManager.get("Gift"),handler:this.__gift,disabled:a}],this.__canSeeActions()?n.push({key:"coop-action",text:this.__stringManager.get("coop_profile_action"),handler:this.__coopAction,disabled:a}):n.push({key:"message",text:this.__stringManager.get("Message"),handler:this.__messageAction,disabled:a})):(this.shown.age=this.__prefsManager.getBool("avwidget_show_age",!0),this.shown.gender=this.__prefsManager.getBool("avwidget_show_gender",!0),this.shown.ap=this.__prefsManager.getBool("avwidget_show_ap",!0),this.shown.av=this.__prefsManager.getBool("avwidget_show_ageverified",!0),this.shown.staff=this.__prefsManager.getBool("avwidget_show_staff",!0),this.shown.vip=this.__prefsManager.getBool("avwidget_show_vip",!0)),this.shown.vip=this.shown.vip&&!this.__featureAccessManager.canSeeVipUpsell(),this.setActions(t,n),this.$el.toggleClass("is-online",i);var s=[];return _.each({staff:this.__user.get("is_staff")&&this.shown.staff,ap:this.__user.get("is_ap")&&this.shown.ap,vip:this.__user.get("is_vip")&&this.shown.vip,"age-verified":this.__user.get("is_ageverified")&&this.shown.av,married:void 0!==this.__user.relations.spouse},function(e,t){e&&s.push(t)}),this.setShields(s),this.__myself.get("is_vip")||this.$(".shields button.vip").prop("disabled",!1),t={age:null!==this.__user.get("age")&&this.shown.age?this.__stringManager.get("x years old",{x:this.__user.get("age")}):null,gender:null!==this.__user.get("gender")&&this.shown.gender?this.__stringManager.get("gender_"+this.__user.get("gender")):null,gender_class:null!==this.__user.get("gender")?this.__user.get("gender"):null,relationship_status:null!==this.__user.get("relationship_status")?this.__stringManager.get("relationship_status_"+this.__user.get("relationship_status")):null,looking_for:null!==this.__user.get("looking_for")?this.__stringManager.get("looking_for_"+this.__user.get("looking_for")):null,member_since:null!==this.__user.get("created")?new Date(this.__user.get("created")).toLocaleDateString():null,location:this.__user.get("country")?this.__stringManager.get("country_"+this.__user.get("country")):null,interests:this.__user.get("interests")||null,tagline:this.__user.get("tagline")||null},this.__user.relations.viewer_friend&&(t.current_friend=!0),"US"===this.__user.get("country")&&this.__user.get("state")&&(t.location=this.__stringManager.get("state_"+this.__user.get("state"))+", "+t.location),t.current_room=!!this.__user.relations.current_room,t.any_affinity=t.relationship_status||t.looking_for,this.setInfo(e.template(t)),this.$(".current_room").hide(),this.__initializeFeed(),t.location&&30<t.location.length&&this.$(".location .text").css("font-size","11px"),this.__user.relations.current_room&&(this.__roomModel=this.__user.getSingleEdge("current_room"),this.__roomModel.populated().then(function(){this.$(".current_room .text").text(this.__roomModel.get("name")),"AP"===this.__roomModel.get("rating")&&this.$(".current_room").addClass("is-ap"),this.__imageManager.loadAsBackgroundImage(this.$(".current_room .room-image"),this.__roomModel.get("themed_image_url")||this.__roomModel.get("image_url")),this.$(".current_room").show()}.bind(this))),this.__getLookImage()}.bind(this)).then(function(e){this.setForeground(IMVU.URI.build(e,{height:500,width:300,view:"chat"}))}.bind(this))},__getLookImage:function(){var e,t,i=new this.__promise(function(t){e=t});return this.__profileImage?t=this.__rest.get(this.__profileImage):(this.__profileOutfitModel=this.__user.getSingleEdge("profile_outfit"),t=this.__profileOutfitModel.populated().then(function(){return this.__rest.get(this.__profileOutfitModel.get("look_url"))}.bind(this))),t.then(function(t){e.resolve(t.response.avatarImage)}.bind(this)),i},__moreAction:function(t){$(t.currentTarget).hasClass("disabled")||this.__user.populated().then(function(){var i=[];0===this.__user.get("persona_type")&&i.push({key:"chat",classNames:this.__user.get("online")?"":"disabled",text:this.__stringManager.get("Invite to Chat"),handler:this.__chatAction.bind(this,!this.__user.get("online"))}),this.__activeChat&&(this.__activeChat.isUserMuted(this.__user)?i.push({name:"unmute",text:this.__stringManager.get("Unmute"),handler:this.__unmuteUser.bind(this)}):i.push({name:"mute",text:this.__stringManager.get("Mute"),handler:this.__muteUser.bind(this)})),this.__canSeeActions()&&i.push({name:"message",text:this.__stringManager.get("Message"),handler:this.__messageAction.bind(this),classNames:0!==this.__user.get("persona_type")?"disabled":""}),this.__user.relations.viewer_friend&&i.push({name:"unfriend",text:this.__stringManager.get("Unfriend"),handler:this.__unfriendAction.bind(this)}),this.__user.relations.viewer_inbound_friend_request&&i.push({name:"decline",text:this.__stringManager.get("Decline Friend Request"),handler:this.__declineFriendAction.bind(this)}),this.__blockedUserModel||i.push({name:"block_person",text:this.__stringManager.get("Block"),handler:this.__blockAction.bind(this)}),i.push({name:"report_person",text:this.__stringManager.get("Report"),handler:this.__reportAction.bind(this)}),this.__contextMenuManager.showMenu(t,e.ContextMenu,{items:i,displayOptions:{above:!0,right:!1}})}.bind(this))},__muteUser:function(){this.__activeChat.muteUser(this.__user),this.close()},__unmuteUser:function(){this.__activeChat.unmuteUser(this.__user),this.close()},__chatAction:function(t){t||this.__user.populated().then(function(){if(this.__featureAccessManager.canSeeChooseRoomDialog())return this.__dialogManager.showDialog(e.ChooseRoomDialog,{user:this.__user});this.__chatManager.inviteUserToMyRoom(this.__user)}.bind(this))},__blockAction:function(t){this.__dialogManager.showDialog(e.BlockPersonDialog,{model:this.__user}).finished.then(function(){this.close()}.bind(this))},__unBlockAction:function(t){this.__dialogManager.showDialog(e.UnBlockPersonDialog,{model:this.__user})},__reportAction:function(t){this.__dialogManager.showDialog(e.ReportUserDialog,{model:this.__user}).finished.then(function(){this.close()}.bind(this))},__messageAction:function(e){e&&$(e.currentTarget).hasClass("disabled")||(this.__featureAccessManager.canSeeWindows()?this.__windowManager.addMessagesWindow("create_message",{model:"userPicker"}).composeMessageTo(this.__user):this.__modeManager.openMode({showAlways:!0,mode:{id:"messages",modelUrl:this.__user.get("username").replace("Guest_","")},submode:{id:"compose"}}).then(function(e){e.composeMessageTo(this.__user)}.bind(this)),this.__dialogManager.closeAll(),this.close())},__editProfile:function(){this.__dialogManager.showDialog(e.EditProfileDialog,{})},__friendAction:function(e){if($(e.target).toggleClass("disabled",!0),this.__user===this.__myself||this.__user.relations.viewer_friend||this.__user.relations.viewer_outbound_friend_request)throw Error("Tried to friend either myself or someone I've already friended!");this.__user.relations.viewer_inbound_friend_request?(this.__googleAnalytics.recordFriendRequest("accepted"),e=this.__friendManager.acceptFriendRequest(this.__user)):(this.__googleAnalytics.recordFriendRequest("sent"),e=this.__friendManager.addFriend(this.__user)),e.then(function(){this.__user.invalidate()}.bind(this))},__unfriendAction:function(){this.__friendManager.unfriend(this.__user).then(function(){this.__dialogManager.alert({title:this.__stringManager.get("dialog_generic_save_success_title"),text:this.__stringManager.get("dialog_generic_save_success_text")+this.__user.get("username").replace("Guest_","")+".",ok:this.__stringManager.get("dialog_generic_save_success_ok")})}.bind(this),function(e){this.__dialogManager.alert({title:this.__stringManager.get("dialog_generic_save_cancelled_title"),text:this.__stringManager.get("dialog_generic_save_cancelled_text"),ok:this.__stringManager.get("dialog_generic_save_cancelled_ok")})}.bind(this))},__declineFriendAction:function(){this.__friendManager.rejectFriendRequest(this.__user).then(function(){this.__user.invalidate(),this.__showProfile()}.bind(this))},__joinRoom:function(){this.__chatManager.goToRoom(this.__roomModel,!0)},__inviteToMyRoom:function(){this.trigger("card:inviteToMyRoom",this.activeProfileModel.get("userNode"))},__coopAction:function(){this.trigger("card:coopWith",this.__user),this.close()},__gift:function(t){t&&$(t.currentTarget).hasClass("disabled")||this.__dialogManager.showDialog(e.ItemPickerDialog,{model:this.__user}).finished.then(function(){this.close()}.bind(this))},__openVIPDialog:function(){return this.__dialogManager.showDialog(e.BuyUpgradeDialog,{})}})}({UiCore:e["@UiCore"],Model:e["@Model"],Widgets:e["@Widgets"],BlockPersonDialog:gt,BuyUpgradeDialog:_t,Card:b,ChooseRoomDialog:Ae,ContextMenu:g,EditProfileDialog:ge,Feed:se,FeedItem:ne,ItemPickerDialog:Me,ReportUserDialog:pt,UnBlockPersonDialog:xe,template:C,profileJSON:e["json!/common/pure/util/profile.json"]})}});
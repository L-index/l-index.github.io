module({"@NextUtil":"@NextUtil","@IMQ":"@IMQ","@globalCSS":"@globalCSS","@Leanplum":"@Leanplum","@Model":"@Model","@ScrollBar":"@ScrollBar","@UiCore":"@UiCore","json!@globalDictionary":"json!@globalDictionary","@Widgets":"@Widgets","@Dialogs":"@Dialogs","@SHA512":"@SHA512","@Cards":"@Cards","@exif":"@exif","@SmartBanner":"@SmartBanner","@Lightboxes":"@Lightboxes","@moment":"@moment","json!/common/pure/util/profile.json":"json!/asset/996b43a0c80f13b9/common/pure/util/profile.json","@FastClick":"@FastClick","css!/build/welcome/welcome-desktop-app.css":"css!/asset/1efd53f8d154434b/build/welcome/welcome-desktop-app.css"},function(e){var t,i,n=(i=Handlebars.template,Handlebars.templates=Handlebars.templates||{},i({1:function(){return"hidden"},3:function(){return'\n    <div class="update-indicator-placeholder"></div>\n    '},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;return i='<div class="system-tray">\n    <div class="logo ',((o=t.unless.call(e,e&&e.showLogo,{name:"unless",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===o)&&(i+=o),i+='">\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30">\n            <title>IMVU logo</title>\n            <path d="M9.42 6.52c-.14-.67-.5-1.193-1.07-1.567-.573-.375-1.196-.49-1.87-.347-.673.143-1.194.502-1.564 1.077-.37.574-.484 1.197-.34 1.87.09.428.284.804.58 1.125-.138.422-.16.848-.07 1.277l.61 2.862c.143.67.5 1.192 1.07 1.562.57.37 1.19.48 1.862.34.67-.15 1.194-.5 1.568-1.07.375-.58.49-1.2.348-1.87l-.61-2.86c-.09-.43-.286-.81-.584-1.14.137-.42.162-.85.072-1.27zm-3.296.7c-.052-.244-.01-.472.122-.684.132-.213.32-.345.562-.396.242-.05.466-.007.675.132.208.14.337.332.39.576.052.244.01.47-.123.678-.135.208-.323.338-.565.39-.242.05-.466.008-.673-.127-.207-.14-.337-.33-.39-.57zm2.744 5.58c-.138.207-.327.335-.567.386-.24.052-.46.01-.66-.125-.2-.13-.33-.32-.38-.56l-.61-2.87c-.05-.24-.01-.46.12-.67.14-.2.32-.33.56-.38.24-.05.47-.01.68.13.21.14.34.32.39.57l.6 2.85c.06.24.01.47-.12.68zm12.617.266c-.687.145-1.22.526-1.6 1.14-.596-.407-1.238-.537-1.924-.392-.67.143-1.19.502-1.57 1.078-.37.576-.49 1.195-.35 1.858l.38 1.76c.25 1.153.87 2.05 1.86 2.685.99.636 2.07.83 3.24.583 1.17-.248 2.07-.864 2.72-1.85.65-.985.85-2.056.6-3.213l-.37-1.747c-.14-.673-.5-1.194-1.07-1.564-.57-.37-1.2-.483-1.87-.338zm1.004 1.664c.21.14.34.33.39.572l.37 1.752c.15.728.03 1.403-.38 2.024-.41.622-.98 1.01-1.71 1.166-.73.155-1.41.032-2.03-.37-.63-.404-1.02-.97-1.17-1.697l-.38-1.765c-.05-.243-.01-.468.12-.675.13-.207.32-.337.57-.39.24-.05.47-.01.68.123.21.134.34.322.39.565l.37 1.768c.05.234.18.418.38.552.21.135.43.177.66.127.244-.052.43-.178.564-.38.13-.203.17-.425.12-.668l-.37-1.754c-.05-.243-.01-.47.13-.683.14-.213.33-.346.575-.397.242-.052.47-.01.68.13zm-11.66 1.385c-.6-.406-1.25-.534-1.95-.385-.68.144-1.21.502-1.58 1.073-.38.572-.49 1.198-.35 1.88.08.376.24.716.48 1.02l2.5 3.127c.29.36.66.63 1.11.79.44.15.89.18 1.36.09.47-.1.87-.31 1.22-.64.34-.32.57-.71.69-1.167l1.01-3.87c.09-.38.1-.76.02-1.15-.14-.674-.5-1.197-1.08-1.57-.57-.37-1.2-.485-1.88-.34-.66.14-1.19.52-1.57 1.134zm1.2 1.07c.09-.368.32-.59.69-.67.24-.052.46-.008.67.13.21.14.34.333.39.576.03.16.03.29 0 .42l-1.02 3.89c-.1.36-.32.58-.68.65-.37.08-.67-.03-.91-.33l-2.49-3.13c-.09-.11-.15-.23-.18-.37-.06-.25-.02-.48.12-.69.13-.21.32-.34.58-.39.36-.07.66.04.89.34l1.37 1.72.55-2.12zm10.8-9.85c-.25-1.155-.86-2.053-1.82-2.695-.97-.64-2.02-.84-3.15-.6-.58.123-1.12.377-1.63.76-.62-.144-1.22-.156-1.8-.032-1.14.24-2.01.85-2.64 1.83-.62.982-.81 2.05-.56 3.206l.37 1.748c.14.664.49 1.184 1.05 1.56.56.378 1.17.498 1.83.357.66-.15 1.18-.52 1.55-1.12.58.4 1.2.53 1.87.39.66-.14 1.17-.52 1.55-1.12.58.4 1.2.53 1.87.39.66-.14 1.17-.5 1.53-1.07.36-.57.46-1.2.32-1.87l-.37-1.75zm-1.25 2.76c-.13.204-.32.333-.56.385-.25.052-.47.01-.68-.124-.21-.135-.33-.327-.39-.578L19.6 8.03c-.05-.24-.175-.428-.372-.56-.198-.13-.415-.17-.652-.12-.236.05-.418.176-.545.375-.12.2-.16.42-.11.663l.37 1.748c.05.24.01.468-.12.68-.13.21-.32.34-.55.39-.24.054-.47.013-.67-.122-.2-.136-.33-.327-.38-.58l-.37-1.746c-.05-.242-.17-.428-.37-.56-.2-.13-.41-.17-.65-.12-.23.048-.41.174-.54.38-.13.206-.17.425-.12.658l.37 1.747c.05.242.01.47-.12.68-.13.21-.32.34-.55.392-.23.05-.46.006-.66-.135-.2-.14-.33-.33-.38-.573l-.37-1.752c-.15-.737-.04-1.41.35-2.024.39-.61.94-.99 1.66-1.15.65-.13 1.27-.03 1.86.32.39-.56.914-.9 1.563-1.04.72-.15 1.38-.03 1.988.38.605.4.985.97 1.14 1.71l.37 1.75c.05.26.017.48-.11.69zm4.84-4.792c-.87-1.018-1.86-1.92-2.97-2.678C21.06.97 18.14 0 15 0c-3.145 0-6.06.97-8.47 2.625-.586.4-1.132.85-1.654 1.33.234-.095.474-.173.72-.224.526-.11 1.08-.13 1.618-.03.54.1 1.05.32 1.5.61.45.3.85.68 1.16 1.13.123.18.23.37.32.57.358-.46.78-.88 1.26-1.21.63-.44 1.35-.74 2.11-.9.58-.12 1.18-.15 1.77-.09.516-.3 1.072-.52 1.654-.64.76-.16 1.538-.18 2.29-.04.755.15 1.473.45 2.12.88.646.43 1.207.97 1.636 1.61.43.64.725 1.36.886 2.12l.372 1.75c.11.52.13 1.07.036 1.6-.09.53-.295 1.04-.58 1.49l-.096.15.067.04c.45.29.85.67 1.16 1.12.31.45.52.97.63 1.49l.37 1.75c.16.77.18 1.56.04 2.32-.14.77-.45 1.49-.88 2.15-.43.66-.98 1.23-1.62 1.66-.64.44-1.37.74-2.14.9h-.01c-.77.17-1.56.19-2.33.05s-1.5-.43-2.16-.86c-.46-.29-.88-.65-1.24-1.05l-.21.8c-.19.74-.6 1.43-1.16 1.96-.56.53-1.27.89-2.01 1.05l-.02.01c-.74.156-1.53.1-2.24-.156-.72-.25-1.37-.716-1.85-1.316l-2.49-3.12c-.4-.493-.69-1.09-.82-1.71-.118-.527-.13-1.08-.03-1.62s.31-1.06.61-1.51l.04-.07-.1-.06c-.45-.29-.854-.67-1.16-1.12-.31-.45-.52-.96-.63-1.487l-.61-2.86c-.09-.405-.11-.827-.07-1.24-.21-.364-.36-.76-.44-1.16-.114-.526-.13-1.08-.033-1.614.014-.072.047-.15.067-.222-.19.29-.37.58-.54.88C.7 9.85 0 12.34 0 15c0 2.655.7 5.142 1.913 7.302.765 1.36 1.73 2.593 2.862 3.652L.998 30H15c3.628 0 6.954-1.288 9.548-3.43.684-.567 1.31-1.197 1.886-1.873C28.654 22.08 30 18.7 30 15c0-3.7-1.346-7.082-3.566-9.697z" fill-rule="evenodd"/>\n        </svg>\n    </div>\n    ',((o=t.if.call(e,e&&e.showUpdateIndicator,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===o)&&(i+=o),i+'\n</div>\n<ul class="main-nav center-nav"></ul>\n<div class="fragment-placeholder"></div>\n'},useData:!0})),o=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;i=t.helperMissing;var a='<a href="#" class="header-button save-profile">';return((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Save",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+"</a>"},useData:!0})}(),a=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var o,a;i=t.helperMissing;var s=this.escapeExpression,r='\n<div class=\'profile\'>\n    <fieldset>\n        <div class="change-profile background-container">\n            <div class="profile-icon-placeholder"></div>\n            <form class="customProfileImage">\n                <label class="change-profile-image" for="custom-profile-image">';return((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"change profile image",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</label>\n                <input class="change-profile-image-input" type="file" accept="image/*" name="custom-profile-image" id="custom-profile-image" />\n            </form>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'edit-profile-header\'>',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"name",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</legend>\n        <div class=\'edit-profile-attribute displayName\'>\n            <textarea id="display_name" type="text" class="value" placeholder="',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"display name",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+="\"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"age",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</legend>\n        <div class="edit-profile-attribute background-container show-label">\n            <input id=\'profile-checkbox-show-age\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_age" data-pref-default=1>\n            <label id="display-age-toggle" for=\'profile-checkbox-show-age\'>\n                <div>\n                    ',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"show age",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+="<br>\n                    <span class='description'>"+s("function"==typeof(a=t.age_description||e&&e.age_description)?a.call(e,{name:"age_description",hash:{},data:n}):a)+' <a class="help-center" href="https://help.imvu.com" target="_blank">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"help center",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+=".</a></span>\n                </div>\n            </label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"gender",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+="</legend>\n        <div class='edit-profile-attribute gender show-label background-container'>\n            <input id='profile-checkbox-show-gender' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_gender\" data-pref-default=1><label for='profile-checkbox-show-gender'>",((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"show gender",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</label>\n        </div>\n        <div class="separator"/>\n        <div class=\'edit-profile-attribute gender\'>\n            <select id="gender" class="value"></select>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'edit-profile-header\'>',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"location",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+="</legend>\n        <div class='edit-profile-attribute geo-location show-label background-container'>\n            <input id='profile-checkbox-show-geo-location' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_geo_location\" data-pref-default=1><label for='profile-checkbox-show-geo-location'>",((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"show location",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</label>\n        </div>\n        <div class="separator"/>\n        <div class=\'edit-profile-attribute location background-container\' id="location"></div>\n        <div class=\'location-container hidden\'>\n            <div class=\'edit-profile-attribute country\'>\n                <select id="country" class="value"></select>\n            </div>\n             <div class="separator"/>\n            <div class=\'edit-profile-attribute state not-applicable\'>\n                <select id="state" class="value"></select>\n            </div>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'edit-profile-header\'>',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"bio",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</legend>\n        <div class=\'edit-profile-attribute tagline\'>\n            <textarea id="tagline" type="text" class="value" placeholder="',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"profile_bio",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+="\"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"interests",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</legend>\n        <div class=\'edit-profile-attribute interests\'>\n            <textarea id="interests" class="value" placeholder="',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"profile_interests",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+="\"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"affinity",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+="</legend>\n        <div class='edit-profile-attribute relationship_status affinity'>\n            <span class=\"descriptor\">",((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"relationship",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+=':</span>\n            <select id="relationship_status" class="value"></select>\n        </div>\n        <div class="separator"/>\n        <div class=\'edit-profile-attribute looking_for affinity\'>\n            <span class="descriptor">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"here for",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+':</span>\n            <select id="looking_for" class="value"></select>\n        </div>\n    </fieldset>\n\n</div>\n'},3:function(e,t,i,n){var o;return i='\n<div class=\'profile\'>\n    <fieldset>\n        <legend class=\'system-info-header\'>Profile Photo</legend>\n        <div class="drawer-profile large-profile background-container">\n            <div class="profile-icon-placeholder"></div>\n            <div class=\'related-pref\'>\n                <form class="customProfileImage">\n                    <label class="change-icon change-profile-image" for="custom-profile-image">Change</label>\n                    <input class="change-profile-image-input" type="file" accept="image/*" name="custom-profile-image" id="custom-profile-image" />\n                </form>\n            </div>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Name</legend>\n        <div class=\'edit-profile-attribute displayName\'>\n            <textarea id="display_name" type="text" class="value" placeholder="Type something"></textarea>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend class=\'system-info-header\'>Avatar Name</legend>\n        <div class=\'edit-profile-attribute avatarName background-container\' id=\'username\'></div>\n    </fieldset>\n    <fieldset>\n        <legend class=\'system-info-header\'>Tagline</legend>\n        <div class=\'edit-profile-attribute tagline\'>\n            <textarea id="tagline" type="text" class="value" placeholder="Type something"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Chat Room</legend>\n        <div class="background-container">\n            <input id=\'profile-checkbox-show-chat-room\' type="checkbox" class="toggle-switch" data-pref="client.is_current_location_hidden" data-pref-invert=1><label for=\'profile-checkbox-show-chat-room\'>Show Chat Room Location</label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Age</legend>\n        <div class="edit-profile-attribute background-container age-container">\n            <div class=\'age\'></div>\n        </div>\n        <div class="edit-profile-attribute background-container show-label">\n            <input id=\'profile-checkbox-show-age\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_age" data-pref-default=1><label id="display-age-toggle" for=\'profile-checkbox-show-age\'>Show Age</label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Gender</legend>\n        <div class=\'edit-profile-attribute gender\'>\n            <select id="gender" class="value"></select>\n        </div>\n        <div class=\'edit-profile-attribute gender show-label background-container\'>\n            <input id=\'profile-checkbox-show-gender\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_gender" data-pref-default=1><label for=\'profile-checkbox-show-gender\'>Show Gender</label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Location</legend>\n        <div class=\'edit-profile-attribute country\'>\n            <select id="country" class="value"></select>\n        </div>\n        <div class=\'edit-profile-attribute state not-applicable\'>\n            <select id="state" class="value"></select>\n        </div>\n        ',((o=t.if.call(e,e&&e.canHideGeoLocation,{name:"if",hash:{},fn:this.program(4,n),inverse:this.noop,data:n}))||0===o)&&(i+=o),i+'\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Interests</legend>\n        <div class=\'edit-profile-attribute interests\'>\n            <textarea id="interests" class="value" placeholder="Type something"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Affinity</legend>\n        <div class=\'edit-profile-attribute relationship_status affinity\'>\n            <span class="descriptor">Relationship:</span>\n            <select id="relationship_status" class="value"></select>\n        </div>\n\n        <div class=\'edit-profile-attribute looking_for affinity\'>\n            <span class="descriptor">Looking For:</span>\n            <select id="looking_for" class="value"></select>\n        </div>\n    </fieldset>\n\n</div>\n<footer class="dialog-footer">\n    <button class="btn btn-primary submit" disabled></button>\n</footer>\n'},4:function(){return"\n            <div class='edit-profile-attribute geo-location show-label background-container'>\n                <input id='profile-checkbox-show-geo-location' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_geo_location\" data-pref-default=1><label for='profile-checkbox-show-geo-location'>Show Location</label>\n            </div>\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;return i="",((o=t.if.call(e,e&&e.canSeeNewEditProfileDesign,{name:"if",hash:{},fn:this.program(1,n),inverse:this.program(3,n),data:n}))||0===o)&&(i+=o),i+'\n<option class="dropdown-item hidden"></option>\n\n'},useData:!0})}(),s=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<footer class="dialog-footer">\n    <a href="javascript:;" class="post footer-post-btn btn btn-primary"></a>\n</footer>'},useData:!0})}(),r=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="back-button"></div>'},useData:!0})}(),l=(r=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("EditProfileImageDialog",{uiContextName:"edit_profile_image_dialog",className:"edit-profile-image-dialog dialog-type-B can-dismiss",dependencies:["globalStringManager","dialogManager","modeManager","timer"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:this.__post},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__stringManager=e.globalStringManager,this.title=this.__stringManager.get("dialog_edit_profile_image_title"),this.__file=IMVU.requireProperty(e,"file",null),this.__modeManager=e.modeManager,_.has(this.__serviceProvider.services,"editProfileImage")||_.has(e,"editProfileImage")?(this.__editProfileImage=e.editProfileImage||this.__serviceProvider.get("editProfileImage"),this.addToDOM()):module.run({EditProfile:"@EditProfileImage"},this.__completeInit.bind(this))},__completeInit:function(e,t){this.__editProfileImage=this.__modeManager.createChildContext(e.EditProfile,{$parentElement:this.__modeManager.$el}),this.__serviceProvider.register("editProfileImage",this.__editProfileImage),this.addToDOM()},postRender:function(){this.setContent("body",e.template),"mobile"===this.serviceProvider.get("platform")&&(this.$(".dialog-header").prepend(e.backButtonTemplate({})),this.$(".dialog-x").remove()),this.$post=this.$(".footer-post-btn").text(this.__stringManager.get("dialog_profile_image_edit_post")),this.__editProfileImage.attach(this.$(".dialog-body")),this.__editProfileImage.restoreScrollValues(),this.__editProfileImage.on("exit",this.hide,this),this.__editProfileImage.on("uploadError",this.__uploadError,this),this.__editProfileImage.on("canPost",this.setPostStatus,this),this.__editProfileImage.changeCustomProfile(this.__file)},__uploadError:function(){this.__timer.setTimeout(function(){this.promiseResolver.resolve(!0),this.__dialogManager.alert({title:this.__stringManager.get("dialog_edit_profile_invalid_image_title"),text:this.__stringManager.get("dialog_edit_profile_invalid_image_text")})}.bind(this),0)},setPostStatus:function(e){this.$post.toggleClass("disabled",!e)},__post:function(){this.__editProfileImage.post()},delete:function(){this.__editProfileImage.reset(),this.__editProfileImage.saveScrollValues(),this.__editProfileImage.detach(),this.__editProfileImage.off(null,null,this),t.prototype.delete.call(this)},__goBack:function(){this.promiseResolver.resolve(!0)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:s,backButtonTemplate:r}),(t={UiCore:e["@UiCore"]}.UiCore.UiContext).extend("UploadCurtain",{uiContextName:"upload_curtain",className:"upload-curtain",dependencies:["Promise","timer"],initialize:function(e){t.prototype.initialize.call(this,e),this.serviceProvider=e.serviceProvider,this.Promise=e.Promise,this.timer=e.timer,this.__completeDelay=e.completeDelay||1e3,this.addToDOM()},show:function(){this.$el.addClass("loading"),t.prototype.show.call(this)},complete:function(){return this.$el.removeClass("loading"),new this.Promise(function(e){this.__completeTimer=this.timer.setTimeout(function(){e.accept(),this.hide()}.bind(this),this.__completeDelay)}.bind(this))},delete:function(){this.timer.clearTimeout(this.__completeTimer)}})),d=(s=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="dropdown-label is-truncated"><span>&nbsp;</span></div>\n<div class="dropdown-option-list-container">\n    <div class="dropdown-scroll-up"></div>\n    <div class="dropdown-scroll-down"></div>\n    <ul class="dropdown-option-list">\n        <li class="dropdown-option is-truncated" data-value="" tabindex="-1"></li>\n    </ul>\n</div>\n'},useData:!0})}(),s=function(e){function t(e){e=$(e.target).closest(".dropdown"),$(".dropdown").not(e).each(function(e,t){$(t).data("dropdown-instance").__hide()})}var i=e.UiCore.UiContext,n=e.NextUtil.Keys;return i.extend("Dropdown",{globalSetup:function(){document.addEventListener("click",t,!0),document.addEventListener("touchend",t,!0)},globalTearDown:function(){document.removeEventListener("click",t,!0),document.removeEventListener("touchend",t,!0)},uiContextName:"dropdown",className:"dropdown disable-text-selection",ITEM_HEIGHT:40,AUTO_SCROLL_BY:2,dependencies:["window","timer"],trackedEvents:function(){return[{type:"click",selector:".dropdown-label",name:"dropdown_label_click",handler:"toggleOpen"},{type:"click",selector:".dropdown-option",name:"dropdown_option_click",handler:"clickOption"},{type:"keydown",selector:"",name:"dropdown_keydown",handler:this.__onKeydown.bind(this,[])},{type:"mousemove",selector:".dropdown-option",name:"dropdown_option_mouseenter",handler:this.__onMousemove.bind(this,{x:0,y:0})},{type:"mouseenter",selector:".dropdown-label",name:"dropdown_label_mouseenter",handler:"__onMouseenterLabel"},{type:"mouseenter",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseenter",handler:"__onScrollUpMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseleave",handler:"__onScrollUpMouseleave"},{type:"mouseenter",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseenter",handler:"__onScrollDownMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseleave",handler:"__onScrollDownMouseleave"}]},__onMousemove:function(e,t){e.x==t.screenX&&e.y==t.screenY||(e.x=t.screenX,e.y=t.screenY,this.$el.focus(),this.setActiveElement($(t.target)))},__onBlur:function(e){this.$el.removeClass("is-open")},__onMouseenterLabel:function(e){this.$(".is-selected").removeClass("is-selected")},initialize:function(e){if(this.$select=IMVU.requireProperty(e,"$replaceElement"),!this.$select.is("select"))throw Error("$replaceElement must be a <select> element. got: "+this.$select[0].tagName);if(this.$select.closest("label").length)throw Error("do not wrap custom dropdowns with <label> tags; it disrupts event handling");i.prototype.initialize.call(this,e),this.window=e.window,this.timer=e.timer,this.boundingBox=e.boundingBox||this.getDefaultBoundingBox(),this.document=e.document||document,this.__keyArray=[],(this.dismissOnScroll=e.dismissOnScroll)&&$(e.dismissOnScroll).on("scroll.dropdown",function(){this.__hide()}.bind(this)),$(".dropdown-layer").length||$("body").append('<div class="dropdown-layer"/>'),this.$dropdownLayer=$(".dropdown-layer"),e.dimNoValue&&this.$el.addClass("dim-no-value"),this.$el.data("dropdown-instance",this),this.addToDOM()},delete:function(){this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray),this.dismissOnScroll&&$(this.dismissOnScroll).off("scroll.dropdown"),$(this.window).off("resize.dropdown"),i.prototype.delete.call(this)},__onHidden:function(){this.$el.is(":visible")&&this.remove(),i.prototype.__onHidden.apply(this,arguments)},getDefaultBoundingBox:function(){var e=this.$el.position().top-5*this.ITEM_HEIGHT,t=e+11*this.ITEM_HEIGHT;return 0>e&&(e=0),t>$(this.window).height()&&(t=$(this.window).height()),{x:0,y:e,w:$(this.window).width(),h:t-e}},render:function(){this.$placeholder=$("<div/>"),this.$el.html(e.template),this.$label=this.$(".dropdown-label"),this.$optionList=this.$(".dropdown-option-list"),this.$optionListContainer=this.$(".dropdown-option-list-container");var t=this.$optionList.find(".dropdown-option");this.$select.addClass("is-enhanced"),this.refreshLabel(this.$select.find(":selected")),t.remove(),this.$select.children().each(function(e,i){var n=t.clone(!0);n.text($(i).text()),n.attr("data-text",$(i).text().toLowerCase()),n.attr("data-value",$(i).val()),this.$optionList.append(n)}.bind(this)),this.$el.addClass(this.$select[0].className).removeClass("dropdown-template").addClass("dropdown"),this.$label.append(this.$select),this.$el.attr("tabindex",this.$select.attr("tabindex")||"0"),this.$select.attr("tabindex",-1),this.$optionList.on("scroll",this.__onScroll.bind(this)),this.$select.on("change",this.__changedOption.bind(this)),this.$el.addClass("is-ready")},__fullHeight:function(){return this.$select.children().length*this.ITEM_HEIGHT},__getSelectedIndex:function(){return this.$select[0].selectedIndex},__getTopEdgeInViewport:function(e){return e.offset().top-$(this.document).scrollTop()},__getComputedInfo:function(){var e=this.__getTopEdgeInViewport(this.$el),t=this.__fullHeight(),i=this.__getSelectedIndex()*this.ITEM_HEIGHT,n=this.getDefaultBoundingBox().y,o=this.getDefaultBoundingBox().y+this.getDefaultBoundingBox().h,a=e-i,s=a+t,r=0;return a<n&&(a=n),s>o&&(r=s-o,s=o,a>n&&(a-=Math.min(a-n,r))),{projectedTopDiff:a-e,computedHeight:s-a,selectedTop:i,maxTop:n,maxBottom:o,fullHeight:t}},__refreshScrollers:function(){var e=this.$optionList[0].scrollHeight-this.$optionList.innerHeight(),t=0<this.$optionList.scrollTop();e=Math.round(this.$optionList.scrollTop())<e;this.$el.toggleClass("can-scroll-up",t).toggleClass("can-scroll-down",e)},isOpen:function(){return this.$el.hasClass("is-open")},__hide:function(){this.isOpen()&&($(this.window).off("resize.dropdown"),this.$el.removeClass("is-open"),this.$placeholder.before(this.$el).detach(),this.$el.removeAttr("style"))},__show:function(){if(!this.isOpen()){$(this.window).on("resize.dropdown",t);var e=this.$el.offset(),i=this.$el.width(),n=this.$el.height(),o=this.$el.css("margin-left"),a=this.$el.css("margin-right"),s=this.$el.css("margin-top"),r=this.$el.css("margin-bottom"),l=this.$el.css("float");this.$placeholder.css({width:i,height:n,"margin-left":o,"margin-right":a,"margin-top":s,"margin-bottom":r,float:l}),this.$el.addClass("is-open").css({top:this.__getTopEdgeInViewport(this.$el),left:e.left,width:i,height:n,"margin-left":0,"margin-right":0,"margin-top":0,"margin-bottom":0}),this.$el=this.$el.before(this.$placeholder).detach(),this.$dropdownLayer.append(this.$el)}},toggleOpen:function(e){return this.isOpen()?this.__hide():(this.__show(),e=this.__getComputedInfo(),this.$optionListContainer.css({top:e.projectedTopDiff,height:e.computedHeight}),this.$el.focus(),e=e.selectedTop+e.projectedTopDiff,this.$optionList.scrollTop(e),this.__lastScrollTop=e,this.setActiveElement(this.$(".dropdown-option").eq(this.__getSelectedIndex())),this.__refreshScrollers()),!1},refreshLabel:function(e){this.$label.find("> span").text(e.text()).toggleClass("no-value",""===e.val())},clickOption:function(e){this.__hide(),this.$select.val($(e.target).attr("data-value")),this.$select.trigger("change"),t(e)},selectByValue:function(e){this.$(".is-selected").removeClass("is-selected"),this.$('.dropdown-option[data-value="'+e+'"]').addClass("is-selected"),this.$("select").val(e),e=this.$("select").find(":selected"),this.refreshLabel(e)},val:function(){return this.$("select").val()},__changedOption:function(e){e=$(e.target).find(":selected"),this.refreshLabel(e)},__maybeScrollOptionIntoView:function(e,t){if(e[0]){var i=this.$el.hasClass("can-scroll-up"),n=this.$el.hasClass("can-scroll-down"),o=this.$optionList,a=o.height(),s=o.offset().top,r=s+a,l=e.outerHeight(),d=e.offset().top,c=d+l,h=d-s+o.scrollTop(),_=a/2-l/2*3;d<s+(i?l:0)?(t&&(h-=_),o.scrollTop(h-(i?this.ITEM_HEIGHT:0))):c>r-(n?l:0)&&(t&&(h+=_),o.scrollTop(h-(a-l)+(n?l:0)))}},__open:function(t){return this.isOpen()&&this.$select.val(this.$optionList.find(".is-selected").attr("data-value")).change(),this.toggleOpen(t),t=this.$optionList.children().eq(this.$select[0].selectedIndex),e.NextUtil.DomHelper.radioClass(t,"is-selected"),t},__moveSelection:function(t){return 0>(t=this.$optionList.children().index(this.$optionList.find(".is-selected"))+t)?t=0:t>this.$select.children().length-1&&(t=this.$select.children().length-1),t=this.$optionList.children().eq(t),e.NextUtil.DomHelper.radioClass(t,"is-selected"),t},setActiveElement:function(t){this.__activeElement=t,e.NextUtil.DomHelper.radioClass(t,"is-selected")},__onKeydown:function(i,o){if(!this.isOpen()&&n.is(o,"VK_ENTER")||!this.isOpen()&&n.is(o,"VK_DOWN"))t(this.$el),this.__open(o);else{var a=this.__activeElement&&this.__activeElement.parent()[0]===this.$optionList[0]?this.__activeElement:this.$(".dropdown-option").first();if(n.is(o,"VK_DOWN"))this.__maybeScrollOptionIntoView(a.next()),a.next()[0]&&this.setActiveElement(a.next());else if(n.is(o,"VK_UP"))this.__maybeScrollOptionIntoView(a.prev()),a.prev()[0]&&this.setActiveElement(a.prev());else if(n.is(o,"VK_ENTER"))this.__hide(),this.$select.val(this.__activeElement.attr("data-value")),this.$select.trigger("change"),t(o);else if(n.is(o,"VK_ESC"))t(this.$el);else{var s=n.getAlphaNumericChar(o);if(!1!==s){var r=a[0];this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray),i.push(s);var l=i.join("").toLowerCase();for(this.__keyValueArray=this.timer.setTimeout(function(){i.length=0}.bind(this),1e3);r.nextSibling;)if(r=r.nextSibling,(s=$(r)).attr("data-text")[0]&&e.NextUtil.string.startsWith(s.attr("data-text"),l))return this.isOpen()||this.toggleOpen(o),this.setActiveElement(s),void this.__maybeScrollOptionIntoView(s,s[0]!=a[0].nextSibling&&s[0]!=a[0].prevSibling);for(r=this.$(".dropdown-option")[0];r&&r!=a[0];){if((s=$(r)).attr("data-text")[0]&&e.NextUtil.string.startsWith(s.attr("data-text"),l)){this.isOpen()||this.toggleOpen(o),this.setActiveElement(s),this.__maybeScrollOptionIntoView(s,s[0]!=a[0].nextSibling&&s[0]!=a[0].prevSibling);break}r=r.nextSibling}}}}},__onScroll:function(e){e=this.$optionList.scrollTop(),this.__refreshScrollers(),this.__lastScrollTop=e},__doScrollUp:function(e,t){var i=this.__getComputedInfo(),n=void 0===t?this.AUTO_SCROLL_BY:t;if(this.$optionListContainer.offset().top+this.$optionListContainer.height()+n<i.maxBottom){var o=this.$optionListContainer.height()+n;o>i.fullHeight&&(o=i.fullHeight),this.$optionListContainer.css({height:o}),this.$optionList[0].scrollTop-=n,this.__refreshScrollers(this.$dropdown)}else void 0===t&&(this.$optionList[0].scrollTop-=this.AUTO_SCROLL_BY)},__onScrollUpMouseenter:function(e){this.timer.clearInterval(this.__autoScrollInterval),this.__autoScrollIntervalCounter=0,this.__autoScrollInterval=this.timer.setInterval(function(){this.__doScrollUp(e)}.bind(this),1)},__onScrollUpMouseleave:function(e){this.timer.clearInterval(this.__autoScrollInterval)},__doScrollDown:function(e,t){var i=this.__getComputedInfo(),n=void 0===t?this.AUTO_SCROLL_BY:t;if((a=this.$optionListContainer.offset().top-n)>i.maxTop){var o=this.$optionListContainer.height()+n,a=this.$optionListContainer.position().top-n;o>i.fullHeight?o=i.fullHeight:this.$optionListContainer.css({top:a}),this.$optionListContainer.css({height:o}),this.$optionList[0].scrollTop+=n,this.__refreshScrollers(this.$dropdown)}else void 0===t&&(this.$optionList[0].scrollTop+=this.AUTO_SCROLL_BY)},__onScrollDownMouseenter:function(e){this.timer.clearInterval(this.__autoScrollDownInterval),this.__autoScrollDownIntervalCounter=0,this.__autoScrollDownInterval=this.timer.setInterval(function(){this.__doScrollDown(e)}.bind(this),1)},__onScrollDownMouseleave:function(e){this.timer.clearInterval(this.__autoScrollDownInterval)}})}({UiCore:e["@UiCore"],template:s,NextUtil:e["@NextUtil"]}),o=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("EditProfileDialog",{uiContextName:"edit_profile_dialog",className:"edit-profile-dialog dialog-type-B",dependencies:"dialogManager featureAccessManager globalStringManager loginManager platform prefsManager Promise".split(" "),trackedEvents:function(){return[{type:"change",selector:".change-profile-image-input",name:"change_profile_image",handler:this.__changeProfileImage},{type:"click",selector:"button.submit",name:"submit",handler:this.__submitChanges},{type:"click",selector:"button.cancel",name:"cancel",handler:this.__cancel},{type:"click",selector:".save-profile",name:"submit",handler:this.__submitChanges},{type:"change",selector:"#country",name:"country",handler:this.__handleCountryChange},{type:"change",selector:"#state",name:"state",handler:this.__handleFieldChange},{type:"click",selector:"#location",name:"location",handler:this.__showLocationDropdown},{type:"change",selector:"#gender",name:"gender",handler:this.__handleFieldChange},{type:"change",selector:"#looking_for",name:"looking_for",handler:this.__handleFieldChange},{type:"change",selector:"#relationship_status",name:"relationship_status",handler:this.__handleFieldChange},{type:"input",selector:"#display_name",name:"display_name",handler:this.__handleFieldChange,repeats:1},{type:"input",selector:"#interests",name:"interests",handler:this.__handleFieldChange,repeats:1},{type:"input",selector:"#tagline",name:"tagline",handler:this.__handleFieldChange,repeats:1},{type:"change",selector:"input[data-pref]",name:"preference",handler:this.__handleFieldChange,attributes:function(e){return{pref:e.data("pref")}}}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__stringManager=i.globalStringManager,this.__myself=i.loginManager.getCurrentUser(),this.__curtainDelay=i.curtainDelay||700,this.__canSeeNewEditProfileDesign=this.__featureAccessManager.canSeeProfileLightbox(),this.title=this.__stringManager.get("dialog_edit_profile_title"),this.userFieldsToPopulate="country state gender looking_for relationship_status tagline".split(" "),this.addToDOM(),this.__canSeeNewEditProfileDesign&&(this.$el.addClass("new-design"),this.$(".dialog-header").append(e.SaveButtonTemplate()),i=738<$(this.__window).width(),"desktop"===this.__platform||i)&&(this.$(".dialog-header").before(e.SaveButtonTemplate()),this.$(".dialog-x").addClass("cancel-button").text(this.__globalStringManager.get("Cancel")),this.$(".dialog-header").before(this.$(".dialog-title").addClass("title-outside")),this.$(".dialog-header").before(e.SaveButtonTemplate()),this.$(".dialog-container").addClass("no-header"))},postRender:function(){this.setContent("body",e.template({canSeeNewEditProfileDesign:this.__canSeeNewEditProfileDesign,age_description:this.__globalStringManager.get("age_description",{age:this.__myself.get("age")})})),this.$(".profile").scrollbar(),this.__setupDropDowns(),this.__canSeeNewEditProfileDesign?(e.NextUtil.DomHelper.enhanceTextarea(this.$("#tagline"),100,45),e.NextUtil.DomHelper.enhanceTextarea(this.$("#interests"),256,64),e.NextUtil.DomHelper.enhanceTextarea(this.$("#display_name"),30,45)):(e.NextUtil.DomHelper.enhanceTextarea(this.$("#tagline"),100),e.NextUtil.DomHelper.enhanceTextarea(this.$("#interests"),256),e.NextUtil.DomHelper.enhanceTextarea(this.$("#display_name"),30)),this.__uploadCurtain=this.createChildContext(e.UploadCurtain,{$parentElement:this.$el,completeDelay:this.__curtainDelay}),this.__myself.populated().then(function(){this.__profileIcon=this.createChildContext(e.Widgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.__myself}),this.__myself.get("is_adult")||this.$("#display-age-toggle").remove(),this.$(".age").text(this.__myself.get("age")),this.__populateUserFields(),this.__handleCountryChange(),this.__toggleHasChanges(!1)}.bind(this)),this.__prefsManager.populated().then(function(){this.__populatePrefs(),this.__toggleHasChanges(!1)}.bind(this))},__populatePrefs:function(){this.$("input[data-pref]").each(function(e,t){var i=$(t),n=this.__prefsManager.getBool(i.attr("data-pref"),!!i.attr("data-pref-default"));i.attr("data-pref-invert")&&(n=!n),i.prop("checked",n)}.bind(this))},__populateUserFields:function(){_.each(this.userFieldsToPopulate,function(e){var t=this.__myself.get(e);""!==t&&this.$("select#"+e).val(t).trigger("change")}.bind(this)),this.$("#username").text(this.__myself.get("username").replace("Guest_","")).trigger("input"),this.$("#location").text(this.__myself.get("country")+(this.__myself.get("state")?" - "+this.__myself.get("state"):"")),_.each(["display_name","interests","tagline"],function(e){""!==this.__myself.get(e)&&this.$("#"+e).val(this.__myself.get(e)).trigger("input")}.bind(this))},__setupDropDowns:function(){_.each(this.userFieldsToPopulate,function(t){var i=this.$("select#"+t);i.length&&(_.each(e.profileJSON[t],function(e,t){var n=this.$(".dropdown-item").clone().removeClass("hidden dropdown-item");i.append(n.attr("value",t).text(e))}.bind(this)),this.createChildContext(e.Dropdown,{$replaceElement:i,dismissOnScroll:this.$(".profile")}))}.bind(this))},__getPostData:function(){var e={gender:this.$("#gender").val(),country:this.$("#country").val(),relationship_status:this.$("#relationship_status").val(),looking_for:this.$("#looking_for").val(),interests:this.$("#interests").val(),tagline:this.$("#tagline").val(),display_name:this.$("#display_name").val()};return this.__countryIsUSA()&&(e.state=this.$("#state").val()),e},__changeProfileImage:function(t){this.__dialogManager.showDialog(e.EditProfileImageDialog,{file:t.target.files[0]}),this.$(".customProfileImage")[0].reset()},__submitChanges:function(){this.__removeMultipleConsecutiveSpaces(this.$("#display_name")),this.__uploadCurtain.show();var e=[this.__myself.save(this.__getPostData(),{error:this.__myself.invalidate.bind(this.__myself)})];this.$("input[data-pref]").each(function(t,i){var n=(a=$(i)).attr("data-pref"),o=a.prop("checked"),a=!!a.attr("data-pref-invert");e.push(this.__prefsManager.setBool(n,a?!o:o))}.bind(this)),this.__Promise.every(e).then(function(){this.__toggleHasChanges(!1),this.__uploadCurtain.complete()}.bind(this)).catch(function(e){var t=this.__stringManager.get("dialog_generic_save_error_text"),i="msg_blank msg_display_name_not_string msg_display_name_length msg_display_name_inappropriate msg_display_name_registered msg_display_name_wrapping_spaces msg_display_name_at_sign msg_display_name_persona msg_display_name_multiple_spaces".split(" ");e.message&&-1<i.indexOf(e.message)&&(t=this.__stringManager.get("edit_profile_error_"+e.message,{minimum:"1",maximum:"30"})),this.__uploadCurtain.hide(),this.__dialogManager.alert({title:this.__stringManager.get("dialog_generic_save_error_title"),text:t,ok:this.__stringManager.get("dialog_generic_save_error_ok")})}.bind(this)),this.__canSeeNewEditProfileDesign&&this.hide()},__toggleHasChanges:function(e){this.$("button.submit").prop("disabled",!e).text(e?this.__stringManager.get("dialog_edit_profile_save_changes"):this.__stringManager.get("dialog_edit_profile_saved"))},__handleFieldChange:function(){""!==this.$("#display_name").val()?this.__toggleHasChanges(!0):this.$("button.submit").prop("disabled",!0).text(this.__stringManager.get("dialog_edit_profile_save_changes"))},__removeMultipleConsecutiveSpaces:function(e){e.val(e.val().replace(/\s\s+/g," "))},__cancel:function(){this.hide(),this.promiseResolver.reject()},__countryIsUSA:function(){return"US"===this.$("#country").val()},__handleCountryChange:function(){this.$(".edit-profile-attribute.state").toggleClass("not-applicable",!this.__countryIsUSA()),this.__handleFieldChange()},__showLocationDropdown:function(){this.$("#location").toggleClass("hidden",!0),this.$(".location-container").toggleClass("hidden",!1)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],Widgets:e["@Widgets"],NextUtil:e["@NextUtil"],template:a,profileJSON:e["json!/common/pure/util/profile.json"],Dropdown:s,UploadCurtain:l,EditProfileImageDialog:r,SaveButtonTemplate:o}),a=function(e){function t(e,t){var i=e.get("bootstrapParams").is_app;e.get("window").open(t,i?"_system":"_blank")}function i(e){return-1!==e.indexOf("iPad")||-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPod")}return{openExternal:t,externalizeA:function(e,i){var n=$(i),o=n.attr("href");n.attr("href",""),n.click(function(){return t(e,o),!1})},isAndroid:function(e){return-1!==e.get("window").navigator.userAgent.indexOf("Android")},isAndroidChrome:function(e){return-1!==(e=e.get("window").navigator.userAgent).indexOf("Android")&&-1!==e.indexOf("Chrome/")&&-1===e.indexOf("Version/")},isAndroidWebApp:function(e){return!(-1===(e=e.get("window")).navigator.userAgent.indexOf("Android")||!e.navigator.standalone)},isIOS:function(e){return i(e=e.get("window").navigator.userAgent)},isIOSSafari:function(e){return!(!i(e=e.get("window").navigator.userAgent)||-1!==e.indexOf("CriOS/"))&&(-1!==e.indexOf("Safari/")||-1!==e.indexOf("AppleWebKit/")&&-1===e.indexOf("Chrome/"))},getVersionIOS:function(e){return i(e=e.get("window").navigator.userAgent)?null===(e=/(iphone|ipad)(; CPU)? OS ((\d+)_(\d+)(_(\d+))?)/i.exec(e))?null:{raw:e[3],major:parseInt(e[4],10),minor:parseInt(e[5],10),revision:e[7]?parseInt(e[7],10):null}:null}}}(),r=function(e){var t=e.GlobalNav;return t.extend("LoggedOutTopNav",{className:"global-nav logged-out bar",dependencies:"browserInfo cookieManager dialogManager googleAnalytics loginManager platform window".split(" "),trackedEvents:function(){return _.union([{type:"click",selector:"#top-nav-signup",name:"sign_up",handler:this.__onClickTopNavSignUp},{type:"click",selector:"#nag-bar-signup",name:"sign_up",handler:this.__onClickNagBarSignUp},{type:"click",selector:".logo",name:"logo_home_click",handler:this.__onLogoClick},{type:"click",selector:".secondary-nav",name:"secondary_nav_log_in_click",handler:this.__onSecNavClick}],t.prototype.trackedEvents.call(this))},initialize:function(e){e=void 0===e?{}:e,t.prototype.initialize.call(this,e),this.__window=e.window,this.__loginManager=e.loginManager,this.__dialogManager=e.dialogManager,this.__googleAnalytics=e.googleAnalytics,this.__loginCookieName=this.__serviceProvider.get("loginCookieName"),this.__showLogo=!("/next/"===this.__window.location.pathname||"/next/ftux/"===this.__window.location.pathname),this.addToDOM(),this.__window.location.pathname.match(/^\/next/)&&this.__loginManager.setLoginDestination(this.__window.location.href),this.$el.closest("body").addClass("logged-out"),(this.__window.location.pathname.match(/^\/next\/feed\/feed_element/)||this.__window.location.pathname.match(/^\/next\/forgotpassword/))&&this.__cookieManager.set(this.__loginCookieName,""),this.__cookieManager.get(this.__loginCookieName)&&this.__showLoginDialog()},render:function(){this.$el.html(e.template({showLogo:this.__showLogo,showLogin:this.__showLogin,showUpdateIndicator:!!this.__window.autoUpdate}))},markActiveMode:function(e){},__onClickTopNavSignUp:function(){this.__doSignUp("logged out top nav large")},__onClickNagBarSignUp:function(){this.__doSignUp("logged out nag bar large")},__doSignUp:function(e){"mobile"===this.__platform?"iOS"===this.__browserInfo.getMobileOS()?this.__window.location="itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8":"Android"===this.__browserInfo.getMobileOS()?this.__window.location="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova":this.__window.location="/mobile":(this.__googleAnalytics.recordSignUpClick(e),this.__directToWelcomeSignup())},__showLoginDialog:function(){this.__directToWelcomeLoginDialog()},__onLogoClick:function(){this.__directToWelcomeSignup()},__onSecNavClick:function(){this.__directToWelcomeLoginDialog()},__directToWelcomeLoginDialog:function(){this.__loginManager.setLoginDestination(""),this.__cookieManager.set(this.__loginCookieName,""),this.__window.location="/welcome/login/"},__directToWelcomeSignup:function(){this.__loginManager.setLoginDestination(""),this.__cookieManager.set(this.__loginCookieName,""),this.__window.location="/welcome/ftux/"}})}({GlobalNav:o=function(e){var t=e.UiCore.UiContext;return t.extend("TopNav",{className:"global-nav bar disable-text-selection",uiContextName:"global_nav",tagName:"nav",dependencies:"cardManager cookieManager dialogManager globalStringManager loginManager modeManager siteRoot storePlatform timer window externalWindow".split(" "),trackedEvents:function(){return[{type:"click",selector:".clickable-logo",name:"nav_go_home",handler:this.goHome.bind(this)},{type:"click",selector:"[data-mode]",name:"mode_button",handler:this.onClickModeButton.bind(this),attributes:function(e){return{category:e.data("mode")}},allowBubble:!0},{type:"click",selector:"[data-drawer]",name:"drawer_button",handler:this.__onClickDrawerButton.bind(this),attributes:function(e){return{category:e.data("drawer")}},allowBubble:!0},{type:"click",selector:"[data-action]",name:"nav_action",handler:"onClickActionButton",attributes:function(e){return{category:e.data("action")}},allowBubble:!0}]},__actions:{profile:function(){this.__cardManager.showUserProfileCard({user:this.__loginManager.getCurrentUser(),context:"feed"})},edit_profile:function(){this.__dialogManager.showDialog(e.EditProfileDialog)},feedback:function(){this.__electronSensitiveWindowOpener("https://im.vu/a1_rate","_blank",void 0)},credits:function(){this.__window.open(IMVU.URI.build("/store/index/",{platform:this.__storePlatform}),"_blank")},signout:function(){this.__cookieManager.set("prefer_alloy",1),this.__cookieManager.set("alloy_landing_cookie",1),this.__loginManager.logout().then(function(){this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot}.bind(this))},mobileapp:function(){e.MobileBrowser.isAndroid(this.__serviceProvider)?this.__window.open("https://play.google.com/store/apps/details?id=com.imvu.mobilecordova","_blank"):e.MobileBrowser.isIOS(this.__serviceProvider)?this.__window.open("https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8","_blank"):this.__window.open("https://imvu.com/mobile/","_blank")},download:function(){this.__modeManager.openMode({openDefaultView:!0,mode:{id:"download"}})},helpcenter:function(){this.__electronSensitiveWindowOpener("https://help.imvu.com/","_blank")}},setVisibility:function(e){this.$el.toggleClass("hide",!e)},initialize:function(e){t.prototype.initialize.call(this,e),this.__window=e.window,this.__externalWindow=e.externalWindow,this.__electronSensitiveWindowOpener=function(e,t,i){var n=this.__window;"_blank"===t&&(n=this.__externalWindow),n.open(e,t,i)},this.__cookieManager=e.cookieManager,this.__siteRoot=e.siteRoot,this.__modeManager=e.modeManager,this.__loginManager=e.loginManager,this.__cardManager=e.cardManager,this.__dialogManager=e.dialogManager,this.__globalStringManager=e.globalStringManager,this.__storePlatform=e.storePlatform,this.__dollarStoreCtx=null},toggleLogo:function(e){this.$(".logo").toggleClass("hidden",!e)},render:function(){throw Error("You must implement render() for your GlobalNav.")},markActiveMode:function(e){throw Error("You must implement markActiveMode() for your GlobalNav.")},goHome:function(){this.__modeManager.openMode({openDefaultView:!0,mode:{id:"feed"}})},onClickModeButton:function(e){var t=$(e.currentTarget).data("mode"),i={openDefaultView:!0,mode:{id:t}};(e=$(e.currentTarget).data("submode"))&&(i=_.extend(i,{openDefaultView:!1,submode:{id:e}})),"messages"===t&&(i=_.extend(i,{openDefaultView:!0,mode:{id:t}})),this.__modeManager.openMode(i)},onClickActionButton:function(e){e=$(e.currentTarget).data("action"),this.__actions[e]&&this.__actions[e].call(this)},__onClickDrawerButton:function(e){throw Error("You must implement __onClickDrawerButton() if you want to use drawers in your GlobalNav.")},drillDown:function(e){},switchToOriginal:function(){this.__window.open("/switch_to/classic/","_blank")},revealSubmodeSpecificItems:function(){this.$el.addClass("reveal-submode-specific")},setText:function(e){if(this.$el){var t=this.$(".main-nav.center-nav");t.length&&t.text(e)}},clearText:function(){this.setText("")},toggleSignupButton:function(e){this.$("button.sign-up").toggleClass("hidden",!e)},setDollarStoreContext:function(e){this.__dollarStoreCtx=e},__subscribeToSales:function(){this.__imqManager.subscribeMessage("/user/"+this.__imqManager.config.userId,"web_msg",function(e,t){this.listenTo(t,"message",function(e){try{if("offerEnable"===e.message.substr(0,11)){var t=JSON.parse(e.message.substring(12));if(t.type&&"sale"===t.type){var i=1e3*t.duration;this.__saleFlag=!0,this.$(".urgent-offer-badge")&&this.$(".urgent-offer-badge").addClass("hidden"),this.$(".sale-badge").removeClass("hidden"),this.__dollarStoreCtx&&this.__dollarStoreCtx.updateSaleItems(),this.__saleTimer=this.__timer.setInterval(function(){this.__timer.clearInterval(this.__saleTimer),this.__saleFlag=!1,this.$(".sale-badge").addClass("hidden")}.bind(this),i)}}}catch(e){}}.bind(this))}.bind(this))},__checkForSales:function(){this.__paymentChannels&&this.__paymentChannels.invalidate();var t=this.__globalStartupModel.get("paymentChannelNextUrl");this.__paymentChannels=this.__restModelFactory.readCollection(t,e.UiCore.NodeCollection),this.__paymentChannels.populated().then(function(){var e=null,t=_.filter(this.__paymentChannels.models,function(e){if(0<e.get("duration"))return e}.bind(this));_.isEmpty(t)||(e=_.min(t,function(e){return e.get("duration")}.bind(this))),e&&(this.$(".urgent-offer-badge")&&this.$(".urgent-offer-badge").addClass("hidden"),this.$(".sale-badge").removeClass("hidden"),e=1e3*e.get("duration"),this.__timer.setTimeout(function(){this.$(".sale-badge").addClass("hidden"),this.$(".urgent-offer-badge")&&this.$(".urgent-offer-badge").removeClass("hidden")}.bind(this),e))}.bind(this))}})}({UiCore:e["@UiCore"],MobileBrowser:a,EditProfileDialog:o}),template:n}),l=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o,a;i=t.helperMissing;var s=this.escapeExpression,r='<form name="login_form" method="GET" action="#" class="login">\n    <div class="label login_avatarname label-first" data-holder="';return((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='">\n        <input type="text" tabindex="1" name="avatarname" placeholder=\'',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='\'  autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" value="'+s("function"==typeof(a=t.username||e&&e.username)?a.call(e,{name:"username",hash:{},data:n}):a)+'" />\n    </div>\n    <div class="label login_password label-second" data-holder="',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='">\n        <div style="position:relative">\n            <input tabindex="1" type="password" name="password" placeholder=\'',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='\'/>\n            <div class="toggle-password-visibility icon icon-password-show"></div>\n        </div>\n    </div>\n\n    <div class="label label-forgot">\n        <a class="forgot-password-link" href="/next/forgotpassword">'+s("function"==typeof(a=t.passwordHolderContent||e&&e.passwordHolderContent)?a.call(e,{name:"passwordHolderContent",hash:{},data:n}):a)+'</a>\n    </div>\n    <div class="label label-log-in">\n        <button class="btn btn-primary" >',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_signin_button",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</button>\n    </div>\n    <div class="label label-or">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_or",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</div>\n    <div class="label label-fb">\n        <a class="btn btn-fb id-fb">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_frontpage_fb_cta",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</a>\n    </div>\n\n    <div class="label signup">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_no_account",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='&nbsp;<a class="id-signup">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_signup",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</a></div>\n    <div class="label need-help">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_need_help",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='<a data-external href="https://help.imvu.com/">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_help_center",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</a></div>\n\n    <p class="app-store-buttons text-spacing">\n        <a data-external href="https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8" class="ios-button" target="_blank">\n            <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon-app-store" viewBox="0 0 135 40">\n                <title>Available on the App Store</title>\n                <path fill="#A6A6A6" d="M130.197 40H4.73C2.12 40 0 37.872 0 35.267V4.727C0 2.12 2.122 0 4.73 0h125.467C132.803 0 135 2.12 135 4.726v30.54c0 2.606-2.197 4.734-4.803 4.734z"/><path d="M134.032 35.268c0 2.116-1.714 3.83-3.834 3.83H4.728c-2.118 0-3.838-1.714-3.838-3.83V4.725C.89 2.61 2.61.89 4.73.89h125.467c2.12 0 3.834 1.72 3.834 3.835l.01 30.543z"/><path d="M30.128 19.784c-.03-3.223 2.64-4.79 2.76-4.864-1.51-2.203-3.852-2.504-4.675-2.528-1.967-.207-3.875 1.177-4.877 1.177-1.022 0-2.565-1.16-4.228-1.13-2.14.03-4.142 1.27-5.24 3.19-2.266 3.92-.576 9.69 1.595 12.86 1.086 1.55 2.355 3.28 4.016 3.22 1.62-.07 2.23-1.04 4.19-1.04 1.94 0 2.51 1.03 4.2.99 1.74-.03 2.84-1.56 3.89-3.13 1.25-1.78 1.76-3.53 1.78-3.62-.04-.01-3.39-1.29-3.42-5.15zm-3.2-9.478c.874-1.093 1.472-2.58 1.306-4.09-1.265.057-2.847.876-3.758 1.945-.806.95-1.526 2.49-1.34 3.94 1.42.11 2.88-.71 3.792-1.79zm26.717 21.198h-2.27l-1.245-3.91h-4.324l-1.185 3.91h-2.21l4.29-13.308h2.65l4.31 13.308zm-3.89-5.55L48.63 22.48c-.12-.355-.342-1.19-.67-2.507h-.04c-.132.566-.343 1.402-.633 2.507l-1.105 3.475h3.573zm14.907.634c0 1.632-.44 2.922-1.323 3.87-.79.842-1.78 1.263-2.95 1.263-1.27 0-2.17-.45-2.73-1.36h-.04v5.06H55.5V25.07c0-1.026-.027-2.08-.08-3.16h1.876l.12 1.522h.04c.71-1.15 1.79-1.72 3.237-1.72 1.132 0 2.077.447 2.833 1.34.758.898 1.136 2.076 1.136 3.537zm-2.172.078c0-.934-.21-1.704-.632-2.31-.46-.632-1.08-.948-1.856-.948-.526 0-1.004.176-1.43.523-.43.35-.71.81-.84 1.38-.066.27-.1.48-.1.65v1.6c0 .7.215 1.29.643 1.77s.984.72 1.668.72c.803 0 1.428-.31 1.875-.92.448-.62.672-1.43.672-2.45zm13.21-.078c0 1.632-.442 2.922-1.325 3.87-.79.842-1.77 1.263-2.94 1.263-1.265 0-2.173-.45-2.725-1.36h-.04v5.06h-2.132V25.07c0-1.026-.027-2.08-.08-3.16h1.876l.12 1.522h.04c.71-1.15 1.788-1.72 3.237-1.72 1.14 0 2.08.447 2.84 1.34.76.898 1.14 2.076 1.14 3.537zm-2.173.078c0-.934-.21-1.704-.633-2.31-.46-.632-1.078-.948-1.855-.948-.53 0-1.01.176-1.44.523-.43.35-.71.81-.84 1.38-.07.27-.1.48-.1.65v1.6c0 .7.21 1.29.64 1.77.43.48.98.72 1.67.72.8 0 1.43-.31 1.87-.92.45-.62.67-1.43.67-2.45zm14.513 1.106c0 1.132-.394 2.053-1.183 2.764-.867.777-2.074 1.165-3.625 1.165-1.432 0-2.58-.27-3.45-.82l.495-1.77c.936.57 1.963.85 3.082.85.8 0 1.42-.18 1.87-.54.44-.36.67-.84.67-1.45 0-.54-.19-.99-.56-1.36-.37-.37-.98-.71-1.84-1.03-2.33-.87-3.5-2.14-3.5-3.81 0-1.09.41-1.99 1.22-2.69.81-.69 1.9-1.04 3.26-1.04 1.21 0 2.21.21 3.02.63l-.54 1.74c-.75-.41-1.6-.61-2.55-.61-.75 0-1.34.18-1.76.55-.36.33-.54.73-.54 1.21 0 .53.2.96.61 1.31.35.32 1 .66 1.94 1.03 1.14.46 1.98 1 2.53 1.62.54.62.81 1.39.81 2.31zm7.048-4.264h-2.35v4.66c0 1.184.414 1.776 1.244 1.776.38 0 .697-.033.947-.1l.05 1.62c-.42.157-.98.236-1.66.236-.85 0-1.5-.257-1.98-.77-.48-.514-.71-1.376-.71-2.587v-4.837h-1.4v-1.6h1.4V20.15l2.09-.633v2.39h2.35v1.6zm10.602 3.12c0 1.474-.42 2.685-1.263 3.632-.883.975-2.055 1.46-3.516 1.46-1.4 0-2.52-.466-3.36-1.4s-1.25-2.113-1.25-3.534c0-1.487.43-2.705 1.3-3.652.86-.948 2.03-1.422 3.49-1.422 1.41 0 2.54.467 3.4 1.402.82.907 1.23 2.078 1.23 3.513zm-2.21.07c0-.887-.19-1.646-.573-2.28-.447-.766-1.086-1.15-1.914-1.15-.857 0-1.508.385-1.955 1.15-.383.634-.572 1.405-.572 2.317 0 .885.19 1.644.572 2.276.46.77 1.105 1.15 1.936 1.15.814 0 1.453-.39 1.914-1.17.393-.64.59-1.41.59-2.29zm9.14-2.915c-.21-.04-.435-.06-.67-.06-.75 0-1.33.284-1.74.85-.354.5-.532 1.133-.532 1.896v5.03h-2.13l.02-6.58c0-1.11-.028-2.12-.08-3.02h1.856l.078 1.83h.06c.224-.63.58-1.14 1.065-1.52.475-.35.988-.52 1.54-.52.198 0 .376.01.534.04v2.03zm9.536 2.47c0 .38-.025.703-.078.966h-6.396c.025.94.334 1.67.928 2.17.54.44 1.236.67 2.092.67.947 0 1.81-.15 2.588-.46l.334 1.48c-.908.39-1.98.59-3.217.59-1.488 0-2.656-.44-3.506-1.32-.84-.88-1.27-2.05-1.27-3.53 0-1.45.4-2.65 1.19-3.62.83-1.03 1.95-1.54 3.36-1.54 1.39 0 2.43.51 3.14 1.54.57.81.85 1.82.85 3.02zm-2.033-.554c.014-.64-.125-1.18-.414-1.64-.37-.6-.94-.89-1.7-.89-.7 0-1.27.29-1.7.87-.36.46-.57 1.01-.63 1.65h4.44zM49.05 10.01c0 1.176-.353 2.062-1.058 2.657-.653.55-1.58.824-2.783.824-.6 0-1.11-.02-1.54-.07V6.99c.55-.09 1.15-.138 1.8-.138 1.14 0 2.01.25 2.59.747.65.56.98 1.36.98 2.41zm-1.105.028c0-.763-.202-1.348-.606-1.756-.41-.407-1-.61-1.78-.61-.33 0-.61.02-.85.067v4.88c.13.02.36.03.71.03.8 0 1.42-.23 1.85-.67s.65-1.1.65-1.95zm6.965 1c0 .724-.208 1.32-.622 1.784-.434.48-1.01.718-1.727.718-.69 0-1.24-.23-1.65-.69-.41-.458-.61-1.037-.61-1.735 0-.73.21-1.33.64-1.794s1-.69 1.71-.69c.69 0 1.25.23 1.67.69.4.45.6 1.03.6 1.73zm-1.088.033c0-.43-.094-.8-.28-1.11-.22-.37-.534-.56-.94-.56-.422 0-.742.19-.962.57-.188.31-.28.69-.28 1.14 0 .44.093.81.28 1.12.227.38.543.57.95.57.4 0 .715-.19.94-.57.195-.31.292-.69.292-1.13zm8.943-2.35l-1.475 4.72h-.96l-.61-2.04c-.156-.51-.282-1.02-.38-1.52h-.02c-.09.52-.216 1.03-.378 1.53l-.65 2.05h-.97l-1.387-4.72h1.077l.533 2.24c.13.53.235 1.04.32 1.52h.02c.077-.39.206-.89.388-1.5l.67-2.25h.853l.64 2.21c.156.54.282 1.05.38 1.55h.028c.07-.48.178-1 .32-1.55l.572-2.2h1.03zm5.433 4.72H67.15v-2.7c0-.83-.316-1.25-.95-1.25-.31 0-.562.12-.757.35-.193.23-.29.5-.29.81v2.8h-1.05v-3.37c0-.41-.012-.86-.037-1.35h.92l.05.74h.03c.12-.23.303-.42.542-.57.284-.17.602-.26.95-.26.44 0 .806.15 1.097.43.362.35.543.87.543 1.56v2.83zm2.89 0H70.04V6.56h1.048v6.877zm6.17-2.39c0 .73-.207 1.32-.62 1.79-.435.48-1.01.72-1.728.72-.693 0-1.244-.23-1.654-.69-.41-.45-.615-1.03-.615-1.73 0-.73.22-1.33.64-1.79s1-.7 1.71-.7c.7 0 1.25.23 1.67.69.4.45.6 1.02.6 1.73zm-1.088.04c0-.43-.094-.8-.28-1.11-.22-.37-.534-.56-.94-.56-.422 0-.742.19-.96.57-.19.31-.282.69-.282 1.14 0 .44.094.81.28 1.12.228.38.544.57.952.57.4 0 .713-.19.94-.57.194-.32.29-.694.29-1.13zm6.16 2.37h-.94l-.08-.54h-.028c-.322.43-.78.65-1.377.65-.445 0-.805-.14-1.076-.43-.25-.26-.37-.58-.37-.96 0-.57.24-1.01.72-1.32.48-.3 1.16-.45 2.03-.44v-.09c0-.62-.33-.93-.98-.93-.47 0-.88.12-1.23.35l-.22-.69c.44-.27.98-.4 1.61-.4 1.23 0 1.85.65 1.85 1.95v1.74c0 .47.02.85.07 1.12zm-1.088-1.62v-.73c-1.156-.02-1.734.3-1.734.95 0 .25.066.43.2.55.136.12.308.19.513.19.23 0 .45-.07.65-.22.2-.14.32-.33.37-.56.01-.05.02-.11.02-.18zm7.043 1.62h-.93l-.05-.75h-.028c-.297.58-.803.86-1.514.86-.568 0-1.04-.22-1.416-.67s-.562-1.02-.562-1.73c0-.76.203-1.38.61-1.85.396-.44.88-.66 1.456-.66.64 0 1.08.22 1.33.64h.02V6.56h1.05v5.608c0 .46.01.882.04 1.27zm-1.085-2v-.78c0-.14-.01-.25-.03-.33-.06-.25-.186-.46-.38-.63-.194-.17-.43-.25-.7-.25-.39 0-.697.15-.922.46-.223.31-.336.71-.336 1.19 0 .47.107.85.322 1.14.227.31.533.47.916.47.344 0 .62-.13.828-.39.202-.24.3-.52.3-.86zm10.048-.41c0 .73-.207 1.32-.62 1.79-.435.48-1.01.72-1.728.72-.69 0-1.242-.23-1.654-.69-.41-.45-.615-1.03-.615-1.73 0-.73.22-1.33.64-1.79s1-.69 1.72-.69c.69 0 1.25.23 1.67.69.4.45.6 1.02.6 1.73zm-1.086.04c0-.43-.094-.8-.28-1.11-.222-.37-.534-.56-.942-.56-.42 0-.74.19-.96.56-.19.31-.282.69-.282 1.14 0 .44.094.81.28 1.12.228.38.544.57.952.57.4 0 .715-.19.94-.57.194-.316.292-.692.292-1.13zm6.72 2.37h-1.046v-2.7c0-.83-.316-1.25-.95-1.25-.312 0-.563.12-.757.35s-.3.5-.3.81v2.8h-1.05V10.1c0-.417-.01-.866-.04-1.35h.92l.05.735h.03c.12-.23.3-.416.54-.57.28-.173.6-.262.95-.262.44 0 .8.145 1.1.43.36.35.54.87.54 1.57v2.82zm7.054-3.93h-1.154v2.29c0 .59.205.88.61.88.19 0 .345-.01.468-.05l.027.8c-.207.07-.48.11-.814.11-.414 0-.736-.13-.97-.38-.233-.25-.35-.68-.35-1.27v-2.4h-.688v-.79h.69v-.86l1.026-.31v1.17h1.16v.79zm5.548 3.93h-1.05v-2.68c0-.84-.315-1.27-.948-1.27-.486 0-.818.25-1 .74-.03.1-.05.23-.05.38v2.84h-1.046v-6.9h1.047V9.4h.02c.33-.517.803-.775 1.416-.775.434 0 .793.142 1.078.427.36.35.54.88.54 1.58v2.8zm5.723-2.58c0 .19-.014.35-.04.48h-3.142c.014.47.164.82.455 1.07.266.22.61.33 1.03.33.464 0 .888-.07 1.27-.22l.164.73c-.447.2-.973.29-1.582.29-.73 0-1.305-.21-1.72-.64-.42-.43-.626-1.01-.626-1.73 0-.71.193-1.3.582-1.77.406-.5.955-.75 1.648-.75.678 0 1.193.256 1.54.76.282.4.42.9.42 1.488zm-1-.27c.008-.31-.06-.58-.203-.8-.182-.29-.46-.43-.834-.43-.342 0-.62.15-.834.43-.174.23-.277.5-.31.82h2.18z" fill="#FFF"/>\n            </svg>\n        </a>\n        <a data-external href="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova" class="last android-button" target="_blank">\n            <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon-google-play" viewBox="0 0 135 40">\n                <title>Get it on Google Play</title>\n                <defs><linearGradient id="a" x1="21.8" y1="418.71" x2="5.02" y2="435.49" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#00a0ff"/><stop offset=".01" stop-color="#00a1ff"/><stop offset=".26" stop-color="#00beff"/><stop offset=".51" stop-color="#00d2ff"/><stop offset=".76" stop-color="#00dfff"/><stop offset="1" stop-color="#00e3ff"/></linearGradient><linearGradient id="b" x1="33.83" y1="430" x2="9.64" y2="430" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ffe000"/><stop offset=".41" stop-color="#ffbd00"/><stop offset=".78" stop-color="orange"/><stop offset="1" stop-color="#ff9c00"/></linearGradient><linearGradient id="c" x1="24.83" y1="432.3" x2="2.07" y2="455.05" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ff3a44"/><stop offset="1" stop-color="#c31162"/></linearGradient><linearGradient id="d" x1="7.3" y1="410.18" x2="17.46" y2="420.34" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#32a071"/><stop offset=".07" stop-color="#2da771"/><stop offset=".48" stop-color="#15cf74"/><stop offset=".8" stop-color="#06e775"/><stop offset="1" stop-color="#00f076"/></linearGradient></defs>\n                <rect width="135" height="40" rx="5" ry="5"/><path d="M130 .8a4.2 4.2 0 0 1 4.2 4.2v30a4.2 4.2 0 0 1-4.2 4.2H5A4.2 4.2 0 0 1 .8 35V5A4.2 4.2 0 0 1 5 .8h125m0-.8H5a5 5 0 0 0-5 5v30a5 5 0 0 0 5 5h125a5 5 0 0 0 5-5V5a5 5 0 0 0-5-5z" fill="#a6a6a6"/><path d="M47.42 10.24a2.71 2.71 0 0 1-.75 2 2.91 2.91 0 0 1-2.2.89 3.15 3.15 0 0 1-2.21-5.37 3 3 0 0 1 2.21-.9 3.1 3.1 0 0 1 1.23.25 2.47 2.47 0 0 1 .94.67l-.53.53a2 2 0 0 0-1.64-.71 2.32 2.32 0 0 0-2.33 2.31V10a2.36 2.36 0 0 0 4 1.73 1.89 1.89 0 0 0 .5-1.22h-2.17v-.72h2.91a2.54 2.54 0 0 1 .04.45zM52 7.74h-2.7v1.9h2.46v.72H49.3v1.9H52V13h-3.5V7H52v.74zM55.28 13h-.77V7.74h-1.68V7H57v.74h-1.72V13zm4.66 0V7h.77v6h-.77zm4.19 0h-.77V7.74h-1.68V7h4.12v.74h-1.67V13zm9.48-.78a3.12 3.12 0 0 1-4.4 0 3.24 3.24 0 0 1 0-4.45 3.1 3.1 0 0 1 4.38 0 3.23 3.23 0 0 1 .02 4.45zm-3.83-.5a2.31 2.31 0 0 0 3.26 0 2.56 2.56 0 0 0 0-3.44 2.31 2.31 0 0 0-3.26 0 2.56 2.56 0 0 0 0 3.44zm5.8 1.28V7h.94l2.92 4.67V7h.76v6h-.8l-3.05-4.89V13h-.77z" fill="#fff" stroke="#fff" stroke-miterlimit="10" stroke-width=".2"/><path d="M68.14 21.75A4.25 4.25 0 1 0 72.41 26a4.19 4.19 0 0 0-4.13-4.25h-.14zm0 6.83a2.58 2.58 0 1 1 2.39-2.75V26a2.46 2.46 0 0 1-2.34 2.58h-.05zm-9.31-6.83A4.25 4.25 0 1 0 63.09 26 4.19 4.19 0 0 0 59 21.75h-.17zm0 6.83a2.58 2.58 0 1 1 2.38-2.76V26a2.46 2.46 0 0 1-2.34 2.58h-.04zm-11.09-5.52v1.8h4.32a3.77 3.77 0 0 1-1 2.27 4.42 4.42 0 0 1-3.33 1.32 4.8 4.8 0 0 1 0-9.6A4.6 4.6 0 0 1 51 20.14l1.27-1.27A6.29 6.29 0 0 0 47.74 17a6.61 6.61 0 1 0-.51 13.21h.51a5.84 5.84 0 0 0 6.17-6.07 5.87 5.87 0 0 0-.1-1.13h-6.07v.05zm45.31 1.4a3.92 3.92 0 0 0-7.65 1.28V26a4.16 4.16 0 0 0 4.07 4.25h.15a4.23 4.23 0 0 0 3.54-1.88l-1.45-1a2.43 2.43 0 0 1-2.09 1.18 2.16 2.16 0 0 1-2.06-1.29l5.69-2.35zm-5.8 1.42a2.33 2.33 0 0 1 2.17-2.48 1.65 1.65 0 0 1 1.58.9zM82.63 30h1.87V17.5h-1.87V30zm-3.06-7.3h-.07a3 3 0 0 0-2.24-1 4.26 4.26 0 0 0 0 8.51 2.9 2.9 0 0 0 2.24-1h.06v.69c0 1.63-.87 2.5-2.27 2.5a2.35 2.35 0 0 1-2.14-1.51l-1.63.68a4.05 4.05 0 0 0 3.77 2.51c2.19 0 4-1.29 4-4.43V22h-1.72v.7zm-2.14 5.88a2.59 2.59 0 0 1 0-5.16 2.4 2.4 0 0 1 2.27 2.52V26a2.38 2.38 0 0 1-2.17 2.57h-.1zm24.38-11.08h-4.47V30h1.87v-4.74h2.61a3.89 3.89 0 1 0-.01-7.76zm0 6H99.2v-4.26h2.65a2.14 2.14 0 0 1 0 4.28zm11.53-1.8a3.5 3.5 0 0 0-3.34 1.91l1.66.69a1.77 1.77 0 0 1 1.7-.92 1.8 1.8 0 0 1 2 1.58v.16a4.13 4.13 0 0 0-1.95-.48c-1.79 0-3.6 1-3.6 2.81a2.89 2.89 0 0 0 3 2.75h.08a2.63 2.63 0 0 0 2.4-1.2h.06v1h1.8v-4.81c0-2.19-1.66-3.46-3.79-3.46zm-.23 6.85a1.3 1.3 0 0 1-1.46-1.06c0-1 1.06-1.33 2-1.33a3.32 3.32 0 0 1 1.7.42 2.26 2.26 0 0 1-2.19 2zM123.74 22l-2.14 5.42h-.06L119.32 22h-2l3.33 7.58-1.9 4.21h1.95L125.82 22h-2.08zm-16.81 8h1.87V17.5h-1.87V30z" fill="#fff"/><path d="M10.44 7.54a2 2 0 0 0-.44 1.4v22.12a2 2 0 0 0 .46 1.4l.07.07L22.9 20.15v-.3L10.51 7.47z" fill="url(#a)"/><path d="M27 24.28l-4.1-4.13v-.3l4.1-4.13h.09L32 18.56c1.4.79 1.4 2.09 0 2.89l-4.89 2.78z" fill="url(#b)"/><path d="M27.12 24.22L22.9 20 10.44 32.46a1.63 1.63 0 0 0 2.08.06l14.61-8.3" fill="url(#c)"/><path d="M27.12 15.78l-14.61-8.3a1.63 1.63 0 0 0-2.08.06L22.9 20z" fill="url(#d)"/><path d="M27 24.13l-14.49 8.25a1.67 1.67 0 0 1-2 0l-.07.07.07.07a1.66 1.66 0 0 0 2 0l14.61-8.3z" style="isolation:isolate" opacity=".2"/><path d="M10.44 32.32a2 2 0 0 1-.46-1.4v.15a2 2 0 0 0 .46 1.4l.07-.07zM32 21.3l-5 2.83.09.09L32 21.44A1.75 1.75 0 0 0 33 20a1.86 1.86 0 0 1-1 1.3z" style="isolation:isolate" opacity=".12"/><path d="M12.51 7.62L32 18.7a1.86 1.86 0 0 1 1 1.3 1.75 1.75 0 0 0-1-1.44L12.51 7.48C11.11 6.69 10 7.35 10 8.95v.15c0-1.61 1.12-2.27 2.51-1.48z" style="isolation:isolate" fill="#fff" opacity=".25"/>\n            </svg>\n        </a>\n    </p>\n    <label class="submit">\n        <div class="error-message-container">\n            <div class="error-message try-again-later">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_try_again_later_error",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</div>\n            <div class="error-message credentials">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_credentials_error",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</div>\n            <div class="error-message disabled">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_disabled_error",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+='</div>\n            <div class="error-message unknown">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_unknown_login_error",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+"</div>\n        </div>\n    </label>\n</form>\n"},useData:!0})}(),function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;i=t.helperMissing;var a='<div class="content">\n    <div class="privacy-policy-minors-body">';return((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_dialog_body",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</div>\n    <div class="privacy-policy-minors-form">\n        <div class="privacy-policy-minors-form-title">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_dialog_form_title",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</div>\n        <div class="fieldset">\n            <label>',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Name",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</label>\n            <input type="text" class="privacy-policy-minors-avatarname full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"your name",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</label>\n            <input type="text" class="privacy-policy-minors-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"email address",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+="<span> (",((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_email_note",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+=')</span></label>\n            <input type="text" class="privacy-policy-minors-email full-width"></input>\n            <div class="input-error"></div>\n        </div>\n        <div class="fieldset">\n            <label>',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_name",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_email",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-email full-width"></input>\n            <div class="input-note">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_email_note",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</div>\n            <div class="input-error"></div>\n        </div>\n    </div>\n    <div class="privacy-policy-link"><a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_privacy_policy",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</a></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary minors-guardian-form-submit full-width disabled">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"submit",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+"</button>\n<\/script>"},useData:!0})}()),c={validateEmail:function(e){return/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(e)}},h=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;i=t.helperMissing;var a="<div>\n    <p>";return((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_dialog_body_1",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+="</p>\n    <p>",((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_dialog_body_2",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</p>\n</div>\n<div class="privacy-policy-link"><a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_privacy_policy",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</a></div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary ok full-width">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"OK",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+"</button>\n<\/script>"},useData:!0})}(),g=(h=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyMinorsGuardianDialog",{uiContextName:"privacy_policy_minors_guardian_dialog",className:"privacy-policy-minors-guardian-dialog dialog-type-B",dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_minors_okay",handler:"__onClose"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("privacy_policy_minors_guardian_dialog_title"),this.addToDOM()},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text())}})}({Dialogs:e["@Dialogs"],template:h}),d=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyMinorsDialog",{uiContextName:"privacy_policy_minors_dialog",className:"privacy-policy-minors-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","rest"],trackedEvents:function(){return[{type:"keyup",selector:"input.privacy-policy-minors-avatarname",name:"change_avatarname",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-name",name:"change_username",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-email",name:"change_email",handler:"__validateMinorsEmail"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-name",name:"change_guardian_name",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-email",name:"change_guardian_email",handler:"__validateGuardiansEmail"},{type:"click",selector:"button",name:"submit_privacy_policy_minors_form",handler:"__submit"}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__GUARDIAN_VERIFICATION_URL=this.__serviceProvider.get("root")+"/guardian_verification",this.title=this.__globalStringManager.get("privacy_policy_minors_dialog_title"),this.__formValidator=e.FormValidator,this.addToDOM(),this.$(".dialog-x").remove(),this.__hasError=!1},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text()),this.$(".content").scrollbar()},__toggleButton:function(){var e=!1;this.$("input").each(function(t){$(this).val()||(e=!0)});var t=this.__minorsEmailError||this.__guardiansEmailError;this.$(".minors-guardian-form-submit").toggleClass("disabled",e||t)},__validateMinorsEmail:function(e){this.__minorsEmailError=!1;var t=$(e.currentTarget);(e=t.siblings(".input-error")).text(""),null!==(t=this.__validateEmail(t.val()))&&(this.__minorsEmailError=!0,e.text(t)),this.__toggleButton()},__validateGuardiansEmail:function(e){this.__guardiansEmailError=!1,(e=$(e.currentTarget)).siblings(".input-note").toggleClass("hidden",!1);var t=e.siblings(".input-error");t.text("");var i=this.__validateEmail(e.val());null===i&&this.$("input.privacy-policy-minors-email").val()===this.$("input.privacy-policy-minors-guardian-email").val()&&(i=this.__globalStringManager.get("privacy_policy_minors_guardian_email_note")),null!==i&&(this.__guardiansEmailError=!0,t.text(i),e.siblings(".input-note").toggleClass("hidden",!0)),this.__toggleButton()},__validateEmail:function(e){return e?this.__formValidator.validateEmail(e)?null:this.__globalStringManager.get("error_message_email_invalide_format"):this.__globalStringManager.get("error_message_email_empty")},__submit:function(t){this.__rest.post(this.__GUARDIAN_VERIFICATION_URL,{avatarname:this.$("input.privacy-policy-minors-avatarname").val(),user_name:this.$("input.privacy-policy-minors-name").val(),user_email:this.$("input.privacy-policy-minors-email").val(),guardian_name:this.$("input.privacy-policy-minors-guardian-name").val(),guardian_email:this.$("input.privacy-policy-minors-guardian-email").val()}).then(function(e){}),this.__onClose(t),this.__dialogManager.showDialog(e.PrivacyPolicyMinorsGuardianDialog)}})}({Dialogs:e["@Dialogs"],PrivacyPolicyMinorsGuardianDialog:h,FormValidator:c,template:d}),h={mixin:function(e){_.isArray(e)||(e=[].slice.call(arguments));var t=e[0],i=[],n=[];return _.each(e,function(e){if(e.initialize&&i.push(e.initialize),e.trackedEvents&&n.push(e.trackedEvents),e!==t){var o=t.dependencies||[];_.each(e.dependencies,function(e){-1===_.indexOf(o,e)&&o.push(e)}),_.extend(t,e,{dependencies:o})}}),i.length&&(t.initialize=1<i.length?function(){for(var e=Array.prototype.slice.call(arguments),t=i.length;0<t--;)i[t].apply(this,e)}:i[0]),n.length&&(t.trackedEvents=1<n.length?function(){for(var e=Array.prototype.slice.call(arguments),t=[],i=n.length;0<i--;)t=t.concat(n[i].apply(this,e));return t}:n[0]),t}},c=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return"show-label"},3:function(e,t,i,n){var o,a;return(o="function"==typeof(a=t.defaultLabel||e&&e.defaultLabel)?a.call(e,{name:"defaultLabel",hash:{},data:n}):a)||0===o?o:""},5:function(){return"&nbsp"},7:function(e,t,i,n){var o,a;return(o="function"==typeof(a=t.content||e&&e.content)?a.call(e,{name:"content",hash:{},data:n}):a)||0===o?o:""},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;return i='<div class="holder-label">\n    <div class="info ',((o=t.if.call(e,e&&e.defaultLabel,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===o)&&(i+=o),i+='">',((o=t.if.call(e,e&&e.defaultLabel,{name:"if",hash:{},fn:this.program(3,n),inverse:this.program(5,n),data:n}))||0===o)&&(i+=o),i+='</div>\n    <div class="content">',((o=t.if.call(e,e&&e.content,{name:"if",hash:{},fn:this.program(7,n),inverse:this.noop,data:n}))||0===o)&&(i+=o),i+"</div>\n</div>\n"},useData:!0})}(),function(e){return Handlebars.registerPartial("InputMixinHolderLabel",e.HolderLabelTemplate),{dependencies:[],trackedEvents:function(){return[{type:"focus",selector:".label[data-holder] input",name:"focus_input",handler:"__onHolderInputFocus"},{type:"blur",selector:".label[data-holder] input",name:"blur_input",handler:"__onHolderInputBlur"}]},initialize:function(){var e;this.render=(e=this.render,function(){e.apply(this,arguments),this.__insertLabelTemplate(this.$(".label[data-holder]"))})},__insertLabelTemplate:function(t){(t=(t instanceof $?t:this.$(t)).not(":has(>.holder-label)")).prepend(e.HolderLabelTemplate()),t.filter("[data-dropdown]").each(function(e,t){this.__setInputLabelMsg(t,$(t).attr("data-holder"))}.bind(this))},__onHolderInputFocus:function(e){(e=$(e.currentTarget)).attr("placeholder",""),e=e.closest(".label[data-holder]").removeClass("error"),this.__insertLabelTemplate(e),e.find(">.holder-label >.info").html(e.attr("data-holder")).addClass("show-label")},__onHolderInputBlur:function(e){if(!(e=$(e.currentTarget)).val()){var t=e.closest(".label[data-holder]");e.attr("placeholder",t.attr("data-holder")),t.hasClass("error")||t.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label")}},__clearError:function(e){var t=(e=$(e).closest(".label[data-holder]").removeClass("error")).find("input");!t[0]||t.val()?this.__setInputLabelMsg(e,e.attr("data-holder")):(t.attr("placeholder",e.attr("data-holder")),e.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label"))},__setInputLabelMsg:function(e,t){var i=e instanceof $?e:this.$(e);i.find(">.holder-label >.info").html(t).toggleClass("show-label",!!i.attr("data-holder")||i.hasClass("error"))},__setInputErrorLabelMsg:function(e,t){this.__setInputLabelMsg(this.$(e).addClass("error"),t)}}}({UiCore:e["@UiCore"],HolderLabelTemplate:c})),u=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;i=t.helperMissing;var a='<div class="copy-body">\n    ';return((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_pending_guardian_approval_1",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+="\n    ",((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_pending_guardian_approval_2",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+="\n    ",((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_pending_guardian_approval_3",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='\n    <a href="https://help.imvu.com" target="_blank">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Help Center",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='.</a></div>\n</div>\n<div class="privacy-policy-link"><a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_privacy_policy",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</a></div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary full-width">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"close pending policy",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+"</button>\n<\/script>\n\n"},useData:!0})}(),p=(c=function(t){var i={Dialogs:e["@Dialogs"]}.Dialogs.AlloyModalDialog;return i.extend("TooltipDialog",{uiContextName:"tooltip_dialog",className:"tooltip-dialog dialog-type-B text-close",trackedEvents:function(){return this.__customTrackedEvents},initialize:function(e){this.__customTrackedEvents=e.trackedEvents||[],i.prototype.initialize.call(this,e),this.title=e.title,this.__tooltipContent=e.tooltipContent,this.addToDOM()},postRender:function(){this.setContent("body",this.__tooltipContent)}})}(),c=function(e){var t=e.UiCore.UiContext;return t.extend("Tooltip",{className:"tooltip",uiContextName:"tooltip",dependencies:["dialogManager","timer","tooltipLayer","window"],trackedEvents:function(){return[{type:"click",selector:"a",name:"link_click",handler:"__clickedLink",allowBubble:!0}].concat(this.__customTrackedEvents)},__installTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.on("mouseenter.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.$target.off("mouseleave.tooltip")}.bind(this)),this.__tooltipLayer.$el.on("mouseleave.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=this.__timer.setTimeout(function(){this.setVisible(!1),this.__timer.clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=this.__timer.setTimeout(function(){this.__hide(),this.__installTargetMouseleave()}.bind(this),125)}.bind(this),250)}.bind(this))},__removeTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.off(".tooltip")},initialize:function(e){this.$tooltip=IMVU.requireProperty(e,"$replaceElement"),this.$target=IMVU.requireProperty(e,"$tooltipTarget"),this.tooltipTitle=IMVU.optionalProperty(e,"title",!1),this.__tooltipStyle=IMVU.optionalProperty(e,"tooltipStyle","default"),this.__customTrackedEvents=e.trackedEvents||[],t.prototype.initialize.call(this,e),this.$body=$("body"),this.$globalNav=$("nav.global-nav:visible"),"mobile"===this.__serviceProvider.get("platform")?this.$target.on("click.tooltip",function(e){e.stopPropagation(),this.__openTooltipDialog()}.bind(this)):this.$target.on("mouseenter.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.__timer.clearTimeout(this.__targetFadeinTimeout),this.__installTargetMouseleave(),this.__targetFadeinTimeout=this.__timer.setTimeout(function(){this.setVisible(!0),this.__show()}.bind(this),250)}.bind(this)),"snug"===this.__tooltipStyle&&this.$el.addClass("tooltip-snug"),this.$el.append(this.$tooltip),this.setParentUiContext(this.__tooltipLayer),this.__tooltipLayer.$el.append(this.$el)},setVisible:function(e){this.$el.toggleClass("tooltip-open",!!e)},__installTargetMouseleave:function(){this.$target.on("mouseleave.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__targetTimeout=this.__timer.setTimeout(function(){this.setVisible(!1),this.__timer.clearTimeout(this.__targetTimeout),this.__targetTimeout=this.__timer.setTimeout(function(){this.__hide()}.bind(this),125)}.bind(this),250)}.bind(this))},__show:function(){this.__installTooltipLayerEventHandlers(),this.__trackTooltip(),$(this.__window).on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this)),this.$body.find(".transparent-overlay").on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this))},__trackTooltip:function(){var e=this.$globalNav.height(),t=this.$target[0].getBoundingClientRect().top,i=this.$target[0].getBoundingClientRect().left,n=$(window).width()-(i+this.$target.outerWidth()/2),o=this.$el[0].offsetWidth;0<this.$target.parents(".dialog-manager").length&&(e=0),i=n>o?i+this.$target.width()/2:i+this.$target.width()/2-o,this.$el.css({"margin-top":Math.max(t,e),"margin-left":i})},__hide:function(){this.__removeTooltipLayerEventHandlers(),this.setVisible(!1)},__openTooltipDialog:function(){return this.__dialogManager.showDialog(e.TooltipDialog,{title:this.tooltipTitle||this.$target.text(),tooltipContent:this.$tooltip.html(),trackedEvents:this.__customTrackedEvents})},delete:function(){this.$el.removeAttr("style"),this.__timer.clearTimeout(this.__targetFadeinTimeout),this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.$target.off(".tooltip"),this.__removeTooltipLayerEventHandlers(),$(this.__window).off("scroll.tooltip"),this.$body.find(".transparent-overlay").off("scroll.tooltip"),t.prototype.delete.call(this)},__clickedLink:function(){this.__hide()}})}({UiCore:e["@UiCore"],TooltipDialog:c}),u=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyMinorsPendingDialog",{uiContextName:"privacy_policy_minors_pending_dialog",className:"privacy-policy-minors-pending-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("privacy_pending_guardian_approval_title"),this.addToDOM(),this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text())},__onClose:function(e){t.prototype.__onClose.call(this,e)}})}({Dialogs:e["@Dialogs"],Tooltip:c,template:u}),function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;i=t.helperMissing;var a='<div class="copy-body">\n    ';return((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_1",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='\n    <a href="#" class="tooltip-target">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_2",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+="</a>\n    ",((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_3",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='\n    <a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_4",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+="</a>\n    ",((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_5",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+="\n    <br>\n    ",((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_6",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='\n\n    <div class="accept-button">\n        <button class="btn btn-primary accept-cookies">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"accept all cookies",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+'</button>\n    </div> \n</div>\n\n\n<div class="tooltip-content cookie-tooltip">\n    <div class="tooltip-body">\n        To give you the best possible experience, personalize content and ads, this site uses Cookies. Continuing to use the site you agree we may place these cookies on your device. You can view our Privacy Policy for more details.\n\n        <div class="tooltip-header">Strictly Necessary Cookies:</div>\n            <div>These cookies are necessary for the website to function and cannot be switched off in our systems. </div>\n            <ul>\n                <li>prefer_alloy - Used to determine if you see IMVU Next or Core.</li>\n                <li>alloy_landing_cookie - Used to determine if you see IMVU Next or Core.</li>\n                <li>in_ux - Assigned to a "unique user" experiment.</li>\n                <li>osCsid - Session cookie; required for login to function.</li>\n            </ul>\n        <div class="tooltip-header">Performance Cookies:</div>\n            <div>These cookies allow us to count visits and traffic sources, so we can measure and improve the performance of our site. They help us know which pages are the most and least popular and see how visitors move around the site.</div>\n            <ul>\n                <li>browser_session - Tracks statistics about your IMVU session.</li>\n                <li>window_session - Tracks statistics about a specific IMVU window.</li>\n                <li>Targeting Cookies</li>\n                <li>These cookies are set through our site by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant ads on other sites. They work by uniquely identifying your browser and device.</li>\n                <li>login_interstitial_seen - tracks the last time you saw an interstitial, for aggregate analytics purposes.</li>\n                <li>sncd - Tracks CIDs you have logged into, for detecting if a new account is an alt.</li>\n                <li>nunu - Tracks if we believe you are a new new user.</li>\n                <li>preLogID - Used to connect incoming users with their subsequent login or registration.</li>\n                <li>imvua - Tracks which acquisition partner you came from.</li>\n                <li>datetime_entered - Tracks when you first landed on our site.</li>\n                <li>linkshare_site_id - If acquired through a specific partner, tracks which ad you followed.</li>\n                <li>lpip - Stores the IP you hit a landing page with.</li>\n            </ul>\n        <div class="tooltip-header">Presentation Cookies:</div>\n            <div>These cookies are set to help enhance your experience and for example, allow us to show you IMVU in the language of your choice.</div>\n            <ul>\n                <li>imvu_avnm - stores your avatarname for display purposes.</li>\n                <li>saved_locale - stores which language you prefer to see IMVU in.</li>\n            </ul>\n        <div class="tooltip-header">Third Party Partners:</div>\n            <div>We also have third party partners who may set cookies including this list below:</div>\n            <ul>\n                <li>Amazon</li>\n                <li>Doubleverify</li>\n                <li>Facebook</li>\n                <li>Google</li>\n                <li>Peanutlabs</li>\n                <li>Revenue Universe</li>\n                <li>AppNexus</li>\n                <li>Google Analytics</li>\n                <li>Threat Metrix</li>​\n            </ul>\n    </div>\n</div>'},useData:!0})}()),m=(c=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyAdultDialog",{uiContextName:"privacy_policy_adult_dialog",className:"privacy-policy-adult-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("privacy_policy_adult_dialog_title"),this.addToDOM(),this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",e.template,{}),this.tooltip=this.createChildContext(e.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".tooltip-target")}),this.tooltip.$el.addClass("tooltip-wide")},__onClose:function(e){this.__cookieManager.set("accepted_all_cookies",!0),t.prototype.__onClose.call(this,e)}})}({Dialogs:e["@Dialogs"],Tooltip:c,template:p}),n=function(e){var t=e.LoggedOutTopNav;return t.extend("LoggedOutTopNavDesktop",{dependencies:"featureAccessManager googleAnalytics historyManager loginManager modeManager window".split(" "),trackedEvents:function(){return _.union([{type:"click",selector:".sign-in",name:"sign_in",handler:this.showLoginDialog},{type:"click",selector:".logo",name:"logo_click",handler:"__goToNext"}],t.prototype.trackedEvents.call(this))},render:function(){this.__showLogo=!0,this.$el.html(e.template({showLogo:this.__showLogo})),(this.__showLogin="/welcome/ftux/download/"!==this.__window.location.pathname)&&this.$(".fragment-placeholder").replaceWith(e.fragmentTemplate),this.listenTo(this.__historyManager,"stateChange",this.toggleLoginBasedOnState),this.toggleLoginBasedOnState()},toggleLoginBasedOnState:function(){"/welcome/"!==this.__window.location.pathname&&"/welcome/ftux/download/"!=this.__window.location.pathname?this.$(".secondary-nav").removeClass("hidden"):this.$(".secondary-nav").addClass("hidden")},getLoginDialogFactory:function(){return e.LoginDialog},__showLoginDialog:$.noop,showLoginDialog:function(e){e.loginMode=e.loginMode||"ftux",this.__googleAnalytics.recordClick("welcome","show login");var t=this.__serviceProvider.get("loginDestination")||this.__serviceProvider.get("siteRoot").replace("welcome","next");return this.__loginDialogFactory=this.getLoginDialogFactory(),this.__loginDialog=this.__loginDialogFactory.default.prototype,this.__dialogManager.showDialog(this.__loginDialogFactory,_.extend({loginDestination:t},e||{})).finished},__goToNext:function(e){this.__loginManager.isLoggedIn()?this.__window.location="/next/home/explore":this.showLoginDialog()}})}({LoggedOutTopNav:r,LoginDialog:P=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("LoginDialog",e.Mixin.mixin({uiContextName:"login_dialog",className:"login-dialog dialog-type-B-flexible",dependencies:"cookieManager dialogManager globalStringManager googleAnalytics leanplum loginManager modeManager restModelFactory window".split(" "),trackedEvents:function(){return[{type:"submit",selector:"form.login",name:"login",handler:"__onLogin"},{type:"click",selector:".id-signup",name:"signup",handler:"__onClickSignup"},{type:"click",selector:".id-fb",name:"fb_login",handler:this.__onClickFB},{type:"click",selector:".toggle-password-visibility",name:"toggle_password_visibility",handler:"__togglePasswordVisibility"},{type:"click",selector:".forgot-password-link",name:"forgot_password",handler:"__forgotPassword"},{type:"click",selector:".ios-button",name:"download_ios",handler:"__downloadIos"},{type:"click",selector:".android-button",name:"download_android",handler:"__downloadAndroid"}]},initialize:function(e){this.title=e.globalStringManager.get("welcome_login_dialog_signin"),void 0!==e.globalStringManager&&(this.__globalStringManager=e.globalStringManager),this.hasCloseButton=!!_.isUndefined(e.hasCloseButton)||e.hasCloseButton,this.__loginMode=e.loginMode,t.prototype.initialize.call(this,e),this.__loginCookieName=this.__serviceProvider.get("loginCookieName"),this.__cookieManager=this.__serviceProvider.get("cookieManager"),this.__hasSignupButton=!!_.isUndefined(e.hasSignupButton)||e.hasSignupButton,this.__loginUsername=this.__cookieManager.get("login_username")?this.__cookieManager.get("login_username"):"",this.__refreshOnLogin=e.refreshOnLogin||"mobile"===this.__serviceProvider.get("platform"),this.__loginDestination=e.loginDestination,this.shouldFocusOnPrimaryButton=!1,this.__socialLogin=this.__loginManager.getSocialLogin(),this.__socialLogin.checkLoginState(),this.__hadSocialLogin=this.__socialLogin.isLoggedIn(),this.__socialLogin.logout(),this.addToDOM()},postRender:function(){if(this.__loginUsername=void 0===this.__loginUsername?"":this.__loginUsername,this.__loginUsername="undefined"===this.__loginUsername?"":this.__loginUsername,this.__loginUsername=null===this.__loginUsername?"":this.__loginUsername,this.setContent("body",e.template,{username:this.__loginUsername,passwordHolderContent:this.__globalStringManager.get("login_dialog_forgot_credentials")}),this.$(".login_avatarname input").focus(),this.__loginUsername&&this.$(".login_password input").focus(),this.$(".login").toggleClass("can-signup",this.__hasSignupButton),this.__loginUsername){var t=this.$('input[name="avatarname"]').closest(".label[data-holder]");this.__insertLabelTemplate(t),t.hasClass("ignore-placeholder-behavior")||t.find(">.holder-label >.info").html(t.attr("data-holder"))}},__onLogin:function(t){null!==t&&t.preventDefault(),this.__leanplum.recordEvent("login_click",{mode:this.__loginMode}),t="true"===this.__cookieManager.get("accepted_all_cookies");var i=this.__socialLogin.isLoggedIn()?{email:this.__socialLogin.getProfileItem("email"),platform:"facebook_web",platform_token:this.__socialLogin.__fbAuthResponse.accessToken,platform_uid:this.__socialLogin.__fbAuthResponse.userID,gdpr_cookie_acceptance:t}:{username:this.$('[name="avatarname"]').val(),password:this.$('[name="password"]').val(),gdpr_cookie_acceptance:t};this.$("label.submit").addClass("loading"),this.__loginManager.performLoginFromCredentials(this.__serviceProvider,i).then(function(t){if(this.__restModelFactory.readModel(t.relations.user,e.UiCore.NodeModel).populated().then(function(e){this.__leanplum.recordEvent("welcome_login_success",{cid:e.get("legacy_cid").toString()})}.bind(this)),this.__googleAnalytics.recordSuccessfulAuthentication("true"),this.$("label.submit").removeClass("loading"),this.$(".error-message").removeClass("active").css("height",""),this.__cookieManager.set(this.__loginCookieName,"true"),this.__cookieManager.set("prefer_alloy","1"),this.__cookieManager.set("login_username",i.username),this.__cookieManager.set("password_changed","0"),this.__loginDestination)this.__window.location.href=this.__loginDestination;else if(this.__loginManager.getLoginDestination())this.__window.location.href=this.__loginManager.getLoginDestination();else if(this.__serviceProvider.services.overrideMode&&"ftux"!==this.__serviceProvider.services.overrideMode)t=this.__serviceProvider.get("siteRoot"),t+=this.__serviceProvider.get("startMode")+"/",this.__serviceProvider.services.startSubmode&&(t+=this.__urlId(this.serviceProvider.get("startSubmode"))+"/"),this.__window.location.href=t;else if(this.__refreshOnLogin)this.__window.location.reload();else{var n=this.__restModelFactory.readModel(t.relations.user,e.UiCore.NodeModel);n.populated().then(function(){return n.getEdgeCollection("preferences",e.UiCore.RestCollection)}.bind(this)).then(function(e){return this.__prefs=e,this.__prefs.populated()}.bind(this)).then(function(){for(var e=!1,t=0;t<this.__prefs.length;t++){var i=this.__prefs.at(t);"registered_through_alloy"!==i.get("name")&&"registered_through_mobile"!==i.get("name")&&"pure_mobile_access"!==i.get("name")||!i.get("value")||(e=!0,this.__window.location.reload())}e||(this.__window.location.href="/switch_to/classic/")}.bind(this))}}.bind(this),function(t){var i="credentials";t===this.__loginManager.ERROR_TRY_AGAIN_LATER?i="try-again-later":t===this.__loginManager.ERROR_DISABLED?i="disabled":t!==this.__loginManager.ERROR_UNDERAGE&&t!==this.__loginManager.ERROR_COOKIE_UNACCEPT&&t!==this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT||(i="disabled",this.__showPrivacyPolicyDialog(t)),this.__leanplum.recordEvent("welcome_login_error",{error:i}),e.NextUtil.DomHelper.radioClass(this.$(".error-message."+i),"active"),t=this.$(".error-message.active").height(),this.$(".error-message.active").css("height",0),this.$("label.submit").removeClass("loading"),this.$(".error-message.active").height(),this.$(".error-message.active").css("height",t)}.bind(this))},__onClickSignup:function(e){e.preventDefault(),this.__googleAnalytics.recordSignUpClick("login"),this.promiseResolver.resolve("signup"),this.__window.location.href="/welcome/ftux/gender/"},__onClickFB:function(){var e=function(){this.__onLogin(null)}.bind(this);this.hide(),this.__socialLogin.login(e)},__togglePasswordVisibility:function(){var e=this.$(".login_password input"),t="password"==e.attr("type");e[0].setAttribute("type",t?"text":"password"),this.$(".toggle-password-visibility").toggleClass("icon-password-show",!t).toggleClass("icon-password-hide",t),e.focus()},__forgotPassword:function(){this.__leanplum.recordEvent("welcome_login_forgot_password_click"),this.__window.location="/next/forgotpassword/"},__downloadIos:function(){this.__leanplum.recordEvent("welcome_login_download_ios_click")},__downloadAndroid:function(){this.__leanplum.recordEvent("welcome_login_download_android_click")},__onClose:function(e){t.prototype.__onClose.call(this,e),(!(e=-1!==this.__window.location.pathname.search("/welcome/ftux"))||e&&this.__hadSocialLogin)&&this.__modeManager.openMode({mode:{id:"ftux"},submode:{id:"__default__"}})},__showPrivacyPolicyDialog:function(t){var i=e.PrivacyPolicyAdultDialog;return t===this.__loginManager.ERROR_UNDERAGE?i=e.PrivacyPolicyMinorsDialog:t===this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT&&(i=e.PrivacyPolicyMinorsPendingDialog),this.__dialogManager.showDialog(i)}},e.InputMixin))}({Dialogs:e["@Dialogs"],NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],InputMixin:g,Mixin:h,PrivacyPolicyMinorsDialog:d,PrivacyPolicyAdultDialog:c,PrivacyPolicyMinorsPendingDialog:u,template:l}),template:n,fragmentTemplate:l=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return"hidden"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;i=t.helperMissing;var a='<ul class="secondary-nav ';return((o=t.unless.call(e,e&&e.showLogin,{name:"unless",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===o)&&(a+=o),a+='">\n    <div class="have-an-account">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_have_an_account",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</div><a class="sign-in">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_login_link",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+"</a>\n</ul>\n"},useData:!0})}()}),r=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="imvu-loading">\n    <div class="spinner"></div>\n    <div class="error-message"></div>\n</div>\n\n<div class="nav-placeholder"></div>\n<div class="mode-container"></div>\n\n<div class="scene-manager-placeholder"></div>\n<div class="conversation-manager"></div>\n\n<div class="toaster-placeholder"></div>\n'},useData:!0})}(),d=IMVU.BaseClass.extend("StringManager",{dependencies:["dictionary","window"],initialize:function(e){if(this.__dictionary=e.dictionary,this.__window=e.window,!this.__dictionary)throw Error("StringManager requires a dictionary")},__process_placeholders:function(e,t){return _.each(t,function(t,i){e=e.replace(RegExp("{{\\s*"+i+"\\s*}}","g"),t)}),e},get:function(e,t){var i=this.__dictionary[e];if(!_.isString(i))throw Error('Unable to find text: "'+e+'" in translation dictionary');return this.__process_placeholders(i,t)},getWithDefault:function(e,t,i){return e=this.__dictionary[e],_.isString(e)?this.__process_placeholders(e,i):t},getPluralized:function(e,t){var i=parseInt(t.howMany,10);return 0===i?this.get(e+"_none",t):this.get(e+(2>i?"_singular":"_plural"),t)},handlebarsHelper:function(e,t){return this.get(e,t.hash)}}),s=function(e){var t=e.UiCore.UiContext;return t.extend("ModeManager",{id:"imvu",uiApplication:"alloy",uiContextName:"application",uiPlatform:"next",_isTest:!1,_setIsTest:function(){this._isTest=!0},dependencies:"appTitle availableModes globalStringManager leanplum localStorage Promise restModelFactory root seenBefore timer uiEventReporter window".split(" "),getSmartBannerAttributes:function(){var t="other";return e.MobileBrowser.isIOS(this.__serviceProvider)?t="ios":e.MobileBrowser.isAndroid(this.__serviceProvider)&&(t="android"),{device:t,UA:this.__window.navigator.userAgent}},trackedEvents:function(){var e=this.getSmartBannerAttributes.bind(this);return[{type:"click",selector:"#smartbanner .sb-close",name:"smartbanner_close",handler:function(){},attributes:e},{type:"click",selector:"#smartbanner .sb-button",name:"smartbanner_go_native",handler:function(){},attributes:e}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__module=i.module||module,this.__serviceProvider=i.serviceProvider,this.uiPlatform+="_"+this.__serviceProvider.get("platform"),this.__window=i.window,this.__timer=i.timer,this.__uiEventReporter=i.uiEventReporter,this.__restModelFactory=i.restModelFactory,this.__Promise=i.Promise,this.__globalStringManager=i.globalStringManager,this.__seenBefore=i.seenBefore,this.__campaign=i.campaign,this.__root=i.root,this.__availableModes=i.availableModes,this.__modes={},this.__currentModeId=null,this.__modesOpened=0,this.__pageReadyRecorded=!1,this.__dismissibles=[],this.__openingMode=!1,this.__readyPromiseObj=function(e){var t=null;return{finished:new e(function(e){t=e}),promiseResolver:t}}(this.__Promise),this.addToDOM(),this.show(),this.__recordBrowserInformation(),this.__recordUserStats(),this.__animationManagerSetup(),this.__inputFieldSetup(),e.Dropdown.prototype.globalSetup(),e.NextUtil.DomHelper.dismissibleSetUp()},recordPageReady:function(){if(!(this.__pageReadyRecorded||!this.__window.performance||1<this.__modesOpened)){var e=this.__timer.getTime();e={record:!0,mode:this.__currentModeId,fetchTime:(this.__window.performance.timing.responseEnd-this.__window.performance.timing.navigationStart)/1e3,domConstructionTime:(this.__window.performance.timing.loadEventEnd-this.__window.performance.timing.domLoading)/1e3,contentDisplayTime:(e-this.__window.performance.timing.loadEventEnd)/1e3,totalTime:(e-this.__window.performance.timing.navigationStart)/1e3};this.__recordEvent("page_ready",e);var t={};_.each("redirectStart redirectEnd fetchStart domainLookupStart domainLookupEnd connectStart secureConnectionStart connectEnd requestStart responseStart responseEnd".split(" "),function(e,i){this.__window.performance.timing[e]&&(t[e]=(this.__window.performance.timing[e]-this.__window.performance.timing.navigationStart)/1e3)}.bind(this)),this.__window.console.log("Page load stats:"),this.__window.console.log(JSON.stringify(e)),this.__window.console.log(JSON.stringify(t)),this.__pageReadyRecorded=!0}},__recordBrowserInformation:function(){this.__recordEvent("browserInfo",{record:!0,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,language:navigator.language,platform:navigator.platform,standalone:navigator.standalone||!1,userAgent:navigator.userAgent,vendor:navigator.vendor})},__recordUserStats:function(){this.__recordEvent("userStats",{record:!0,referer:document.referrer,is_new_new:!this.__seenBefore,campaign:this.__campaign})},addDismissible:function(e){_.contains(this.__dismissibles,e)||this.__dismissibles.push(e)},removeDismissible:function(e){this.__dismissibles=_.without(this.__dismissibles,e)},dismissAllDismissibles:function(){e.NextUtil.DomHelper.dismissAllDismissibles(),this.__serviceProvider.get("dialogManager").closeAll(!0),$("#qa-3d-info-panel").hide(),_.invoke(this.__dismissibles,"call")},__inputFieldSetup:function(){$(document).on("keyup",'.search > [type="text"], .signup-dialog input, .login-dialog input',function(t){$(this).toggleClass("is-filled",!!$(this).val()),t.keyCode===e.NextUtil.Keys.VK_ENTER&&$(this).blur()}),$(document).on("click",'.search > [type="reset"]',function(){$(this).parent().find('[type="text"]').removeClass("is-filled").focus()}),$(document).on("click",'.signup-dialog [type="reset"]',function(){$(this).prev('[type="text"]').removeClass("is-filled").focus()})},__animationManagerSetup:function(){$(document).on("click","nav > ul > li, button",function(t){(t=$(t.currentTarget)).addClass("clicked"),e.NextUtil.DomHelper.applyTemporaryClass(this.__timer,t,"animating-delayed-fadein")}.bind(this)),$(document).on("mouseleave","nav > ul > li, button",function(e){$(e.currentTarget).removeClass("clicked")}.bind(this))},delete:function(){e.Dropdown.prototype.globalTearDown(),e.NextUtil.DomHelper.dismissibleTearDown(),$(document).off("click mouseleave keyup"),t.prototype.delete.call(this)},ready:function(){return this.__readyPromiseObj.finished.then.apply(this.__readyPromiseObj.finished,arguments)},render:function(){this.$el.html(e.template()),this.__readyPromiseObj.promiseResolver.resolve("test")},isOpeningMode:function(){return this.__openingMode},openModeFromPath:function(t){var i=(t=_.rest(_.compact(t.split("/"))))[0];if((t=1<t.length?t[1]:null)&&-1!==t.indexOf("-")){var n=t.split("-")[0],o={feed_element:e.Lightboxes.FeedLightbox};if(t=[this.__root,n,t].join("/"),o[n])return void this.__serviceProvider.get("dialogManager").showDialog(o[n],{model:this.__restModelFactory.readModel(t,"feed_element"===n?e.Model.FeedNode:e.UiCore.NodeModel)})}this.openMode({openDefaultView:!t,mode:{id:i},submode:{id:t}})},openMode:function(t){if(this.togglePermalinkConditional(),!this.__openingMode){this.__openingMode=!0,this.dismissAllDismissibles();var i=IMVU.requireProperty(t,"mode"),n=IMVU.optionalProperty(t,"submode",void 0),o=!n||IMVU.optionalProperty(t,"openDefaultView",!1);this.__availableModes[i.id]?n&&n.id?this.__leanplum.setState(i.id,{submode:n.id}):this.__leanplum.setState(i.id):this.__leanplum.setState("unknown_mode",{mode:i.id});var a=!(!(a=this.getCurrentMode())||a.id!==i.id||!a.isCurrentSubmode(o?"__default__":n.id));return(a=(this.__modeChangeConfirmer&&!a?this.__modeChangeConfirmer:this.__Promise.accept)()).catch(function(){this.__openingMode=!1}.bind(this)),a.then(function(){this.__modesOpened++,this.setTitle(this.__globalStringManager.get("Loading")),this.__serviceProvider.get("globalNav").markActiveMode({id:i.id}),$("#qa-3d-info-panel").hide();var a,s=null,r=new this.__Promise(function(e){s=e});if(r.then(function(){this.__openingMode=!1}.bind(this)),this.__currentModeId!==i.id&&this.__modes[this.__currentModeId]&&(null!==(a=this.getCurrentMode())&&a.hide(),this.clearModeChangeConfirmer()),this.__modes[i.id]){var l=this.__currentModeId!==i.id||t.showAlways;if(this.__currentModeId!==i.id&&(this.__currentModeId=i.id,this.__registerHandlebarsHelper(i.id)),!(a=this.getCurrentMode()))return;a.$el.show(),n=_.extend({poppingHistory:!!t.poppingHistory},n||{}),o?a.openDefaultView():a.openSubmode(n),l?a.show(_.extend(i,n)):(this.__serviceProvider.get("globalNav").markActiveMode(a),this.setTitle(a.getTitle())),s.resolve(a),void 0!==i.submode&&this.togglePermalinkConditional(i.submode.id)}else{var d=IMVU.optionalProperty(this.__availableModes,i.id,this.__availableModes.default);this.__modes[i.id]={},this.__currentModeId=i.id,a=d.startupUrl,"true"===this.__localStorage.getItem("forceProduction")&&(a=a.replace("localhost.",""));var c=this.__restModelFactory.readModel(a,e.UiCore.NodeModel);c.populated().then(function(){this.__modes[i.id].nestedProvider=this.__serviceProvider.nestedProvider(),this.__modes[i.id].nestedProvider.register("startupModel",c),this.__modes[i.id].nestedProvider.register("startMode",this.__serviceProvider.get("startMode")),this.__modes[i.id].nestedProvider.register("startSubmode",this.__serviceProvider.get("startSubmode")),t=_.extend(i,{$parentElement:this.$(".mode-container"),parentUiContext:this,submode:n});var a={mode:d.alias};this.__window.$$STRINGTABLE||(a.dictionary="json!"+d.dictionaryAlias),this.__module.run(a,function(a){this.__window.$$STRINGTABLE&&(a.dictionary=this.__window.$$STRINGTABLE[d.dictionaryAlias.slice(1)]),this.__modes[t.id].stringManager=this.__modes[t.id].nestedProvider.create(e.StringManager,{dictionary:a.dictionary}),this.__modes[t.id].nestedProvider.register("stringManager",this.__modes[t.id].stringManager),this.__registerHandlebarsHelper(i.id),this.__modes[t.id].mode=this.__modes[t.id].nestedProvider.create(a.mode,t),this.children().push(this.__modes[t.id].mode),this.__modes[t.id].mode.show(),o?this.__modes[t.id].mode.openDefaultView():this.__modes[t.id].mode.openSubmode(n),s.resolve(this.__modes[t.id].mode),this.togglePermalinkConditional(d.startupUrl)}.bind(this))}.bind(this))}return this.__recordEvent("load_"+this.__currentModeId+"_mode",{}),r}.bind(this))}},togglePermalink:function(e){!0===e?(this.$(".mode-container").addClass("is-permalink"),this.$(".magic-line-menu").addClass("hidden"),this.$(".rooms-mode .magic-line-menu").css("display","")):(this.$(".mode-container").removeClass("is-permalink"),this.$(".magic-line-menu").removeClass("hidden"))},togglePermalinkConditional:function(e){var t=!1;(e=void 0===e?String(this.__window.location.href):String(e)).includes("imvu.com/next/feed/feed_element-")?t=!0:e.includes("imvu.com/next/chat/room-")?t=!1:e.includes("imvu.com/next/profile/user-")?t=!0:e.includes("imvu.com/next/shop/product-")&&(t=!0),this.togglePermalink(t)},deleteMode:function(e){this.__modes[e]&&(this.__modes[e].mode.delete(),delete this.__modes[e])},getCurrentMode:function(){return this.__currentModeId&&this.__modes[this.__currentModeId]&&this.__modes[this.__currentModeId].mode||null},__registerHandlebarsHelper:function(e){e=this.__modes[e].stringManager,Handlebars.registerHelper("i18n",e.handlebarsHelper.bind(e))},setNotificationCount:function(e){var t=this.__window.document.title,i=/(\(\d+\))+/;t.match(i)?this.__window.document.title=0<e?t.replace(i,"("+e+")"):t.replace(i,"").trim():0<e&&(this.__window.document.title="("+e+") "+t)},setTitle:function(e){this.__window.document.title=this.__makeTitle(e),this.__serviceProvider.get("globalNav").trigger("titleUpdate")},__makeTitle:function(e){return""!==e?e+" : "+this.__appTitle:this.__appTitle},setModeChangeConfirmer:function(e){this.__modeChangeConfirmer=e},clearModeChangeConfirmer:function(){this.__modeChangeConfirmer=null},getModeChangeConfirmer:function(){return this.__modeChangeConfirmer},createSmartBanner:function(){$.smartbanner({title:"IMVU Mobile",author:"IMVU",appendToSelector:"#imvu"})}})}({UiCore:e["@UiCore"],ScrollBar:e["@ScrollBar"],NextUtil:e["@NextUtil"],Lightboxes:e["@Lightboxes"],Model:e["@Model"],Dropdown:s,StringManager:d,globalCSS:e["@globalCSS"],template:r,SmartBanner:e["@SmartBanner"],MobileBrowser:a}),r=function(e){return e.UiCore.ServiceProvider.extend("RealServiceProvider",{initialize:function(t){e.UiCore.ServiceProvider.prototype.initialize.call(this),_.each(t,function(e,t){this.register(t,e)}.bind(this));var i=-1!==location.host.indexOf("localhost."),n="true"===localStorage.getItem("forceProduction");_.each({isLocalhost:function(){return i},root:function(){return i&&!n?"https://api.localhost.imvu.com":"https://api.imvu.com"},uiEventReporter:function(){return this.create(e.UiCore.UiEventReporter)},localStorage:function(){return window.localStorage},defer:function(){return _.defer}},function(e,t){this.has(t)||this.register(t,e.call(this))}.bind(this))}})}({UiCore:e["@UiCore"]}),l=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiEventReporter;return i.extend("NextUiEventReporter",{dependencies:["modeManager"],initialize:function(e){i.prototype.initialize.call(this,e),this.__modeManager=e.modeManager},recordEvent:function(e,t,n,o,a){var s=this.__modeManager.getCurrentMode();s&&(a.current_mode=s.id),t.match(/default/i)&&(t="next_default"),i.prototype.recordEvent.call(this,e,t,n,o,a)},getServiceUrl:function(){return this.__serviceUrl}})}(),c=IMVU.BaseClass.extend("GlobalVariablesManager",{initialize:function(e){this.__variables={}},add:function(e,t){if(this.__variables.hasOwnProperty(e))throw Error('Key "'+e+'" is already defined.');this.__variables[e]=t},set:function(e,t){if(!this.__variables.hasOwnProperty(e))throw Error('Key "'+e+'" is not exist.');this.__variables[e]=t},has:function(e){return this.__variables.hasOwnProperty(e)},get:function(e){if(this.__variables.hasOwnProperty(e))return this.__variables[e];throw Error('Key "'+e+'" is not exist.')}}),u=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o,a;i=this.escapeExpression;var s=t.helperMissing,r='<div class="inviter row">\n    <div class="profile-icon">\n        <img class="is-portrait">\n    </div>\n    <div class="details">\n        <div class="username is-truncated">'+i("function"==typeof(a=t.username||e&&e.username)?a.call(e,{name:"username",hash:{},data:n}):a)+"</div>\n        <div>";return((o=(a=t["i18n-g"]||e&&e["i18n-g"]||s).call(e,"chat_invite_dialog_invited_to",{name:"i18n-g",hash:{},data:n}))||0===o)&&(r+=o),r+'</div>\n    </div>\n</div>\n<div class="room row">\n    <div class="room-icon">\n        <img class="is-portrait">\n    </div>\n    <div class="details">\n        <div class="roomname is-truncated">'+i("function"==typeof(a=t.roomname||e&&e.roomname)?a.call(e,{name:"roomname",hash:{},data:n}):a)+"</div>\n    </div>\n</div>\n"},useData:!0})}(),u=function(e){var t=e.Dialogs.AlloyConfirmDialog;return t.extend("InviteDialog",{uiContextName:"invite_dialog",className:"invite-dialog",dependencies:"loginManager globalStringManager inviter imageManager room Promise cardManager".split(" "),trackedEvents:function(){return t.prototype.trackedEvents.call(this).concat([{type:"click",selector:".profile-icon",name:"show_profile",handler:"__showProfileOfSender"}])},initialize:function(e){this.__serviceProvider=e.serviceProvider,this.__loginManager=e.loginManager,this.__imageManager=e.imageManager,this.__cardManager=e.cardManager,this.__dialogManager=e.dialogManager,this.Promise=e.Promise,this.__inviter=e.inviter,this.__room=e.room,e.title=e.globalStringManager.get("chat_invite_dialog_title"),e.yes=e.globalStringManager.get("chat_invite_dialog_accept"),e.no=e.globalStringManager.get("chat_invite_dialog_ignore"),t.prototype.initialize.call(this,e)},postRender:function(){t.prototype.postRender.call(this),this.Promise.every([this.__inviter.populated(),this.__room.populated()]).then(function(){this.$(".dialog-body p").replaceWith(e.template({username:this.__inviter.get("display_name").replace("Guest_",""),roomname:this.__room.get("name")})),this.__imageManager.on("load",this.$(".inviter .profile-icon > img"),this.__inviter.get("thumbnail_url"),{}),this.__imageManager.on("load",this.$(".room .icon > img"),this.__room.get("image_url"),{}),this.$(".profile-icon").toggleClass("is-online",!!this.__inviter.get("online"))}.bind(this))},__showProfileOfSender:function(){this.__cardManager.showUserProfileCard({user:this.__inviter,context:"feed"})}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:u}),u=function(e){var t=e.UiCore.UiContext;return t.extend("ChatManager",_.extend({dependencies:"dialogManager loginManager modeManager Promise restModelFactory globalStringManager window cookieManager featureAccessManager".split(" "),initialize:function(e){t.prototype.initialize.call(this,e),this.__modeManager=e.modeManager,this.window=e.window,this.Promise=e.Promise,this.restModelFactory=e.restModelFactory,this.__dialogManager=e.dialogManager,this.__myself=e.loginManager.getCurrentUser(),this.__stringManager=e.globalStringManager,this.__isUsingToaster=e.cookieManager.get("use_toaster")||!0,this.__featureAccessManager=e.featureAccessManager,this.Promise.every([this.__myself.populated()]).then(function(){this.inviteCollection=this.track(this.__myself.getEdgeCollection("invites")),this.inviteCollection.on("add",this.__showInvite,this)}.bind(this))},delete:function(){this.inviteCollection&&this.inviteCollection.off(null,null,this),t.prototype.delete.call(this)},inviteUserToRoom:function(t,i){var n;t.populated().then(function(){return(n=this.track(t.getSingleEdge("chat",e.UiCore.NodeModel))).populated()}.bind(this)).then(function(){return this.track(n.getEdgeCollection("invites")).create({relations:{recipient:i.url()}}).catch(function(e){if(e.error&&e.error.error){var t={displayname:i.get("username").replace("Guest_","")};this.__dialogManager.alert({title:this.__stringManager.get("Invite User Error Title"),text:this.__stringManager.getWithDefault("ERROR."+e.error.error,this.__stringManager.get("ERROR.INVITE-GENERIC",t),t),ok:this.__stringManager.get("OK")})}}.bind(this))}.bind(this)).catch(function(e){})},goToRoom:function(e,t){return this.__modeManager.openMode({mode:{id:"chat"},submode:{id:e.get("id"),roomModel:e,modelUrl:e.get("id"),isInvite:t},showAlways:!0})},openWindow:function(e){if(this.__featureAccessManager.canSeeWindows()&&this.__serviceProvider.has("windowManager"))return this.__serviceProvider.get("windowManager").hasWindow(e.id)?this.__serviceProvider.get("windowManager").addWindow(e.id):(this.__serviceProvider.get("globalNav").hideDrawers(),this.__serviceProvider.get("windowManager").addChatWindow(e.id,{model:e}))},inviteUserToMyRoom:function(e){var t=this.track(this.__myself.getSingleEdge("default_room"));t.invalidate(),t.populated().then(function(){return this.__dialogManager.closeAll(),this.goToRoom(t)}.bind(this)).then(function(){this.inviteUserToRoom(t,e)}.bind(this))},__showInvite:function(t){var i,n;this.__isUsingToaster||t.populated().then(function(){return i=this.track(t.node.getSingleEdge("inviter")),n=this.track(t.node.getSingleEdge("room")),this.Promise.every([i.populated(),n.populated()])}.bind(this)).then(function(){this.__dialogManager.showDialog(e.InviteDialog,{inviter:i,room:n}).finished.then(function(e){t.node.save({status:"accepted"}).then(function(){this.goToRoom(n,!0)}.bind(this))}.bind(this))}.bind(this))}},Backbone.Events))}({UiCore:e["@UiCore"],InviteDialog:u}),p=IMVU.BaseClass.extend("TouchEventHelper",{dependencies:["window","timer"],initialize:function(e){this.__window=e.window,this.__timer=e.timer,_.bindAll(this,"__touchStart","__touchEvent","__touchChanged","__touchMove","__touchEnd","generateTrackedEvents")},__touchStart:function(e,t){null===e.touchStartId&&(e.touchStartId=t.originalEvent.changedTouches[0].identifier,e.touchStartX=t.originalEvent.changedTouches[0].pageX,e.touchStartY=t.originalEvent.changedTouches[0].pageY,e.movedX=!1,e.movedY=!1,e.timeStart=this.__timer.getTime(),e.hasFiredLongPress=!1,e.trackLongPress&&(e.longPressTimer=this.__timer.setTimeout(function(){e.hasFiredLongPress||(e.hasFiredLongPress=!0,$(t.target).trigger("longpress"))},500)),$(t.target).trigger("swipestart"))},__touchEvent:function(e,t){var i=jQuery.Event(e);return i.swipeDistance=Math.abs(t),i},__touchChanged:function(e,t,i){if(null!==e.touchStartId){var n=!0,o=null;if(_.each(t.originalEvent.changedTouches,function(t){t.identifier===e.touchStartId&&(o=t)}),null!==o){var a=o.pageX-e.touchStartX,s=Math.abs(a),r=o.pageY-e.touchStartY,l=Math.abs(r);(10<s||10<l)&&this.__timer.clearTimeout(e.longPressTimer),!e.movedY&&(i||e.trackHorizontalMoves)&&(e.movedX||s>l||10>=l)&&(10<a?($(t.target).trigger(this.__touchEvent("swiperight",a)),e.touchStartX=o.pageX,e.movedX=!0,n=!1,e.triggeredSwipe=!0,this.__timer.clearTimeout(e.longPressTimer)):-10>a&&($(t.target).trigger(this.__touchEvent("swipeleft",a)),e.touchStartX=o.pageX,e.movedX=!0,n=!1,e.triggeredSwipe=!0,this.__timer.clearTimeout(e.longPressTimer))),!e.movedX&&(i||e.trackVerticalMoves)&&(e.movedY||l>s||10>=s)&&(10<r?($(t.target).trigger(this.__touchEvent("swipedown",r)),e.touchStartY=o.pageY,e.movedY=!0,n=!1,e.triggeredSwipe=!0,this.__timer.clearTimeout(e.longPressTimer)):-10>r&&($(t.target).trigger(this.__touchEvent("swipeup",r)),e.touchStartY=o.pageY,e.movedY=!0,n=!1,e.triggeredSwipe=!0,this.__timer.clearTimeout(e.longPressTimer))),e.trackLongPress&&(t=500<=this.__timer.getTime()-e.timeStart,10>=s&&10>=l&&i&&t&&(n=!1))}else n=null;return n}return null},__touchMove:function(e,t){this.__touchChanged(e,t,!1)},__touchEnd:function(e,t){var i=this.__touchChanged(e,t,!0);null!==i&&(e.touchStartId=null,i||t.preventDefault(),this.__timer.clearTimeout(e.longPressTimer)),e.triggeredSwipe&&$(t.target).trigger("swipeend")},generateTrackedEvents:function(e,t){var i={touchStartId:null,touchStartX:null,trackVerticalMoves:!1,trackHorizontalMoves:!1,trackLongPress:!1},n=[{type:"touchstart",selector:e,name:"touch_start",handler:this.__touchStart.bind(null,i)},{type:"touchend",selector:e,name:"touch_end",handler:this.__touchEnd.bind(null,i)},{type:"touchcancel",selector:e,name:"touch_cancel",handler:this.__touchEnd.bind(null,i)}];return t&&(i.trackVerticalMoves=!!t.trackVerticalMoves,i.trackHorizontalMoves=!!t.trackHorizontalMoves,i.trackLongPress=!!t.trackLongPress),(i.trackVerticalMoves||i.trackHorizontalMoves||i.trackLongPress)&&n.push({type:"touchmove",selector:e,name:"touch_move",handler:this.__touchMove.bind(null,i)}),n}}),e["@exif"],IMVU.BaseClass.extend("ImageManager",{dependencies:["Promise","timer","window"],initialize:function(e){this.Promise=e.Promise,this.__imageErrorEvent=e.imageErrorEvent||"error",this.__timer=e.timer,this.__window=e.window},load:function(e,t,i){i=i||{},t.match(/\/rendered_image\//)&&(t=t.replace(/\.localhost/,""));var n=(e=this.__getImageAndContainer(e,t,i)).img,o=e.container;return t=e.src,new this.Promise(function(e){n.on("load",this.__finishImageLoad.bind(this,n,o,i,e)),n.on(this.__imageErrorEvent,this.__handleImageError.bind(this,n,o,i,e)),o.addClass("loading"),n.attr({src:t})}.bind(this))},__getImageAndContainer:function(e,t,i){e=$(e);var n=i.container?$(i.container):e;return e!==n||e.siblings().length||(n=e.parent()),i.cacheBuster&&(t=t+(i=-1<t.indexOf("?")?"&":"?")+this.__timer.getTime()),{img:e,container:n,src:t}},__finishImageLoad:function(e,t,i,n){t.removeClass("loading").addClass("loaded"),t=e.width();var o=e.height();if(e.toggleClass("is-square",t===o),e.toggleClass("is-portrait",o>t),e.toggleClass("is-landscape",t>o),i.forceStaticImage){var a=e[0],s=document.createElement("canvas");s.width=t,s.height=o,s.getContext("2d").drawImage(a,0,0,t,o),_.each(a.attributes,function(e){s.setAttribute(e.name,e.value),"id"===e.name&&a.removeAttribute(e.name)}),a.parentNode.insertBefore(s,a),e.hide()}n.accept()},__handleImageError:function(e,t,i,n){t.removeClass("loading").addClass("error"),i.defaultImage&&e.attr({src:i.defaultImage}),n.reject()},__makeBackgroundImage:function(e,t){e.addClass(t.attr("class")).css("background-image","url("+t.attr("src")+")"),t.off().remove()},getExifData:function(e){var t=this.__window.EXIF;return new this.Promise(function(i){t.getData(e,function(){i.accept(t.getAllTags(this))})}.bind(e))},loadAsBackgroundImage:function(e,t,i){var n=document.createElement("img");return this._$lastDummyImage=$(n),e=this.__makeBackgroundImage.bind(this,$(e),$(n)),this.load($(n),t,i).then(e).catch(e)},_spyOnLoadAsBackgroundImage:function(){var e=this.loadAsBackgroundImage;this.loadAsBackgroundImage=function(){var t=e.apply(this,arguments);return this._$lastDummyImage.trigger("load"),t},this.loadAsBackgroundImage.cleanUpSpy=function(){this.loadAsBackgroundImage=e}}})),f=IMVU.BaseClass.extend("LocalStorageManager",_.extend({dependencies:["cookieManager"],initialize:function(e){if(this.__cookieManager=e.cookieManager,this.broken=!1,void 0===localStorage.getItem)this.broken=!0;else try{localStorage.setItem("breakage_test",42),localStorage.removeItem("breakage_test")}catch(e){this.broken=!0}},getItem:function(e){return this.broken?"null"===(e=this.__cookieManager.get(e))?null:e:localStorage.getItem(e)},getWithDefault:function(e,t){var i=this.getItem(e);return null===i?t:i},setItem:function(e,t){this.broken?this.__cookieManager.set(e,t):(localStorage.setItem(e,t),this.trigger("change:"+e,t))},removeItem:function(e){this.broken?this.__cookieManager.set(e,null):(localStorage.removeItem(e),this.trigger("remove:"+e))},clear:function(){this.broken||localStorage.clear()}},Backbone.Events)),v=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;i=t.helperMissing;var a='<p class="status"></p>\n<p class="timer">';return((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Retry in",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+=' <span class="clock"></span></p>\n<button class="btn retry">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Try Now",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+"</button>"},useData:!0})}(),b=(v=function(e){var t=e.UiCore.UiContext;return t.extend("ImqStatus",{className:"imq-status",uiContextName:"imq_status",dependencies:["imqManager","globalStringManager","timer"],trackedEvents:function(){return[{type:"click",selector:"button.retry",name:"retry",handler:this.__reconnect}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__serviceProvider=e.serviceProvider,this.__imqManager=e.imqManager,this.__globalStringManager=e.globalStringManager,this.__timer=e.timer,this.__imqManager.state.on("change:status",this.__update,this),this.__update()},delete:function(){this.__timer.clearTimeout(this.__tickTimeout),t.prototype.delete.call(this)},render:function(){this.$el.html(e.template)},__update:function(){var e,t=this.__imqManager.state.get("status");if(!this.__hasEverDisconnected){if("disconnected"!==t)return;this.__hasEverDisconnected=!0,this.addToDOM()}switch(this.__timer.clearTimeout(this.__tickTimeout),t){case"connected":e=this.__globalStringManager.get("Connected!");break;case"disconnected":e=this.__globalStringManager.get("Not connected"),this.__tick();break;default:e=this.__globalStringManager.get("Connecting")}this.$(".status").text(e),this.$el.toggleClass("connected","connected"===t),this.$el.toggleClass("connecting","connecting"===t),this.$("button.retry").prop("disabled","disconnected"!==t)},__tick:function(){var e=this.__imqManager.state.get("connectAt"),t=(e=Math.round((e-this.__timer.getTime())/1e3),Math.floor(e/60));e%=60;this.$(".timer .clock").text(t+":"+(10>e?"0":"")+e),this.__tickTimeout=this.__timer.setTimeout(this.__tick.bind(this),1e3)},__reconnect:function(){this.__imqManager.connect()}})}({UiCore:e["@UiCore"],template:v}),IMVU.BaseClass.extend("NullPrefsManager",{dependencies:["Promise"],initialize:function(e){this.Promise=e.Promise},populated:function(){return this.Promise.resolve()},get:function(e,t){return t},getBool:function(e,t){return t},set:function(e,t){}})),w=function(e){var t=IMVU.BaseClass;return t.extend("FeatureAccessManager",{dependencies:"cookieManager geolocation globalStartupModel leanplum loginManager platform prefsManager webGL window".split(" "),initialize:function(e){t.prototype.initialize.call(this,e),this.__isQA=!1,this.__prefsManager=e.prefsManager,this.__leanplum=e.leanplum,this.__cookieManager=e.cookieManager,this.__webGL=e.webGL,this.__platform=e.platform,this.__window=e.window,this.__geolocation=e.geolocation,this.__globalStartupModel=e.globalStartupModel,(this.__loginManager=e.loginManager)&&this.__loginManager.isLoggedIn()&&(this.__myself=this.__loginManager.getCurrentUser()),this.__prefsManager.collection&&this.__prefsManager.collection.on("change add remove reset update",this.__updateFlags.bind(this))},__updateFlags:function(){this.__isQA=this.__prefsManager.getBool("is_qa")&&!this.__prefsManager.getBool("next.hide_qa"),this.__canSeeDeveloperPages=this.__prefsManager.getBool("next.dev_mode.enabled"),this.__shouldSeeDisplayNames=this.__prefsManager.getBool("next.should_see_display_names")},__getIEVersion:function(){var e=this.__window.navigator.userAgent,t=e.indexOf("MSIE ");return 0<t?parseInt(e.substring(t+5,e.indexOf(".",t)),10):0<e.indexOf("Trident/")?11:0<(t=e.indexOf("Edge/"))&&parseInt(e.substring(t+5,e.indexOf(".",t)),10)},__isIE:function(){return!1!==this.__getIEVersion()},canSeeSaleToaster:function(){return!0},canSeeQA:function(){return this.__isQA},canSeeClientLoginToaster:function(){return!0},isLeanplumExperiment:function(e){if("experiment"===this.__cookieManager.get("forceLeanplumBranch"))return!0;if("control"===this.__cookieManager.get("forceLeanplumBranch"))return!1;switch(e){case"welcome":break;default:throw Error("Project unsupported")}return!0===this.__leanplum.get("testExperiment")}})}(e["@UiCore"]),y=function(e){var t=e.UiCore.DialogManager;return t.extend("DialogManager",{initialize:function(e){t.prototype.initialize.call(this,e),$(document).on("keyup.dialogManager",this.__handleKeyup.bind(this))},delete:function(){t.prototype.delete.call(this),$(document).off("keyup.dialogManager")},__handleKeyup:function(t){t.keyCode===e.NextUtil.Keys.VK_ESC&&this.closeActive()},alert:function(t){return this.showDialog(e.Dialogs.AlloyAlertDialog,t)},confirm:function(t){return this.showDialog(e.Dialogs.AlloyConfirmDialog,t)},closeAll:function(e){for(var t=!1,i=this.__stack.length-1;0<=i;i--){var n=this.__stack[i];(n.$el.hasClass("interstitial")||n.$el.hasClass("persistent"))&&!0===e?t=!0:(n.hide(),n.promiseResolver.reject())}t||(this.hide(),this.__stack=[])},closeActive:function(){var e=_.last(this.__stack);e&&(e.hide(),e.promiseResolver.reject())},show:function(){var e=document.documentElement.scrollTop||document.body.scrollTop;this.__undoScrollTop=document.documentElement.scrollTop?function(){$("html").scrollTop(e)}:document.body.scrollTop?function(){$("body").scrollTop(e)}:function(){},t.prototype.show.call(this),$("#imvu").scrollTop(e)},hide:function(){t.prototype.hide.call(this),this.__undoScrollTop&&(this.__undoScrollTop(),delete this.__undoScrollTop)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],NextUtil:e["@NextUtil"]}),M=function(e){var t=IMVU.BaseClass;return t.extend("TimestampHelper",{dependencies:["Promise","globalStringManager"],initialize:function(e){t.prototype.initialize.call(this,e),this.__serviceProvider=e.serviceProvider,this.__globalStringManager=e.globalStringManager,this.__moment=this.__serviceProvider.get("moment"),e.now&&(this._now=e.now),this.setDifference(this.now())},_setNow:function(e){this._now=this.__moment(e)},_getDiffDate:function(){return this.__diffDate},now:function(){return this._now||this.__moment()},setDifference:function(e){this.__diffDate=this.__moment(e),this.__calcResult=this.__calcDiff(this.__diffDate,!1)},formatSingleUnit:function(e){e=void 0===e?this.__calcResult:e;var t=this.__calcDiff(this.__moment(e),!0);return this.__formatSingleUnit(this.__moment(e),t)},formatDaysOrWeeks:function(e){return e=void 0===e?this.__calcResult:e,e=this.__calcDiff(this.__moment(e),!1),this.__formatDaysOrWeeks(e)},sameGroup:function(e,t){var i=this.__calcDiff(this.__moment(e),!1),n=this.__calcDiff(this.__moment(t),!1);return!(!i.today||!n.today)||i.number===n.number&&i.text===n.text},sameDay:function(e,t){return this.__moment(e).isSame(this.__moment(t),"day")},formatDateAndTime:function(e){return e&&this.setDifference(e),this.__formatDateAndTime(this.__diffDate)},formatTime:function(e){return e&&this.setDifference(e),this.__formatTime(this.__diffDate)},feedItem:function(e){return e?this.__formatSingleUnitAgo(this.__diffDate,this.__calcResult):this.__formatSingleUnit(this.__diffDate,this.__calcResult)},messageHeaderDay:function(){return this.__calcResult.today?this.__formatDaysOrWeeks(this.__calcResult):"day"===this.__calcResult.text?1===this.__calcResult.number?this.__formatDaysOrWeeks(this.__calcResult):this.__getLongDayName():"year"===this.__calcResult.text?this.__getShortMonthName()+this.__diffDate.format(" D, YYYY"):this.__getShortDayName()+", "+this.__getShortMonthName()+this.__diffDate.format(" D")},activityCenterHeader:function(){return this.__formatDaysOrWeeks(this.__calcResult)},activityCenterDetail:function(){if(this.__calcResult.today)return this.__formatSingleUnit(this.__diffDate,this.__calcResult);var e=this.__getShortMonthName()+this.__diffDate.format(" D,"),t=this.formatTime(this.__diffDate);if("day"===this.__calcResult.text){if(1===this.__calcResult.number)return t;e=this.__globalStringManager.get(this.__diffDate.format("dddd"))}else"year"===this.__calcResult.text&&(e=this.__getShortMonthName()+this.__diffDate.format(" D, YYYY"));return e+" "+t},chatDrawerTimestamp:function(){if(this.__calcResult.today)return this.formatTime(this.__diffDate);var e=this.__diffDate.format("MMM D,"),t=this.formatTime(this.__diffDate);if("day"===this.__calcResult.text){if(1===this.__calcResult.number)return t;e=this.__getLongDayName()}else"year"===this.__calcResult.text&&(e=this.__getShortMonthName()+this.__diffDate.format(" D, YYYY"));return e+" "+t},messageDrawerDateTime:function(){return this.__calcResult.today?this.formatTime(this.__diffDate):"day"===this.__calcResult.text?1===this.__calcResult.number?this.__formatDaysOrWeeks(this.__calcResult):this.__getLongDayName():this.__diffDate.format("M/DD/YY")},orderDate:function(e){return this.__moment(e).format("dddd, MMMM D, YYYY")},__getLongDayName:function(){return this.__globalStringManager.get(this.__diffDate.format("dddd"))},__getShortDayName:function(){return this.__globalStringManager.get(this.__diffDate.format("ddd"))},__getLongMonthName:function(){return this.__globalStringManager.get(this.__diffDate.format("MMMM"))},__getShortMonthName:function(){return this.__globalStringManager.get(this.__diffDate.format("MMM"))},formatActivityTimestamp:function(e){e=this.__moment(e);var t=this.__calcDiff(e,!1);if(t.today)return this.__formatSingleUnit(e,t);var i=e.format("MMM D,"),n=this.formatTime(e);return"day"===t.text?i=1===t.number?this.__formatDaysOrWeeks(t):this.__globalStringManager.get(e.format("dddd")):"year"===t.text&&(i=e.format("MMM D, YYYY")),i+" "+n},__formatDate:function(e){return e.format("MMMM D YYYY")},__formatTime:function(e){return e.format("h:mm A")},__formatDateAndTime:function(e){return e.format("MMMM D YYYY, h:mm A")},__dayThreshold:function(e,t){return e.hours()<t.hours()||e.hours()===t.hours()&&e.minutes()<t.minutes()||e.minutes()===t.minutes()&&e.seconds<=t.seconds()},__calcDiff:function(e,t){var i=this.now(),n=i.diff(e,"minutes"),o=Math.floor(n/60);if(t||i.date()===e.date()){if(1>n)return{number:0,text:"minute",today:!0};if(60>n)return{number:n,text:"minute",today:!0};if(24>o)return{number:o,text:"hour",today:!0}}o=i.diff(e,"hour"),n=t?Math.floor(o/24):i.diff(e,"day"),t||this.__dayThreshold(i,e)&&n++;var a=i.diff(e,"week");a=i.diff(e,"month");return 7>n?{number:n,text:"day",today:!1}:(t?30>n?n=i.diff(e,"day"):a=Math.floor(o/720):i.date()===e.date()&&this.__dayThreshold(i,e)&&a++,0===a?{number:a=Math.floor(n/7),text:"week",today:!1}:12>a?{number:a,text:"month",today:!1}:(a=Math.round(n/30),{number:Math.floor(a/12),text:"year",today:!1}))},__formatSingleUnit:function(e,t){return 0===(t=void 0===t?this.__calcResult:t).number&&"minute"===t.text?this.__globalStringManager.get("Just now"):_.contains(["week","month"],t.text)?e.format("MMM D"):"year"===t.text?e.format("M/DD/YY"):this.__globalStringManager.get("ts_short_"+t.text,{howMany:t.number})},__formatSingleUnitAgo:function(e,t){return 0===(t=void 0===t?this.__calcResult:t).number&&"minute"===t.text?this.__globalStringManager.get("Just now"):_.contains(["week","month"],t.text)?e.format("MMM D"):"year"===t.text?e.format("M/DD/YY"):this.__globalStringManager.get("ts_short_ago_"+t.text,{howMany:t.number})},__formatDaysOrWeeks:function(e){return(e=void 0===e?this.__calcResult:e).today?this.__globalStringManager.getPluralized("ts_timebreak_day",{howMany:0}):this.__globalStringManager.getPluralized("ts_timebreak_"+e.text,{howMany:e.number})}})}(e["@UiCore"]),C=function(e){return e.UiCore.RestCollection.extend("PrefCollection",{model:e.UiCore.EdgeModel})}({UiCore:e["@UiCore"]}),S=(C=function(e){return IMVU.BaseClass.extend("PrefsManager",{dependencies:["loginManager","Promise","rest"],initialize:function(t){this.Promise=t.Promise,this.rest=t.rest,this.__pendingSets={};var i=t.loginManager.getCurrent().getSingleEdge("user");this.__populated=i.populated().then(function(){return i.getEdgeCollection("preferences",e.PrefCollection)}.bind(this)).then(function(e){return this.collection=e,e.populated()}.bind(this)).then(function(){this.collection.on("change",this.__cleanPendingSet.bind(this))}.bind(this))},__cleanPendingSet:function(e){var t=e.get("name");e=e.get("value"),this.__pendingSets[t]===e&&delete this.__pendingSets[t]},populated:function(){return this.__populated},__ensurePopulated:function(){if("pending"===this.__populated.state)throw Error("Cannot perform preference operation until preferences are populated")},get:function(e,t){if(this.__ensurePopulated(),this.__pendingSets[e])return this.__pendingSets[e];for(var i=0;i<this.collection.length;i++){var n=this.collection.at(i);if(n.get("name")===e)return n.get("value")}return t},getBool:function(e,t){var i=this.get(e,null);return _.isNull(i)?t:!!parseInt(i,10)},getInt:function(e,t){var i=this.get(e,null);return _.isNull(i)?t:parseInt(i,10)},setBool:function(e,t){return this.set(e,t?"1":"0")},setInt:function(e,t){return this.set(e,String(t))},set:function(e,t){if(this.__ensurePopulated(),"string"!=typeof t)throw Error("Tried to set pref with non-string value: "+typeof t);if(this.get(e)===t)return new this.Promise(function(e){e.accept()});this.__pendingSets[e]=t;var i=this.rest.post(this.collection.url,{id:"/preferences/preference-"+e,data:{value:t}});return i.catch(function(){delete this.__pendingSets[e]}.bind(this)),i}})}({UiCore:e["@UiCore"],PrefCollection:C}),function(e){return IMVU.BaseClass.extend("HistoryManager",_.extend({dependencies:["modeManager","restModelFactory","siteRoot","timer","window"],initialize:function(e){this.__window=e.window,this.__modeManager=e.modeManager,this.__siteRoot=e.siteRoot,this.__restModelFactory=e.restModelFactory,this.__needsInitialState=!0,this.__currentStateIndex=-1,this.__sessionId=e.timer.getTime(),this.__window.history.scrollRestoration="manual",this.__window.addEventListener("popstate",this.__onPopState.bind(this))},setState:function(e){var t="pushState";if(this.__needsInitialState||e.replace)this.__needsInitialState=!1,t="replaceState";else if(this.compareStates(this.__window.history.state,e))return!1;return this.__setState(e,t),!0},compareStates:function(e,t){return!(!(e&&t&&e.mode&&e.mode.id&&t.mode&&t.mode.id&&e.mode.id===t.mode.id)||e.submode&&t.submode&&e.submode.id!==t.submode.id)},__prepareStateForStorage:function(t){var i={};return _.each(t,function(t,n){t instanceof e.Model.FeedNode?(i.__feedNodes=i.__feedNodes||{},i.__feedNodes[n]=t.id):t instanceof e.Model.ProductNode?(i.__productNodes=i.__productNodes||{},i.__productNodes[n]=t.id):t instanceof e.UiCore.NodeModel?(i.__nodes=i.__nodes||{},i.__nodes[n]=t.id):t instanceof e.UiCore.EdgeCollection?(i.__edgecollections=i.__edgecollections||{},i.__edgecollections[n]=t.url):t instanceof Object?i[n]=this.__prepareStateForStorage(t):"replace"!==n&&(i[n]=t)}.bind(this)),i},__prepareStateForUse:function(t){var i={};return _.each(t,function(n,o){"__feedNodes"===o?_.each(t[o],function(t,n){i[n]=this.__restModelFactory.readModel(t,e.Model.FeedNode)}.bind(this)):"__productNodes"===o?_.each(t[o],function(t,n){i[n]=this.__restModelFactory.readModel(t,e.Model.ProductNode)}.bind(this)):"__nodes"===o?_.each(t[o],function(t,n){i[n]=this.__restModelFactory.readModel(t,e.UiCore.NodeModel)}.bind(this)):"__edgecollections"===o?_.each(t[o],function(t,n){i[n]=this.__restModelFactory.readCollection(t,e.UiCore.EdgeCollection)}.bind(this)):i[o]=n instanceof Object?this.__prepareStateForUse(n):n}.bind(this)),i},__setState:function(e,t){var i=this.__window.document.title,n=this.__siteRoot+e.mode.id+"/";e.fragment&&(n+=e.fragment+"/"),e.replace||++this.__currentStateIndex,(e=this.__prepareStateForStorage(e)).index=this.__currentStateIndex,e.sessionId=this.__sessionId,this.__window.history[t](_.clone(e),i,n),this.trigger("stateChange")},silentMoveHistory:function(e){this.__modeManager.isOpeningMode()||(this.__silentlyMoving=!0,this.__window.history.go(e))},__finishHistoryChange:function(e){this.__modeManager.togglePermalinkConditional(),this.__currentStateIndex=e,this.__silentlyMoving=!1,this.trigger("stateChange")},__onPopState:function(e){if(e.state&&(e.state.index!==this.__currentStateIndex||e.state.sessionId!==this.__sessionId)||!e.state&&this.__window.history.state){var t=this.__prepareStateForUse(e.state||this.__window.history.state);this.__silentlyMoving?this.__finishHistoryChange(t.index):this.__modeManager.openMode(_.extend({poppingHistory:!0},t)).then(this.__finishHistoryChange.bind(this,t.index)).catch(function(){this.__openingMode=!1,this.__window.history.go(this.__currentStateIndex-t.index)}.bind(this))}}},Backbone.Events))}({UiCore:e["@UiCore"],Model:e["@Model"]})),x=function(e){var t=function(){return function(e){var t,i=+this;t=!e;var n=this.lang(),o=Math.round(Math.abs(i)/1e3),a=Math.round(o/60),s=Math.round(a/60),r=Math.round(s/24),l=Math.round(r/365);return(o=45>o&&["s",o]||1===a&&["m"]||45>a&&["mm",a]||1===s&&["h"]||22>s&&["hh",s]||1===r&&["d"]||345>=r&&["dd",r]||1===l&&["y"]||["yy",l])[2]=t,o[3]=0<i,o[4]=n,t=function(e,t,i,n,o){return o.relativeTime(t||1,!!i,e,n)}.apply({},o),e&&(t=this.lang().pastFuture(i,t)),t}}();return e.moment.lang("IOSRelativeTime",{relativeTime:{future:"in %s",past:"%s ago",s:"Just now",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:function(e){return 7>e?e+"d":Math.floor(e/7)+"w"},y:"1y",yy:"%dy"}}),e.moment.lang("en"),function(i){var n=e.moment.apply(this,Array.prototype.slice.call(arguments,1));return n.lang("IOSRelativeTime"),n.from=function(n,o){var a=t.call(e.moment.duration(this.diff(n)).lang(this.lang()._abbr),!o);return i.get("globalStringManager").getWithDefault(a,a)},n}}({moment:e["@moment"]}),k=(x=function(e){return function(t){var i=function(){return e.moment.apply({},arguments)};return i.IOSRelativeTime=e.IOSRelativeTime.bind({},t),i}}({moment:e["@moment"],IOSRelativeTime:x}),function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("TooltipLayer",{className:"tooltip-layer",uiContextName:"tooltip_layer",initialize:function(e){i.prototype.initialize.call(this,e),this.addToDOM()}})}()),D=function(e){function t(e){var t={};return 0<e.length&&(e=(e=e.substring(1)).split("&"),_.each(e,function(e){var n=e.split("=");if(e=void 0!==n[0]?decodeURIComponent(n[0].replace(/\+/g,"%20")):"",n=void 0!==n[1]?decodeURIComponent(n[1].replace(/\+/g,"%20")):"",i.test(e))if(i.exec(e)[1]){var o=e.replace(i,"");o in t||(t[o]={}),t[o][i.exec(e)[1]]=n}else(e=e.replace(i,""))in t||(t[e]=[]),t[e].push(n);else t[e]=n})),t}var i=/\[(.*?)\]/;return{fetch:function(e,i){var n=t(e.location.search),o=_.pick(n,i),a=(n=_.omit(n,i),e.location.pathname);return _.size(n)&&(a+="?"+$.param(n)),e.history.replaceState(e.history.state,document.title,a),o},get:function(e,i){return t(e.location.search)[i]},getAllParams:t}}(),T=(D=function(e){return IMVU.BaseClass.extend("LoginManager",{dependencies:"root rest restModelFactory random Promise uiEventReporter timer window".split(" "),enablePing:!0,pingImmediately:!0,initialize:function(e){this.__serviceProvider=e.serviceProvider,this.root=e.root,this.rest=e.rest,this.restModelFactory=e.restModelFactory,this.random=e.random,this.Promise=e.Promise,this.timer=e.timer,this.uiEventReporter=e.uiEventReporter,this.enablePing=IMVU.optionalProperty(e,"enablePing",this.enablePing),this.__pingTimeout=null,this.userURL=void 0,this.__setClientSession(),this.__logoutWorkItems=[],this.addLogoutWork(this.uiEventReporter.flush,this.uiEventReporter),this.__window=e.window},delete:function(){this.timer.clearTimeout(this.__pingTimeout)},__ping:function(){this.enablePing&&(this.__loginModel.getSingleEdge("user").save({online:!0}),this.__pingTimeout=this.timer.setTimeout(this.__ping.bind(this),11e4))},createFromCookie:function(){return new this.Promise(function(t){this.__loginModel=this.restModelFactory.readModel(this.root+"/login/me",e.UiCore.NodeModel),this.__loginModel.populated().then(function(){null===this.__pingTimeout&&(this.pingImmediately?this.__ping():this.__pingTimeout=this.timer.setTimeout(this.__ping.bind(this),11e4)),this.__serviceProvider.register("sauce",this.__loginModel.get("sauce")),t.resolve(this.__loginModel)}.bind(this)).catch(function(e){this.__serviceProvider.get("modelCache").release(this.__loginModel),t.reject(e)}.bind(this))}.bind(this))},createFromCredentials:function(t,i){return(i=_.clone(i||{})).wait=!0,new this.Promise(function(i){var n=function(t,n,o){void 0===t?(this.__loginModel=this.restModelFactory.readModel(n.data.id,e.UiCore.NodeModel),this.__loginModel.populated().then(function(){this.__serviceProvider.register("sauce",n.data.sauce),i.resolve(this.__loginModel)}.bind(this)).catch(function(e){i.reject(e)},this.__loginModel)):i.reject(t)}.bind(this);this.rest.post(this.root+"/login",t,n)}.bind(this))},getCurrent:function(){return this.__loginModel},addLogoutWork:function(e,t){this.__logoutWorkItems.push([e,t])},logout:function(){return this.timer.clearTimeout(this.__pingTimeout),new this.Promise(function(e){this.Promise.every(_.map(this.__logoutWorkItems,function(e){return e[0].bind(e[1])()})).then(function(){return this.rest.delete(this.__loginModel.id)}.bind(this)).then(function(t){this.__loginModel=void 0,e.resolve()}.bind(this)).catch(function(t){e.reject(t)}.bind(this))}.bind(this))},__setClientSession:function(){var e=new Date;e="client_"+this.random.getInteger(100,1e4).toString(36).substr(2,16)+e.getTime();document.cookie="client_session="+escape(e)+";domain="+(-1!==this.root.indexOf("localhost"))?"localhost.":"imvu.com;path=/"}})}({UiCore:e["@UiCore"],QueryParams:D}),function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;i=t.helperMissing;var a='<form class="login_fb_error_form" name="login_fb_error_form" method="GET" action="#" class="login_fb_error">\n    <div class="label error_exclamation">';return((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_fb_error_exclamation",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</div>\n    <div class="label error_explanation">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_fb_error_explanation",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</div>\n    <div class="label label-email">\n        <button class="btn btn-primary id-email">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_fb_error_email",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</button>\n    </div>\n    <div class="label label-or">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_or",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</div>\n    <div class="label label-fb">\n        <a class="btn btn-fb id-fb">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_fb_error_facebook",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+"</a>\n    </div>\n</form>\n"},useData:!0})}()),I=(T=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("LoginFBErrorDialog",e.Mixin.mixin({uiContextName:"login_fb_error_dialog",className:"login-fb-error-dialog dialog-type-B-flexible",dependencies:["dialogManager","globalStringManager","loginManager","modeManager","window"],trackedEvents:function(){return[{type:"click",selector:".id-email",name:"login_with_email",handler:"__onClickEmail"},{type:"click",selector:".id-fb",name:"register_with_facebook",handler:"__onClickFB"}]},initialize:function(e){this.__dialogManager=e.dialogManager,this.title=e.globalStringManager.get("login_fb_error_choose"),this.hasCloseButton=!!_.isUndefined(e.hasCloseButton)||e.hasCloseButton,t.prototype.initialize.call(this,e),this.__socialLogin=void 0!==e.socialLogin?e.socialLogin:this.__loginManager.getSocialLogin(),this.__socialLogin.logout(),this.addToDOM()},postRender:function(){this.setContent("body",e.template,{})},__onClickEmail:function(t){this.delete(),this.__loginDialog=this.__dialogManager.showDialog(e.LoginDialog)},__onClickFB:function(){this.delete();var e=function(){this.__modeManager.openMode({mode:{id:"ftux"},submode:{id:"gender"}})}.bind(this);this.__socialLogin.new(e)}},e.InputMixin))}({Dialogs:e["@Dialogs"],NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],InputMixin:g,LoginDialog:P,Mixin:h,template:T}),function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o;i=t.helperMissing;var a='<form class="login_fb_banned_form" name="login_fb_banned_form" method="GET" action="#" class="login_fb_banned">\n    <div class="label banned_exclamation">';return((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_fb_banned_exclamation",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</div>\n    <div class="label banned_explanation">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_fb_banned_explanation",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</div>\n    <div class="label label-email">\n        <button class="btn btn-primary id-email">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_fb_error_email",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</button>\n    </div>\n    <div class="label label-or">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_or",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+='</div>\n    <div class="label label-fb">\n        <a class="btn btn-fb id-fb">',((o=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_fb_error_facebook",{name:"i18n-g",hash:{},data:n}))||0===o)&&(a+=o),a+"</a>\n    </div>\n</form>\n"},useData:!0})}()),P=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("LoginFBBannedDialog",e.Mixin.mixin({uiContextName:"login_fb_banned_dialog",className:"login-fb-banned-dialog dialog-type-B-flexible",dependencies:["dialogManager","globalStringManager","loginManager","modeManager","window"],trackedEvents:function(){return[{type:"click",selector:".id-email",name:"login_with_email",handler:"__onClickEmail"},{type:"click",selector:".id-fb",name:"register_with_facebook",handler:"__onClickFB"}]},initialize:function(e){this.__dialogManager=e.dialogManager,this.title=e.globalStringManager.get("login_fb_error_choose"),this.hasCloseButton=!!_.isUndefined(e.hasCloseButton)||e.hasCloseButton,t.prototype.initialize.call(this,e),this.__socialLogin=void 0!==e.socialLogin?e.socialLogin:this.__loginManager.getSocialLogin(),this.__socialLogin.logout(),this.addToDOM()},postRender:function(){this.setContent("body",e.template,{})},__onClickEmail:function(t){this.delete(),this.__loginDialog=this.__dialogManager.showDialog(e.LoginDialog)},__onClickFB:function(){this.delete();var e=function(){this.__modeManager.openMode({mode:{id:"ftux"},submode:{id:"gender"}})}.bind(this);this.__socialLogin.new(e)}},e.InputMixin))}({Dialogs:e["@Dialogs"],NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],InputMixin:g,LoginDialog:P,Mixin:h,template:I}),E=(I=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var o,a,s=this.escapeExpression;return i=t.helperMissing,s='<form class="social_login_service_failure_form" name="social_login_service_failure_form" method="GET" action="#">\n    <div class="label failure_warning">'+s("function"==typeof(a=t.social_login_service||e&&e.social_login_service)?a.call(e,{name:"social_login_service",hash:{},data:n}):a)+" ",((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"social_login_service_failure_warning",{name:"i18n-g",hash:{},data:n}))||0===o)&&(s+=o),s+='</div>\n    <div class="label failure_prompt">',((o=(a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"social_login_service_failure_prompt",{name:"i18n-g",hash:{},data:n}))||0===o)&&(s+=o),s+"</div>\n</form>\n"},useData:!0})}(),h=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("SocialLoginServiceFailureDialog",e.Mixin.mixin({uiContextName:"social_login_service_failure_dialog",className:"social-login-service-failure-dialog dialog-type-A",dependencies:["dialogManager","globalStringManager"],trackedEvents:function(){return[]},initialize:function(e){this.__dialogManager=e.dialogManager,this.title=e.globalStringManager.get("social_login_service_failure_title"),this.hasCloseButton=!!_.isUndefined(e.hasCloseButton)||e.hasCloseButton,this.__social_login_service=e.social_login_service,t.prototype.initialize.call(this,e),this.addToDOM()},postRender:function(){this.setContent("body",e.template,{social_login_service:this.__social_login_service})}},e.InputMixin))}({Dialogs:e["@Dialogs"],NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],InputMixin:g,Mixin:h,template:I}),h=function(e){var t=e.UiCore.UiContext;return t.extend("SocialLogin",{dependencies:["dialogManager","localStorage","rest","root","window"],__setAuth:function(e){(this.__loggedIn="connected"===e.status)&&void 0!==e.authResponse&&(this.__fbAuthResponse=e.authResponse),void 0!==this.__fbAuthResponse&&void 0!==this.__fbAuthResponse.userID&&this.__window.console.log("Social external userID:  "+String(this.__fbAuthResponse.userID))},getAuth:function(){return this.__fbAuthResponse},__getProfile:function(){this.__window.FB.api("/me?fields=id,name,email,permissions,gender,first_name,last_name,locale,middle_name,birthday",function(e){this.__profile.name="string"==typeof e.name?e.name:"",this.__profile.first_name="string"==typeof e.first_name?e.first_name:"",this.__profile.middle_name="string"==typeof e.middle_name?e.middle_name:"",this.__profile.last_name="string"==typeof e.last_name?e.last_name:"",this.__profile.short_name="string"==typeof e.short_name?e.short_name:"",this.__profile.id=e.id,this.__profile.email="string"==typeof e.email?e.email:"",this.__profile.gender="string"==typeof e.gender?e.gender:"",this.__profile.locale="string"==typeof e.locale?e.locale:"",this.__profile.verified="boolean"==typeof e.verified&&e.verified,this.__profile.permissions=e.permissions,this.__profile.birthday="string"==typeof e.birthday?e.birthday:"","string"==typeof e.birthday?(e=e.birthday.split("/"),this.__profile.birthdayYear=void 0!==e[2]?e[2]:"",this.__profile.birthdayDay=void 0!==e[1]?e[1]:"",this.__profile.birthdayMonth=void 0!==e[0]?e[0]:""):(this.__profile.birthdayYear="",this.__profile.birthdayMonth="",this.__profile.birthdayDay="")}.bind(this))},__statusCallback:function(e,t,i){this.__setAuth(e),this.__loggedIn&&t?t():!this.__loggedIn&&i&&i()},checkLoginState:function(e,t){this.__window&&this.__window.FB?this.__window.FB.getLoginStatus(function(i){this.__statusCallback(i,e,t)}.bind(this)):this.__loggedIn=!1},isLoggedIn:function(){return void 0!==this.__loggedIn&&!0===this.__loggedIn},populateCredentials:function(){if(!this.isLoggedIn()){var e=function(){this.isLoggedIn()&&this.__getProfile()}.bind(this);this.checkLoginState(e)}},initialize:function(e){this.__dialogManager=e.dialogManager,t.prototype.initialize.call(this,e),this.__profile={},this.populateCredentials()},isPermitted:function(e){return this.__profile.permissions.data.forEach(function(t){if(t.permission==e)return!0}),!1},getProfileItem:function(e){if("string"==typeof e)switch(e){case"name":return this.__profile.name;case"first_name":return this.__profile.first_name;case"middle_name":return this.__profile.middle_name;case"last_name":return this.__profile.last_name;case"short_name":return this.__profile.short_name;case"id":return this.__profile.id;case"email":return this.__profile.email;case"gender":return this.__profile.gender;case"locale":return this.__profile.locale;case"birthday":return this.__profile.birthday;case"birthdayYear":return this.__profile.birthdayYear;case"birthdayMonth":return this.__profile.birthdayMonth;case"birthdayDay":return this.__profile.birthdayDay;case"verified":return this.__profile.verified;case"permissions":return this.__profile.permissions}},getProfileBirthdayStr:function(){return""===this.__profile.birthdayYear||""===this.__profile.birthdayMonth||""===this.__profile.birthdayDay?null:this.__profile.birthdayYear+"-"+this.__profile.birthdayMonth+"-"+this.__profile.birthdayDay+" 00:00:00 GMT"},getPlatform:function(){return"facebook_web"},__captureUserNode:function(e){this.__loginNode=e.response,this.__userNode=this.__loginNode.data.user},__fbNew:function(t,i){this.__window.FB.login(function(n){if("connected"===n.status){this.__setAuth(n),this.__getProfile();var o={platform:this.getPlatform(),platform_token:this.__fbAuthResponse.accessToken,platform_uid:this.__fbAuthResponse.userID};this.__rest.post(this.__root+"/login",o).then(function(e){this.__captureUserNode(e),this.__window.location.href="/next/home"}.bind(this)).catch(function(o){"LOGIN-008"===o.error.error?this.__dialogManager.showDialog(e.LoginFBBannedDialog):this.__statusCallback(n,t,i)}.bind(this))}else this.__statusCallback(n,t,i)}.bind(this),{scope:"email,public_profile,user_birthday,user_likes,publish_actions",return_scopes:!0})},new:function(e,t){this.logout(),void 0!==this.__window&&void 0!==this.__window.FB&&this.__window.FB.getLoginStatus(function(i){"connected"===i.status?(this.__getProfile(),this.__statusCallback(i,e,t)):this.__fbNew(e,t)}.bind(this))},__fbLogin:function(t,i){this.__window.FB.login(function(n){"connected"===n.status?(this.__setAuth(n),n={platform:this.getPlatform(),platform_token:this.__fbAuthResponse.accessToken,platform_uid:this.__fbAuthResponse.userID},this.__rest.post(this.__root+"/login",n).then(function(e){this.__captureUserNode(e),t&&t()}.bind(this)).catch(function(t){this.__fbLogout(),i?i():"LOGIN-008"===t.error.error?this.__dialogManager.showDialog(e.LoginFBBannedDialog):this.__dialogManager.showDialog(e.LoginFBErrorDialog,{socialLogin:this})}.bind(this))):i?i():this.__dialogManager.showDialog(e.LoginFBErrorDialog,{socialLogin:this})}.bind(this),{scope:"email,public_profile,user_birthday,user_likes,publish_actions",return_scopes:!0})},__checkForSocialLoginService:function(){return void 0!==this.__window&&(void 0!==this.__window.FB||(this.__dialogManager.showDialog(e.SocialLoginServiceFailureDialog,{social_login_service:"Facebook"}),!1))},login:function(e,t){this.__checkForSocialLoginService()&&(this.logout(),void 0!==this.__window&&void 0!==this.__window.FB&&this.__window.FB.getLoginStatus(function(i){"connected"===i.status?(this.__getProfile(),this.__setAuth(i),this.__statusCallback(i,e,t)):this.__fbLogin(e,t)}.bind(this)))},__fbLogout:function(e,t){this.__window.FB.logout(function(i){this.__statusCallback(i,e,t)}.bind(this))},logout:function(e,t){this.__checkForSocialLoginService()&&this.__window.FB.getLoginStatus(function(e,t,i){"connected"===e.status&&(this.__fbAuthResponse=void 0,this.__profile={},this.__fbLogout(t,i)),this.__statusCallback(e,t,i)}.bind(this))}})}({UiCore:e["@UiCore"],LoginFBErrorDialog:T,LoginFBBannedDialog:P,SocialLoginServiceFailureDialog:h}),h=function(e){var t=e.LoginManager;return t.extend("NextLoginManager",{dependencies:["leanplum","localStorage","window"],pingImmediately:!1,initialize:function(i){this.window=i.window,this.__localStorage=i.localStorage,this.__leanplum=i.leanplum,t.prototype.initialize.call(this,i),this.__logoutConfirmer=this.Promise.accept(),this.__socialLogin=this.__serviceProvider.create(e.SocialLogin)},getSocialLogin:function(){return this.__socialLogin},setLogoutConfirmer:function(e){this.__logoutConfirmer=e},logout:function(){return this.__leanplum.recordEvent("logout"),this.__leanplum.endSession(),this.__localStorage.removeItem("saleToasterSeen"),this.__socialLogin.logout(),this.__logoutConfirmer().then(t.prototype.logout.bind(this)).then(function(){this.window.console.hasOwnProperty("trace")&&this.window.console.trace("Reload after logout LIM"),this.window.location.replace("/next/ftux/")}.bind(this))},logoutInPlace:function(){return this.__socialLogin.logout(),t.prototype.logout.call(this)},isLoggedIn:function(){return void 0!==this.getCurrent()&&void 0!==this.getCurrent().get("session_id")},getCurrentUser:function(){return this.getCurrent().getSingleEdge("user")},setLoginDestination:function(e){this.__loginDestination=e},getLoginDestination:function(){return this.__loginDestination||null},setSignUpDestination:function(e){this.__signUpDestination=e},getSignUpDestination:function(){return this.__signUpDestination||null},getCoreUserModelAndConnectToIMQ:function(t,i,n){var o=i.getSingleEdge("user"),a=t.create(n,{url:i.relations.imq,metadata:{app:"imvu"},httpUrl:i.relations.imqHttp,onPreReconnectCallback:function(e,i){11e4<i?t.get("window").location.reload():e(null,null)},userId:o.get("legacy_cid").toString(),sessionId:i.get("session_id")});return t.register("imqManager",a),i=a.connect().then(function(){var i=t.get("errorModel");i&&a.state.on("change:status",function(){var e=a.state.get("status");"disconnected"===e?i.set("imqDisconnect",!0):"connected"===e&&i.set("imqDisconnect",!1)}.bind(this)),t.create(e.UiCore.ModelInvalidator)}),t.get("Promise").every([i,o.populated()]).then(function(){t.get("loginStatus").set("authenticated",!0)})},ERROR_CREDENTIALS:0,ERROR_LOGIN_ME:1,ERROR_IMQ_CONNECT_OR_USER_FETCH:2,ERROR_TRY_AGAIN_LATER:3,ERROR_DISABLED:4,ERROR_UNDERAGE:5,ERROR_COOKIE_UNACCEPT:6,ERROR_UNDERAGE_PENDING_CONSENT:7,performLoginFromCredentials:function(e,t){var i=e.get("loginManager"),n=e.get("Promise");return new n(function(e){i.createFromCredentials(t).then(function(e){return i.createFromCookie()},function(t){return"LOGIN-002"===t.error?e.reject(this.ERROR_TRY_AGAIN_LATER):"LOGIN-008"===t.error?e.reject(this.ERROR_DISABLED):"LOGIN-010"===t.error?e.reject(this.ERROR_UNDERAGE):"LOGIN-011"===t.error?e.reject(this.ERROR_COOKIE_UNACCEPT):"LOGIN-012"===t.error?e.reject(this.ERROR_UNDERAGE_PENDING_CONSENT):e.reject(this.ERROR_CREDENTIALS),n.reject()}.bind(this)).then(function(t){e.resolve(t)},function(){return e.reject(this.ERROR_LOGIN_ME),n.reject()}.bind(this))}.bind(this))},__ping:function(){if(this.enablePing){var e={availability:"Available",online:!0};"DoNotDisturb"===this.__loginModel.getSingleEdge("user").get("availability")&&(e={availability:"DoNotDisturb"}),this.__loginModel.getSingleEdge("user").save(e).catch(function(){this.window.console.hasOwnProperty("trace")&&this.window.console.trace("Reload after logout during ping"),this.window.location.reload()}.bind(this)),this.__pingTimeout=this.timer.setTimeout(this.__ping.bind(this),11e4)}}})}({IMQ:e["@IMQ"],UiCore:e["@UiCore"],LoginManager:D,SocialLogin:h}),g=(e["@UiCore"],IMVU.BaseClass.extend("GoogleAnalytics",{dependencies:["window"],initialize:function(e){this.__serviceProvider=e.serviceProvider,this.__window=e.window},recordPageView:function(){this.recordPageView=function(e){void 0!==this.__window.gaTrack&&this.__window.gaTrack("send","pageview","/"===e.substr(0,1)?e:"/"+e)}},recordModeChange:function(e){this.__sendEvent("mode","show",e)},recordSubModeChange:function(e){this.__sendEvent("submode","show",e)},recordSignUpClick:function(e){this.__sendEvent("sign up","show dialog",e)},recordRegistrationComplete:function(e){this.__sendEvent("sign up","registration complete",e)},recordSuccessfulAuthentication:function(e){this.__sendEvent("logging in","authenticate",e)},recordProfileImageChanged:function(e){this.__sendEvent("profile image","changed",e)},recordBuyAnItem:function(e){this.__sendEvent("catalog","purchased item",e)},recordFeedItemCreated:function(e){this.__sendEvent("feed item","created",e)},recordFeedItemAction:function(e){this.__sendEvent("feed item","action",e)},recordFriendRequest:function(e){this.__sendEvent("friends","requests",e)},recordEnterChatRoom:function(e){this.__sendEvent("chat rooms","enter",e)},recordChatSend:function(e){this.__sendEvent("chat","send message",e)},recordMessagingEvents:function(e){this.__sendEvent("messaging","messages",e)},recordDollarStore:function(e,t){this.__sendEvent("dollar store",e,t)},recordClick:function(e,t){this.__sendEvent(e,"click",t)},recordPerformance:function(e,t,i){if(void 0!==this.__window.gaTrack){if(i!==parseInt(i,10))throw Error('google analytics expects an integer value for the field: "eventValue"');this.__window.gaTrack("send","event","performance",e,t,i)}},__sendEvent:function(e,t,i){void 0!==this.__window.gaTrack&&this.__window.gaTrack("send","event",e,t,i)}})),P=function(e){var t=e.UiCore.UiContext;return t.extend("ContextMenuManager",{uiContextName:"context_menu_manager",tagName:"section",className:"context-menu-manager",MOUSE_MARGIN:10,initialize:function(e){t.prototype.initialize.call(this,e),this.__serviceProvider=e.serviceProvider,this.__mouseMargin=_.isUndefined(e.mouseMargin)?this.MOUSE_MARGIN:e.mouseMargin,this.__$parentElement=e.$parentElement,this.__boundOnScroll=this.__onScroll.bind(this),this.addToDOM()},toggleMenu:function(e,t,i){this.isContextMenuOpen()?this.closeMenu(e):this.showMenu(e,t,i)},showMenu:function(t,i,n){this.closeMenu(),this.$el.addClass("in-use");var o=(n=n||{}).displayOptions||{};n.location={mousePos:[t.clientX,t.clientY],mirror:[o.right,o.above]},this.__menu=this.createChildContext(i,_.extend({$parentElement:this.$el},n)),this.__menu.on("item-chosen",this.closeMenu.bind(this)),this.__menu.on("resize",this.__positionMenu.bind(this)),e.NextUtil.DomHelper.dismissible({dismissibleEl:this.__menu.$el,dismissHandler:this.closeMenu.bind(this),openerEl:t.target}),this.__positionMenu(),$("body").append(this.$el),_.bindAll(this,"closeMenu"),document.addEventListener("scroll",this.__boundOnScroll,!0)},__positionMenu:function(){var e=this.__menu.location.mirror,t=this.__menu.location.mousePos,i=[this.$el.width(),this.$el.height()],n=[this.__menu.$el.width(),this.__menu.$el.height()],o=_.times(2,function(o){return Math.max(0,Math.min(i[o]-n[o],e[o]?t[o]-n[o]-this.__mouseMargin:t[o]+this.__mouseMargin))}.bind(this));this.__menu.$el.css({left:o[0],top:o[1]})},__onScroll:function(e){this.__menu&&(this.__menu.$el.is(e.target)||0<this.__menu.$el.has(e.target).length)||this.__menu.shouldCloseOnScroll()||this.closeMenu()},closeMenu:function(e){document.removeEventListener("scroll",this.__boundOnScroll,!0),this.$el.removeClass("in-use"),this.__menu&&(this.__menu.delete(),this.__menu=null),this.__$parentElement.append(this.$el)},getMenu:function(){return this.__menu},isContextMenuOpen:function(){return!!this.__menu},delete:function(){$("body").off("click.contextMenuManager"),t.prototype.delete.call(this)}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"]}),D=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="simple-scroller-viewport"></div>\n<button class="btn btn-tertiary simple-scroller-right" disabled></button>\n<button class="btn btn-tertiary simple-scroller-left" disabled></button>'},useData:!0})}(),D=function(e){var t=0,i=e.UiCore.UiContext;return e.UiCore.UiContext.extend("SimpleScroller",{className:"simple-scroller disable-text-selection",uiContextName:"simple_scroller",keepGoingThreshold:50,dependencies:["$target","window","timer"],initialize:function(n){i.prototype.initialize.call(this,n),this.__instanceNumber=t++,this.__absoluteScrollBy=n.scrollBy||!1,this.__window=n.window,this.__autoRefresh=!!n.autoRefresh,this.__timer=n.timer,this.__$target=n.$target,this.__$target.parent(".simple-scroller-viewport").length||(this.template=n.template||e.template,this.addToDOM(),this._refreshScrollabilityCount=0,this.$(".simple-scroller-viewport").on("scroll.simple-scroller",this.refreshScrollability.bind(this)),this.$(".simple-scroller-left").on("click",this.scrollLeft.bind(this)),this.$(".simple-scroller-right").on("click",this.scrollRight.bind(this)),$(this.__window).on(this.__getEventNamespaceForThisInstance("resize"),this.refreshScrollability.bind(this)))},__getEventNamespaceForThisInstance:function(e){return e+".ss-"+this.__instanceNumber},delete:function(){$(this.__window).off(this.__getEventNamespaceForThisInstance("resize")),this.$(".simple-scroller-viewport").off(".simple-scroller"),this.__refreshTimer&&this.__timer.clearInterval(this.__refreshTimer),i.prototype.delete.call(this)},render:function(){this.$el.html(this.template),this.$(".simple-scroller-viewport").append(this.__$target),this.__$target.addClass("simple-scroller-target"),this.refreshScrollability(),this.__autoRefresh&&(this.__refreshTimer=this.__timer.setInterval(function(){this.$el.is(":visible")&&this.refreshScrollability()}.bind(this),300))},viewportWidth:function(){return this.$(".simple-scroller-viewport").outerWidth()},leftEdge:function(){return this.$(".simple-scroller-viewport").scrollLeft()},rightEdge:function(){return this.scrollWidth()-this.viewportWidth()-1},scrollWidth:function(){return this.$(".simple-scroller-viewport")[0].scrollWidth},scrollBy:function(){return this.__absoluteScrollBy||this.viewportWidth()/2},refreshLeftScrollability:function(){this.$(".simple-scroller-left").prop("disabled",0>=this.leftEdge())},refreshRightScrollability:function(){this.$(".simple-scroller-right").prop("disabled",this.leftEdge()>=this.rightEdge())},refreshScrollability:function(){this._refreshScrollabilityCount++,this.refreshLeftScrollability(),this.refreshRightScrollability()},scroll:function(e){this.$(".simple-scroller-viewport").animate({scrollLeft:"+="+e},150,this.refreshScrollability.bind(this))},scrollLeft:function(e){e=this.scrollBy(),this.leftEdge()-e<this.keepGoingThreshold&&(e*=2),this.scroll(-e)},scrollRight:function(e){e=this.scrollBy(),this.leftEdge()+e>this.rightEdge()-this.keepGoingThreshold&&(e*=2),this.scroll(e)},resetPosition:function(){this.$(".simple-scroller-viewport").scrollLeft(0),this.refreshScrollability()}})}({UiCore:e["@UiCore"],template:D}),D=function(e){return IMVU.BaseClass.extend("CardManager",_.extend({dependencies:["dialogManager","platform"],initialize:function(t){this.__dialogManager=t.dialogManager,this.__cardDeckDialog="mobile"===t.platform?e.MobileCardDeckDialog:e.CardDeckDialog},showDeck:function(){return this.__dialogManager.showDialog(this.__cardDeckDialog,{})},showCard:function(e,t){var i=this.showDeck();return(e=i.addCard(e,t))&&e.on("all",this.__echoCardEvent.bind(this)),i},__echoCardEvent:function(){this.trigger.apply(this,arguments)},showUserProfileCard:function(e){this.showCard("UserProfileCard",_.extend(e,{user:IMVU.requireProperty(e,"user"),context:IMVU.requireProperty(e,"context"),activeChat:IMVU.optionalProperty(e,"activeChat",null)}))},closeAll:function(){return this.__dialogManager.closeAll(),this}},Backbone.Events))}({CardDeckDialog:D=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("CardDeckDialog",{uiContextName:"card_deck_dialog",className:"card-deck-dialog",headerIsVisible:!1,initialize:function(e){t.prototype.initialize.call(this,e),this.__cards=[],this.addToDOM()},addCards:function(t,i){return t=e.Cards[t]||t,_.each(i,function(e){this.__cards.push(this.setContent("body",t,_(e||{}).extend({deck:this})))}.bind(this)),1<this.__cards.length&&this.$el.addClass("has-multi-cards"),this.simpleScroller.refreshScrollability(),this},addCard:function(t,i){t=e.Cards[t]||t;var n=this.setContent("body",t,_(i||{}).extend({deck:this}));return this.__cards.push(n),1<this.__cards.length&&this.$el.addClass("has-multi-cards"),this.simpleScroller.refreshScrollability(),n},postRender:function(){this.simpleScroller=this.createChildContext(e.SimpleScroller,{$parentElement:this.$(".dialog-container"),scrollBy:315,$target:this.$(".dialog-body")})}})}({UiCore:e["@UiCore"],Cards:e["@Cards"],Dialogs:e["@Dialogs"],SimpleScroller:D}),MobileCardDeckDialog:T=function(e){var t=e.CardDeckDialog;return t.extend("MobileCardDeckDialog",{uiContextName:"mobile_card_deck_dialog",className:"card-deck-dialog",dependencies:["window","timer"],maxCardsToShow:5,initialize:function(e){this.__UID=e.timer.getTime(),this.__offsets=[],this.__window=e.window,this.__windowInnerWidth=e.window.innerWidth,$(this.__window).on("resize.cardDeckDialog_"+this.__UID,this.recalculateOffsets.bind(this)),t.prototype.initialize.call(this,e)},delete:function(){$(this.__window).off("resize.cardDeckDialog_"+this.__UID),t.prototype.delete.call(this)},addCards:function(t,i){t=e.Cards[t]||t,_.each(i,this.addCard.bind(this,t))},addCard:function(e,i){var n=t.prototype.addCard.apply(this,arguments),o=n.$el.offset();return this.__offsets.push({left:o.left,right:o.left+n.$el.outerWidth()}),this.__cards.length>this.maxCardsToShow&&n.$el.css("visibility","hidden"),n},recalculateOffsets:function(){this.__offsets=[],this.__windowInnerWidth=this.__window.innerWidth;for(var e=0;e<this.__cards.length;e++){var t=this.__cards[e],i=t.$el.offset();this.__offsets.push({left:i.left,right:i.left+t.$el.outerWidth()})}},postRender:function(){var e=this.$(".dialog-body");e.on("scroll",function(){for(var t=e.scrollLeft(),i=0;i<this.__cards.length;i++){var n=this.__offsets[i];this.__cards[i].$el.css("visibility",n.left>t-3*this.__windowInnerWidth&&n.right<t+4*this.__windowInnerWidth?"visible":"hidden")}}.bind(this)),t.prototype.postRender.call(this)}})}({CardDeckDialog:D,Cards:e["@Cards"]})}),T=IMVU.BaseClass.extend("JQueryExpectElement",{initialize:function(e){var t=e.serviceProvider;$.fn.expect=function(e){if(this.length!==e){var i=t.get("window"),n=-1!==i.location.host.indexOf("localhost.");if(e="expecting exactly "+e+" elements but got "+this.length,n)throw Error(e);i.console.error(e)}return this}}}),I=IMVU.BaseClass.extend("CookieManager",{dependencies:["window","cookieDomain"],initialize:function(e){this.__window=e.window,this.__cookieDomain=e.cookieDomain},set:function(e,t){var i;i=e+"="+t+";expires=Fri, 31 Dec 9999 23:59:59 GMT;",i+="domain="+this.__cookieDomain+";",i+="path=/",this.__window.document.cookie=i},get:function(e){return IMVU.getCookies(this.__window.document)[e]}}),e["@UiCore"],IMVU.BaseClass.extend("LoginSentinel",_.extend({dependencies:["timer","loginManager","window"],initialize:function(e){this.__timer=e.timer,this.__loginManager=e.loginManager,this.__window=e.window,this.__checkLogoutInterval=3e5,(this.__myself=this.__loginManager.isLoggedIn()?this.__loginManager.getCurrentUser():null)?this.__checkLogoutTimer=this.__timer.setTimeout(this.__checkLogout.bind(this),this.__checkLogoutInterval):(this.__checkTimeout=5e3,this.__checkLoginTimer=this.__timer.setTimeout(this.__checkLogin.bind(this),this.__checkTimeout))},delete:function(){this.__checkLoginTimer&&(this.__timer.clearTimeout(this.__checkLoginTimer),this.__checkLoginTimer=null),this.__checkLogoutTimer&&(this.__timer.clearTimeout(this.__checkLogoutTimer),this.__checkLogoutTimer=null),this.__myself&&(this.__myself.off(null,null,this),this.__myself=null)},__checkLogin:function(){this.__loginManager.createFromCookie().then(function(){this.__loginManager.isLoggedIn()?(this.__window.console.hasOwnProperty("trace")&&this.__window.console.trace("Reload after login"),this.__window.location.reload()):window.console.log(Date()+":Check for login, still logged out")}.bind(this)),this.__checkTimeout*=2,6e5<this.__checkTimeout&&(this.__checkTimeout=6e5),this.__checkLoginTimer=this.__timer.setTimeout(this.__checkLogin.bind(this),this.__checkTimeout)},__checkLogout:function(){this.__loginManager.createFromCookie().then(function(){this.__loginManager.isLoggedIn()?this.__window.console.log(Date()+":Check for logout, still logged in"):(this.__window.console.hasOwnProperty("trace")&&this.__window.console.trace("Reload after logout - createFromCookie resolved"),this.__window.location.reload())}.bind(this)).catch(function(){this.__window.console.hasOwnProperty("trace")&&this.__window.console.trace("Reload after logout"),this.__window.location.reload()}.bind(this)),this.__checkLogoutTimer=this.__timer.setTimeout(this.__checkLogout.bind(this),this.__checkLogoutInterval)}},Backbone.Events))),L=function(e){return IMVU.BaseClass.extend("WebGL",{dependencies:["cookieManager","platform","deviceType"],initialize:function(t){this.__platform=t.platform,this.__deviceType=t.deviceType,this.__webGLInfo=t.webGLInfo||e.WebGLInfo(),this.__cookieManager=t.cookieManager,this.__enable3d=_.reduce(["mobile"===this.__platform,"tablet"===this.__deviceType||"phone"===this.__deviceType,!this.__webGLInfo.canCompileShader],function(e,t){return e&&!t},!0)},canUse3d:function(){return this.__enable3d},use3d:function(){return"0"!==this.__cookieManager.get("prefer_3d")&&this.__enable3d}})}({WebGLInfo:function(e){e=e||{},this.window=e.window||window,this.canvas=e.canvas||$("<canvas width=800, height=600></canvas>")[0],e=null;var t,i=!1;try{e=this.canvas.getContext("webgl")}catch(t){e=null}if(!e)try{e=this.canvas.getContext("experimental-webgl"),i=!0}catch(t){e=null}return e&&(t=e.createShader(e.VERTEX_SHADER),e.shaderSource(t,"struct Vertex {lowp float f;}; void main() { gl_Position = vec4(0, 0, 0, 0); }"),e.compileShader(t)),{canGetContext:!!e,canCompileShader:!(!e||!e.getShaderParameter(t,e.COMPILE_STATUS)),isExperimental:i}}}),U=IMVU.BaseClass.extend("BrowserInfoManager",{initialize:function(e){var t,i,n,o=e.userAgent||navigator.userAgent,a=e.appName||navigator.appName,s=""+parseFloat(e.appVersion||navigator.appVersion);t=parseInt(e.appVersion||navigator.appVersion,10),this.userAgent=o,-1!==(i=o.indexOf("OPR/"))?(a="Opera",s=o.substring(i+4)):-1!==(i=o.indexOf("Opera"))?(a="Opera",s=o.substring(i+6),-1!==(i=o.indexOf("Version"))&&(s=o.substring(i+8))):-1!==(i=o.indexOf("MSIE"))?(a="IE",s=o.substring(i+5)):-1!==o.indexOf("Trident/")?(a="IE",s=o.indexOf("rv:"),s=o.substring(s+3,o.indexOf(".",s))):-1!==(i=o.indexOf("Edge/"))?(a="IE",s=o.substring(i+5,o.indexOf(".",i))):-1!==(i=o.indexOf("Chrome"))?(a="Chrome",s=o.substring(i+7)):-1!==(i=o.indexOf("Safari"))?(a="Safari",s=o.substring(i+7),-1!==(i=o.indexOf("Version"))&&(s=o.substring(i+8))):-1!==(i=o.indexOf("Firefox"))?(a="Firefox",s=o.substring(i+8)):(t=o.lastIndexOf(" ")+1)<(i=o.lastIndexOf("/"))&&(a=o.substring(t,i),s=o.substring(i+1),a.toLowerCase()===a.toUpperCase()&&(a=e.appName||navigator.appName)),-1!==(n=s.indexOf(";"))?s=s.substring(0,n):-1!==(n=s.indexOf(" "))&&(s=s.substring(0,n)),t=parseInt(""+s,10),isNaN(t)&&(parseFloat(e.appVersion||navigator.appVersion),t=parseInt(e.appVersion||navigator.appVersion,10)),this.__browserName=a,this.__majorVersion=t,this.__os=this.__parseOS(e.platform||navigator.platform)},__parseOS:function(e){var t={Win:"windows",Mac:"mac"};if(e)for(var i in t)if(-1!==e.indexOf(i))return t[i];return"unknown"},getBrowserName:function(){return this.__browserName},getMajorVersion:function(){return this.__majorVersion},getPlatform:function(){return navigator.platform},getOS:function(){return this.__os},getMobileOS:function(){return this.userAgent.match(/iPad/i)||this.userAgent.match(/iPhone/i)||this.userAgent.match(/iPod/i)?"iOS":this.userAgent.match(/Android/i)?"Android":"unknown"},_setUserAgent:function(e){this.userAgent=e},isIE:function(){return"IE"===this.getBrowserName()},isSafari:function(){return"Safari"===this.getBrowserName()},_setOS:function(e){this.__os=e}}),N=(e["@UiCore"],e["@Leanplum"],IMVU.BaseClass.extend("Leanplum",_.extend({dependencies:["Promise"],initialize:function(e){},startSession:function(e){},started:function(){},endSession:function(){},setState:function(e,t){},recordEvent:function(e,t){},registerUser:function(e){},setUser:function(e){},__onVarChange:function(){},getVars:function(e){},get:function(e){}},Backbone.Events)));a=function(e){var t=e.BaseApp;return t.extend("WelcomeApp",{__synchronousStartupDependencies:function(e){var i=e.serviceProvider;i.register("externalWindow",e.externalWindow||i.get("window")),t.prototype.__synchronousStartupDependencies.call(this,e)},__registerLoggedOutServices:function(i,n,o){t.prototype.__registerLoggedOutServices.apply(this,[i,n,o]),n.register("iconManager",n.create(e.IconManager,{}))}})}({BaseApp:a=function(e){return IMVU.BaseClass.extend("BaseApp",{__installJQueryPlugins:function(t){(t=IMVU.requireProperty(t,"serviceProvider")).create(e.JQueryExpectElement,{serviceProvider:t})},launch:function(e){return e=e||{},this.__installJQueryPlugins(e),this.__synchronousStartupDependencies(e),this.__launchWithLoginInfo(e)},__synchronousStartupDependencies:function(t){var i=IMVU.requireProperty(t,"serviceProvider");i.get("window").alloyDebug={serviceProvider:i},this.__isUnsupported(i.get("window"),i.get("window").navigator)&&(i.get("window").location.href="/next/unsupported/"),void 0!==t.startSubmode&&(t.startSubmode=decodeURIComponent(t.startSubmode));var n=IMVU.optionalProperty(t,"applicationName","next");i.register("appName",n),t.suppressPlatform||(n+="_"+t.platform),i.get("rest").precache(t.denormalizedRest||{}),i.get("rest").setApplicationHeader(n+"/1"),i.register("Sha512",e.Sha512),i.register("globalStartupModel",i.get("restModelFactory").readModel(t.globalStartupUrl,e.UiCore.NodeModel)),i.register("showNavCore",!!t.showNavCore),i.register("siteRoot",t.siteRoot),i.register("params",t.params),i.register("locales",t.locales),i.register("currentLocale",t.current_locale),i.register("platform",t.platform),i.register("storePlatform",t.storePlatform),i.register("deviceType",t.deviceType),i.register("touchEventHelper",i.create(e.touchEventHelper)),i.register("startMode",t.startMode),i.register("startSubmode",t.startSubmode),i.register("overrideMode",t.overrideMode),i.register("overrideSubmode",t.overrideSubmode),i.register("campaign",t.campaign),i.register("moment",e.Moment(i)),i.register("seenBefore",t.seen_before),e.FastClick.attach(document.body),n=i.create(e.StringManager,{dictionary:e.dictionary}),i.register("globalStringManager",n),i.register("timestampHelper",i.create(e.TimestampHelper)),i.register("globalVariablesManager",i.create(e.GlobalVariablesManager)),i.register("cookieDomain",IMVU.optionalProperty(t,"cookieDomain",".imvu.com")),_.has(t,"appTitle")?i.register("appTitle",n.getWithDefault(t.appTitle,t.appTitle)):i.register("appTitle","IMVU"),i.register("leanplumAppId",t.leanplumAppId),i.register("leanplumApiKey",t.leanplumApiKey),i.register("leanplum",i.create(t.Leanplum||e.Leanplum,{possibleAlt:t.possibleAlt})),Handlebars.registerHelper("i18n-g",n.handlebarsHelper.bind(n));var o=i.create(t.ModeManagerFactory||e.ModeManager,{$parentElement:t.$parentElement||$("body"),availableModes:IMVU.requireProperty(t,"availableModes")});if(i.register("modeManager",o),i.register("contextMenuManager",o.createChildContext(t.contextMenuManagerFactory||e.ContextMenuManager,{$parentElement:o.$el})),i.get("contextMenuManager").show(),i.register("dialogManager",o.createChildContext(t.dialogManagerFactory||e.DialogManager,{$parentElement:o.$el})),i.register("historyManager",i.create(t.historyManagerFactory||e.HistoryManager)),i.register("tooltipLayer",o.createChildContext(e.TooltipLayer,{$parentElement:o.$el})),t.WindowManager&&o.ready(function(){i.register("windowManager",o.createChildContext(t.WindowManager,{$parentElement:o.$el}))}),i.register("geolocation",t.geolocation),i.register("uiEventReporter",i.create(IMVU.optionalProperty(t,"UiEventReporterFactory",e.NextUiEventReporter))),i.register("cookieManager",i.create(t.cookieManager||e.CookieManager)),i.register("localStorage",i.create(e.LocalStorageManager)),n=i.create(t.loginManagerFactory||e.LoginManager),i.register("loginManager",n),"ftux"==t.startMode&&t.params.from){var a=decodeURIComponent(t.params.from);a.substr(0,t.siteRoot.length)===t.siteRoot&&n.setSignUpDestination(a)}i.register("googleAnalytics",i.create(t.googleAnalytics||e.GoogleAnalytics)),i.register("browserInfo",i.create(t.browserInfo||e.BrowserInfo)),i.register("imageManager",i.create(t.imageManagerFactory||e.ImageManager)),i.register("webGL",i.create(t.WebGLFactory||e.WebGL,{})),i.register("loginCookieName","LoggedInWithAlloy"),i.register("cardManager",i.create(t.cardManagerFactory||e.CardManager)),$(i.get("window")).resize(function(){$(i.get("window")).scroll()})},__launchWithLoginInfo:function(e){var t=IMVU.requireProperty(e,"serviceProvider");return t.get("Promise"),t.get("loginManager").createFromCookie().then(function(){return t.get("globalStartupModel").populated()}.bind(this)).then(function(){return t.get("loginManager").getCurrentUser().populated()}).then(this.__registerLoggedInServices.bind(this,e,t,IMVU.requireProperty(e,"LoggedInNavFactory")),this.__registerLoggedOutServices.bind(this,e,t,IMVU.requireProperty(e,"LoggedOutNavFactory")))},__registerLoggedInServices:function(t,i,n,o){var a=i.create(e.IMQ.ImqManager,{url:i.get("loginManager").getCurrent().relations.imq,metadata:{app:"imvu_next",platform_type:"mobile"===i.get("platform")?"small":"big"},userId:o.get("legacy_cid").toString(),sessionId:i.get("loginManager").getCurrent().get("session_id")});return i.register("loggedInUser",o),i.register("imqManager",a),i.get("modeManager").createSmartBanner(),a.connect().then(function(){i.get("modeManager").createChildContext(e.ImqStatus,{$parentElement:i.get("modeManager").$el})}),i.create(e.UiCore.ModelInvalidator),i.register("prefsManager",i.create(t.PrefsManager||e.PrefsManager)),i.get("prefsManager").populated().then(function(){(a=i.get("prefsManager").get("next.leanplum_device_id"))||(a=i.get("localStorage").getItem("__leanplum_device_id")),a&&(i.get("prefsManager").set("next.leanplum_device_id",a),i.get("localStorage").setItem("__leanplum_device_id",a)),i.get("leanplum").startSession(o.get("legacy_cid").toString()),i.register("featureAccessManager",i.create(t.featureAccessManager||e.FeatureAccessManager)),i.register("chatManager",i.get("modeManager").createChildContext(e.ChatManager)),i.register("globalNav",i.get("modeManager").createChildContext(n,{$replaceElement:i.get("modeManager").$(".nav-placeholder")})),i.get("window").autoUpdate&&IMVU.optionalProperty(t,"module",module).run({UpdateManager:"@UpdateManager"},function(e){i.register("updateManager",i.create(e.UpdateManager,{}))}),i.register("loginSentinel",i.create(t.loginSentinelFactory||e.LoginSentinel));var a=t.startMode,s=i.get("overrideSubmode")||t.startSubmode||"__default__";i.get("overrideMode")&&(a=i.get("overrideMode")||t.startMode,s=i.get("overrideSubmode")||"__default__"),i.get("modeManager").openMode({openDefaultView:!t.startSubmode,mode:{id:a},submode:{id:s}}).then(function(){t.appReadyCallback&&t.appReadyCallback(i)}),i.get("modeManager").$(".imvu-loading").remove()})},__registerLoggedOutServices:function(t,i,n){i.get("localStorage").getItem("__alt_signup")||(i.get("localStorage").removeItem("__leanplum_device_id"),i.get("localStorage").removeItem("__leanplum_user_id")),i.get("localStorage").removeItem("__alt_signup"),i.get("leanplum").startSession(),i.register("prefsManager",i.create(e.NullPrefsManager)),i.register("featureAccessManager",i.create(t.featureAccessManager||e.FeatureAccessManager)),i.register("globalNav",i.get("modeManager").createChildContext(n,{$replaceElement:i.get("modeManager").$(".nav-placeholder"),startSubmode:t.startSubmode})),i.get("window").autoUpdate&&IMVU.optionalProperty(t,"module",module).run({UpdateManager:"@UpdateManager"},function(e){i.register("updateManager",i.create(e.UpdateManager,{}))}),n={mode:{id:t.startMode},submode:{id:t.startSubmode}},t.overrideMode?(n.mode.id=t.overrideMode,n.submode.id=t.overrideSubmode||"__default__"):t.overrideSubmode&&(n.submode.id=t.overrideSubmode),i.get("modeManager").openMode(n),i.get("modeManager").$(".imvu-loading").remove(),i.register("loginSentinel",i.create(t.loginSentinelFactory||e.LoginSentinel)),t.loggedOutCallback&&t.loggedOutCallback(i)},__isUnsupported:function(e,t){var i=!(!document.all||e.opera||!e.XMLHttpRequest||-1!==t.userAgent.toString().toLowerCase().indexOf("trident/4.0")),n=-1!==t.userAgent.toString().toLowerCase().indexOf("trident/4.0"),o=-1<t.userAgent.toString().toLowerCase().indexOf("trident/5"),a=-1<t.userAgent.toString().toLowerCase().indexOf("trident/6");return i||n||o||a}})}({dictionary:e["json!@globalDictionary"],FastClick:e["@FastClick"],IMQ:e["@IMQ"],UiCore:e["@UiCore"],Sha512:e["@SHA512"],BrowserInfo:U,CardManager:D,ChatManager:u,ContextMenuManager:P,CookieManager:I,DialogManager:y,FeatureAccessManager:w,GlobalVariablesManager:c,GoogleAnalytics:g,HistoryManager:S,ImageManager:m,ImqStatus:v,Leanplum:N,LocalStorageManager:f,LoginManager:h,LoginSentinel:E,MobileBrowser:a,ModeManager:s,Moment:x,NextUiEventReporter:l,NullPrefsManager:b,PrefsManager:C,StringManager:d,TimestampHelper:M,TooltipLayer:k,touchEventHelper:p,WebGL:L,JQueryExpectElement:T}),IconManager:d=IMVU.BaseClass.extend("IconManager",{dependencies:["Promise","window"],initialize:function(e){this.__serviceProvider=e.serviceProvider,this.__window=e.window,this.__loadResolver=null,this.__containerParent=IMVU.optionalProperty(e,"parent",this.__window.document.body),this.__loadPromise=new e.Promise(function(e){this.__loadResolver=e}.bind(this)),Handlebars.registerHelper("icon",this.handlebarsHelper.bind(this)),(e.module||module).run({Icons:"text!@IconLibrary"},function(e){this.$__svgContainer=$("<div></div>"),this.$__svgContainer.addClass("svg-icon-container"),this.$__svgContainer.html(e.Icons),$(this.__containerParent).prepend(this.$__svgContainer),this.__loadResolver.resolve()}.bind(this))},populated:function(){return this.__loadPromise},getListOfSymbols:function(){var e=[];return this.$__svgContainer.find("svg > defs > symbol").each(function(t,i){e.push(i.id)}),e.sort()},iconHtml:function(e,t){var i="";return t?(t.hash.class=t.hash.class?t.hash.class+" "+e:e,i=" "+Object.keys(t.hash).map(function(e){return e+'="'+t.hash[e]+'"'}).join(" ")):i=' class="'+e+'"',"<svg"+i+'><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#'+e+'"></svg>'},handlebarsHelper:function(e,t){return this.iconHtml(e,t)}})});return e=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("FakeContext",{uiContextName:"fake_context",className:"fake-context",initialize:function(e){i.prototype.initialize.call(this,e),this.args=e,this.addToDOM()}})}(),function(e){return function(t){return t.LoggedOutNavFactory=t.LoggedOutNavFactory||e.LoggedOutGlobalNav,e.Main.apply(this,arguments)}}({Main:function(e){return function(t){-1!==location.host.indexOf("localhost.")&&"true"===localStorage.getItem("forceProduction")&&(t.globalStartupUrl=t.globalStartupUrl.replace(".localhost",""));var i=t.serviceProvider||new e.ServiceProvider;i.register("useEventWhitelist",!0);var n=new e.WelcomeApp;i.register("showFuncaptcha",t.showFuncaptcha),i.register("language",t.language),i.register("registrationFlow",t.registrationFlow),i.register("ftuxNextPageCallback",t.ftuxNextPageCallback),i.register("queryParams",t.params);var o=i.get("Promise");i.register("PromiseResolver",{get:function(){var e;return new o(function(t){e=t}),e},getRejected:function(e){var t;return new o(function(i){t=i,i.reject(e)}),t},getAccepted:function(e){var t;return new o(function(i){t=i,i.accept(e)}),t}}),i.register("connectionSpeedTimeout",t.connectionSpeedTimeout),i.register("speedTestImages",t.speedTestImages),i.register("loginDestination",t.loginDestination),n.launch(_.extend({serviceProvider:i,LoggedInNavFactory:e.LoggedInNav,loginSentinelFactory:$.noop,applicationName:"welcome",suppressPlatform:!0,UiEventReporterFactory:e.NextUiEventReporter.extend("WelcomeUiEventReporter",{maxBatchSize:30,maxWaitTime:3e4}),ModeManagerFactory:e.ModeManager.extend("WelcomeModeManager",{uiApplication:"welcome",uiPlatform:"nafd",__makeTitle:function(){return this.__globalStringManager.get("welcome_title")}})},t)),i.get("webGL").use3d()&&i.register("polarisLoader",i.create(e.PolarisLoader))}}({WelcomeApp:a,LoggedInNav:e=function(e){return e.FakeGlobalNav.extend("FakeLoggedOutTopNav",{showLoginDialog:function(){return this._loginDialog=!0,new this.__Promise(function(e){this._loginResolver=e}.bind(this))}})}({FakeGlobalNav:function(e){var t={GlobalNav:o}.GlobalNav;return t.extend("FakeGlobalNav",{dependencies:["Promise"],initialize:function(e){this._activeMode=null,this._drillDown=!1,this._isLogoVisible=this._visible=!0,this._location=this._currentDrawerKey=null,this.__Promise=e.Promise,this._productsAddedToCart=[],t.prototype.initialize.call(this,e),this.listenTo(this,"labelUpdate",this.__updateLabel),this.label=""},_getCurrentLocation:function(){return this._location},toggleLogo:function(e){this._isLogoVisible=e},render:function(){},markActiveMode:function(e){this._activeMode=e},drillDown:function(e){this._drillDown=e},switchToOriginal:function(){this._switchToOriginal=!0,this._location="/switch_to/classic/"},setVisibility:function(e){this._visible=e},_inspectState:function(){return{activeMode:this._activeMode,drillDown:this._drillDown,visible:this._visible}},revealSubmodeSpecificItems:function(){this._revealSubmodeSpecific=!0},setText:function(e){this._text=e},addProductsToCart:function(e){return this._productsAddedToCart=this._productsAddedToCart.concat(e),new this.__Promise(function(e){this._addProductsToCartResolver=e}.bind(this))},toggleSignupButton:function(e){this._isSignupButtonVisible=e},__updateLabel:function(e){this.label=e}})}(),FakeContext:e}),ModeManager:s,ServiceProvider:r,PolarisLoader:o=IMVU.BaseClass.extend("PolarisLoader",{dependencies:["timer","window","Promise"],initialize:function(e){this.__timer=e.timer,this.__window=e.window,this.__Promise=e.Promise,this.__polarisPackage=new this.__Promise(function(e){module.run({Polaris:"@Polaris"},function(t){t={Polaris:t.Polaris,network:(new t.Polaris.XHRNetwork).deleteLater(),textureParser:new t.Polaris.DOMTextureParser,preciseTimer:(new t.Polaris.PreciseTimer).deleteLater(),clock:new t.Polaris.RequestAnimationFrameClock({window:this.__window,timer:this.__timer})},e.resolve(t)}.bind(this))}.bind(this))},getPolaris:function(){return this.__polarisPackage}}),NextUiEventReporter:l}),LoggedOutGlobalNav:n})});
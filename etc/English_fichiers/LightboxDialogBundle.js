module({"@NextUtil":"@NextUtil","json!/common/withme/js/mode/friends/profile.json":"json!/asset/8196a1066d1f2551/common/withme/js/mode/friends/profile.json","json!/common/js/JSON/Countries.json":"json!/asset/82bbf3f0be07c92d/common/js/JSON/Countries.json","@Model":"@Model","@UiCore":"@UiCore","json!/common/js/JSON/Provinces.json":"json!/asset/1e80a06c565197b7/common/js/JSON/Provinces.json","@Caman":"@Caman","@Widgets":"@Widgets","@Dialogs":"@Dialogs","@Linkify":"@Linkify","@moment":"@moment","@Checkout":"@Checkout","json!/common/js/JSON/States.json":"json!/asset/581385bf78983508/common/js/JSON/States.json","json!/common/pure/util/profile.json":"json!/asset/996b43a0c80f13b9/common/pure/util/profile.json","css!/build/withme/LightboxDialogBundle.css":"css!/asset/48fe5b619b50982f/build/withme/LightboxDialogBundle.css"},function(e){var t,i,n=(t={UiCore:e["@UiCore"]},(i=IMVU.NamedModel).extend("TriggerListItem",{dependencies:["Promise","rest"],initialize:function(e,t){var n=e.Promise;delete e.Promise,this.__rest=e.rest,delete e.Rest,this.url=e.productId,this.collection=t.collection,i.prototype.initialize.call(this,e),this.__populated=new n(function(e){this.fetch({update:!0}).then(e.resolve.bind(e),e.resolve.bind(e))}.bind(this))},populated:function(){return this.__populated},sync:function(e,i,n){return n.withCredentials=!1,t.UiCore.RestUtil.makeRequest(this.__rest,"get",this.url,void 0,n,function(e,t,a){void 0===e?n.success(i,t,n):_.delay(function(){this.collection.remove(i),n.error&&n.error(i,a,n)}.bind(this),0)}.bind(this))},url:function(){return this.url},parse:function(e){return{product_name:e.data.product_name,is_ap:"AP"===e.data.rating}}})),a=function(e){var t=IMVU.NamedCollection;return t.extend("TriggerList",{dependencies:["Promise","rest","restModelFactory"],model:e.TriggerListItem,initialize:function(e){t.prototype.initialize.call(this),this.__serviceProvider=e.serviceProvider,this.__rest=e.rest,this.__Promise=e.Promise,this.__products={},this.__tagPromises={},this.__populated=new this.__Promise(function(e){e.resolve()}.bind(this))},populated:function(){return this.__populated},loadTriggers:function(e){var t=null;return this.__populated=new this.__Promise(function(e){t=e}.bind(this)),this.fetch({url:e,reset:!0,success:function(){this.__Promise.every(_.map(this.models,function(e){return e.populated})).then(t.resolve.bind(t),t.reject.bind(t))}.bind(this),error:t.reject.bind(t)}),this.__populated},sync:function(t,i,n){return n.withCredentials=!1,e.UiCore.RestUtil.makeRequest(this.__rest,"get",n.url,void 0,n,function(e,t,a){void 0===e?n.success(i,t,n):n.error&&n.error(i,a,n)})},triggersForProduct:function(e){return new Backbone.Collection(this.filter(function(t){return e.id===t.get("productId")&&t.get("trigger_name").length}.bind(this)))},parse:function(e,t){var i=this.__Promise,n=this.__rest,a=[],s=this.__serviceProvider.get("root")+"/product/product-";return _.each(e.objects,function(e){_.each(e.actions,function(e,t){if("trigger"===e.type){var o=t.match(/imvu-pid-([0-9]*)(-([0-9]*))*/);if(o&&!(2>o.length)){var r=o[1];r&&_.each(e.description.split(/\s*,\s*/),function(e){if(r!==e){var t=s+r;a.push({id:t+":"+e,productId:t,trigger_name:e,Promise:i,rest:n})}})}}})}),a}})}({UiCore:e["@UiCore"],Model:e["@Model"],TriggerListItem:n}),s=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<button class="btn remove-button"></button>'},3:function(){return'<button class="btn id-info info-button"></button>'},5:function(){return'<button class="btn ap ap-badge"></button>'},7:function(e,t,i,n){var a;return i='\n    <div class="product-info">\n        ',((a=t.if.call(e,e&&e.showName,{name:"if",hash:{},fn:this.program(8,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n        ",((a=t.if.call(e,e&&e.showInstanceCount,{name:"if",hash:{},fn:this.program(10,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n        ",((a=t.if.call(e,e&&e.showPriceInfo,{name:"if",hash:{},fn:this.program(12,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n        ",((a=t.if.call(e,e&&e.showCart,{name:"if",hash:{},fn:this.program(14,n),inverse:this.program(16,n),data:n}))||0===a)&&(i+=a),i+"\n    </div>\n"},8:function(e,t,i,n){var a;return'<div class="product-name">'+(0,this.escapeExpression)("function"==typeof(a=t.name||e&&e.name)?a.call(e,{name:"name",hash:{},data:n}):a)+"</div>"},10:function(){return'<div class="instance-count"></div>'},12:function(e,t,i,n){var a,s,o=this.escapeExpression;return i=t.helperMissing,o='\n            <div class="price-info">\n                <div class="price-credits">'+o("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+'</div>\n                <div class="owned-label">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"IN INVENTORY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+='</div>\n                <div class="displayonly-label">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"DISPLAY ONLY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+"</div>\n            </div>\n        "},14:function(e,t,i,n){var a;i=t.helperMissing;var s='\n            <div class="cart-button add-to-cart-btn" title="';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Add to Cart",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='">',((a=(t.icon||e&&e.icon||i).call(e,"icon-add-to-cart",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n            <div class="cart-button in-cart-btn" title="',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"In Cart",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='">',((a=(t.icon||e&&e.icon||i).call(e,"icon-in-cart",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n        "},16:function(){return'\n            <span class="id-info more-info"></span>\n        '},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i='<div class="tile-body">\n    <img class="cover-image">\n    ',((a=t.if.call(e,e&&e.removeButton,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n    ",((a=t.if.call(e,e&&e.infoButton,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n    ",((a=t.if.call(e,e&&e.isAp,{name:"if",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n</div>\n",((a=t.if.call(e,e&&e.showProductInfo,{name:"if",hash:{},fn:this.program(7,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+'\n<div class="is-wearing-icon icon icon-ok"></div>\n<div class="shimmer-container"><div class="shimmer"></div></div>'},useData:!0})}(),o=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("ProductTile",{className:"tile product-tile is-square disable-text-selection",uiContextName:"product_tile",tagName:"article",dependencies:"Promise cardManager dialogManager featureAccessManager globalStringManager iconManager imageManager loginManager touchEventHelper window".split(" "),trackedEvents:function(){return[{type:"click",name:"change_wearing",handler:this.__onTileClick.bind(this)},{type:"click",selector:".id-info",name:"more_details",handler:this.__moreDetails.bind(this)},{type:"click",selector:".remove-button",name:"remove_button_clicked",handler:this.__handleRemoveButton.bind(this)},{type:"click",selector:".product-info",name:"more_details",handler:this.__moreDetails.bind(this)},{type:"click",selector:".add-to-cart-btn",name:"add_to_cart",handler:this.__addToCart.bind(this)},{type:"click",selector:".in-cart-btn",name:"in_cart_button",handler:function(e){e.preventDefault()}}]},initialize:function(i){this.template=i.template||e.template,this.uiAttributes={repeats:1},this.__touchEventHelper=i.touchEventHelper,t.prototype.initialize.call(this,i),this.__serviceProvider=i.serviceProvider,this.dressUpAvatarManager=IMVU.optionalProperty(i,"dressUpAvatarManager",null),this.__category=IMVU.optionalProperty(i,"category",!1),this.imageManager=i.imageManager,this.__cardManager=i.cardManager,this.__globalStringManager=i.globalStringManager,this.undoRedo=i.undoRedo,this.imageHeight=i.imageHeight?i.imageHeight:null,this.imageWidth=i.imageWidth?i.imageWidth:null,this.__model=i.model;try{this.__mode=this.__serviceProvider.get("mode")}catch(e){}this.addToDOM(),this.__model.populated().then(function(){if(void 0!==this.__model.node?(this.productNode=this.__model.node,this.__loadLook()):this.productNode=this.__model,this.__isHiddenBundle())this.$el.hide();else{var e=this.__getDetails(),t=!1;if(void 0!==e.category_path)for(var i=0;i<e.category_path.length;i++)t=3102===e.category_path[i].id;t=t?e.product_image:e.previewImage,this.$el.html(this.template(e)),this.setImage(t),this.$el.attr("product-id",this.productId),this.$el.attr("cid",this.productNode.cid),this.$el.toggleClass("cannot-remove",!this.__isRemovable()),this.$el.removeClass("sorting"),this.dressUpAvatarManager&&(this.__updateWearingStatus(),this.dressUpAvatarManager.getLookModel().on("change",this.__updateWearingStatus,this))}}.bind(this)).catch(function(){this.$el.hide()}.bind(this)),void 0!==this.__model.sorted&&(this.__model.sorted()||this.$el.addClass("sorting")),this.$el.addClass("loading")},delete:function(){this.dressUpAvatarManager&&this.dressUpAvatarManager.getLookModel().off(null,null,this),t.prototype.delete.call(this)},__isHiddenBundle:function(){return this.productNode.get("is_bundle")&&this.__hideBundles&&!this.productNode.get("look_url")},__loadLook:function(){this.dressUpAvatarManager&&this.productNode.populated().then(function(){this.priorLook=this.dressUpAvatarManager.getOriginalLook(),this.outfitLookUrl=this.__getDetails().lookUrl}.bind(this)).catch(this.__kill.bind(this))},__kill:function(){this.collection.remove(this.productNode)},render:function(){this.$el.html(this.template)},__isRemovable:function(){return"outfits"!==this.__category},__handleRemoveButton:function(){this.isWearing()&&this.__toggleProduct(!1),this.__kill()},setImage:function(e){this.imageHeight&&this.imageWidth&&(e=IMVU.URI.build(e,{width:this.imageWidth,height:this.imageHeight})),this.imageManager.load(this.$("img"),e,{container:this.$el})},isWearing:function(){return!!this.dressUpAvatarManager.isWearing(this.productNode.id)||!!this.outfitLookUrl&&this.dressUpAvatarManager.getCurrentLookUrl()===this.outfitLookUrl},__updateWearingStatus:function(){this.$el.toggleClass("is-wearing",this.isWearing())},__onTileClick:function(){this.dressUpAvatarManager?this.$el.hasClass("loaded")&&(this.isWearing()?this.__isRemovable()&&this.__toggleProduct(!1):this.__toggleProduct(!0)):this.__moreDetails()},__moreDetails:function(e){this.productNode.isPopulated()&&!this.__getDetails().is_bundle&&(this.__serviceProvider.has("mode")&&"__id__"===this.__mode.getCurrentSubmode().subId()?(e=this.__mode.getSubmodeUrl(this.__urlId(this.model.id)),this.__window.open(e,e)):this.__dialogManager.showProductLightbox(this.productNode))},toggleProduct:function(e){this.__toggleProduct(e)},__toggleProduct:function(e){this.$el.addClass("applying"),this.trigger(e?"applyProduct":"removeProduct",this.productNode.id);var t=function(){s&&s!=this.dressUpAvatarManager.getLookModel().get("look_url")&&this.undoRedo.add(s),this.$el.removeClass("applying")}.bind(this),i=function(){this.outfitLookUrl=this.dressUpAvatarManager.getCurrentLookUrl(),n()}.bind(this),n=function(){this.dressUpAvatarManager.getLookModel().change().then(function(){s&&s!=this.dressUpAvatarManager.getLookModel().get("look_url")&&this.undoRedo.add(s),this.__updateWearingStatus(),this.$el.removeClass("applying")}.bind(this))}.bind(this),a=function(){this.$el.removeClass("applying"),this.trigger("abortProduct",this.productNode.id)}.bind(this),s=this.dressUpAvatarManager.getLookModel().get("look_url");!0===this.__getDetails().is_bundle?e?(this.priorLook=this.dressUpAvatarManager.getCurrentLookUrl(),this.dressUpAvatarManager.putOnOutfit(this.productNode.id,this.outfitLookUrl).then(i).catch(a)):this.dressUpAvatarManager.putOnOutfit(null,this.dressUpAvatarManager.getOriginalLook()).then(n).catch(a):this.dressUpAvatarManager[e?"add":"remove"].bind(this.dressUpAvatarManager)(this.productNode.id).then(t).catch(a)},__getDetails:function(){return{name:this.productNode.get("product_name"),creatorName:this.productNode.get("creator_name"),previewImage:this.productNode.get("preview_image"),isAp:"AP"===this.productNode.get("rating"),lookUrl:this.productNode.get("look_url"),showInfo:!0,showProductInfo:!1,removeButton:!1,category_path:this.productNode.get("category_path"),product_image:this.productNode.get("product_image")}},__addToCart:function(){this.$el.hasClass("in-cart")||(this.$el.addClass("in-cart"),this.__serviceProvider.get("globalNav").addProductsToCart([this.productNode]).catch(function(){this.$el.removeClass("in-cart")}.bind(this)))}})}({UiCore:e["@UiCore"],template:s}),r={getTimeFormat:function(e,t){var i=Math.floor(e/3600),n=Math.floor(e/60)-60*i,a=e%60;t&&(a=a.toFixed(t));var s=10>a?"0":"";return i?i+":"+(10>n?"0":"")+n+":"+s+a:n+":"+s+a},formatCredits:function(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},zeroPad:function(e,t){return(Array(t).join("0")+e).substr(-t,t)},formatMini:function(e){for(var t=[{base:1e3,letter:"K"},{base:1e6,letter:"M"},{base:1e9,letter:"B"}],i=t.length-1;0<=i;i--){var n=t[i],a=n.base;if(e>=a)return(t=Math.floor(e/a))+((e=Math.floor((e-a*t)/(a/10)))?"."+e:"")+n.letter}return""+e}},l=function(e){var t=e.ProductTile;return t.extend("ShoppingTile",{className:"tile product-tile shopping-tile",dependencies:["featureAccessManager","loginManager"],initialize:function(i){i.productNode=i.model,i.inView=!0,i.loginManager.isLoggedIn()&&(this.__myself=i.loginManager.getCurrentUser(),this.__isVip=!!this.__myself.get("is_vip")),this.__formatNumber=e.FormatNumber,this.__hideBundles=!0,t.prototype.initialize.call(this,i),this.__model.populated().then(function(){!this.productNode.get("is_bundle")||this.__isHiddenBundle()||this.productNode.get("is_owned")?this.__updateOwnedOrPurchasableDisplay():(this.__subproducts=this.__model.getEdgeCollection("subproducts",e.Model.ProductEdgeCollection),this.__subproducts.populated().then(function(){this.__updateOwnedOrPurchasableDisplay(),this.listenTo(this.__subproducts,"change:is_owned",this.__updateOwnedOrPurchasableDisplay.bind(this))}.bind(this)).catch(this.__updateOwnedOrPurchasableDisplay.bind(this))),this.listenTo(this.productNode,"change:is_owned",this.__updateOwnedOrPurchasableDisplay,this),this.listenTo(this.productNode,"change:is_purchasable",this.__updateOwnedOrPurchasableDisplay,this)}.bind(this)),i.loginManager.isLoggedIn()&&(this.__cartModel=this.track(this.__myself.getSingleEdge("cart")),this.__cartModel.populated().then(function(){return this.__cartProducts=this.__cartModel.getEdgeCollection("products",e.Model.CartProductCollection),this.__cartProducts.enumerated()}.bind(this)).then(function(e){this.__cartAvailable=!0,this.__updateCartButton(),this.listenTo(this.__cartProducts,"add remove",this.__updateCartButton.bind(this))}.bind(this)))},delete:function(){this.productNode&&this.productNode.off(null,null,this),t.prototype.delete.call(this)},__updateOwnedOrPurchasableDisplay:function(){this.$el.toggleClass("owned",this.productNode.get("is_owned")||!(!this.__subproducts||!this.__subproducts.get("is_owned"))),this.$el.toggleClass("displayonly",!this.productNode.get("is_purchasable")),this.__cartAvailable&&this.__updateCartButton()},__updateCartButton:function(){this.model.populated().then(function(){return this.__cartProducts.checkCartContains(this.productNode.id)}.bind(this)).then(function(e){this.$el.toggleClass("in-cart",e)}.bind(this))},__getDetails:function(){var e=this.__isVip?this.productNode.get("discount_price"):this.productNode.get("product_price");return _.extend(t.prototype.__getDetails.call(this),{showProductInfo:!0,showName:!0,showPriceInfo:!0,showCart:!0,originalPrice:this.productNode.get("product_price"),discountPrice:this.productNode.get("discount_price"),price:this.__formatNumber.formatCredits(Number(e)),isOutfit:this.productNode.get("is_bundle"),isVisible:this.productNode.get("is_visible"),gender:this.productNode.get("gender")})}})}({Model:e["@Model"],UiCore:e["@UiCore"],ProductTile:o,FormatNumber:r}),d=function(e){var t=e.UiCore.UiContext;return t.extend("SubproductList",{className:"subproduct-list",uiContextName:"subproduct_list",CATEGORY_ORDER:"tops bottoms shoes accessories hairstyles eyes skins heads avatars".split(" "),initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){var t=this.__serviceProvider.create(e.Model.FilterModel,[],{}),i=_.sortBy(this.collection.models,function(e){if(e.node&&e.node.isPopulated())return t.setCategoryByProduct(e.node),this.CATEGORY_ORDER.indexOf(t.get("category"))}.bind(this));_.each(i,function(t){this.createChildContext(e.ShoppingTile,{model:t,$parentElement:this.$el})}.bind(this))}})}({UiCore:e["@UiCore"],Model:e["@Model"],ShoppingTile:l}),c=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'\n            <button class="btn ap ap-badge"></button>\n        '},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=this.escapeExpression;var o="<div class=\"main-info\">\n    <div class='picture tile-body'>\n        ";return((a=t.if.call(e,e&&e.isAP,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+"\n        <img/>\n    </div>\n    <div class='text'>\n        <div class='primary-text'>"+i("function"==typeof(s=t.headerText||e&&e.headerText)?s.call(e,{name:"headerText",hash:{},data:n}):s)+"</div>\n        <div class='secondary-text is-truncated'>"+i("function"==typeof(s=t.secondaryText||e&&e.secondaryText)?s.call(e,{name:"secondaryText",hash:{},data:n}):s)+"<span class='name'>"+i("function"==typeof(s=t.secondaryUsername||e&&e.secondaryUsername)?s.call(e,{name:"secondaryUsername",hash:{},data:n}):s)+"</span></div>\n    </div>\n</div>\n\n"},useData:!0})}(),h=function(e){var t=e.UiCore.UiContext;return t.extend("StandardHeadpiece",{className:"standard-headpiece",uiContextName:"standard_headpiece",dependencies:["imageManager"],initialize:function(e){t.prototype.initialize.call(this,e),this.__info=e.info,this.addToDOM()},render:function(){this.$el.html(e.template(this.__info)),this.__imageManager.load(this.$(".picture img"),this.__info.imageUrl,{container:this.$(".picture")})}})}({UiCore:e["@UiCore"],template:c}),g=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r="";return((a=(s=t.icon||e&&e.icon||i).call(e,"icon-bundle",{name:"icon",hash:{},data:n}))||0===a)&&(r+=a),r+"\r\n<div class='count'>"+o("function"==typeof(s=t.count||e&&e.count)?s.call(e,{name:"count",hash:{},data:n}):s)+"</div>"},useData:!0})}(),p=function(e){var t=e.UiCore.UiContext;return t.extend("BundleCount",{className:"bundle-count",uiContextName:"bundle_count",dependencies:["model"],initialize:function(e){t.prototype.initialize.call(this,e),this.__bundleType=e.bundleType||"subproducts",this.__forceCount=e.forceCount||-1,this.addToDOM()},render:function(){0<=this.__forceCount?this.$el.html(e.template({count:this.__forceCount})):this.__model.populated().then(function(){return this.__model.getEdgeCollection(this.__bundleType,e.Model.ProductEdgeCollection).enumerated()}.bind(this)).then(function(t){this.$el.html(e.template({count:t.length}))}.bind(this))}})}({UiCore:e["@UiCore"],Model:e["@Model"],template:g}),u=function(e){var t=e.StandardHeadpiece;return t.extend("InventoryOutfitHeadpiece",{className:"inventory-outfit-headpiece standard-headpiece",uiContextName:"inventory_outfit_headpiece",dependencies:["loginManager","model","globalStringManager"],initialize:function(i){this.__myself=i.loginManager.getCurrentUser(),this.model=i.model,this.model.populated().then(function(){i.info={imageUrl:this.model.get("outfit_image"),headerText:this.model.get("outfit_name"),isAP:"AP"===this.model.get("rating")},t.prototype.initialize.call(this,i),this.createChildContext(e.BundleCount,{model:this.model,bundleType:"products",$parentElement:this.$(".tile-body")})}.bind(this)).then(function(){this.createChildContext(e.Widgets.DisplayName,{$replaceElement:this.$(".secondary-text"),user:this.__myself,showVipBadge:!1,size:"small",color:"medium",prefix:this.__globalStringManager.get("by")})}.bind(this))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],BundleCount:p,StandardHeadpiece:h}),m=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return"<div class='title'>\n    <h2 class='body-heading'>"+(0,this.escapeExpression)("function"==typeof(a=t.title||e&&e.title)?a.call(e,{name:"title",hash:{},data:n}):a)+"</h2>\n    <div class='toggle'></div>\n</div>\n<div class='content-wrapper'>\n    <div class='content'></div>\n</div>"},useData:!0})}(),f=function(e){var t=e.UiCore.UiContext;return t.extend("AccordionSection",{className:"accordion-section",uiContextName:"accordion_section",trackedEvents:function(){return[{type:"click",selector:".title",name:"toggle",handler:"__toggle"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__title=IMVU.requireProperty(e,"title"),e.startOpen&&this.$el.addClass("open"),this.addToDOM()},render:function(){this.$el.html(e.template({title:this.__title}))},__expandForContent:function(){this.$(".content-wrapper").height(this.$(".content").outerHeight(!0))},__collapseContent:function(){this.$(".content-wrapper").height(0)},__toggle:function(){this.$el.hasClass("open")?(this.__collapseContent(),this.$el.removeClass("open")):(this.__expandForContent(),this.$el.addClass("open"))},addWidget:function(e,t){var i=this.createChildContext(e,_.extend({$parentElement:this.$(".content")},t));return this.$el.hasClass("open")&&this.__expandForContent(),i}})}({UiCore:e["@UiCore"],template:m}),v=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="lightbox">\n    <div class="main-container"></div>\n    <div class="lightbox-sidebar">\n        <div class="sidebar-content">\n            <div class="headpiece">\n                <div class="widgets"></div>\n                <div class="sticky-container-wrap"></div>\n            </div>\n            <div class="sidebar-panels"></div>\n            <div class="panel-footers"></div>\n        </div>\n    </div>\n    <div class=\'mobile-overlay\'>\n        <div class=\'panel-footers\'></div>\n    </div>\n</div>\n'},useData:!0})}(),b=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="sticky-content disable-text-selection">\n    <div class="buttons" />\n    <div class="nav-container">\n\t   <ul class="nav center-nav" />\n\t   <div class="magic-line" />\n    </div>\n    <div class="simple-scroller-placeholder"/>\n</div>\n'},useData:!0})}(),C=function(e){var t=e.UiCore.UiContext;return t.extend("StickyContainer",{uiContextName:"sticky_container",className:"sticky-container",trackedEvents:function(){return[{type:"click",selector:".center-nav > li",name:"panel",handler:this.__onclickPanelNav.bind(this),attributes:function(e){return{which:e.attr("data-btn")}}}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template)},addElementToCenterNav:function(e){this.$(".center-nav").append(e)},setMagicLine:function(e){e=e||this.$(".center-nav li:first"),this.$(".nav-container .magic-line").show().css({"margin-left":e.position().left+"px",width:e.outerWidth()})},__onclickPanelNav:function(e){this.trigger("panelclick",$(e.target).attr("data-btn"))}})}({UiCore:e["@UiCore"],template:b}),y=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<div class="scroller"></div>'},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return i='<div class="panel-container" data-panel="'+(i=this.escapeExpression)("function"==typeof(s=t.panelName||e&&e.panelName)?s.call(e,{name:"panelName",hash:{},data:n}):s)+'">',((a=t.unless.call(e,e&&e.isFooter,{name:"unless",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"</div>\n"},useData:!0})}(),M=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a,s;return i='\n    <button class="btn btn-ghost main">'+(i=this.escapeExpression)("function"==typeof(s=t.ctaSecondary||e&&e.ctaSecondary)?s.call(e,{name:"ctaSecondary",hash:{},data:n}):s)+"</button>\n    ",((a=t.if.call(e,e&&e.shopLightbox,{name:"if",hash:{},fn:this.program(2,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n"},2:function(e,t,i,n){var a;i=t.helperMissing;var s='\n        <button class="btn btn-ghost in-cart disabled hidden">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"in_cart",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>\n    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=this.escapeExpression;var o="";return((a=t.if.call(e,e&&e.ctaSecondary,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+'\n<button class="btn btn-primary">'+i("function"==typeof(s=t.ctaPrimary||e&&e.ctaPrimary)?s.call(e,{name:"ctaPrimary",hash:{},data:n}):s)+"</button>\n"},useData:!0})}(),k=function(e){var t=e.UiCore.UiContext;return t.extend("LightboxButtons",{className:"buttons lightbox-buttons",uiContextName:"lightbox_buttons",trackedEvents:function(){return[{type:"click",selector:".btn-ghost:not(.in-cart)",name:"cta_secondary",handler:this.__onclickSecondary.bind(this)},{type:"click",selector:".btn-primary",name:"cta_primary",handler:this.__onclickPrimary.bind(this)}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__buttons=IMVU.requireProperty(e,"buttons"),this.addToDOM()},render:function(){this.$el.html(e.template(this.__buttons))},__onclickPrimary:function(){this.trigger("lightboxButton:ctaPrimary")},__onclickSecondary:function(){this.trigger("lightboxButton:ctaSecondary")},_triggerButton:function(e){e?this.__onclickPrimary():this.__onclickSecondary()}})}({UiCore:e["@UiCore"],template:M}),x=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("LightboxDialog",{uiContextName:"lightbox_dialog",className:"lightbox-dialog",dependencies:["window","platform","globalStringManager"],initialize:function(e){t.prototype.initialize.call(this,e),"desktop"===this.__platform&&this.hideHeader(),this.__panels={},this.addToDOM()},postRender:function(){this.setContent("body",e.template),this.__addStickyContainer(),this.refreshSize(),$(this.__window).on("resize.lightboxDialog",this.refreshSize.bind(this)),"mobile"===this.__platform&&(this.$(".lightbox-sidebar").scroll(this.__onMobileScroll.bind(this)),this.$(".lightbox-sidebar").on("click",this.__onMobileSidebarClick.bind(this)))},delete:function(){$(this.__window).off("resize.lightboxDialog"),t.prototype.delete.call(this)},addWidgetToMainContainer:function(e,t){this.hideHeader();var i=this.createChildContext(e,_.extend({$parentElement:this.$(".main-container")},t||{}));return this.refreshSize(),i},addStandardHeadpiece:function(t){this.hideHeader(),this.createChildContext(e.StandardHeadpiece,{$prependElement:this.$(".headpiece .widgets"),info:t}),this.refreshSize()},setHeadpieceButtons:function(t){this.hideHeader(),this.__ctaButtons=this.createChildContext(e.LightboxButtons,{$replaceElement:this.__stickyContainer.$(".buttons"),buttons:t}),this.listenTo(this.__ctaButtons,"lightboxButton:ctaPrimary",this.__onclickPrimary.bind(this)),this.listenTo(this.__ctaButtons,"lightboxButton:ctaSecondary",this.__onclickSecondary.bind(this)),this.$(".headpiece").addClass("has-buttons")},removeHeadpieceButtons:function(){this.__ctaButtons&&(this.stopListening(this.__ctaButtons),this.__ctaButtons.delete(),delete this.__ctaButtons,this.$(".headpiece").removeClass("has-buttons"))},addWidgetToHeadpiece:function(e,t,i){return this.hideHeader(),e=this.createChildContext(e,_.extend({$parentElement:this.$(".headpiece .widgets")},t||{})),this.refreshSize(),e},__addStickyContainer:function(){return _.has(this,"__stickyContainer")||(this.__stickyContainer=this.createChildContext(e.StickyContainer,{$parentElement:this.$(".headpiece .sticky-container-wrap")}),this.listenTo(this.__stickyContainer,"panelclick",this.__selectPanel.bind(this)),this.refreshSize()),this.__stickyContainer},addFooterToSidebarPanel:function(e,t,i){return i=this.__getPanel(i),e=this.createChildContext(e,_.extend({$parentElement:i.$footers},t||{})),"mobile"===this.__platform&&i.$widgets.css({"margin-bottom":i.$footers.height()}),this.refreshSize(),e},addWidgetToSidebarPanel:function(e,t,i){return t=t||{},i=this.__getPanel(i,t.addCounter||!1).$widgets.find(".scroller:not(.scroll-wrapper)"),e=this.createChildContext(e,_.extend({$parentElement:i},t||{})),"mobile"!==this.__platform&&i.scrollbar(),this.refreshSize(),e},__getPanel:function(e,t){return e=e||"default",this.__panels[e]||this.__createPanel(e,t)},setSidebarPanelLoading:function(e,t){var i=this.__getPanel(t);i.$widgets.toggleClass("loading",e),i.$footers.toggleClass("loading",e)},__createPanel:function(t,i){var n=0===_.keys(this.__panels).length,a="default"===t?"":this.__globalStringManager.get("lightbox_panel_title_"+t),s="";return i&&(s="<span class='counter counter-"+t+"'>0</span> "),this.__stickyContainer.addElementToCenterNav("<li class='"+(n?"selected active":"")+"' data-btn='"+t+"'>"+s+a+"</li>"),this.$(".sidebar-panels").append(e.PanelTemplate({panelName:t})),this.$(("mobile"===this.__platform?".mobile-overlay":".lightbox-sidebar")+" .panel-footers").append(e.PanelTemplate({panelName:t,isFooter:!0})),a=this.$('.sidebar-panels [data-panel="'+t+'"]'),s=this.$('.panel-footers [data-panel="'+t+'"]'),n?(a.addClass("selected"),s.addClass("selected")):(this.__showPanelNav(),this.__stickyContainer.setMagicLine()),this.__panels[t]={$widgets:a,$footers:s},this.__panels[t]},__showPanelNav:function(){this.hideHeader(),this.$(".headpiece").addClass("has-nav"),this.$(".nav-container").show()},__selectPanel:function(t){var i=this.$('.nav-container [data-btn="'+t+'"]');e.NextUtil.DomHelper.radioClass(i,"selected active"),this.__stickyContainer.setMagicLine(i),this.$(".panel-container").removeClass("selected"),(t=this.$(".panel-container[data-panel="+t+"]")).addClass("selected"),"mobile"!==this.__platform&&t.find(".scroller").scrollbar()},refreshSize:function(){var e="block"===this.$(".lightbox").css("display")?0:this.$(".lightbox-sidebar").width(),t=parseInt(this.$(".main-container").css("min-width"),10),i="100%"===this.$el.css("max-width")?$(this.__window).width():parseInt(this.$el.css("max-width"),10),n=parseInt(this.$(".main-container > :first-child").css("max-width"),10),a=parseInt(this.$el.css("padding-left"),10)+parseInt(this.$el.css("padding-right"),10),s=parseInt(this.$el.css("padding-top"),10)+parseInt(this.$el.css("padding-bottom"),10);s=$(this.__window).height()-s,e=$(this.__window).width()-a-e;i&&(e=Math.min(i-a,e)),i=Math.max(t,Math.min(s,e)),n&&(i=Math.min(Math.max(t,n),i)),this.$(".main-container").css({width:i,height:this.headerIsVisible?0:i}),"mobile"!==this.__platform||this.headerIsVisible||this.$(".lightbox-sidebar").css({"padding-top":Math.min(i,this.$el.height()-this.$(".headpiece").height()),"margin-top":-i})},__onMobileScroll:function(){var e=this.$(".headpiece .sticky-container-wrap"),t=this.$(".sticky-container"),i=e.offset().top<=this.$(".lightbox").offset().top;this.__stickyHeadpieceEnabled?i||(t.detach().appendTo(e),e.css({height:"auto"}),this.__stickyHeadpieceEnabled=!1):i&&(e.css({height:e.height()}),t.detach().appendTo(this.$(".mobile-overlay")),this.__stickyHeadpieceEnabled=!0)},__onMobileSidebarClick:function(e){e=e.pageY-this.$(".lightbox-sidebar").offset().top;var t=this.$(".lightbox-sidebar").scrollTop();e<parseInt(this.$(".lightbox-sidebar").css("padding-top"),10)-t&&this.$(".main-container > *").trigger("click")},__onclickPrimary:function(e){},__onclickSecondary:function(e){}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],Dialogs:e["@Dialogs"],LightboxButtons:k,StandardHeadpiece:h,StickyContainer:C,template:v,PanelTemplate:y}),w=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<img class='silhouette' src='/common/withme/img/loading_avatar.png'>"},useData:!0})}(),P=function(e){var t=e.UiCore.UiContext;return t.extend("Avatar2d",{uiContextName:"avatar_2d",className:"avatar-2d",dependencies:["timer","dialogManager","globalStringManager"],initialize:function(e){t.prototype.initialize.call(this,e),this.__timer=e.timer,this.__lookModel=e.model,this.__width=e.width||800,this.__height=e.height||800,this.__vanishDelay=e.vanishDelay||1e3,this.__imageError=e.imageError||"error",this.__dialogManager=e.dialogManager,this.__globalStringManager=e.globalStringManager,this.__imageFactory=e.imageFactory||function(){return new Image},this.addToDOM(),this.__lookModel.on("syncing",this.__refreshLoading,this),this.__refreshLoading(),e.filterModel?(this.__filterModel=e.filterModel,this.listenTo(this.__filterModel,"change:category",this.__updateAvatarImage.bind(this))):e.view&&(this.__view=e.view),this.listenTo(this.__lookModel,"change:avatar_image",this.__updateAvatarImage.bind(this)),this.__lookModel.populated().then(this.__updateAvatarImage.bind(this))},delete:function(){this.__destroyInFlightImage(),this.$(".avatar-image").off(),this.__timer.clearTimeout(this.__vanishTimer),t.prototype.delete.call(this)},__refreshLoading:function(){this.$el.toggleClass("loading",this.__lookModel.isSyncing()||!!this.__$inFlightImage)},__destroyInFlightImage:function(){this.__$inFlightImage&&(this.__$inFlightImage.off(),this.__$inFlightImage=null)},__vanishCurrentImage:function(){if(this.__$currentImage){var e=this.__$currentImage;e.addClass("vanishing"),this.__$currentImage=null,this.__vanishTimer=this.__timer.setTimeout(function(){e.remove()},this.__vanishDelay)}},__maybeFadeIn:function(e){this.$el.is(":visible")&&e.addClass("fade-in")},__onImageLoad:function(){this.__vanishCurrentImage(),this.__$currentImage=this.__$inFlightImage,this.__maybeFadeIn(this.__$inFlightImage),this.$el.addClass("populated").removeClass("error").append(this.__$inFlightImage),this.__$inFlightImage=null,this.__refreshLoading()},__onImageFail:function(){this.__destroyInFlightImage(),this.__recordEvent("avatar_image_load_error",{url:this.__lookModel.get("avatar_image"),record:!0}),this.$el.addClass("error"),this.__refreshLoading(),this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_avatar_error_title"),text:this.__globalStringManager.get("dialog_avatar_error_text"),ok:this.__globalStringManager.get("dialog_avatar_error_button")})},__buildFilterView:function(){var e=this.__filterModel.get("category");return"dressup_front_"+(_.contains("wearing all accessories skins avatars outfits".split(" "),e)?"all":e)},__buildImageSrc:function(){return IMVU.URI.build(this.__lookModel.get("avatar_image"),{width:this.__width,height:this.__height,view:this.__filterModel?this.__buildFilterView():this.__view})},__updateAvatarImage:function(){if(void 0!==this.__lookModel.get("avatar_image")&&null!==this.__lookModel.get("avatar_image")){var e=this.__buildImageSrc();e!==this.__currentImageSrc&&(this.__currentImageSrc=e,this.__destroyInFlightImage(),this.__$inFlightImage=$(this.__imageFactory()),this.__$inFlightImage.attr("src",e).addClass("avatar-image avatar-2d-ie11-fix").on("load",this.__onImageLoad.bind(this)).on(this.__imageError,this.__onImageFail.bind(this)),this.__refreshLoading())}},render:function(){this.$el.html(e.template()),this.__maybeFadeIn(this.$(".silhouette"))}})}({UiCore:e["@UiCore"],template:w}),S=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("SceneManager",{uiContextName:"scene_manager",className:"scene-manager",dependencies:["Promise","module","featureAccessManager"],initialize:function(e){i.prototype.initialize.call(this,e),this.__serviceProvider=e.serviceProvider,this.__soloSceneFactory=e.soloSceneFactory,this.__scenePresenterFactory=e.scenePresenterFactory,this.__featureAccessManager=e.featureAccessManager,this.__sceneRegistry={},this.module=e.module||module,this.addToDOM()},loadedLazyDependencies:function(){return this.__loadedLazyDependenciesResolver||(this.__loadedLazyDependenciesPromise=new this.__Promise(function(e){this.__loadedLazyDependenciesResolver=e,this.module.run({bundle:"@lazySceneBundle"},function(t){this.__soloSceneFactory=this.__soloSceneFactory||t.bundle.SoloScene,this.__scenePresenterFactory=this.__scenePresenterFactory||t.bundle.ChatSceneModule,e.resolve()}.bind(this))}.bind(this))),this.__loadedLazyDependenciesResolver.promise},showSolo:function(e){return this.loadedLazyDependencies().then(function(){return _.each(["context","$parentElement","avatarNode"],function(t){e[t]=IMVU.requireProperty(e,t,'showSolo requires a "'+t+'" arg')}),e.context.createChildContext(this.__soloSceneFactory,_.extend({size:"match-parent"},e,{$parentElement:e.$parentElement})).loadedEverything()}.bind(this))},showScenePresenter:function(e){return this.loadedLazyDependencies().then(function(){return _.each(["context","$parentElement"],function(t){e[t]=IMVU.requireProperty(e,t,'showScenePresenter requires a "'+t+'" arg')}),e.context.createChildContext(this.__scenePresenterFactory,e)}.bind(this))}})}(),U=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="progress">\n    <div class="bar">\n        <div class="value"></div>\n        <div class="percentage"></div>\n    </div>\n    <div class="border"></div>\n</div>\n'},useData:!0})}(),T=function(e){var t=e.UiCore.UiContext;return t.extend("LoadingProgress",{uiContextName:"loading_progress",className:"loading-progress",dependencies:["Promise","timer","progressPromises","globalStringManager","window"],initialize:function(e){t.prototype.initialize.call(this,e),this.__timer=e.timer,this.__lingerTime=e.lingerTime||2e3,this.__showLoadingBarText=!!e.showLoadingBarText,this.finished=new e.Promise(function(e){this.__finishedResolver=e}.bind(this));var i=e.weighting||_.map(_.range(this.__progressPromises.length),function(){return 1}.bind(this));this.__initTime=+new Date,this.__progressControls=_.map(this.__progressPromises,function(e,t){return{promise:e,weight:i[t],progress:0}}.bind(this)),this.__progressTotal=_.reduce(this.__progressControls,function(e,t){return e+t.weight}.bind(this),0),this.addToDOM(),this.__updateBar=this.__createUpdateBarFunction(!!e.showLoadingBarText),_.each(this.__progressControls,function(e){e.promise.then(this.__onProgress.bind(this),this.__onProgress.bind(this))}.bind(this)),this.__onProgress()},delete:function(){this.__timer.clearTimeout(this.__timeoutFade),this.__timer.clearTimeout(this.__timeoutDelete),t.prototype.delete.call(this)},render:function(){this.$el.html(e.template).addClass("animated"),this.__showLoadingBarText&&this.$(".percentage").show()},partialProgress:function(e,t){"pending"===this.__progressControls[e].promise.state&&(this.__progressControls[e].progress=t,this.__onProgress())},__onProgress:function(){var e=_.reduce(this.__progressControls,function(e,t){return"pending"!==t.promise.state&&(t.progress=1),e+t.progress*t.weight},0);this.__updateBar(e/this.__progressTotal),e===this.__progressTotal&&this.__finish()},__finish:function(){this.__finishedResolver.accept(),this.__timer.clearTimeout(this.__timeout),this.__timeoutFade=this.__timer.setTimeout(function(){this.$el.fadeOut(.25*this.__lingerTime)}.bind(this),.75*this.__lingerTime),this.__timeoutDelete=this.__timer.setTimeout(this.delete.bind(this),this.__lingerTime),this.trigger("timeCompleted",+new Date-this.__initTime)},__createUpdateBarFunction:function(t){if(t){e.NextUtil.BezierEasing.apply(e.NextUtil.BezierEasing,[.25,.1,.25,1]);var i=null,n=0;return this.$(".percentage").show(),this.$(".value").css("transition","none"),function(e){var t=this.__timer.getTime(),a=n,s={done:!1};i&&(i.done=!0),i=s,function i(){if(!s.done){var o=Math.min((this.__timer.getTime()-t)/2e3,1);n=(e-a)*o+a,this.$(".value").css("width",100*n+"%"),this.$(".percentage").text(this.__globalStringManager.get("loading_bar_text",{percentage:Math.floor(100*n)})),1>o&&this.__window.requestAnimationFrame(i.bind(this))}}.call(this)}.bind(this)}return function(e){this.$(".value").css("width",100*e+"%")}.bind(this)}})}({UiCore:e["@UiCore"],template:U,NextUtil:e["@NextUtil"]}),D=function(e){var t=e.UiCore.UiContext;return t.extend("Avatar3d",{uiContextName:"avatar_3d",className:"avatar-3d",dependencies:["Promise","loginManager","model"],initialize:function(i){t.prototype.initialize.call(this,i),this.__serviceProvider.has("sceneManager")||this.__serviceProvider.register("sceneManager",this.__serviceProvider.get("modeManager").createChildContext(e.SceneManager,{$replaceElement:this.__serviceProvider.get("modeManager").$(".scene-manager-placeholder"),module:i.module})),this.__sceneManager=this.__serviceProvider.get("sceneManager"),this.__model=i.model,this.__view=i.view||"**unknown**",this.__filterModel=IMVU.optionalProperty(i,"filterModel",null),this.__camParams=i.camParams,this.__soloScene=null,this.__sceneContext=i.sceneContext,this.addToDOM(),this.__loadEvents={},_.each(["sceneCreated","sceneLoaded"],function(e){new this.__Promise(function(t){this.__loadEvents[e]=t}.bind(this))}.bind(this)),i.showLoadingProgress&&this.createChildContext(e.LoadingProgress,{$parentElement:this.$el,showLoadingBarText:!0,progressPromises:_.pluck(_.values(this.__loadEvents),"promise")}),this.__showScene()},__showScene:function(){_.isNull(this.__soloScene)&&this.__sceneManager.showSolo({context:this,$parentElement:this.$el,avatarNode:this.__model,view:this.__view,filterModel:this.__filterModel,size:"match-parent",enableThumbs:!1,camParams:this.__camParams||{},sceneContext:this.__sceneContext}).then(function(e){return this.__loadEvents.sceneCreated.accept(),this.__soloScene=e,this.listenTo(this.__soloScene,"assetChanged",this.trigger.bind(this,"assetChanged")),this.__soloScene.loadedEverything()}.bind(this)).then(function(){this.__loadEvents.sceneLoaded.accept()}.bind(this))},toggleRendering:function(e){this.__soloScene&&this.__soloScene.toggleRendering(e)},playTriggeredAction:function(e){this.__soloScene&&this.__soloScene.playTriggeredAction(e)}})}({UiCore:e["@UiCore"],Model:e["@Model"],LoadingProgress:T,SceneManager:S}),L=function(e){var t=e.UiCore.UiContext;return t.extend("Avatar",{uiContextName:"avatar",className:"avatar",dependencies:["webGL"],initialize:function(i){t.prototype.initialize.call(this,i),this.addToDOM(),this.__type=i.webGL.use3d()?e.Avatar3d:e.Avatar2d,this.__avatarFactory=this.createChildContext(this.__type,_.extend(i,{$parentElement:this.$el})),this.listenTo(this.__avatarFactory,"assetChanged",this.trigger.bind(this,"assetChanged"))},toggleRendering:function(t){this.__type===e.Avatar3d&&this.__avatarFactory.toggleRendering(t)},playTriggeredAction:function(e){this.__avatarFactory.playTriggeredAction(e)}})}({UiCore:e["@UiCore"],Avatar2d:P,Avatar3d:D}),E=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="price-info">\n    <div class="owned-label">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"IN INVENTORY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n</div>\n<div class="icons">\n    <span class="icon more-info" title="',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"more_options",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'""></span>\n    </div>\n</div>\n'},useData:!0})}(),A=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("ContextMenu",{uiContextName:"context_menu",tagName:"ul",className:"context-menu",trackedEvents:function(){return[{type:"click",selector:"li",name:"context_menu_item",handler:"__chooseMenuItem",attributes:function(e){return{which:e.attr("data-menu-item")}}}]},initialize:function(e){i.prototype.initialize.call(this,e),this.__items=IMVU.requireProperty(e,"items"),this.location=IMVU.requireProperty(e,"location"),this.__closeOnScroll=void 0===e.closeOnScroll||e.closeOnScroll,this.addToDOM()},render:function(){_.each(this.__items,function(e){var t=$("<li />");t.attr("data-menu-item",e.name).text(e.text).addClass(e.classNames).toggleClass("divider",!!e.divider),this.$el.append(t)}.bind(this))},__chooseMenuItem:function(e){var t=$(e.currentTarget).data("menu-item"),i=_.find(this.__items,function(e){return e.name===t}).handler;i&&i.call(this,e),this.trigger("item-chosen")},shouldCloseOnScroll:function(){return!this.__closeOnScroll}})}(),I=function(e){var t=e.UiCore.UiContext;return t.extend("InventoryOutfitActionBar",{uiContextName:"inventory_outfit_action_bar",className:"inventory-outfit-action-bar",dependencies:["contextMenuManager","dialogManager","globalStringManager","loginManager","restModelFactory"],trackedEvents:function(){return[{type:"click",selector:".more-info",name:"more_info",handler:"__showMoreInfo"}]},initialize:function(e){this.__model=IMVU.requireProperty(e,"model"),this.__myself=e.loginManager.getCurrentUser(),t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template({}))},__showMoreInfo:function(t){var i=[{name:"delete_outfit",text:this.__globalStringManager.get("inventory_outfit_lightbox_context_menu_delete_outfit"),handler:this.__deleteOutfit.bind(this)}];this.__contextMenuManager.showMenu(t,e.ContextMenu,{items:i,displayOptions:{right:!0,above:!0}})},__deleteOutfit:function(){this.__model.trigger("delete_outfit")}})}({UiCore:e["@UiCore"],Model:e["@Model"],template:E,ContextMenu:A}),N=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<button class="btn ap ap-badge"></button>'},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r="<div class='tile-body'>\n    <img class='tile-image' src='"+i("function"==typeof(s=t.preview_image||e&&e.preview_image)?s.call(e,{name:"preview_image",hash:{},data:n}):s)+"' />\n    ";return((a=t.if.call(e,e&&e.is_ap,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+="\n    <div class='name-overlay'>\n        <div class='trigger-name is-truncated'>"+i("function"==typeof(s=t.trigger_name||e&&e.trigger_name)?s.call(e,{name:"trigger_name",hash:{},data:n}):s)+"</div>\n        ",((a=(s=t.icon||e&&e.icon||o).call(e,"icon-triggers",{name:"icon",hash:{},data:n}))||0===a)&&(r+=a),r+"\n    </div>\n</div>"},useData:!0})}(),F=function(e){var t=e.UiCore.UiContext;return t.extend("ActionTile",{className:"lightbox-tile action-tile",uiContextName:"action_tile",dependencies:["webGL","restModelFactory"],trackedEvents:function(){return[{type:"click",selector:".tile-body.playable",name:"play_action",handler:"__playAction"}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__imageSize=i.imageSize||140,this.__productNode=i.restModelFactory.readModel(this.model.get("productId"),e.Model.ProductNode),this.addToDOM()},render:function(){this.__productNode.populated().then(function(){this.$el.html(e.template({trigger_name:this.model.get("trigger_name"),preview_image:IMVU.URI.build(this.__productNode.get("preview_image"),{width:this.__imageSize,height:this.__imageSize}),is_ap:"GA"!==this.__productNode.get("rating")})),this.__updatePlayable()}.bind(this))},__updatePlayable:function(){this.$(".tile-body").toggleClass("playable",this.__webGL.use3d())},__playAction:function(){this.trigger("playAction",this.model.get("trigger_name"),this.__productNode)}})}({UiCore:e["@UiCore"],Model:e["@Model"],template:N}),H=function(e){var t=e.UiCore.ListPresenter;return t.extend("ActionProduct",{className:"lightbox-tile-list action-product",uiContextName:"action_product",itemFactory:e.ActionTile,initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()}})}({UiCore:e["@UiCore"],Model:e["@Model"],ActionTile:F}),R=function(e){var t=e.UiCore.UiContext;return t.extend("ActionProduct",{className:"action-list",uiContextName:"action_list",initialize:function(e){t.prototype.initialize.call(this,e),this.__productTriggers=e.productTriggers,this.addToDOM()},render:function(){_.each(this.__productTriggers,function(t){t.length&&(t=this.createChildContext(e.ActionProduct,{$parentElement:this.$el,collection:t}),this.listenTo(t,"playAction",this.trigger.bind(this,"playAction")))}.bind(this))}})}({UiCore:e["@UiCore"],ActionProduct:H}),B=function(e){var t=IMVU.NamedModel;return t.extend("LookModel",_.extend({dependencies:["rest","Promise"],initialize:function(e){this.__rest=e.rest,this.__Promise=e.Promise,this.__avatar=IMVU.requireProperty(e,"avatar"),t.prototype.initialize.call(this,{asset_url:this.__avatar.get("asset_url"),look_url:this.__avatar.get("look_url"),products:this.__avatar.get("products"),pending_adds:[],pending_removes:[],avatar_image:null,body_pattern_ids:null}),this.__lookBase=this.__avatar.get("look_url"),this.__changeNum=0,this.__changeToPendingSet={},this.__changeToPendingSet[this.__changeNum]={pending_adds:[],pending_removes:[],url:this.__lookBase},this.__lastShownRequest=this.__requestCount=0,this.__initialRequestSent=this.__populated=!1,this.__outstandingRequests=0,this.__populatedResolver=null,this.__populatedPromise=new this.__Promise(function(e){this.__populatedResolver=e}.bind(this))},resetToAvatar:function(){this.set({asset_url:this.__avatar.get("asset_url"),look_url:this.__avatar.get("look_url"),products:this.__avatar.get("products"),avatar_image:null,body_pattern_ids:null,pending_adds:[],pending_removes:[]}),this.__lookBase=this.__avatar.get("look_url"),this.__initialRequestSent=this.__populated=!1},populated:function(){return this.__populated||this.__initialRequestSent||(this.__initialRequestSent=!0,this.change()),this.__populatedPromise},getChangePromise:function(){return this.__changePromise},_test_set_populated:function(){this.__populated=!0,this.__populatedResolver.resolve()},isSyncing:function(){return 0<this.__outstandingRequests},forceChangeToLookUrl:function(e){return e?(this.abortPendingFetches(),this.__fetch(e)):this.__Promise.resolve(!0)},change:function(e){var t=(e=e||{}).add||[];e=e.remove||[],t=_(this.get("pending_adds")).concat(t),e=_(this.get("pending_removes")).concat(e);var i=_.intersection(t,e);t=_(t).difference(i);e=_(e).difference(i);i=this.__buildLookUrl(this.__lookBase,t,e);var n=++this.__changeNum;return this.__changeToPendingSet[n]={pending_adds:t,pending_removes:e,url:i},this.set({pending_adds:t,pending_removes:e}),this.__fetch(i)},__fetch:function(e){var t=++this.__requestCount;return this.__outstandingRequests++,this.trigger("syncing",this.isSyncing()),this.__changeResolver=null,this.__changePromise=new this.__Promise(function(e){this.__changeResolver=e}.bind(this)),this.__rest.get(e).then(function(e){this.__outstandingRequests--,this.trigger("syncing",this.isSyncing()),e=e.response.data||e.response,t>this.__lastShownRequest&&(this.__lastShownRequest=t,this.set({asset_url:e.assetURL,products:e.products,look_url:e.canonicalLookURL,avatar_image:e.avatarImage,body_pattern_ids:e.bodyPatternIds}),t===this.__requestCount&&(this.set({pending_adds:[],pending_removes:[]}),this.__lookBase=e.canonicalLookURL),this.__populated=!0,this.__populatedResolver.resolve(),this.__changeResolver.resolve(e))}.bind(this)).catch(function(e){return this.__outstandingRequests--,this.trigger("syncing",this.isSyncing()),this.__Promise.reject(e)}.bind(this))},getProducts:function(){return this.get("products")},getGender:function(){var e=this.get("body_pattern_ids");return null==e?null:_.contains(e,80)?"female":_.contains(e,191)?"male":null},abortPendingFetches:function(){this.__rest.cancelAll(this.__avatar.id)},isPendingAdd:function(e){return _(this.get("pending_adds")).contains(e)},isPendingRemove:function(e){return _(this.get("pending_removes")).contains(e)},__buildLookUrl:function(e,t,i){return IMVU.URI.build(e,{add:t.join(","),remove:i.join(",")},{prune:!0})},getCanonicalGaUrl:function(){if(0<(t=_.chain(this.getProducts()).filter(function(e){return"AP"===e.rating}).map(function(e){return e.product_id}).value()).length)return t=this.__buildLookUrl(this.__lookBase,[],t),this.__rest.get(t).then(function(e){return(e.response.data||e.response).canonicalLookURL}.bind(this));var e,t=new this.__Promise(function(t){e=t}.bind(this));return e.resolve(this.get("look_url")),t},getGeneratedCanonicalUrl:function(e,t){var i=this.__buildLookUrl(this.__lookBase,e||[],t||[]);return this.__rest.get(i).then(function(e){return(e.response.data||e.response).canonicalLookURL}.bind(this))}},Backbone.Events))}(e["@UiCore"]),O=function(e){return IMVU.BaseClass.extend("DressUpAvatarManager",_.extend({dependencies:"Promise dialogManager globalStartupModel globalStringManager loginManager rest restModelFactory".split(" "),initialize:function(t){if(this.__serviceProvider=t.serviceProvider,this.Promise=t.Promise,this.dialogManager=t.dialogManager,t.loginManager.isLoggedIn()&&(this.__myself=t.loginManager.getCurrentUser()),this.__restModelFactory=t.restModelFactory,this.__globalStringManager=t.globalStringManager,this.__rest=t.rest,this.__femalePid=t.femalePid||"80",this.__malePid=t.malePid||"191",this.__persistLooks=IMVU.requireProperty(t,"persistLooks"),this.__confirmGenderChange=IMVU.optionalProperty(t,"confirmGenderChange",!0),this.persistentAvatar=null,this.outfitData={},this.__resolver=null,this.__loadedPromise=new this.Promise(function(e){this.__resolver=e}.bind(this)),t.globalStartupModel.populated().then(function(){this.outfitUrl=t.globalStartupModel.get("outfitUrl"),this.__baseBodyPatterns={female:t.globalStartupModel.get("femaleBodyPatternUrl"),male:t.globalStartupModel.get("maleBodyPatternUrl")},this.__defaultLooks={female:t.globalStartupModel.get("starterLooks.female"),male:t.globalStartupModel.get("starterLooks.male")},this.__defaultOwnedProducts={}}.bind(this)),_.has(this,"__myself"))this.__myself.populated().then(function(){return this.persistentAvatar=this.__myself.getSingleEdge("avatar"),this.Promise.every([this.persistentAvatar.populated()])}.bind(this)).then(function(){this.__createLookModel(),this.persistentAvatar.on("change",this.__onPersistentAvatarChange,this),this.__originalLook=this.getCurrentLookUrl(),this.__resolver.accept(null)}.bind(this));else{var i,n=(n=t.globalStartupModel.get("starterLooks.female")).replace(/\.localhost/,"");t.globalStartupModel.populated().then(function(){return(i=this.__restModelFactory.readModel(n,e.Model.ProductNode)).populated()}.bind(this)).then(function(){this.persistentAvatar=new Backbone.Model({id:"dressup_avatar",look_url:n,assert_url:i.get("assert_url"),products:i.get("products")}),this.persistentAvatar.Promise=this.__serviceProvider.get("Promise"),this.persistentAvatar.populated=function(){return this.Promise.accept()}.bind(this.persistentAvatar),this.__createLookModel(),this.__originalLook=this.getCurrentLookUrl(),this.__resolver.accept(null)}.bind(this))}},delete:function(){this.stopListening(),this.__lookModel&&this.__lookModel.off(void 0,void 0,this),this.persistentAvatar&&this.persistentAvatar.off(void 0,void 0,this)},populated:function(){return this.__loadedPromise},setChatParticipant:function(e){this.chatParticipant=e,this.populated().then(function(){this.forceChangeToLookUrl(e.get("look_url"))}.bind(this))},getLookModel:function(){return this.__lookModel},getOriginalLook:function(){return this.__originalLook},getPersistedLookModel:function(){return this.__serviceProvider.create(e.LookModel,{avatar:this.persistentAvatar})},addProps:function(e){return this.__props=e,this.populated().then(this.__addToAvatar.bind(this,e))},__createLookModel:function(){this.__lookModel=this.getPersistedLookModel()},__onPersistentAvatarChange:function(){this.updateOutfitData(),!this.chatParticipant&&this.persistentAvatar.changed.look_url&&this.__lookModel&&this.__lookModel.get("look_url")!==this.persistentAvatar.get("look_url")&&(this.__lookModel.resetToAvatar(),this.__props?this.__addToAvatar(this.__props):this.__lookModel.populated())},__persistAvatar:function(){var e=this.__lookModel.get("look_url");this.__persistLooks&&(this.__lookModel.abortPendingFetches(),this.chatParticipant?this.chatParticipant.save({look_url:e}):this.persistentAvatar.save({look_url:e}))},getGender:function(){return this.__loadedPromise.then(function(){return this.__lookModel.get("products")&&0!==this.__lookModel.get("products").length?this.__restModelFactory.readModel(this.__lookModel.get("products")[0].id,e.Model.ProductNode).populated():void 0}.bind(this)).then(function(e){return e?e.get("gender"):e})},checkGenderMatches:function(t){if(!this.__lookModel.get("products")||!this.__lookModel.get("products").length)return this.Promise.resolve(!0);var i=this.__restModelFactory.readModel(t,e.Model.ProductNode),n=this.getGender();return this.Promise.every([i.populated(),n]).then(function(){return i.get("gender")?this.Promise.resolve(i.get("gender")===n.result||_.contains(i.get("categories"),"Avatars")):this.Promise.resolve(!0)}.bind(this))},__getDefaultOwnedProducts:function(e){return this.__defaultOwnedProducts[e]?this.Promise.accept(this.__defaultOwnedProducts[e]):this.__rest.get(this.__defaultLooks[e]).then(function(t){t=t.response.data||t.response;var i=_.every(t.products,function(e){return e.owned});return this.__defaultOwnedProducts[e]=i?_.pluck(t.products,"id"):[this.__baseBodyPatterns[e]],this.__defaultOwnedProducts[e]}.bind(this))},__maybeChangeGenderAndAdd:function(t){var i=this.__restModelFactory.readModel(t,e.Model.ProductNode),n="female"===i.get("gender")?"female":"male";return i.populated().then(function(){return this.__confirmGenderChange?this.dialogManager.confirm({title:this.__globalStringManager.get("dialog_wrong_gender_title"),text:this.__globalStringManager.get("dialog_wrong_gender_text"),yes:this.__globalStringManager.get("dialog_wrong_gender_yes"),no:this.__globalStringManager.get("dialog_wrong_gender_no")}).finished:this.Promise.accept()}.bind(this)).then(function(){return this.changeGenderAndAdd(n,[t])}.bind(this))},changeGenderAndAdd:function(e,t){return this.__getDefaultOwnedProducts(e).then(function(e){return this.__addToAvatar(e.concat(t))}.bind(this))},__addToAvatar:function(e){return this.__lookModel.change({add:e}).then(function(){this.updateOutfitData()}.bind(this))},addProducts:function(e){return this.__addToAvatar(e).then(function(){this.__persistAvatar()}.bind(this))},add:function(e){return this.checkGenderMatches(e).then(function(t){return t?this.__addToAvatar([e]):this.__maybeChangeGenderAndAdd(e)}.bind(this)).then(function(){this.updateOutfitData(),this.__persistAvatar()}.bind(this)).catch(function(e){return this.Promise.reject(e)}.bind(this))},addAllSubproducts:function(t){var i,n=t.getEdgeCollection("subproducts",e.Model.ProductEdgeCollection);return n.populated().then(function(){return i=n.at(0).node,this.checkGenderMatches(i.id)}.bind(this)).then(function(e){var t=n.map(function(e){return e.node.id});return e?this.addProducts(t):this.changeGenderAndAdd(i.get("gender"),t)}.bind(this))},remove:function(t){var i=_.isArray(t)?t:[t];return this.__lookModel.get("look_url"),_.contains(i,this.getCurrentBodyPatternWorn())?(t=_.map(this.persistentAvatar.get("products"),function(t){return this.__restModelFactory.readModel(t.id,e.Model.ProductNode).populated()}.bind(this)),t=this.Promise.every(t).then(function(e){return(e=_.find(e,function(e){return _.contains(e.get("is"),"body_pattern")}))?1===i.length&&e.id===i[0]?this.Promise.accept():this.__lookModel.change({remove:i,add:[e.id]}):this.__lookModel.change({remove:i})}.bind(this))):t=this.__lookModel.change({remove:i}),t.then(function(){this.updateOutfitData(),this.__persistAvatar()}.bind(this)).catch(function(e){return this.Promise.reject(e)}.bind(this))},removeAllSubproducts:function(t){var i=t.getEdgeCollection("subproducts",e.Model.ProductEdgeCollection);return i.populated().catch(function(){}).then(function(){this.remove(i.map(function(e){return e.node.id}))}.bind(this))},isWearing:function(e){return this.enforceOutfitState(),e===this.outfitData.id||_.contains(this.getCurrentProductsWorn(!0),e)},getUnowned:function(){var t,i=[];return this.persistentAvatar.populated().then(function(){var n=this.__lookModel.get("products"),a=[];return _.each(n,function(e){i.push(e),a.push(e.product_id)}.bind(this)),a=a.join(),this.__wornOwnedProducts&&this.stopListening(this.__wornOwnedProducts),t=this.__wornOwnedProducts=this.__myself.searchEdgeCollection("inventory",{pids:a},e.Model.ProductEdgeCollection),this.listenTo(this.__wornOwnedProducts,"change:relations",function(){this.trigger("change:ownedWornProducts")}),t.populated()}.bind(this)).then(function(){return _.pluck(_.filter(i,function(e){var i=!1;return _.each(t.models,function(t){(t=t.node.get("id"))===e.id&&t!==this.__femalePid&&t!==this.__malePid&&(i=!0)}.bind(this)),!i}.bind(this)),"id")}.bind(this))},forceChangeToLookUrl:function(e,t){return this.__lookModel.forceChangeToLookUrl(e).then(function(){this.updateOutfitData(),t&&this.__persistAvatar()}.bind(this))},updateOutfitData:function(){this.outfitData!=={}&&this.outfitData.products&&0!==this.outfitData.products.length&&!this.isWearingFullOutfit(this.outfitData.products)&&(this.outfitData={})},isWearingFullOutfit:function(e){var t=this.getCurrentProductsWorn();return _.intersection(t,e).length===t.length&&_.intersection(t,e).length===e.length},enforceOutfitState:function(){this.outfitData.id&&!this.isWearingFullOutfit(this.outfitData.products)&&(this.outfitData={})},isWearingOutfit:function(e){return this.outfitData.id==e},putOnOutfit:function(e,t){var i=this.outfitData;return this.outfitData={id:e,look:t,products:null},this.forceChangeToLookUrl(t).then(function(){if(this.outfitData.products=this.getCurrentProductsWorn(),i.look!=t&&this.trigger("change:look_url",t),i){if(i.id!=e&&i.products){var n=_.pluck(i.products,"product_id"),a=_.pluck(this.outfitData.products,"product_id");this.arraysEqual([n,a])&&this.trigger("change:outfitId",e,i.id)}}else this.trigger("change:outfitId",e,null);this.__persistAvatar()}.bind(this)).catch(function(e){this.outfitData=i}.bind(this))},arraysEqual:function(e){return _.all(e,function(t){return t.length===e[0].length&&0===_.difference(t,e[0]).length})},getCurrentLookUrl:function(){return this.__lookModel.get("look_url")},getCurrentProductsWorn:function(e){return e=!!e,_.chain(this.__lookModel.get("products")).filter(function(t){return e||t.product_id!=this.__femalePid&&t.product_id!=this.__malePid}.bind(this)).pluck("id").value()},getCurrentBodyPatternWorn:function(){return this.getCurrentProductsWorn(!0)[0]},__saveDoneAlert:function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_save_profile_done_title"),text:this.__globalStringManager.get("dialog_save_profile_done_text"),ok:this.__globalStringManager.get("dialog_save_profile_done_button")})},__saveErrorAlert:function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_save_profile_error_title"),text:this.__globalStringManager.get("dialog_save_profile_error_text"),ok:this.__globalStringManager.get("dialog_save_profile_error_button")})},saveCurrentOutfit:function(t){return t=t||{},this.getUnowned().then(function(i){for(var n=0,a=i.length;n<a;n++)if(!t[i[n]])return;this.__restModelFactory.createModel(this.outfitUrl,e.UiCore.NodeModel,{look_url:this.__lookModel.get("look_url")}).then(function(e){this.putOnOutfit(e.get("id"),e.get("look_url")),this.trigger("change:saveOutfit")}.bind(this)).catch(function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_save_outfit_error_title"),text:this.__globalStringManager.get("dialog_save_outfit_error_text"),ok:this.__globalStringManager.get("dialog_save_outfit_error_button")})}.bind(this))}.bind(this))},setProfileLook:function(t,i){var n=this.__restModelFactory.readModel(this.__myself.relations.profile_outfit,e.UiCore.NodeModel);return i&&this.__restModelFactory.createModel(this.outfitUrl,e.UiCore.NodeModel,{look_url:this.__lookModel.get("look_url")}).then(function(e){this.trigger("change:saveOutfit")}.bind(this)),n.populated().then(function(){return n.save({look_url:this.__lookModel.get("look_url")})}.bind(this)).then(function(){t||this.__saveDoneAlert()}.bind(this)).catch(this.__saveErrorAlert.bind(this))},containsAPProduct:function(e){e||(e=this.__lookModel.get("products"));var t=!1;return e.forEach(function(e){"AP"===e.rating&&(t=!0)}),t}},Backbone.Events))}({UiCore:e["@UiCore"],Model:e["@Model"],LookModel:B}),z=function(e){var t=e.LightboxDialog;return t.extend("InventoryOutfitLightbox",{uiContextName:"inventory_outfit_lightbox",className:"inventory-outfit-lightbox lightbox-dialog",dependencies:["globalStringManager","loginManager","Promise"],initialize:function(i){t.prototype.initialize.call(this,i),this.__dressUpAvatarManagerFactory=i.dressUpAvatarManagerFactory||e.DressUpAvatarManager,this.__myself=this.track(i.loginManager.getCurrentUser()),this.__imageFactory=i.imageFactory,this.__triggerList=this.__serviceProvider.create(i.triggerListFactory||e.TriggerList),this.__dressUpAvatarManager=this.__serviceProvider.create(this.__dressUpAvatarManagerFactory,{persistLooks:!1,confirmGenderChange:!1}),this.model.populated().then(function(){this.listenTo(this.model,"delete_outfit",this.hide),this.__subproductCollection=this.model.getEdgeCollection("products",e.Model.ProductEdgeCollection),this.__showAvatar()}.bind(this))},__setupHeadpiece:function(){this.addWidgetToHeadpiece(e.InventoryOutfitHeadpiece,{model:this.model}),this.actionBar=this.addWidgetToHeadpiece(e.InventoryOutfitActionBar,{model:this.model})},__setupSidebar:function(){this.setSidebarPanelLoading(!0),this.__dressUpAvatarManager.populated().then(function(){return this.__Promise.every([this.__triggerList.loadTriggers(this.__dressUpAvatarManager.getLookModel().get("asset_url")),this.__subproductCollection?this.__subproductCollection.populated().catch(function(){}):this.__Promise.accept()])}.bind(this)).then(function(){var t=this.__subproductCollection?this.__subproductCollection.map(function(e){return this.__triggerList.triggersForProduct(e.node)}.bind(this)):[this.__triggerList.triggersForProduct(this.model)];this.__addAccordionSection(this.__globalStringManager.get("items_in_look"),e.SubproductList,{collection:this.__subproductCollection},!0);var i=_.reduce(t,function(e,t){return e+t.length},0);if(0<i){var n="desktop"===this.__platform;t=this.__addAccordionSection(this.__globalStringManager.get("actions_with_count",{count:i}),e.ActionList,{productTriggers:t},n);this.listenTo(t,"playAction",this.__playAction.bind(this))}this.setSidebarPanelLoading(!1)}.bind(this))},__addAccordionSection:function(t,i,n,a){return this.addWidgetToSidebarPanel(e.AccordionSection,{title:t,startOpen:!!a}).addWidget(i,n)},__showAvatar:function(){this.__dressUpAvatarManager.populated().then(function(){return this.__dressUpAvatarManager.forceChangeToLookUrl(this.model.get("look_url"))}.bind(this)).then(function(){this.__setupHeadpiece(),this.__setupSidebar(),this.__avatarWidget=this.addWidgetToMainContainer(e.Avatar,{model:this.__dressUpAvatarManager.getLookModel(),imageFactory:this.__imageFactory,showLoadingProgress:!0,sceneContext:"shop_clothing"})}.bind(this))},setSidebarPanelLoading:function(e,t){var i=this.__getPanel(t);i.$widgets.toggleClass("loading",e),i.$footers.toggleClass("loading",e)},hide:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!1),t.prototype.hide.call(this)},show:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!0),t.prototype.show.call(this)},delete:function(){this.__dressUpAvatarManager.delete(),t.prototype.delete.call(this)},__playAction:function(e){this.__avatarWidget&&this.__avatarWidget.playTriggeredAction(e)}})}({Model:e["@Model"],Widgets:e["@Widgets"],AccordionSection:f,ActionList:R,Avatar:L,DressUpAvatarManager:O,InventoryOutfitActionBar:I,InventoryOutfitHeadpiece:u,LightboxDialog:x,TriggerList:a,SubproductList:d}),W=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<div class='message'></div>"},useData:!0})}(),V=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return(a="function"==typeof(s=t.text||e&&e.text)?s.call(e,{name:"text",hash:{},data:n}):s)||0===a?a:""},useData:!0})}(),q=function(e){var t=e.UiCore.UiContext,i="imvu.com www.imvu.com secure.imvu.com avatars.imvu.com im.vu localhost.imvu.com help.imvu.com go.imvu.com".split(" "),n=["imvu.com","www.imvu.com","secure.imvu.com","localhost.imvu.com"];return t.extend("UserText",{className:"user-text",uiContextName:"user_text",EXTERNAL_LINK_WARNINGS_SUPPRESSED_KEY:"alloy.external_link_warnings.suppressed",dependencies:"Promise conversationHelpers dialogManager featureAccessManager globalStringManager modeManager prefsManager root text timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:"a",name:"user_text_link",handler:this.__onClickLink}]},initialize:function(e){t.prototype.initialize.call(this,e),this.text=String(e.text)||"",this.__dialogManager=e.dialogManager,this.__window=e.window,this.__prefsManager=e.prefsManager,this.__featureAccessManager=e.featureAccessManager,this.__globalStringManager=e.globalStringManager,this.__conversationHelpers=e.conversationHelpers,this.__modeManager=e.modeManager,this.__root=e.root,this.addToDOM()},delete:function(){t.prototype.delete.call(this)},render:function(t){t=t||!0,this.text=this.text.replace(/(?:\r\n|\r|\n)/g,"<br />"),t&&(this.text=this.text.replace(/<(?:.|\n)*?>/gm," ")),this.text=this.__conversationHelpers.sanitize(this.text),this.text=this.__conversationHelpers.collapseWhitespace(this.text),this.$el.html(e.template({text:this.text})),this.$el.linkify({target:"_blank"})},__isNextMode:function(e){var t=_.rest(e.pathname.split("/"));return this.__featureAccessManager.canSeeFixForUserTextUrl()?_.contains(n,e.hostname)&&1<t.length&&"next"===t[0]&&0<t[1].length:_.contains(n,e.hostname)&&1<t.length&&"next"===t[0]},__onClickLink:function(e){var t=e.target.href;this.__isNextMode(e.target)?(e.preventDefault(),this.__modeManager.openModeFromPath(e.target.pathname)):this.isExternalLink(e.target)&&!this.isExternalLinkWarningSuppressed()&&(e.preventDefault(),this.__dialogManager.confirm({title:this.__globalStringManager.get("visit_link_title"),text:this.__globalStringManager.get("visit_link_text"),checkbox:this.__globalStringManager.get("visit_link_checkbox"),checkedByDefault:!1,yes:this.__globalStringManager.get("visit_link_title"),no:this.__globalStringManager.get("Cancel")}).finished.then(function(e){e.checked&&this.suppressExternalLinkWarnings(),this.__window.open(t,"_blank")}.bind(this)))},isExternalLinkWarningSuppressed:function(){return this.__prefsManager.getBool(this.EXTERNAL_LINK_WARNINGS_SUPPRESSED_KEY,!1)},suppressExternalLinkWarnings:function(){this.__prefsManager.setBool(this.EXTERNAL_LINK_WARNINGS_SUPPRESSED_KEY,!0)},isExternalLink:function(e){return!_.contains(i,e.hostname)},waitForVisible:function(){return new this.__Promise(function(e){var t=10,i=function(){this.isVisible()?e.resolve():0<t?(t--,this.__timer.setTimeout(i.bind(this),500)):e.reject(Error("text never becomes visible"))};i.call(this)}.bind(this))},isVisible:function(){return this.$el.is(":visible")},isOverflowed:function(){return!(!this.isVisible()||!(Math.ceil(this.$el.innerWidth())<this.$el[0].scrollWidth||Math.ceil(this.$el.innerHeight())<this.$el[0].scrollHeight))},handleOverflow:function(){if(this.$el.text(this.text),this.isOverflowed()){if(!this.shortText){for(var e=this.text,t=e,i=0;this.isOverflowed();){if(i>this.text.length){e=this.text.substr(0,this.text.length/2);break}(t=e.replace(/\s+\S+$/,"..."))===e&&(t=(t=e.replace(/(\.\.\.)*$/,"")).replace(/.{1,3}$/,"...")),e=t,this.$el.text(e),this.$el.linkify({target:"_blank"}),i++}(t=e.replace(/(\s+\S+){1,2}$/,"..."))===e&&(t=(t=e.replace(/(\.\.\.)*$/,"")).replace(/.{1,6}$/,"...")),this.shortText=t}this.$el.text(this.shortText),this.$el.linkify({target:"_blank"})}else this.$el.linkify({target:"_blank"}),e=this.$el.html(),this.$el.html(e+"&nbsp;&nbsp;&nbsp;&nbsp;")}})}({UiCore:e["@UiCore"],template:V,Linkify:e["@Linkify"]}),G=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("FeedText",{className:"feed-text",uiContextName:"feed_text",dependencies:["model","platform","timer"],initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},delete:function(){this.__timer.clearTimeout(this.__scrollbarTimeout)},render:function(){this.model.populated().then(function(){this.$el.html(e.template);var t=this.model.get("payload.background_color");t&&this.$el.css("background-color","#"+t),this.__userText=this.createChildContext(e.UserText,{$parentElement:this.$(".message"),text:this.model.get("payload.message")}),"mobile"!==this.__platform&&(this.__scrollbarTimeout=this.__timer.setTimeout(function(){this.$(".message").scrollbar()}.bind(this),0))}.bind(this))}})}({UiCore:e["@UiCore"],template:W,UserText:q}),j=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s,o=this.escapeExpression;return i=t.helperMissing,o='<span class="count">'+o("function"==typeof(s=t.count||e&&e.count)?s.call(e,{name:"count",hash:{},data:n}):s)+'</span>\n<span class="label-single">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,e&&e.nameSingular,{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+='</span>\n<span class="label-plural">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,e&&e.namePlural,{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+"</span>"},useData:!0})}(),K=function(e){var t=e.UiCore.UiContext;return t.extend("Counter",{className:"counter",uiContextName:"counter",dependencies:["count","name"],initialize:function(e){t.prototype.initialize.call(this,e),this.__count=e.count,this.__name=e.name,this.addToDOM()},render:function(){this.$el.html(e.template({count:e.FormatNumber.formatMini(this.__count),nameSingular:this.__name+"_single",namePlural:this.__name+"_plural"})),this.$el.toggleClass("is-plural",0===this.__count||1<this.__count)},update:function(e){this.__count=e,this.render()}})}({UiCore:e["@UiCore"],template:j,FormatNumber:r}),Y=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='notation no-results'><span>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"post_has_no_tags",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</span></div>"},useData:!0})}(),X=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='name-container'></div>\n<div class='products'></div>\n<div class='actions'>\n    <button class='add-to-cart btn btn-xsmall btn-ghost full-width'>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"add_look_to_cart",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</button>\n    <button class='in-cart btn btn-xsmall btn-ghost full-width' disabled>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"in_cart",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>\n</div>"},useData:!0})}(),J=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<button class="btn ap ap-badge"></button>'},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i="<div class='tile-body'>\n    <img class='tile-image'/>\n    ",((a=t.if.call(e,e&&e.is_ap,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n    <div class='wearing-indicator'></div>\n</div>"},useData:!0})}(),Z=function(e){var t=e.UiCore.UiContext;return t.extend("LightboxProductTile",{className:"tile lightbox-tile product-tile lightbox-product-tile",uiContextName:"lightbox_product_tile",dependencies:["dialogManager","featureAccessManager","imageManager","window"],trackedEvents:function(){return[{type:"click",name:"click_tile",handler:"__onClick"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__imageSize=e.imageSize||140,this.__dressUpAvatarManager=IMVU.optionalProperty(e,"dressUpAvatarManager"),this.__serviceProvider.has("mode")&&(this.__mode=this.__serviceProvider.get("mode")),this.addToDOM()},render:function(){this.model.populated().then(function(){this.$el.addClass("loaded").attr("data-id",this.model.id).html(e.template({is_ap:"GA"!==this.model.get("rating")})),this.__imageManager.load(this.$(".tile-image"),IMVU.URI.build(this.model.get("preview_image"),{width:this.__imageSize,height:this.__imageSize})),this.model.get("is_bundle")&&this.createChildContext(e.BundleCount,{model:this.model,$parentElement:this.$(".tile-body")}),this.__dressUpAvatarManager&&this.__dressUpAvatarManager.populated().then(function(){this.__updateWearingStatus(),this.listenTo(this.__dressUpAvatarManager.getLookModel(),"change",this.__updateWearingStatus.bind(this))}.bind(this))}.bind(this))},__toggleProduct:function(){this.__dressUpAvatarManager.isWearing(this.model.id)?this.__dressUpAvatarManager.remove(this.model.id):this.__dressUpAvatarManager.add(this.model.id)},__updateWearingStatus:function(){this.$el.toggleClass("is-wearing",this.__dressUpAvatarManager.isWearing(this.model.id))},__onClick:function(){if(this.__dressUpAvatarManager)this.__toggleProduct();else if(this.__serviceProvider.has("mode")){var e=this.__mode.getSubmodeUrl(this.__urlId(this.model.id));this.__window.open(e,e)}else this.__dialogManager.showProductLightbox(this.model)}})}({UiCore:e["@UiCore"],BundleCount:p,template:J}),Q=function(e){var t=e.UiCore.ListPresenter;return t.extend("LightboxProductList",{className:"lightbox-tile-list lightbox-product-list",uiContextName:"lightbox_product_list",itemFactory:e.LightboxProductTile,initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()}})}({UiCore:e["@UiCore"],Model:e["@Model"],LightboxProductTile:Z}),ee=function(e){var t=e.UiCore.UiContext;return t.extend("LookTag",{className:"look-tag",uiContextName:"look_tag",dependencies:["dialogManager","loginManager","restModelFactory","tagInfo","Promise"],trackedEvents:function(){return[{type:"click",selector:"button.add-to-cart",name:"add_look_to_cart",handler:"__addLookToCart"}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__cartModel=this.track(this.__myself.getSingleEdge("cart")),this.__user=this.track(this.__restModelFactory.readModel(i.tagInfo.id,e.UiCore.NodeModel)),this.__productCollection=new IMVU.NamedCollection(_.map(i.tagInfo.products,function(t){return this.__restModelFactory.readModel(t,e.Model.ProductNode)}.bind(this))),this.addToDOM()},render:function(){this.__cartModel.populated().then(function(){return this.__cartProducts=this.__cartModel.getEdgeCollection("products",e.Model.CartProductCollection),this.__cartProducts.populated({ignoreBadProducts:!0})}.bind(this)).then(function(){return this.__Promise.every(this.__productCollection.map(function(e){return e.populated().catch(function(){})}.bind(this)))}.bind(this)).then(function(){this.$el.html(e.template),this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".name-container"),user:this.__user,configuration:"small-single-lightbg"}),this.__productCollection.length&&this.createChildContext(e.LightboxProductList,{collection:this.__productCollection,$parentElement:this.$(".products")}),this.__updateCartButton(),this.listenTo(this.__cartProducts,"add remove reset",this.__updateCartButton.bind(this)),this.__productCollection.each(function(e){this.listenTo(e,"change:is_owned",this.__updateCartButton.bind(this))}.bind(this))}.bind(this))},__updateCartButton:function(){this.$(".actions").toggleClass("hidden",0===this.__unownedProducts().length);var e=0<this.__productsToAddToCart().length;this.$(".btn.add-to-cart").toggleClass("hidden",!e),this.$(".btn.in-cart").toggleClass("hidden",e)},__productsToAddToCart:function(){return this.__productCollection.filter(function(e){return!e.get("is_owned")&&!this.__cartProducts.find(function(t){return t.node&&t.node.id===e.id})}.bind(this))},__unownedProducts:function(){return this.__productCollection.filter(function(e){return!e.get("is_owned")})},__addLookToCart:function(){this.__dialogManager.showLightbox("ShoppingCartLightbox",{productsToAdd:this.__productsToAddToCart()})}})}({UiCore:e["@UiCore"],Model:e["@Model"],Widgets:e["@Widgets"],LightboxProductList:Q,template:X}),te=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<button class="btn ap ap-badge"></button>'},3:function(e,t,i,n){var a;i=t.helperMissing;var s='\n        <div class="owned-label">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"IN INVENTORY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n    "},5:function(e,t,i,n){var a;return'\n        <div class="price-credits">'+(0,this.escapeExpression)("function"==typeof(a=t.price||e&&e.price)?a.call(e,{name:"price",hash:{},data:n}):a)+"</div>\n    "},7:function(e,t,i,n){var a;i=t.helperMissing;var s='\n        <div class="cart-button add-to-cart-btn" title="';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Add to Cart",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='">',((a=(t.icon||e&&e.icon||i).call(e,"icon-add-to-cart",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n        <div class="cart-button in-cart-btn" title="',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"In Cart",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='">',((a=(t.icon||e&&e.icon||i).call(e,"icon-in-cart",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=this.escapeExpression;var o='<div class=\'name-container\'></div>\n<div class="tile-body">\n    <img class="tile-image" />\n    ';return((a=t.if.call(e,e&&e.isAp,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+='\n</div>\n<div class="product-info">\n    <div class="product-name">'+i("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:n}):s)+'</div>\n    <div class="price-info">\n    ',((a=t.if.call(e,e&&e.isOwned,{name:"if",hash:{},fn:this.program(3,n),inverse:this.program(5,n),data:n}))||0===a)&&(o+=a),o+="\n    </div>\n    ",((a=t.unless.call(e,e&&e.isOwned,{name:"unless",hash:{},fn:this.program(7,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+"\n</div>\n"},useData:!0})}(),ie=function(e){var t=e.UiCore.UiContext;return t.extend("FeedTagTile",{className:"tile lightbox-tile product-tile feed-tag-tile",uiContextName:"feed_tag_tile",dependencies:"dialogManager imageManager featureAccessManager loginManager Promise restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",name:"click_tile",handler:"__onClick"},{type:"click",selector:".add-to-cart-btn",name:"add_look_to_cart",handler:"__addLookToCart"}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__cartModel=this.track(this.__myself.getSingleEdge("cart")),this.__user=this.track(this.__restModelFactory.readModel(i.tagInfo.id,e.UiCore.NodeModel)),this.__productCollection=new IMVU.NamedCollection(_.map(i.tagInfo.products,function(t){return this.__restModelFactory.readModel(t,e.Model.ProductNode)}.bind(this))),this.__pidListArr=[],this.__isAp=this.__hasAvatar=!1,this.__price=0,this.__isOwned=!0,this.__outfitName="Outfit",this.__maleItemCount=this.__femaleItemCount=0,this.__Promise.every(this.__productCollection.map(function(e){return e.populated().then(function(){this.__pidListArr.push(e.get("product_id")),-1!=e.get("categories").indexOf("Avatars")&&(this.__hasAvatar=!0),"AP"==e.get("rating")&&(this.__isAp=!0),"female"==e.get("gender")?this.__femaleItemCount++:this.__maleItemCount++,e.get("is_owned")||(this.__isOwned=!1,this.__price=this.__myself.get("is_vip")?this.__price+e.get("discount_price"):this.__price+e.get("product_price"))}.bind(this))}.bind(this))).then(function(){this.__hasAvatar||(this.__femaleItemCount>this.__maleItemCount?this.__pidListArr.push("80"):this.__pidListArr.push("191")),this.__pidList=this.__pidListArr.join(","),this.__outfitUrl=this.__serviceProvider.get("root")+"/image_dressup/"+this.__pidList,this.addToDOM()}.bind(this))},render:function(){this.__cartModel.populated().then(function(){return this.__cartProducts=this.__cartModel.getEdgeCollection("products",e.Model.CartProductCollection),this.__cartProducts.populated({ignoreBadProducts:!0})}.bind(this)).then(function(){this.$el.html(e.template({name:this.__outfitName,price:this.__price,isAp:this.__isAp,isOwned:this.__isOwned})),this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".name-container"),user:this.__user,configuration:"small-single-lightbg"}),this.__imageManager.load(this.$(".tile-image"),this.__outfitUrl),this.__updateCartButton(),this.listenTo(this.__cartProducts,"add remove reset",this.__updateCartButton.bind(this)),this.__productCollection.each(function(e){this.listenTo(e,"change:is_owned",this.__updateCartButton.bind(this))}.bind(this))}.bind(this))},__updateCartButton:function(){var e=0<this.__productsToAddToCart().length;this.$el.toggleClass("in-cart",!e)},__onClick:function(){this.__dialogManager.showFeedTagLightbox({user:this.__user,productCollection:this.__productCollection,pidListArr:this.__pidListArr,isAp:this.__isAp})},__addLookToCart:function(){this.__dialogManager.showShoppingCartLightbox({productsToAdd:this.__productsToAddToCart()})},__productsToAddToCart:function(){return this.__productCollection.filter(function(e){return!e.get("is_owned")&&!this.__cartProducts.find(function(t){return t.node&&t.node.id===e.id})}.bind(this))}})}({UiCore:e["@UiCore"],Model:e["@Model"],Widgets:e["@Widgets"],template:te,BundleCount:p}),ne=function(e){var t=e.UiCore.UiContext;return t.extend("TagPanel",{uiContextName:"tag_panel",className:"tag-panel",dependencies:["featureAccessManager","globalStartupModel","globalStringManager","model","restModelFactory"],initialize:function(e){t.prototype.initialize.call(this,e),this.__restModelFactory=e.restModelFactory,this.addToDOM()},render:function(){this.model.populated().then(function(){return this.model.getSingleEdge("photo").populated()}.bind(this)).then(function(e){return e.getSingleEdge("photo_details").populated()}.bind(this)).then(function(t){this.$el.html(e.template),t=t.get("users"),this.__userEndPoint=this.__globalStartupModel.get("userEndpoint"),this.__productEndPoint=this.__globalStartupModel.get("productEndpoint");for(var i=Object.keys(t),n=i.length,a=0;a<n;a++){var s=t[i[a]];this.__restModelFactory.multiGetQueueElement(this.__userEndPoint,s.id),s.products.forEach(function(e){this.__restModelFactory.multiGetQueueElement(this.__productEndPoint,e)}.bind(this))}this.__restModelFactory.multiGetRequest(this.__userEndPoint,e.UiCore.NodeModel),this.__restModelFactory.multiGetReset(this.__userEndPoint),this.__restModelFactory.multiGetRequest(this.__productEndPoint,e.Model.ProductNode),this.__restModelFactory.multiGetReset(this.__productEndPoint),0<(t=_.sortBy(t,function(e){return 0<e.products.length?-1:1})).length?_.each(t,function(t){this.createChildContext(e.FeedTagTile,{tagInfo:t,$parentElement:this.$el})}.bind(this)):this.$el.addClass("has-no-tags")}.bind(this))}})}({UiCore:e["@UiCore"],Model:e["@Model"],FeedTagTile:ie,LookTag:ee,template:Y}),ae=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return"<div class='more hidden'>"+(0,this.escapeExpression)("function"==typeof(a=t.more_comments_text||e&&e.more_comments_text)?a.call(e,{name:"more_comments_text",hash:{},data:n}):a)+"</div>\n<ul class='items'>\n</ul>"},useData:!0})}(),se=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="profile-icon-placeholder"></div>\n<section>\n    <header>\n       <div class="username"></div>\n    </header>\n    <div class="comment-message"></div>\n</section>\n'},useData:!0})}(),oe=function(e){var t=e.UiCore.UiContext;return t.extend("FeedCommentsItem",{uiContextName:"feed_comments_item",tagName:"li",className:"feed-comments-item",dependencies:"feedModel imageManager cardManager conversationHelpers dialogManager featureAccessManager restModelFactory globalNav globalStartupModel globalStringManager contextMenuManager loginManager timestampHelper featureAccessManager".split(" "),trackedEvents:function(){return[{type:"click",selector:".profile-icon",name:"feed_comment_tap_portrait",handler:this.__onClickAuthor},{type:"click",selector:".display-name-text",name:"feed_comment_tap_author",handler:this.__onClickAuthor},{type:"click",selector:".comment-message",name:"feed_comment_tap_message",handler:this.__onClickComment}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__imageManager=e.imageManager,this.__cardManager=e.cardManager,this.__edgeModel=e.model,this.__featureAccessManager=e.featureAccessManager,this.__globalNav=e.globalNav,this.__restModelFactory=e.restModelFactory,this.__conversationHelpers=e.conversationHelpers,this.__dialogManager=e.dialogManager,this.__contextMenuManager=e.contextMenuManager,this.__globalStringManager=e.globalStringManager,this.__startupModel=e.globalStartupModel,this.__reportUrl=this.__startupModel.get("safetyReportUrl"),this.__loginManager=e.loginManager,this.__myself=e.loginManager.getCurrentUser(),this.__timestampHelper=e.timestampHelper,this.__featureAccessManager=e.featureAccessManager,this.addToDOM()},render:function(){this.__edgeModel.populated().then(function(){var t=this.__edgeModel.node;this.__timeSince=this.__timestampHelper.formatTime(t.get("time")),this.$el.html(e.template),this.__userText=this.createChildContext(e.UserText,{$parentElement:this.$(".comment-message"),text:t.get("text")}),this.author=this.__edgeModel.node.getSingleEdge("author"),this.$el.toggleClass("is-me",this.author===this.__myself),this.__profileIcon=this.createChildContext(e.Widgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.author}),this.__displayName=this.createChildContext(e.Widgets.DisplayName,{$replaceElement:this.$(".username"),user:this.author,showVipBadgeTooltip:!0,marginLeft:"medium",size:"small",color:"medium"}),this.$el.attr("data-cid",this.__edgeModel.cid),this.__conversationHelpers.applyMessageBoundaries(this,this.__edgeModel)}.bind(this))},__onClickComment:function(t){if(t.stopPropagation(),this.__loginManager.isLoggedIn()){var i=this.track(this.__feedModel.getSingleEdge("actor")),n=[{name:"timestamp",text:this.__timeSince,classNames:"header"}],a=this.author.get("id")===this.__loginManager.getCurrentUser().id;i=i.get("id")===this.__loginManager.getCurrentUser().id;(a||i)&&n.push({name:"delete",text:"Delete",handler:this.__deleteFeedComment.bind(this)}),a||n.push({name:"report",text:"Report",handler:this.__reportFeedComment.bind(this)}),this.__contextMenuManager.toggleMenu(t,e.ContextMenu,{items:n,displayOptions:{above:!1,right:!0}})}},__reportFeedComment:function(){this.__dialogManager.confirm({title:this.__globalStringManager.get("dialog_feed_report_comment_title"),text:this.__globalStringManager.get("dialog_feed_report_comment_text"),yes:this.__globalStringManager.get("Report"),no:this.__globalStringManager.get("Cancel"),termsOfService:!0}).finished.then(function(){this.__restModelFactory.createModel(this.__reportUrl,e.UiCore.NodeModel,{reason:"comment",relations:{content:this.model.node.id}}).then(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("report_confirm_title"),text:this.__globalStringManager.get("report_confirm_text"),ok:this.__globalStringManager.get("report_confirm_done")})}.bind(this),function(){this.__dialogManager.alert({title:this.__globalStringManager.get("report_error_title"),text:this.__globalStringManager.get("report_error_text"),ok:this.__globalStringManager.get("report_error_done")})}.bind(this))}.bind(this))},__deleteFeedComment:function(){this.__edgeModel.node.destroy()},__onClickAuthor:function(){this.__loginManager.isLoggedIn()&&this.__cardManager.showUserProfileCard({user:this.__edgeModel.node.getSingleEdge("author"),context:"feed"})}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],moment:e["@moment"],ContextMenu:A,UserText:q,template:se}),re=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("FeedComments",{uiContextName:"feed_comments",className:"feed-comments",dependencies:"conversationHelpers globalStartupModel globalStringManager touchEventHelper featureAccessManager rest restModelFactory".split(" "),initialize:function(i){this.__featureAccessManager=i.featureAccessManager,this.itemFactory=i.itemFactory||e.FeedCommentsItem,i.reverse=!0,i.manuallyPage=!0,this.__touchEventHelper=i.touchEventHelper,this.__globalStringManager=i.globalStringManager,t.prototype.initialize.call(this,i),this.__conversationHelpers=i.conversationHelpers,this.__userEndPoint=this.__globalStartupModel.get("userEndpoint"),this.collection.populated().then(function(){for(var t=this.collection.models.length,i=0;i<t;i++)this.__restModelFactory.multiGetQueueElement(this.__userEndPoint,this.collection.models[i].node.relations.author);this.__restModelFactory.multiGetRequest(this.__userEndPoint,e.UiCore.NodeModel),this.__restModelFactory.multiGetReset(this.__userEndPoint),this.__conversationHelpers.refreshAllMessageBoundaries(this)}.bind(this)),this.collection.on("add paged reset",function(){this.collection.populated().then(function(){this.__conversationHelpers.refreshAllMessageBoundaries(this)}.bind(this))}.bind(this))},__toggleTimestamp:function(e){this.$el.toggleClass("show-timestamp",e)},__emptyText:function(){return{standard:this.__globalStringManager.get("no_feed_comments"),concise:this.__globalStringManager.get("no_feed_comments")}}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],FeedCommentsItem:oe}),le=function(e){var t=e.FeedComments;return t.extend("CommentList",{className:"comment-list feed-comments",uiContextName:"comment_list",tagName:"div",dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".more",name:"view_more",handler:"viewMore"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.collection.populated().then(function(){this.__refreshMore(),this.listenTo(this.collection,"add remove reset",this.__refreshMore.bind(this,!0))}.bind(this))},renderTemplate:function(){this.$el.html(e.template({more_comments_text:this.__globalStringManager.get("view_all_comments",{count:this.collection.total_count})})),this.$itemContainer=this.$(".items"),t.prototype.renderTemplate.call(this)},__refreshMore:function(e){this.$(".more").toggleClass("hidden",!this.collection.hasNextPage()),e&&this.$(".more").text(this.__globalStringManager.get("load_more_comments"))},__childrenInDOM:function(){var e=_.map(_.filter(_.values(this.__registry),function(e){return e.$el}),function(e){return e.$el[0]});return this.$itemContainer.children().filter(e)},__emptyText:function(){return{standard:this.__globalStringManager.get("post_has_no_comments"),concise:this.__globalStringManager.get("post_has_no_comments")}}})}({UiCore:e["@UiCore"],FeedComments:re,template:ae}),de=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<img />\n<div class='expanded-photo'>\n    <img />\n</div>\n"},useData:!0})}(),ce=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("FeedPhoto",{className:"feed-photo",uiContextName:"feed_photo",dependencies:["imageManager","model","timer"],initialize:function(e){t.prototype.initialize.call(this,e),this.__photoFadeDelay=e.photoFadeDelay||150,this.addToDOM()},delete:function(){t.prototype.delete.call(this),this.__timer.clearTimeout(this.__fadeTimer)},render:function(){this.$el.addClass("loading").html(e.template),this.__fadeTimer=this.__timer.setTimeout(function(){this.$el.addClass("fade")}.bind(this),this.__photoFadeDelay),this.model.populated().then(function(){return this.$el.css({"max-width":Math.max(this.model.get("payload.width"),this.model.get("payload.height"))+"px"}),this.__imageManager.load(this.$("img"),this.model.get("payload.url"),{})}.bind(this)).then(function(){this.$el.removeClass("loading")}.bind(this)).catch(function(){this.$el.removeClass("loading").addClass("error")}.bind(this))}})}({UiCore:e["@UiCore"],template:de}),he=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="main-container">\r\n    <div class="canvas-container container"><div class="image-container"></div><div class="canvas-footer"></div></div>\r\n    <div class="controls-container container"></div>\r\n</div>\r\n\r\n<script type="text/template" class="post-header-template">\r\n    <a class="back">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Back",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</a>\r\n    <a class="post">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"dialog_photobooth_post",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</a>\r\n<\/script>\r\n\r\n<script type="text/template" class="save-header-template">\r\n    <a class="save">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Save",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</a>\r\n<\/script>"},useData:!0})}(),_e=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("UploadCurtain",{uiContextName:"upload_curtain",className:"upload-curtain",dependencies:["Promise","timer"],initialize:function(e){i.prototype.initialize.call(this,e),this.serviceProvider=e.serviceProvider,this.Promise=e.Promise,this.timer=e.timer,this.__completeDelay=e.completeDelay||1e3,this.addToDOM()},show:function(){this.$el.addClass("loading"),i.prototype.show.call(this)},complete:function(){return this.$el.removeClass("loading"),new this.Promise(function(e){this.__completeTimer=this.timer.setTimeout(function(){e.accept(),this.hide()}.bind(this),this.__completeDelay)}.bind(this))},delete:function(){this.timer.clearTimeout(this.__completeTimer)}})}(),ge=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<div class='overlays'></div>\n<div class='loading-curtain'></div>"},useData:!0})}(),pe=IMVU.BaseClass.extend("BaseComponentCanvasRenderer",{dependencies:["canvasContext","Promise"],initialize:function(e){this.__serviceProvider=e.serviceProvider,this.__canvasContext=e.canvasContext,this.__canvasSize=[e.canvasContext.canvas.width,e.canvasContext.canvas.height],this.__imageFactory=e.imageFactory||function(){return new Image},this.__Promise=e.Promise},__loadImage:function(e,t){var i=!t;return t=t||e,new this.__Promise(function(n){if(this.__image&&t===this.__currentImageUrl)return n.accept();this.__image&&(this.__image.src="",$(this.__image).off(),delete this.__image),this.__image=this.__imageFactory(),$(this.__image).on("load",function(){$(this.__image).off(),n.accept()}.bind(this)).on("error",function(){$(this.__image).off(),this.__currentImageUrl=null,n.reject()}.bind(this)),i&&(this.__image.crossOrigin="anonymous"),this.__image.src=e,this.__currentImageUrl=t}.bind(this))},render:function(e){},delete:function(){this.__image&&($(this.__image).off(),delete this.__image)}}),ue=function(e){var t={BaseComponentCanvasRenderer:pe}.BaseComponentCanvasRenderer;return t.extend("BackgroundCanvasRenderer",{initialize:function(e){t.prototype.initialize.call(this,e),this.__canvasFactory=e.canvasFactory||function(){return document.createElement("canvas")},this.__squashCache={}},__getSquashRatio:function(e){if(this.__squashCache[e])return this.__squashCache[e];var t=this.__image.naturalHeight;(i=this.__canvasFactory()).width=1,i.height=t,(i=i.getContext("2d")).drawImage(this.__image,0,0);for(var i=i.getImageData(0,0,1,t).data,n=1,a=t;0<a;a--)if(0!==i[4*(a-1)+3]){n=a/t;break}return this.__squashCache[e]=n},__isCustomBackground:function(e){return"data:"===e.imageUrl.substring(0,5)},render:function(e){if(!e.imageUrl)return this.__Promise.accept();var t=this.__isCustomBackground(e),i=t?e.customBackgroundToken:null;return this.__loadImage(e.imageUrl,i).then(function(){if(t){var n=0,a=0,s=this.__canvasSize[0];if(this.__image.width<this.__image.height?(s=this.__image.width,a=Math.floor((this.__image.height-s)/2)):(s=this.__image.height,n=Math.floor((this.__image.width-s)/2)),e.rotation){this.__canvasContext.save();var o=Math.floor(this.__canvasSize[0]/2);this.__canvasContext.translate(o,o),this.__canvasContext.rotate(e.rotation*Math.PI/180),this.__canvasContext.translate(-o,-o)}o=this.__getSquashRatio(i),this.__canvasContext.drawImage(this.__image,n,a,s,s,0,0,this.__canvasSize[0],this.__canvasSize[1]/o),e.rotation&&this.__canvasContext.restore()}else this.__canvasContext.drawImage(this.__image,0,0,this.__canvasSize[0],this.__canvasSize[1])}.bind(this))}})}(),me=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<div class='drag-area'></div>\n<div class='zoom-buttons'>\n    <div class='zoom in'></div>\n    <div class='zoom out'></div>\n</div>\n<div class=\"mode-indicator-icon\"><i class=\"pose-mode\" /></div>\n"},useData:!0})}(),fe=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("DraggableOverlay",{trackedEvents:function(){return[{type:"mousedown",selector:".drag-area",name:"start_drag",handler:this.__handleDown},{type:"touchstart",selector:".drag-area",name:"start_drag",handler:this.__handleDown},{type:"mousemove",selector:".drag-area",name:"drag",handler:this.__handleMove,attributes:{repeats:1}},{type:"touchmove",selector:".drag-area",name:"drag",handler:this.__handleMove,attributes:{repeats:1}},{type:"mouseup",selector:".drag-area",name:"stop_drag",handler:this.__handleUp},{type:"touchend",selector:".drag-area",name:"stop_drag",handler:this.__handleUp},{type:"mouseout",selector:".drag-area",name:"stop_drag",handler:this.__handleUp}]},initialize:function(e){i.prototype.initialize.call(this,e),this.__temporarilyDisabledFilter=this.__dragging=!1},__pixelCoords:function(e){e=e.originalEvent.changedTouches?e.originalEvent.changedTouches[0]:e;var t=this.$el.offset();return[e.pageX-t.left,e.pageY-t.top]},__handleDown:function(e){e.preventDefault(),e.stopPropagation(),this.__dragging||(this.__dragging=!0,this.__$elSize=[this.$el.width(),this.$el.height()],this.__canvasModel.getLayerAttr("filter","disabled")||(this.__temporarilyDisabledFilter=!0,this.__canvasModel.setLayerAttrs("filter",{disabled:!0})),this.__startDrag(e))},__handleUp:function(e){e.stopPropagation(),this.__dragging&&(this.__dragging=!1,this.__temporarilyDisabledFilter&&(this.__temporarilyDisabledFilter=!1,this.__canvasModel.setLayerAttrs("filter",{disabled:!1})),this.__stopDrag(e))},__handleMove:function(e){e.preventDefault(),e.stopPropagation(),this.__dragging&&(this.__outOfBounds(this.__pixelCoords(e))?(this.__dragging=!1,this.__temporarilyDisabledFilter&&(this.__temporarilyDisabledFilter=!1,this.__canvasModel.setLayerAttrs("filter",{disabled:!1})),this.__stopDrag(e)):this.__drag(e))},__outOfBounds:function(e){return _.any(e,function(t,i){return 0>e[i]||e[i]>this.__$elSize[i]}.bind(this))},reset:function(){}})}(),ve=function(e){var t=function(e,t,i){return Math.max(t,Math.min(i,e))},i=e.DraggableOverlay;return i.extend("AvatarOverlay",{uiContextName:"avatar_overlay",className:"avatar-overlay",dependencies:["canvasModel"],DRAG_LIMITS:{x:.06,y:.375},trackedEvents:function(){return i.prototype.trackedEvents.call(this).concat([{type:"click",selector:".zoom.in",name:"zoom_in",handler:this.__zoomIn},{type:"click",selector:".zoom.out",name:"zoom_in",handler:this.__zoomOut}])},initialize:function(e){i.prototype.initialize.call(this,e),this.__canvasModel=e.canvasModel,this.__dragLimits=e.dragLimits||this.DRAG_LIMITS,this.addToDOM(),this.__refreshZoomButtons()},__startDrag:function(e){this.__lastCoords=this.__pixelCoords(e)},__stopDrag:function(e){},__drag:function(e){e=this.__pixelCoords(e);var t=Math.round(e[0]-this.__lastCoords[0]),i=Math.round(e[1]-this.__lastCoords[1]);(t||i)&&this.__setPosition(this.__canvasModel.getLayerAttr("avatar","xPosition")+t/this.__$elSize[0],this.__canvasModel.getLayerAttr("avatar","yPosition")+i/this.__$elSize[1]),this.__lastCoords=e},__setPosition:function(e,i){var n=this.__canvasModel.getLayerAttr("avatar","scales"),a=this.__canvasModel.getLayerAttr("avatar","scaleIndex"),s=this.__dragLimits.x*n[a];n=this.__dragLimits.y*n[a];this.__canvasModel.setLayerAttrs("avatar",{xPosition:t(e,0-s,1+s),yPosition:t(i,0-n,1+n)})},__setZoom:function(e){this.__canvasModel.setLayerAttrs("avatar",{scaleIndex:t(e,0,this.__canvasModel.getLayerAttr("avatar","scales").length-1)}),this.__setPosition(this.__canvasModel.getLayerAttr("avatar","xPosition"),this.__canvasModel.getLayerAttr("avatar","yPosition")),this.__refreshZoomButtons()},__zoomIn:function(e){this.__setZoom(this.__canvasModel.getLayerAttr("avatar","scaleIndex")+1)},__zoomOut:function(e){this.__setZoom(this.__canvasModel.getLayerAttr("avatar","scaleIndex")-1)},__refreshZoomButtons:function(){var e=this.__canvasModel.getLayerAttr("avatar","scales"),t=this.__canvasModel.getLayerAttr("avatar","scaleIndex");e&&(this.$(".zoom.in").toggleClass("disabled",t===e.length-1),this.$(".zoom.out").toggleClass("disabled",0===t))},render:function(){this.$el.html(e.template)},reset:function(){this.__canvasModel.setLayerAttrs("avatar",{xPosition:this.__canvasModel.defaults.layers.avatar.xPosition,yPosition:this.__canvasModel.defaults.layers.avatar.xPosition,scaleIndex:this.__canvasModel.defaults.layers.avatar.scaleIndex}),this.__refreshZoomButtons()}})}({UiCore:e["@UiCore"],template:me,DraggableOverlay:fe}),be=function(t){var i={Caman:e["@Caman"],BaseComponentCanvasRenderer:pe}.BaseComponentCanvasRenderer;return i.extend("FilterCanvasRenderer",{initialize:function(e){this.Caman=e.Caman||Caman,i.prototype.initialize.call(this,e)},render:function(e){return new this.__Promise(function(t){if(!e.filterId)return t.accept();var i="#"+this.__canvasContext.canvas.id;switch(e.filterId){case 1:this.Caman(i,function(){this.reloadCanvasData(),this.greyscale().render(function(){return t.accept()})});break;case 2:this.Caman(i,function(){this.reloadCanvasData(),this.saturation(100).vibrance(-100).contrast(-10).sepia(60).vignette("30%",30).render(function(){return t.accept()})});break;case 3:this.Caman(i,function(){this.reloadCanvasData(),this.hue(25).render(function(){return t.accept()})});break;case 4:this.Caman(i,function(){this.reloadCanvasData(),this.noise(60).stackBlur(2).render(function(){return t.accept()})});break;case 5:this.Caman(i,function(){this.reloadCanvasData(),this.posterize(8).render(function(){return t.accept()})});break;case 6:this.Caman(i,function(){this.reloadCanvasData(),this.vintage(!0).render(function(){return t.accept()})});break;case 7:this.Caman(i,function(){this.reloadCanvasData(),this.lomo(!0).render(function(){return t.accept()})});break;case 8:this.Caman(i,function(){this.reloadCanvasData(),this.sinCity().render(function(){return t.accept()})});break;case 9:this.Caman(i,function(){this.reloadCanvasData(),this.vignette("40%",60).render(function(){return t.accept()})});break;case 10:this.Caman(i,function(){this.reloadCanvasData(),this.clip(25).contrast(9).exposure(27).render(function(){return t.accept()})});break;case 11:this.Caman(i,function(){this.reloadCanvasData(),this.exposure(19).vibrance(55).sharpen(95).clip(47).render(function(){return t.accept()})});break;case 12:this.Caman(i,function(){this.reloadCanvasData(),this.saturation(-50).contrast(40).posterize(6).render(function(){return t.accept()})});break;case 13:this.Caman(i,function(){this.reloadCanvasData(),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.greyscale(),this.filter.posterize(2)}),this.render(function(){return t.accept()})});break;case 14:this.Caman(i,function(){this.reloadCanvasData(),this.brightness(10),this.saturation(45),this.contrast(15),this.noise(50),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(100),this.copyParent(),this.filter.brightness(10),this.filter.contrast(15),this.filter.greyscale(),this.filter.posterize(2)}),this.stackBlur(1),this.render(function(){return t.accept()})});break;case 15:this.Caman(i,function(){this.reloadCanvasData(),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(100),this.copyParent(),this.filter.hue(25),this.filter.vignette("30%",80)}),this.render(function(){return t.accept()})});break;case 16:this.Caman(i,function(){this.reloadCanvasData(),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(100),this.copyParent(),this.filter.greyscale(),this.filter.vignette("40%",60)}),this.render(function(){return t.accept()})});break;case 17:this.Caman(i,function(){this.reloadCanvasData(),this.sharpen(100),this.render(function(){return t.accept()})});break;default:return t.accept()}}.bind(this))}})}(),Ce=function(e){var t=e.DraggableOverlay;return t.extend("PaintOverlay",{uiContextName:"paint_overlay",className:"paint-overlay",dependencies:["canvasModel","timer"],trackedEvents:function(){return t.prototype.trackedEvents.call(this).concat([{type:"click",selector:".undo",name:"undo",handler:this.__undo},{type:"click",selector:".clear",name:"clear",handler:this.__clear}])},initialize:function(e){t.prototype.initialize.call(this,e),this.__canvasModel=e.canvasModel,this.__restartThreshold=e.restartThreshold||300,this.timer=e.timer,this.addToDOM()},__coords:function(e){return{x:(e=this.__pixelCoords(e))[0]/this.__$elSize[0],y:e[1]/this.__$elSize[1]}},__startDrag:function(e){this.__canvasModel.recordPaintCommand("brush_start",this.__coords(e)),this.__canvasModel.setLayerAttrs("paint",{canvasChokehold:1})},__stopDrag:function(e){this.timer.clearTimeout(this.restartBrushTimeout),this.__canvasModel.recordPaintCommand("brush_stop",this.__coords(e)),this.__canvasModel.setLayerAttrs("paint",{canvasChokehold:0})},__drag:function(e){var t=this.__coords(e);this.timer.clearTimeout(this.restartBrushTimeout),this.__canvasModel.recordPaintCommand("brush_move",t),e=function(){this.__canvasModel.recordPaintCommand("brush_restart",t)}.bind(this,t),this.restartBrushTimeout=this.timer.setTimeout(e,this.__restartThreshold)},__findLastBrushstroke:function(){for(var e=this.__canvasModel.getLayerAttr("paint","commands"),t=null,i=e.length-1;0<=i;i--)if("brush_stop"===e[i].name&&null===t)t=i;else if("brush_start"===e[i].name)return[i,t]},__undo:function(){var e=this.__findLastBrushstroke();if(e){var t=this.__canvasModel.getLayerAttr("paint","commands");t.splice(e[0],1+e[1]-e[0]),this.__canvasModel.setLayerAttrs("paint",{commands:t}),this.__canvasModel.trigger("change")}},__clear:function(){for(var e=["set_color","set_width"],t=[],i=this.__canvasModel.getLayerAttr("paint","commands"),n=i.length-1;0<=n;n--){var a=i[n],s=e.indexOf(a.name);if(0<=s&&(t.unshift(a),e.splice(s,1),0===e.length))break}this.__canvasModel.setLayerAttrs("paint",{commands:t}),this.__canvasModel.trigger("change")},render:function(){this.$el.html(e.template)},reset:function(){this.__clear()},delete:function(){this.timer.clearTimeout(this.restartBrushTimeout),t.prototype.delete.call(this)}})}({template:function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<div class='drag-area'></div>\n<div class='edit-buttons'>\n    <div class='undo'></div>\n    <div class='clear'></div>\n</div>\n<div class=\"mode-indicator-icon\"><i class=\"scribble-mode\" /></div>\n"},useData:!0})}(),DraggableOverlay:fe}),ye=function(t){var i={UiCore:e["@UiCore"],BaseComponentCanvasRenderer:pe}.BaseComponentCanvasRenderer;return i.extend("PaintCanvasRenderer",{initialize:function(e){i.prototype.initialize.call(this,e),this.__canvasContext.lineCap="round",this.__canvasContext.lineJoin="round",this.__paintedThru=0},incrementalRender:function(e){return this.__paint(e),this.__Promise.accept()},render:function(e){return this.__paintedThru=0,this.__paint(e),this.__Promise.accept()},__paint:function(e){for(var t=this.__paintedThru;t<e.commands.length;t++){var i=e.commands[t];this._commandHandlers[i.name].call(this,i.data,i.timestamp),this.__paintedThru=t+1}},__translateCoords:function(e){return{x:e.x*this.__canvasSize[0],y:e.y*this.__canvasSize[1]}},_commandHandlers:{set_width:function(e,t){this.width=e.width,this.__canvasContext.lineWidth=this.width},set_color:function(e,t){this.color=e.color,this.__canvasContext.fillStyle=this.color,this.__canvasContext.strokeStyle=this.color},brush_restart:function(e,t){this._commandHandlers.brush_stop.call(this,e,t),this._commandHandlers.brush_start.call(this,e,t)},brush_start:function(e,t){e=this.__translateCoords(e),this.__canvasContext.beginPath(),this.__canvasContext.arc(e.x,e.y,this.width/2,0,2*Math.PI,!1),this.__canvasContext.fill(),this.__canvasContext.beginPath(),this.__canvasContext.moveTo(e.x,e.y),this.lastPoint=this.lastAvgPoint=e,this.lastTime=t,this.__canvasContext.lineWidth=this.width,this.points=[e],this.avgPoints=[],this.velocities=[0,0,0,0,0]},brush_move:function(e,t){if(e=this.__translateCoords(e),null!==this.points){var i=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},n=function(e,n){var a=i(e,n),s=t-this.lastTime;return 0===s&&(s=1),a/s}.bind(this),a=function(e,i){var n=this.width;55>i?n=this.width:155>i?n=1.5*this.width:355>i&&(n=2*this.width),.5>Math.abs(this.__canvasContext.lineWidth-n)?this.__canvasContext.lineWidth=n:this.__canvasContext.lineWidth=0<this.__canvasContext.lineWidth-n?this.__canvasContext.lineWidth-.6:this.__canvasContext.lineWidth+.5,n={x:(this.lastPoint.x+e.x)/2,y:(this.lastPoint.y+e.y)/2},this.avgPoints.push(n),this.__canvasContext.quadraticCurveTo(this.lastPoint.x,this.lastPoint.y,n.x,n.y),this.__canvasContext.stroke(),this.__canvasContext.beginPath(),this.__canvasContext.moveTo(n.x,n.y),this.lastAvgPoint=n,this.lastPoint=e,this.lastTime=t}.bind(this);4>i(e,this.lastPoint)||(this.velocities.shift(),this.velocities.push(n(e,this.lastPoint)),n=_.reduce(this.velocities,function(e,t){return e+t},0),a(e,n/=this.velocities.length),this.points.push(e))}},brush_stop:function(e,t){e=this.__translateCoords(e),null!==this.points&&(this.__canvasContext.lineTo(e.x,e.y),this.__canvasContext.stroke(),this.points=null)}}})}(),Me=function(e){var t=e.BaseComponentCanvasRenderer;return t.extend("AvatarCanvasRenderer",{AVATAR_IMAGE_SIZE:{width:1024,height:1024},dependencies:["restModelFactory"],initialize:function(e){t.prototype.initialize.call(this,e),this.restModelFactory=e.restModelFactory,this.__desiredImageSize=e.desiredImageSize||this.AVATAR_IMAGE_SIZE},__annotateRenderedImageUrl:function(e){return IMVU.URI.build(e.renderedImageUrl,{width:this.__desiredImageSize.width,height:this.__desiredImageSize.height,view:e.poseView||"",no_redirect:1,look:e.lookUrl})},__drawImageOnCanvas:function(e){var t=e.scales[e.scaleIndex],i=this.__image.width*t/this.__desiredImageSize.width;t=this.__image.height*t/this.__desiredImageSize.height;this.__canvasContext.drawImage(this.__image,e.xPosition*this.__canvasSize[0]-i/2,e.yPosition*this.__canvasSize[1]-t/2,i,t)},render:function(t){if(!t.renderedImageUrl)return this.__Promise.accept();var i=this.restModelFactory.readModel(this.__annotateRenderedImageUrl(t),e.UiCore.NodeModel);return i.populated().then(function(){return this.__loadImage(i.get("ssr_url"))}.bind(this)).then(function(){this.__drawImageOnCanvas(t)}.bind(this))}})}({UiCore:e["@UiCore"],BaseComponentCanvasRenderer:pe}),ke=function(e){var t=e.UiCore.UiContext;return t.extend("CanvasPresenter",{uiContextName:"canvas_presenter",className:"canvas-presenter",OUTPUT_IMAGE_SIZE:1024,CANVAS_ID:"photo-booth-canvas",dependencies:["Promise","canvasModel","timer"],initialize:function(i){t.prototype.initialize.call(this,i),this.__serviceProvider=i.serviceProvider,this.__Promise=i.Promise,this.__canvasModel=i.canvasModel,this.__ready=this.__refreshQueued=!1,this.__chokeholdLayer=null,this.__timer=i.timer,this.addToDOM(),this.__rendererFactories=i.rendererFactories||{background:e.BackgroundCanvasRenderer,avatar:e.AvatarCanvasRenderer,filter:e.FilterCanvasRenderer,paint:e.PaintCanvasRenderer},this.__renderers={},_.each(this.__rendererFactories,function(e,t){this.__renderers[t]=this.__serviceProvider.create(e,{canvasContext:this.__canvasContext})}.bind(this)),this.__refresh(),this.__canvasModel.on("change",this.__refresh,this)},render:function(){this.$el.addClass("loading"),this.$el.html(e.template),this.__createOverlays(),this.setOverlay("avatar"),this.__$canvas=$('<canvas id="'+this.CANVAS_ID+'" width="'+this.OUTPUT_IMAGE_SIZE+'" height="'+this.OUTPUT_IMAGE_SIZE+'" data-caman-hidpi-disabled="true"></canvas>'),this.__canvasContext=this.__$canvas.get(0).getContext("2d"),this.$el.append(this.__$canvas)},setOverlay:function(e){_.each(this.__overlays,function(t,i){t.$el.toggle(i===e)})},__createOverlays:function(){this.__overlays={},_.each({avatar:e.AvatarOverlay,paint:e.PaintOverlay},function(e,t){this.__overlays[t]=this.createChildContext(e,{$parentElement:this.$(".overlays"),canvasModel:this.__canvasModel})}.bind(this))},__clear:function(){this.__canvasContext.fillStyle="white",this.__canvasContext.fillRect(0,0,this.OUTPUT_IMAGE_SIZE,this.OUTPUT_IMAGE_SIZE)},ready:function(){return!!this.__ready||(_.every(["renderedImageUrl","poseView"],function(e){return this.__canvasModel.getLayerAttr("avatar",e)}.bind(this))&&(this.__ready=!0,this.$el.removeClass("loading")),this.__ready)},__refresh:function(){if(this.ready())if(this.__refreshing)this.__refreshQueued=!0;else{this.__refreshing=!0;var e,t=[];if(_.each(this.__canvasModel.get("layers"),function(e){t[e.zIndex]=e}.bind(this)),this.trigger("postable",!1),this.$el.addClass("refreshing"),null!==this.__chokeholdLayer&&t[this.__chokeholdLayer].canvasChokehold){var i=t[this.__chokeholdLayer];e=this.__renderers[i.type].incrementalRender(i)}else this.__clear(),this.__chokeholdLayer=null,e=this.__Promise.accept(),_.each(t,function(t,i){if(null===this.__chokeholdLayer){var n=this.__renderers[t.type];if(n&&!t.disabled){var a=function(){return n.render(t)};e=e.then(a,a)}t.canvasChokehold&&(this.__chokeholdLayer=i)}}.bind(this));e.then(this.__finishRefresh.bind(this),this.__finishRefresh.bind(this))}},__finishRefresh:function(){this.__refreshing=!1,this.$el.removeClass("refreshing"),this.__refreshQueued?(this.__refreshQueued=!1,this.__refresh()):this.trigger("postable",!0)},showIndicatorIcon:function(){this.$(".mode-indicator-icon").addClass("show"),this.__timer.clearTimeout(this.__indicatorIconTimerId),this.__indicatorIconTimerId=this.__timer.setTimeout(function(){this.$(".mode-indicator-icon").removeClass("show")}.bind(this),100)},toDataUrl:function(){return this.__$canvas.get(0).toDataURL("image/jpeg")},reset:function(){_.each(this.__overlays,function(e){e.reset()})},delete:function(){_.each(this.__renderers,function(e){e.delete()}),this.__timer.clearTimeout(this.__indicatorIconTimerId),t.prototype.delete.call(this)}})}({UiCore:e["@UiCore"],template:ge,AvatarCanvasRenderer:Me,BackgroundCanvasRenderer:ue,FilterCanvasRenderer:be,PaintCanvasRenderer:ye,AvatarOverlay:ve,PaintOverlay:Ce}),xe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="component-options">\n    <div class="component-option">\n\t<textarea tabindex="1" class="input-caption" maxlength="280" placeholder="Say something..." autofocus></textarea>\n    </div>\n</div>\n'},useData:!0})}(),we=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="simple-scroller-viewport"></div>\n<button class="btn btn-tertiary simple-scroller-right" disabled></button>\n<button class="btn btn-tertiary simple-scroller-left" disabled></button>'},useData:!0})}(),Pe=function(e){var t=0,i=e.UiCore.UiContext;return e.UiCore.UiContext.extend("SimpleScroller",{className:"simple-scroller disable-text-selection",uiContextName:"simple_scroller",keepGoingThreshold:50,dependencies:["$target","window","timer"],initialize:function(n){i.prototype.initialize.call(this,n),this.__instanceNumber=t++,this.__absoluteScrollBy=n.scrollBy||!1,this.__window=n.window,this.__autoRefresh=!!n.autoRefresh,this.__timer=n.timer,this.__$target=n.$target,this.__$target.parent(".simple-scroller-viewport").length||(this.template=n.template||e.template,this.addToDOM(),this._refreshScrollabilityCount=0,this.$(".simple-scroller-viewport").on("scroll.simple-scroller",this.refreshScrollability.bind(this)),this.$(".simple-scroller-left").on("click",this.scrollLeft.bind(this)),this.$(".simple-scroller-right").on("click",this.scrollRight.bind(this)),$(this.__window).on(this.__getEventNamespaceForThisInstance("resize"),this.refreshScrollability.bind(this)))},__getEventNamespaceForThisInstance:function(e){return e+".ss-"+this.__instanceNumber},delete:function(){$(this.__window).off(this.__getEventNamespaceForThisInstance("resize")),this.$(".simple-scroller-viewport").off(".simple-scroller"),this.__refreshTimer&&this.__timer.clearInterval(this.__refreshTimer),i.prototype.delete.call(this)},render:function(){this.$el.html(this.template),this.$(".simple-scroller-viewport").append(this.__$target),this.__$target.addClass("simple-scroller-target"),this.refreshScrollability(),this.__autoRefresh&&(this.__refreshTimer=this.__timer.setInterval(function(){this.$el.is(":visible")&&this.refreshScrollability()}.bind(this),300))},viewportWidth:function(){return this.$(".simple-scroller-viewport").outerWidth()},leftEdge:function(){return this.$(".simple-scroller-viewport").scrollLeft()},rightEdge:function(){return this.scrollWidth()-this.viewportWidth()-1},scrollWidth:function(){return this.$(".simple-scroller-viewport")[0].scrollWidth},scrollBy:function(){return this.__absoluteScrollBy||this.viewportWidth()/2},refreshLeftScrollability:function(){this.$(".simple-scroller-left").prop("disabled",0>=this.leftEdge())},refreshRightScrollability:function(){this.$(".simple-scroller-right").prop("disabled",this.leftEdge()>=this.rightEdge())},refreshScrollability:function(){this._refreshScrollabilityCount++,this.refreshLeftScrollability(),this.refreshRightScrollability()},scroll:function(e){this.$(".simple-scroller-viewport").animate({scrollLeft:"+="+e},150,this.refreshScrollability.bind(this))},scrollLeft:function(e){e=this.scrollBy(),this.leftEdge()-e<this.keepGoingThreshold&&(e*=2),this.scroll(-e)},scrollRight:function(e){e=this.scrollBy(),this.leftEdge()+e>this.rightEdge()-this.keepGoingThreshold&&(e*=2),this.scroll(e)},resetPosition:function(){this.$(".simple-scroller-viewport").scrollLeft(0),this.refreshScrollability()}})}({UiCore:e["@UiCore"],template:we}),$e=function(e){var t=e.BaseControlsPresenter;return t.extend("CaptionControlsPresenter",{uiContextName:"caption_controls_presenter",className:"caption-controls-presenter control-presenter",dependencies:[],initialize:function(e){t.prototype.initialize.call(this,e),this.__canvasPresenter=e.canvasPresenter,this.addToDOM()},render:function(){this.$el.html(e.template),e.NextUtil.DomHelper.enhanceTextarea(this.$(".input-caption"),280)}})}({BaseControlsPresenter:function(e){var t=e.UiCore.UiContext;return t.extend("BaseControlsPresenter",{activate:function(){this.show(),this.__scroller.refreshScrollability()},addToDOM:function(){t.prototype.addToDOM.call(this),this.__scroller=this.createChildContext(e.SimpleScroller,{$parentElement:this.$el,scrollBy:380,$target:this.$("ul")})},deactivate:function(){this.hide()},reset:function(){}})}({UiCore:e["@UiCore"],SimpleScroller:Pe}),NextUtil:e["@NextUtil"],template:xe}),Se=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PhotoBoothCaptionDialog",{uiContextName:"photo_booth_caption_dialog",className:"photo-booth-caption-dialog dialog-type-B-flexible is-tall",dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:this.__post},{type:"click",selector:".save",name:"save",handler:this.__save},{type:"click",selector:".back",name:"back",handler:this.__back}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__mode=e.mode||"add",this.__stringManager=e.globalStringManager,this.title="edit"===this.__mode?this.__stringManager.get("dialog_photobooth_edit_title"):this.__stringManager.get("dialog_photobooth_caption_title"),this.__postCompleteDelay=e.postCompleteDelay||1e3,"edit"===this.__mode?this.model=e.model:this.__photoBooth=e.photoBooth,this.addToDOM()},postRender:function(){this.$(".dialog-body").html(e.template({})),"edit"===this.__mode?this.__postRenderEdit():this.__postRenderAdd()},__postRenderAdd:function(){this.__uploadCurtain=this.createChildContext(e.UploadCurtain,{$parentElement:this.$el,completeDelay:this.__postCompleteDelay}),this.$(".image-container").css("background-image","url("+this.__photoBooth.getImageUrl()+")"),this.createChildContext(e.CaptionControlsPresenter,{$parentElement:this.$(".controls-container")}),this.__photoBooth.on("exit",this.__photoBoothExit,this),this.__photoBooth.on("canPost",this.setPostStatus,this),this.setContent("auxHeader",this.$(".post-header-template").text())},__postRenderEdit:function(){this.createChildContext(e.FeedPhoto,_.extend({$parentElement:this.$(".canvas-container")},{model:this.model})),this.createChildContext(e.CaptionControlsPresenter,{$parentElement:this.$(".controls-container")}),this.$(".image-container").css("display","none"),this.$(".input-caption").val(this.model.get("payload.message")),this.$(".input-caption").trigger("refresh"),this.setContent("auxHeader",this.$(".save-header-template").text())},__post:function(){this.__uploadCurtain.show(),this.__photoBooth.post(this.$(".input-caption").val())},__photoBoothExit:function(){this.__uploadCurtain.hide(),this.promiseResolver.accept(),this.hide()},setPostStatus:function(e){this.$(".back").toggleClass("disabled",!e),this.$(".post").toggleClass("disabled",!e)},__save:function(){var e={payload:{id:this.model.relations.photo,message:this.$(".input-caption").val()},type:"photo"};this.model.save(e),this.hide()},__back:function(){this.hide()},delete:function(){t.prototype.delete.call(this)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:he,CanvasPresenter:ke,CaptionControlsPresenter:$e,FeedPhoto:ce,UploadCurtain:_e}),Ue=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="counts-container">\n    <a class="action-like-count">\n        <span class="count count-likes">0</span> Likes &#183;&nbsp;\n    </a>\n        <a class="action-comment-count">\n            <span class="count count-comments">0</span> Comments &#183;&nbsp;\n        </a>\n    <a class="action-tag-count">\n        <span class="count count-tags">0</span> Tags\n    </a>\n</div>\n<div class="actions-container bar">\n    <li class="action-more-container">\n        <button class="btn action-more">\n            ';return((a=(t.icon||e&&e.icon||i).call(e,"icon-more",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+='\n        </button>\n    </li>\n    <li class="action-like-container">\n        <a class="btn action-like">\n        <svg class="icon-like"><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-like-off"></svg>\n        <svg class="icon-liked"><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-like-on"></svg>\n        </a>\n    </li>\n    <li class="action-comment-container">\n        <a class="btn action-comment">\n            ',((a=(t.icon||e&&e.icon||i).call(e,"icon-comment-off",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+='\n        </a>\n    </li>\n    <li class="action-tag-container">\n        <a class="btn action-tag">\n            ',((a=(t.icon||e&&e.icon||i).call(e,"icon-tag",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+'\n        </a>\n    </li>\n    <li class="action-share-container">\n    </li> \n</div>'},useData:!0})}(),Te=function(e){var t=e.Dialogs.AlloyAlertDialog;return t.extend("ReportUserDialog",{uiContextName:"report_dialog",className:"report-dialog",dependencies:["dialogManager","globalStartupModel","globalStringManager","Promise","restModelFactory"],initialize:function(e){this.__model=e.model,this.__dialogManager=e.dialogManager,this.__restModelFactory=e.restModelFactory,this.__startupModel=e.globalStartupModel,this.__stringManager=e.globalStringManager,this.__promise=e.Promise,this.__safetyReportUrl=this.__startupModel.get("safetyReportUrl"),e=_.extend({title:this.__stringManager.get(this.title),text:this.__stringManager.get(this.text),ok:this.__stringManager.get("report_ok_button"),termsOfService:!0,dropdown:{placeholder:this.__stringManager.get("report_reason_placeholder"),options:_.map(this.dropdownOptions,function(e){return{label:this.__stringManager.get(e.label),value:e.value}}.bind(this))}},e),t.prototype.initialize.call(this,e)},__onConfirm:function(){var t=this.getResult();this.__restModelFactory.createModel(this.__safetyReportUrl,e.UiCore.NodeModel,{reason:t.dropdown,relations:{content:this.__model.id}}).then(this.__confirmDialog.bind(this)).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this)).catch(function(e){this.__errorDialog(e).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this))}.bind(this))},hide:function(){this.reasonDropDown.__hide(),t.prototype.hide.call(this)},__confirmDialog:function(){return new this.__promise(function(e){var t=this.__dialogManager.alert({title:this.__stringManager.get("report_confirm_title"),text:this.__stringManager.get("report_confirm_text"),ok:this.__stringManager.get("report_confirm_done")}).finished;t.then(function(){e.resolve()}),t.catch(function(){e.resolve()})}.bind(this))},__errorDialog:function(e){return new this.__promise(function(e){var t=this.__dialogManager.alert({title:this.__stringManager.get("report_error_title"),text:this.__stringManager.get("report_error_text"),ok:this.__stringManager.get("report_error_done")}).finished;t.then(function(){e.resolve()}),t.catch(function(){e.resolve()})}.bind(this))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"]}),De=function(t){var i={UiCore:e["@UiCore"],SafetyReportDialog:Te}.SafetyReportDialog;return i.extend("ReportFeedItemDialog",{uiContextName:"report_feed_item_dialog",className:"report-feed-item-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager"],title:"report_post_title",text:"report_post_text",dropdownOptions:[],initialize:function(e){this.__model=e.model,this.dropdownOptions=[],"photo"===this.__model.get("type")?(this.dropdownOptions.push({label:"report_post_reason_inappropriate_image",value:"photo"}),this.__model.get("payload.message")&&this.dropdownOptions.push({label:"report_post_reason_inappropriate_caption",value:"caption"})):this.dropdownOptions.push({label:"report_post_reason_inappropriate_text",value:"text"}),i.prototype.initialize.call(this,e)}})}(),Le=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PhotoBoothDialog",{uiContextName:"photo_booth_dialog",className:"photo-booth-dialog dialog-type-B-flexible is-tall",dependencies:["dialogManager","featureAccessManager","globalStringManager","modeManager"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:this.__post},{type:"click",selector:".next",name:"next",handler:this.__openCaptionDialog}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__stringManager=e.globalStringManager,this.title=e.title||this.__stringManager.get("dialog_photobooth_title"),this.__modeManager=e.modeManager,this.__overrideLookUrl=e.overrideLookUrl,_.has(this.__serviceProvider.services,"photoBooth")||_.has(e,"photoBooth")?(this.__photoBooth=e.photoBooth||this.__serviceProvider.get("photoBooth"),this.addToDOM()):module.run({PhotoBooth:"@PhotoBooth"},this.__completeInit.bind(this))},__completeInit:function(e,t){this.__photoBooth=this.__modeManager.createChildContext(e.PhotoBooth,{$parentElement:this.__modeManager.$el,overrideLookUrl:this.__overrideLookUrl}),this.__serviceProvider.register("photoBooth",this.__photoBooth),this.addToDOM()},postRender:function(){this.__photoBooth.attach(this.$(".dialog-body"),{overrideLookUrl:this.__overrideLookUrl}).then(function(){this.__featureAccessManager.canAddFeedCaptions()?this.setContent("auxHeader",this.$(".aux-header-template-2").text()):this.setContent("auxHeader",this.$(".aux-header-template").text())}.bind(this)),this.__photoBooth.on("exit",this.hide,this),this.__photoBooth.on("canPost",this.setPostStatus,this)},setPostStatus:function(e){this.$(".post").toggleClass("disabled",!e)},__post:function(){this.__photoBooth.post()},__openCaptionDialog:function(){this.__dialogManager.showDialog(e.PhotoBoothCaptionDialog,{photoBooth:this.__photoBooth}).finished.then(function(){this.hide()}.bind(this))},delete:function(){this.__photoBooth.detach(),this.__photoBooth.off(null,null,this),t.prototype.delete.call(this)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],PhotoBoothCaptionDialog:Se}),Ee=function(e){var t=e.UiCore.UiContext;return t.extend("FeedActionBar",{uiContextName:"feed_action_bar",tagName:"ul",className:"feed-action-bar bar",dependencies:"cardManager contextMenuManager dialogManager featureAccessManager globalStartupModel globalStringManager googleAnalytics loginManager modeManager platform rest restModelFactory timer".split(" "),trackedEvents:function(){return[{type:"click",selector:".action-more",name:"feed_item_menu",handler:this.__showActionMenu},{type:"click",selector:".action-tag",name:"feed_item_tag",handler:this.__triggerTags},{type:"click",selector:".action-tag-count",name:"feed_item_tag_count",handler:this.__triggerTagCount},{type:"click",selector:".action-like:not(.is-liked)",name:"feed_item_like",handler:this.__triggerLike},{type:"click",selector:".action-like.is-liked",name:"feed_item_like",handler:this.__triggerUnlike},{type:"click",selector:".action-like-count",name:"feed_item_like_count",handler:this.__triggerLikeCount},{type:"click",selector:".action-comment",name:"feed_item_comment",handler:this.__triggerComments},{type:"click",selector:".action-comment-count",name:"feed_item_comment_count",handler:this.__triggerCommentCount}]},initialize:function(e){this.uiAttributes={repeats:1},t.prototype.initialize.call(this,e),this.__imageManager=e.imageManager,this.__loginManager=e.loginManager,this.__modeManager=e.modeManager,this.__googleAnalytics=e.googleAnalytics,this.__contextMenuManager=e.contextMenuManager,this.__dialogManager=e.dialogManager,this.__globalStringManager=e.globalStringManager,this.__restModelFactory=e.restModelFactory,this.__reportUrl=e.globalStartupModel.get("safetyReportUrl"),this.__featureAccessManager=e.featureAccessManager,this.__rest=e.rest,this.__isAbbreviated=e.isAbbreviated,this.__feedType=e.feedType,this.__userProfileCard=!0===e.userProfileCard,this.__allCounts=new Backbone.Model({tags:0,likes:0,comments:0}),this.__allCounts.on("change",this.__onCountsChange,this),this.addToDOM(),this.model.on("change",this.__onModelChange,this)},delete:function(){t.prototype.delete.call(this),this.model.off(void 0,void 0,this),this.likedby&&this.likedby.off(void 0,void 0,this),this.commentsSummary&&this.commentsSummary.off(void 0,void 0,this),this.__timer.clearTimeout(this.__waitAtLeastTimeout)},__onCountsChange:function(){this.$(".action-tag-container, .action-tag-count").toggleClass("disabled",!this.__allCounts.get("tags")),this.$el.toggleClass("has-counts",0<this.__allCounts.get("tags")||0<this.__allCounts.get("likes")||0<this.__allCounts.get("comments"))},__postIsByMe:function(){return this.__loginManager.isLoggedIn()&&this.actor.id===this.__loginManager.getCurrentUser().id},__isStaff:function(){return!!this.__loginManager.isLoggedIn()&&this.__loginManager.getCurrentUser().get("is_staff")},__mayWhiteList:function(){return this.__featureAccessManager.hasWhitelistAccess()||this.__isStaff()},__isWhiteListed:function(){return void 0===this.model.relations.whitelist&&void 0!==this.model.relations.unwhitelist},__isUnWhiteListed:function(){return void 0!==this.model.relations.whitelist&&void 0===this.model.relations.unwhitelist},__getActionMenuItems:function(){var e=[];if(this.__postIsByMe())e.push({name:"delete",text:this.__globalStringManager.get("Delete"),handler:this.__deleteFeedItem.bind(this)}),this.__featureAccessManager.canAddFeedCaptions()&&"photo"===this.model.get("type")&&e.push({name:"edit",text:this.__globalStringManager.get("dialog_photobooth_edit_title"),handler:this.__editFeedItem.bind(this)});else{var t=(t=this.__modeManager.getCurrentMode())&&t.getCurrentSubmode()?t.getCurrentSubmode().id:void 0;this.__isWhiteListed()||"explore"===t||e.push({name:"report",text:this.__globalStringManager.get("Report"),handler:this.__reportFeedItem.bind(this)})}return this.__mayWhiteList()&&(this.__isUnWhiteListed()?e.push({name:"whitelist",text:this.__globalStringManager.get("Whitelist"),handler:this.__whitelist.bind(this)}):this.__isWhiteListed()&&e.push({name:"unwhitelist",text:this.__globalStringManager.get("Unwhitelist"),handler:this.__unwhitelist.bind(this)})),this.__whitelistedBy&&e.push({name:"whitelistedby",text:this.__globalStringManager.get("WhitelistedBy",{username:this.__whitelistedBy.get("username")}),handler:this.__onClickWhitelister.bind(this)}),e},__showActionMenu:function(t){t.stopPropagation(),this.__contextMenuManager.toggleMenu(t,e.ContextMenu,{items:this.__getActionMenuItems(),displayOptions:{above:!1,right:!0}})},__whitelist:function(){this.__rest.post(this.model.relations.whitelist,{}).then(function(){this.model.invalidate()}.bind(this)).catch(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("whitelist_error_title"),text:this.__globalStringManager.get("whitelist_error_text"),ok:this.__globalStringManager.get("OK")})}.bind(this))},__unwhitelist:function(){this.__rest.delete(this.model.relations.unwhitelist,{}).then(function(){this.model.invalidate()}.bind(this)).catch(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("whitelist_error_title"),text:this.__globalStringManager.get("unwhitelist_error_text"),ok:this.__globalStringManager.get("OK")})}.bind(this))},__invalidateRelatedFeedsAfterReporting:function(){this.__invalidateFeed(this.__loginManager.getCurrentUser(),"subscribed_feed"),this.__invalidateFeed(this.actor,"personal_feed")},__invalidateFeed:function(t,i){t.populated().then(function(){return t.getSingleEdge(i).populated()}.bind(this)).then(function(t){t.getEdgeCollection("elements",e.Model.FeedCollection).invalidate()}.bind(this))},__reportFeedItem:function(){this.__featureAccessManager.canReportFeedCaptions()?this.__dialogManager.showDialog(e.ReportFeedItemDialog,{model:this.model}).finished.then(function(e){}.bind(this)):this.__dialogManager.confirm({title:this.__globalStringManager.get("dialog_feed_report_post_title"),text:this.__globalStringManager.get("dialog_feed_report_post_text"),yes:this.__globalStringManager.get("Report"),no:this.__globalStringManager.get("Cancel"),termsOfService:!0}).finished.then(function(){this.__restModelFactory.createModel(this.__reportUrl,e.UiCore.NodeModel,{reason:this.model.get("type"),relations:{content:this.model.id}}).then(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("report_confirm_title"),text:this.__globalStringManager.get("report_confirm_text"),ok:this.__globalStringManager.get("report_confirm_done")}).finished.then(function(){this.trigger("item-reported")}.bind(this))}.bind(this),function(){this.__dialogManager.alert({title:this.__globalStringManager.get("report_error_title"),text:this.__globalStringManager.get("report_error_text"),ok:this.__globalStringManager.get("report_error_done")})}.bind(this))}.bind(this))},__deleteFeedItem:function(){this.__dialogManager.confirm({title:this.__globalStringManager.get("Delete Post"),text:this.__globalStringManager.get("Are you sure"),yes:this.__globalStringManager.get("Delete"),no:this.__globalStringManager.get("Cancel")}).finished.then(function(){this.model.destroy().then(function(){this.__modeManager.openMode({openDefaultView:!0,mode:{id:"feed"}})}.bind(this),function(){this.__dialogManager.alert({title:this.__globalStringManager.get("Network Error Title"),text:this.__globalStringManager.get("Network Error Text"),ok:this.__globalStringManager.get("Network Error Ok")})}.bind(this))}.bind(this))},__editFeedItem:function(){this.__dialogManager.showDialog(e.PhotoBoothCaptionDialog,{mode:"edit",model:this.model})},render:function(){var t=this.__allCounts.get("tags");this.model.populated().then(function(){this.__mayWhiteList()&&this.model.relations.whitelister&&this.model.getSingleEdge("whitelister").populated().then(function(e){this.__whitelistedBy=e}.bind(this)),this.actor=this.model.getSingleEdge("actor"),this.$el.html(e.template({canSeeShareWidget:this.__featureAccessManager.canSeeShareWidget()})),this.createChildContext(e.Widgets.SocialShare,{$parentElement:this.$(".action-share-container"),linkToCopy:this.__getShareLink()}),this.$el.toggleClass("is-abbreviated",!!this.__isAbbreviated),this.$(".action-tag-container, .action-tag-count").toggleClass("disabled",!t),this.__onModelChange(!1),this.$(".action-more").toggle(0<this.__getActionMenuItems().length).prop("disabled",!this.__loginManager.isLoggedIn())}.bind(this))},__onModelChange:function(){this.likedby&&this.likedby.off(void 0,void 0,this),this.likedby=this.model.searchEdgeCollection("liked_by",{limit:0},e.UiCore.EdgeCollection),this.likedby.on("add remove reset",this.__onLikeCollectionChange,this),this.__onLikeCollectionChange(),this.__isAbbreviated&&(this.commentsSummary&&this.commentsSummary.off(void 0,void 0,this),this.commentsSummary=this.model.getSummaryCollection("comments"),this.commentsSummary.on("update add remove reset",this.__onCommentsCollectionChange,this),this.__onCommentsCollectionChange(),"photo"===this.model.get("type")&&this.model.getSingleEdge("photo").populated().then(function(e){return e.getSingleEdge("photo_details").populated()}.bind(this)).then(function(e){this.__userTags=new IMVU.NamedCollection,_.each(e.get("users"),function(e){this.__userTags.add(this.__serviceProvider.create(IMVU.NamedModel,e))}.bind(this)),this.__allCounts.set("tags",this.__userTags.length),this.$(".count-tags").text(this.__userTags.length)}.bind(this)))},__onCommentsCollectionChange:function(){this.__allCounts.set("comments",this.commentsSummary.total_count)},__onLikeCollectionChange:function(){this.__allCounts.set("likes",this.likedby.total_count),this.$(".count-likes").text(e.FormatNumber.formatMini(this.likedby.total_count)),this.likedby.populated().then(function(){var e=null!==this.likedby.getMyEdge();if(!e&&this.__loginManager.isLoggedIn()){var t=this.__loginManager.getCurrentUser().id;_.each(this.likedby.models,function(i){i.node.id==t&&(e=!0)}.bind(this))}!0!==this.__pendingOptimisticLikeState&&!1!==this.__pendingOptimisticLikeState||(e=this.__pendingOptimisticLikeState,delete this.__pendingOptimisticLikeState),this.$(".action-like").toggleClass("is-liked",!!e)}.bind(this))},__waitAtLeast:function(e,t,i){0>(e-=new Date-t)&&(e=0),this.__timer.clearTimeout(this.__waitAtLeastTimeout),this.__waitAtLeastTimeout=this.__timer.setTimeout(i,e)},__triggerLike:function(){if(!this.__isLikeOrUnlikeInFlight){var e=new Date;this.__isLikeOrUnlikeInFlight=!0,this.__googleAnalytics.recordFeedItemAction("liked post"),this.__pendingOptimisticLikeState=!0,this.$(".action-like").addClass("is-liked"),this.model.like().catch(function(t){delete this.__pendingOptimisticLikeState,this.__waitAtLeast(1e3,e,function(){this.$(".action-like").removeClass("is-liked")}.bind(this))}.bind(this)).then(function(){this.__isLikeOrUnlikeInFlight=!1}.bind(this))}},__triggerUnlike:function(){if(!this.__isLikeOrUnlikeInFlight){var e=new Date;this.__isLikeOrUnlikeInFlight=!0,this.__googleAnalytics.recordFeedItemAction("unliked post"),this.__pendingOptimisticLikeState=!1,this.$(".action-like").removeClass("is-liked"),this.model.unlike().catch(function(t){delete this.__pendingOptimisticLikeState,this.__waitAtLeast(1e3,e,function(){this.$(".action-like").addClass("is-liked")}.bind(this))}.bind(this)).then(function(){this.__isLikeOrUnlikeInFlight=!1}.bind(this))}},__triggerLikeCount:function(){"mobile"===this.__platform?this.$(".action-like").hasClass("is-liked")?this.__triggerUnlike():this.__triggerLike():this.trigger("action-like-count")},__triggerComments:function(){this.trigger("action-comments")},__triggerCommentCount:function(){this.trigger("action-comment-count")},__triggerTags:function(){this.trigger("action-tags")},__triggerTagCount:function(){this.trigger("action-tag-count")},__onClickWhitelister:function(){this.__cardManager.showUserProfileCard({user:this.__whitelistedBy,context:"username",openContext:this})},__getShareLink:function(){var e=this.model.id.split("/");return this.__serviceProvider.get("siteRoot")+"feed/"+e.pop()}})}({UiCore:e["@UiCore"],Model:e["@Model"],Widgets:e["@Widgets"],template:Ue,ContextMenu:A,FormatNumber:r,PhotoBoothCaptionDialog:Se,PhotoBoothDialog:Le,ReportFeedItemDialog:De}),Ae=function(t){var i={UiCore:e["@UiCore"],FeedActionBar:Ee}.FeedActionBar;return i.extend("ActionBar",{className:"action-bar feed-action-bar",uiContextName:"action_bar",initialize:function(e){e.isAbbreviated=!0,i.prototype.initialize.call(this,e)}})}(),Ie=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){i=t.helperMissing;var a=this.escapeExpression;return"<div class='menu-bar magic-line-menu'>\n    <ul class='menu-tabs'></ul>\n    <div class='magic-line'></div>\n</div>\n<div class='bar'>\n    <div class='menu-toggle'></div>\n    <textarea class=\"input-text no-focus\" type=\"text\" placeholder=\""+a((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Type something...",{name:"i18n-g",hash:{},data:n}))+'"></textarea>\n    <button class="btn btn-small btn-ghost btn-strokeless btn-send" type="submit" disabled>'+a((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Send",{name:"i18n-g",hash:{},data:n}))+"</button>\n</div>"},useData:!0})}(),Ne=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'\n        <button class="btn ap"></button>\n\t'},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return i='<div class="product-item">\n    <div class="product-arrow">\n\t<div class="arrow"></div>\n    </div>\n    <div class=\'title\'><span class=\'product\'>'+(i=this.escapeExpression)("function"==typeof(s=t.product_name||e&&e.product_name)?s.call(e,{name:"product_name",hash:{},data:n}):s)+"</span></div>\n    <div class='shields'>\n\t",((a=t.if.call(e,e&&e.is_ap,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n    </div>\n</div>\n"},useData:!0})}(),Fe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return"<div class='title'><span class='trigger'>"+(0,this.escapeExpression)("function"==typeof(a=t.trigger_name||e&&e.trigger_name)?a.call(e,{name:"trigger_name",hash:{},data:n}):a)+"</span></div>\n"},useData:!0})}(),He=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'\n        <button class="btn ap"></button>\n    '},3:function(){return'\n        <button class="btn vip"></button>\n    '},5:function(){return'\n        <button class="btn requires_friend"></button>\n    '},7:function(e,t,i,n){var a;return"<span class='name'>"+(0,this.escapeExpression)("function"==typeof(a=t.name||e&&e.name)?a.call(e,{name:"name",hash:{},data:n}):a)+"</span>"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return i='<svg version="1.1" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <defs>\n        <filter id="invert-action-'+(i=this.escapeExpression)("function"==typeof(s=t.uid||e&&e.uid)?s.call(e,{name:"uid",hash:{},data:n}):s)+'">\n            <feColorMatrix in="SourceGraphic" type="matrix" values="-1 0 0 0 1\n                                                                    0 -1 0 0 1\n                                                                    0 0 -1 0 1\n                                                                    0 0 0 1 0"/>\n        </filter>\n        <mask id="masked-action-'+i("function"==typeof(s=t.uid||e&&e.uid)?s.call(e,{name:"uid",hash:{},data:n}):s)+'">\n            <image src="" width="100%" height="100%" filter="url(\'#invert-action-'+i("function"==typeof(s=t.uid||e&&e.uid)?s.call(e,{name:"uid",hash:{},data:n}):s)+'\')" xlink:href="'+i("function"==typeof(s=t.image_url||e&&e.image_url)?s.call(e,{name:"image_url",hash:{},data:n}):s)+'"></image>\n        </mask>\n    </defs>\n    <rect x="0" y="0" width="100%" height="100%" fill="#000" mask="url(\'#masked-action-'+i("function"==typeof(s=t.uid||e&&e.uid)?s.call(e,{name:"uid",hash:{},data:n}):s)+"')\" />\n</svg>\n<div class='shields'>\n    ",((a=t.if.call(e,e&&e.requires_ap,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n    ",((a=t.if.call(e,e&&e.requires_vip,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n    ",((a=t.if.call(e,e&&e.requires_friend,{name:"if",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n</div>\n<div class='title'>",((a=t.if.call(e,e&&e.show_name,{name:"if",hash:{},fn:this.program(7,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"</div>"},useData:!0})}(),Re=function(e){var t=e.UiCore.UiContext;return t.extend("ActionCatalogItem",{uiContextName:"action_catalog_item",tagName:"li",className:"catalog-item action-catalog-item",dependencies:["globalStringManager","loginManager","Promise","timer"],trackedEvents:function(){return[{type:"click",selector:".title",name:"change_partner",handler:this.__changePartner}]},initialize:function(e){t.prototype.initialize.call(this,e),this.model=e.model,this.__timer=e.timer,this.__myself=e.loginManager.getCurrentUser(),this.__Promise=e.Promise,this.__partner=e.partner,this.addToDOM()},__shouldFilter:function(){return this.model.get("requires_ap")&&!this.__myself.get("is_ap")||this.model.get("requires_vip")&&!this.__myself.get("is_vip")},__changePartner:function(e){this.trigger("change-partner",e)},render:function(){this.__Promise.every([this.model.populated(),this.__myself.populated()]).then(function(){if(this.__shouldFilter())return this.__Promise.reject();this.$el.attr("data-id",this.model.id);var t=_.extend(this.model.toJSON(),{uid:this.model.cid+"-"+this.__timer.getTime()}),i=t.name;this.__partner?(t.show_name=!1,t.name=""):t.show_name=!0,this.$el.html(e.template(t)),this.__partner&&(i+=" "+this.__globalStringManager.get("with"),this.__partnerDisplayName=this.createChildContext(e.Widgets.DisplayName,{$parentElement:this.$(".title"),user:this.__partner.node,size:"small",color:"light",showVipBadge:!1,prefix:i,ignoreClicks:!0}))}.bind(this)).catch(function(){this.$el.hide()}.bind(this))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:He}),Be=function(e){var t=e.UiCore.UiContext;return t.extend("ActionCatalog",{uiContextName:"action_catalog",className:"action-catalog is-list",tagName:"ul",initialize:function(e){t.prototype.initialize.call(this,e),this.collection=e.collection,this.addToDOM()},render:function(){this.$el.css("overflow-y","auto"),this.collection.each(function(t){this.createChildContext(e.ActionCatalogItem,{$parentElement:this.$el,model:t})}.bind(this)),this.$el.scrollbar(),this.listenTo(this.collection,"add",function(t){this.createChildContext(e.ActionCatalogItem,{$parentElement:this.$el,model:t})}.bind(this))}})}({UiCore:e["@UiCore"],ActionCatalogItem:Re}),Oe=function(e){var t=e.UiCore.UiContext;return t.extend("PidActionCatalogItem",{uiContextName:"pid_action_catalog_item",tagName:"li",className:"catalog-item pid-action-catalog-item disable-text-selection",dependencies:["loginManager","Promise"],initialize:function(e){t.prototype.initialize.call(this,e),this.model=e.model,this.__myself=e.loginManager.getCurrentUser(),this.__Promise=e.Promise,this.addToDOM()},render:function(){this.model.populated().then(function(){this.$el.attr("data-id",this.model.id),this.$el.html(e.template(this.model.toJSON()))}.bind(this)).catch(function(){this.$el.hide()}.bind(this))}})}({UiCore:e["@UiCore"],ActionCatalog:Be,template:Fe}),ze=function(e){var t=e.UiCore.UiContext;return t.extend("PidActionCatalog",{uiContextName:"pid_action_catalog",className:"pid-action-catalog is-list",tagName:"ul",initialize:function(e){t.prototype.initialize.call(this,e),this.collection=e.collection,this.addToDOM()},addItem:function(t){this.createChildContext(e.PidActionCatalogItem,{$parentElement:this.$el,model:t})},render:function(){this.collection.each(this.addItem.bind(this)),this.listenTo(this.collection,"add",this.addItem)}})}({UiCore:e["@UiCore"],PidActionCatalogItem:Oe}),We=function(e){var t=e.UiCore.UiContext;return t.extend("PidProductCatalogItem",{uiContextName:"pid_product_catalog_item",tagName:"li",className:"catalog-item pid-product-catalog-item",dependencies:["loginManager","Promise","templateArgs"],initialize:function(e){t.prototype.initialize.call(this,e),this.collection=e.collection,this.__myself=e.loginManager.getCurrentUser(),this.addToDOM()},render:function(){this.$el.html(e.template(this.__templateArgs)),this.createChildContext(e.PidActionCatalog,{$parentElement:this.$el,collection:this.collection})}})}({UiCore:e["@UiCore"],PidActionCatalog:ze,template:Ne}),Ve=function(e){var t=e.UiCore.UiContext;return t.extend("PidProductCatalog",{uiContextName:"pid_product_catalog",className:"pid-product-catalog is-list",tagName:"ul",initialize:function(e){t.prototype.initialize.call(this,e),this.collection=e.collection,this.triggersByProduct={},this.addToDOM()},addTrigger:function(t){t.populated().then(function(){this.triggersByProduct[t.get("productId")]||(this.triggersByProduct[t.get("productId")]=this.createChildContext(e.PidProductCatalogItem,{$parentElement:this.$el,templateArgs:{product_name:t.get("product_name"),is_ap:t.get("is_ap")},collection:new IMVU.NamedCollection})),this.triggersByProduct[t.get("productId")].collection.add(t)}.bind(this))},render:function(){this.$el.css("overflow-y","auto"),this.collection.each(this.addTrigger.bind(this)),this.listenTo(this.collection,"add",this.addTrigger),this.$el.scrollbar()}})}({UiCore:e["@UiCore"],PidProductCatalogItem:We}),qe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<div class='preview'>\n    <div class='cancel'></div>\n</div>\n<div class='catalog-container'></div>"},useData:!0})}(),Ge=function(e){var t=e.UiCore.UiContext;return t.extend("ChatBarMenu",{className:"chat-bar-menu",dependencies:[],trackedEvents:function(){return[{type:"click",selector:".preview .cancel",name:"cancel_preview",handler:this.cancelSelection},{type:"click",selector:".catalog-container .catalog-item",name:"click_catalog_item",handler:this.__onClickItem,attributes:function(e){return{item_id:e.data("id")}}},{type:"keyup",name:"enter_catalog_item",handler:this.__onKeyUp,allowBubble:!0}]},initialize:function(i){t.prototype.initialize.call(this,i),this.$el.attr("tabindex",-1),this.$el.attr("data-nodismissonclickinsider",!0),e.NextUtil.DomHelper.dismissible({dismissibleEl:this.$el,dismissHandler:this.__dismissHandler.bind(this)}),this.__currentSelection=null,this.addToDOM()},render:function(){this.$el.html(e.template)},connect:function(e){this.cancelSelection()},preloadCatalog:function(){_.delay(function(){this.__catalogCreated||(this.__catalogCreated=!0,this.__createCatalog())}.bind(this))},showCatalog:function(){this.__catalogCreated||(this.__catalogCreated=!0,this.__createCatalog()),this.$el.addClass("showing-catalog")},hideCatalog:function(){this.$el.removeClass("showing-catalog")},cancelSelection:function(){this.$(".catalog-item").removeClass("highlighted"),this.__setSelection(null)},__setSelection:function(e){this.__currentSelection=e,this.$(".preview").toggle(!!e),this.__updatePreviewContent(),this.trigger("change")},__updatePreviewContent:function(){this.__previewContent&&this.__previewContent.delete(),this.__currentSelection&&(this.__previewContent=this.__createPreviewContent())},__createPreviewContent:function(){},__onClickItem:function(t){var i=(t=$(t.currentTarget)).data("id");if(i){if(this.getSelectionId()===i)return this.trigger("send");e.NextUtil.DomHelper.radioClass(t,"highlighted"),this.__setSelection(i),this.$el.focus()}},__onKeyUp:function(t){this.__currentSelection&&t.keyCode===e.NextUtil.Keys.VK_ENTER&&this.trigger("send")},getSelection:function(){return this.__currentSelection},getSelectionId:function(){return this.__currentSelection},__dismissHandler:function(){this.$el.hasClass("showing-catalog")&&(this.__currentSelection?this.cancelSelection():this.__parentUiContext.collapseMenus())}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:qe}),je=function(e){var t=IMVU.BaseClass;return t.extend("ActionCategorylist",{dependencies:["Promise","globalStartupModel","restModelFactory"],initialize:function(e){t.prototype.initialize.call(this,e),this.__Promise=e.Promise,this.__serviceProvider=e.serviceProvider,this.__actionCategoryUrl=e.globalStartupModel.get("actionCategoryUrl"),this.__restModelFactory=e.restModelFactory},search:function(t){return this.__restModelFactory.searchCollection(this.__actionCategoryUrl,t,e.UiCore.NodeCollection)},__getActionsForType:function(e,t){var i={};return e.populated().then(function(){return this.__Promise.every(e.map(function(e){var t=e.get("name");return i[t]=e.getEdgeCollection("actions"),i[t].populated()}.bind(this)))}.bind(this)).then(function(){var e={};return _.each(i,function(i,n){var a={};i.each(function(e){t.whitelist&&!_.contains(t.whitelist,e.node.get("name"))||t.hasOwnProperty("ap")&&!t.ap&&e.node.get("requires_ap")||t.hasOwnProperty("vip")&&!t.vip&&e.node.get("requires_vip")||t.hasOwnProperty("friend")&&!t.friend&&e.node.get("requires_friend")||(a[e.node.get("name")]=e.node)}),0<_.size(a)&&(e[n]=a)}.bind(this)),this.__Promise.accept(e)}.bind(this))},__getActionList:function(e,t){if(t=t||{},"solo"===e)return this.__soloActionCategories||(this.__soloActionCategories=this.search({type:"solo"})),this.__getActionsForType(this.__soloActionCategories,t);if("coop"===e)return this.__coopActionCategories||(this.__coopActionCategories=this.search({type:"coop"})),this.__getActionsForType(this.__coopActionCategories,t);throw Error('Type should be either "solo" or "coop"')},getFlatActionList:function(e,t){return this.__getActionList(e,t).then(function(e){var t=new IMVU.NamedCollection;return _.each(e,function(e){_.each(e,function(e,i){t.add(e)}.bind(this))}.bind(this)),this.__Promise.accept(t)}.bind(this)).catch(function(e){return window.console.log(e),this.__Promise.reject(e)}.bind(this))},__getActionBySelector:function(e,t,i){return new this.__Promise(function(n){this.getFlatActionList(e).then(function(e){(e=e.find(t))?n.resolve(e):n.reject(i)}.bind(this))}.bind(this))},getActionForCommand:function(e,t){return this.__getActionBySelector(e,function(e){return e.get("pitcher_action")===t},'Command "'+t+'" not found in '+e+" actions")},getActionForName:function(e,t){return this.__getActionBySelector(e,function(e){return e.get("name").toLowerCase()===t.toLowerCase()},'Command "'+t+'" not found in '+e+" actions")}})}({UiCore:e["@UiCore"]}),Ke=function(e){var t={solo:"Clap Nod Yay Smile Nope Breakdance Kick Sleep".split(" "),coop:"Shake;Hi-5;BearHug;Bow;Cheek Kiss;Blow Kiss;Hug;Light Hug;Punch;Slap".split(";")},i=e.ChatBarMenu;return i.extend("ActionMenu",{initialize:function(t){i.prototype.initialize.call(this,t),this.__serviceProvider=t.serviceProvider,this.__actionCategoryList=t.serviceProvider.create(t.actionCategoryListFactory||e.ActionCategoryList)},__createCatalog:function(){this.$el.addClass("loading"),this.__actionCategoryList.getFlatActionList(this.actionType,{whitelist:t[this.actionType]}).then(function(t){this.__actionCollection=t,this.$el.removeClass("loading"),this.createChildContext(e.ActionCatalog,{$parentElement:this.$(".catalog-container"),collection:t})}.bind(this))}})}({UiCore:e["@UiCore"],ChatBarMenu:Ge,ActionCatalog:Be,ActionCategoryList:je}),Ye=function(e){var t=e.ActionMenu;return t.extend("PidActionMenu",{uiContextName:"pid_action_menu",payloadName:"trigger",className:"chat-bar-menu pid-action-menu",actionType:"pid",dependencies:["Promise"],initialize:function(e){t.prototype.initialize.call(this,e),this.__Promise=e.Promise,this.__connected=new this.__Promise(function(e){this.__connectedResolver=e}.bind(this))},connect:function(e){this.__connectedResolver.accept(e)},__createCatalog:function(){this.$el.addClass("loading"),this.__connected.then(function(e){return this.__avatarTriggers=e.get("triggerList"),this.__avatarTriggers.populated()}.bind(this)).then(function(){this.$el.removeClass("loading"),this.__catalog=this.createChildContext(e.PidProductCatalog,{$parentElement:this.$(".catalog-container"),collection:this.__avatarTriggers}),this.trigger("item_list",this.__avatarTriggers.length),this.listenTo(this.__avatarTriggers,"reset",function(){this.removeChildContext(this.__catalog),this.__catalog.delete(),this.$(".pid-product-catalog").remove(),this.__catalog=this.createChildContext(e.PidProductCatalog,{$parentElement:this.$(".catalog-container"),collection:this.__avatarTriggers})}.bind(this)),this.listenTo(this.__avatarTriggers,"add reset remove",function(){this.trigger("item_list",this.__avatarTriggers.length)}.bind(this))}.bind(this))},__onClickItem:function(i){var n=$(i.currentTarget);n.data("id")?t.prototype.__onClickItem.call(this,i):n.hasClass("opened")?(n.find(".pid-action-catalog-item").removeClass("highlighted"),this.__setSelection(null),n.removeClass("opened")):e.NextUtil.DomHelper.radioClass(n,"opened")},__setSelection:function(e){t.prototype.__setSelection.call(this,e?this.__avatarTriggers.get(e):null)},getSelectionId:function(){return this.__currentSelection?this.__currentSelection.id:this.__currentSelection},__createPreviewContent:function(){var t=new IMVU.NamedModel;return t.set({name:this.getSelection().get("trigger_name"),image_url:"https://static-akm.imvu.com/imvufiles/actions/actions_trigger_preview.png"}),t.populated=function(){return this.__Promise.accept()}.bind(this),this.createChildContext(e.ActionCatalogItem,{$parentElement:this.$(".preview"),model:t})}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],ActionMenu:Ke,PidProductCatalog:Ve,ActionCatalogItem:Re}),Xe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="preview">\n    <div class="cancel"></div>\n    <div class="shuffle"></div>\n</div>\n<div class="catalog-container">\n    <div class="detail-container">\n        <div class="catalog-error-content">\n            <div class="title">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"sticker_error_title",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</div>\n            <div class='icon'></div>\n            <div>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"sticker_error_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'</div>\n        </div>\n    </div>\n</div>\n<div class="catalog-menu-bar">\n    <a class="contextual-dressup"></a>\n    <a class="recent-stickers"></a>\n    <div class="catalog-menu small-simple-scroller"></div>\n    <a class="add-catalog">\n        <div class="new-badge hidden"></div>\n    </a>\n</div>\n'},useData:!0})}(),Je=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return'<img src="'+(0,this.escapeExpression)("function"==typeof(a=t.product_image||e&&e.product_image)?a.call(e,{name:"product_image",hash:{},data:n}):a)+'" class="sticker-item-image" height="20"/>'},useData:!0})}(),Ze=function(e){var t=e.UiCore.UiContext;return t.extend("StickerPackItem",{uiContextName:"sticker_catalog_item",tagName:"li",className:"sticker-pack-item",initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.model.populated().then(function(){var t=this.model.node;this.$el.attr("data-id",t.id),this.$el.html(e.template({product_image:t.get("product_image"),product_name:t.get("product_name")}))}.bind(this)).catch(function(){this.$el.hide()}.bind(this))}})}({UiCore:e["@UiCore"],template:Je}),Qe=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("StickerPackList",{uiContextName:"sticker_pack_list",className:"sticker-pack-list",itemFactory:e.StickerPackItem,dependencies:["collection"],render:function(){t.prototype.render.call(this)}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],StickerPackItem:Ze,SimpleScroller:Pe}),et=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='header'>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"coop_with",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</div>\n<div class='items is-list'>\n    <ul></ul>\n</div>\n<div class='error-message'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"coop_partner_context_error",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>"},useData:!0})}(),tt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<li>\n    <span class='username'></span>\n</li>"},useData:!0})}(),it=function(e){var t=e.ContextMenu;return t.extend("CoopPartnerMenu",{uiContextName:"coop_partner_menu",tagName:"div",className:"context-menu coop-partner-menu",dependencies:["Promise","loginManager"],initialize:function(e){this.__requirements=e.requirements||{},this.__Promise=e.Promise,this.__myself=e.loginManager.getCurrentUser(),t.prototype.initialize.call(this,e)},render:function(){this.$el.html(e.template),this.$(".items").addClass("loading"),_.isEmpty(this.__requirements)?this.__onLoaded():this.__Promise.every(_.map(this.__items,function(e){return e.user.populated()})).then(this.__onLoaded.bind(this))},__onLoaded:function(){_.any(this.__items,function(e){return this.__checkPartnerRequirements(e.user)}.bind(this))?(_.each(this.__items,function(e){this.__createUserItem(e)}.bind(this)),this.$(".items").removeClass("loading").scrollbar(),this.trigger("resize")):this.$el.addClass("error")},__checkPartnerRequirements:function(e){return!(this.__requirements.ap&&!e.get("is_ap")||this.__requirements.friend&&!e.relations.viewer_friend)},__createUserItem:function(t){var i=t.user;if(i.id!==this.__myself.id){t=$(e.itemTemplate()).attr("data-menu-item",t.name).addClass(t.classNames),this.$("ul").append(t);var n=this.createChildContext(e.Widgets.DualName,{$replaceElement:t.find(".username"),user:i,configuration:"small-dual-lightbg",ignoreClicks:!0,hoverOn:!0});t.on("mouseenter",function(){n.onMouseover()}),t.on("mouseleave",function(){n.onMouseleave()}),this.__checkPartnerRequirements(i)||t.addClass("disabled")}}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],ContextMenu:A,template:et,itemTemplate:tt}),nt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"<div class='img-container'>\n    <img />\n</div>"},useData:!0})}(),at=function(e){var t=e.UiCore.UiContext;return t.extend("Sticker",{className:"sticker",uiContextName:"sticker",dependencies:"contextMenuManager dialogManager featureAccessManager imageManager prefsManager defer globalStringManager".split(" "),trackedEvents:function(){return[{type:"click",selector:"img",name:"show_context_menu",handler:this.__showContextMenu},{type:"click",selector:"canvas",name:"show_context_menu",handler:this.__showContextMenu},{type:"click",name:"tile",handler:this.__onTileClick}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__contextMenuManager=e.contextMenuManager,this.__dialogManager=e.dialogManager,this.__featureAccessManager=e.featureAccessManager,this.__imageManager=e.imageManager,this.__prefsManager=e.prefsManager,this.__globalStringManager=e.globalStringManager,this.__defer=e.defer,this.__imageUrl=e.imageUrl,this.__customContextMenus=e.customContextMenus?e.customContextMenus:[],this.__allowSafetyReport="allowSafetyReport"in e&&e.allowSafetyReport,this.addToDOM()},render:function(){this.$el.html(e.template),this.$img=this.$("img"),this.__loadImage()},delete:function(){this.$img.off().removeAttr("src"),t.prototype.delete.call(this)},__reload:function(){var e=$('img[src="'+this.__imageUrl+'"]');_.each(e,function(e){e.src=""}),_.each(e,function(e){e.src=this.__imageUrl}.bind(this)),this.__defer(function(){this.$img[0].src=this.__imageUrl}.bind(this))},__showContextMenu:function(t){var i=[];if(this.__customContextMenus.length)for(var n=0;n<this.__customContextMenus.length;n++)i.push(this.__customContextMenus[n]);i.push({name:"reload",text:this.__globalStringManager.get("sticker_context_menu_reload"),handler:this.__reload.bind(this)}),this.__allowSafetyReport&&i.push({name:"report",text:this.__globalStringManager.get("sticker_context_menu_report"),handler:function(){this.trigger("safety_report")}.bind(this)}),this.__contextMenuManager.showMenu(t,e.ContextMenu,{items:i,displayOptions:{above:!1,right:!1}})},__loadImage:function(){this.__prefsManager.populated().then(function(){var e=this.__prefsManager.getBool("next.gif_animations.disabled"),t=this.$el.siblings(".shimmer-container");void 0!==t&&t.addClass("shimmer-on"),this.__imageManager.load(this.$img,this.__imageUrl,{container:this.$el,forceStaticImage:e}).then(function(){this.$img.off();var t=this.$el.siblings(".shimmer-container");void 0!==t&&t.removeClass("shimmer-on"),e||this.__reload()}.bind(this)).catch(function(){this.$img.off()}.bind(this))}.bind(this))},__onTileClick:function(){this.$el.hasClass("error")&&(this.$el.removeClass("error"),this.__loadImage())}})}({UiCore:e["@UiCore"],ContextMenu:A,template:nt}),st=function(t){var i={UiCore:e["@UiCore"],Sticker:at}.Sticker;return i.extend("StickerPreview",{className:"sticker sticker-preview",uiContextName:"sticker_preview",dependencies:["restModelFactory","globalStartupModel"],initialize:function(e){this.__context=e.context,this.__stickerTemplate=e.stickerTemplate,this.__startupModel=e.globalStartupModel,this.__restModelFactory=e.restModelFactory,this.__rest=e.serviceProvider.get("rest"),this.__participants=e.participants,this.__ownedPreview=IMVU.optionalProperty(e,"ownedPreview",!0),i.prototype.initialize.call(this,e)},__loadImage:function(){this.$el.addClass("loading");var e={sticker_template:this.__stickerTemplate,participants:this.__participants};this.__context&&(e.context=this.__context.id),this.__ownedPreview?this.__startupModel.populated().then(function(){return this.__restModelFactory.simplePOST(this.__startupModel.get("stickerInstanceUrl"),{is_preview:!0,relations:e})}.bind(this)).then(function(e){this.__deleted||(this.__imageUrl=e.data.ssr_url,i.prototype.__loadImage.call(this))}.bind(this)).catch(function(e){this.trigger("preview-error",e,this.__stickerTemplate),this.$el.removeClass("loading").addClass("error"),void 0!==(e=this.$el.prev(".shimmer-container"))&&e.removeClass("shimmer-on")}.bind(this)):(this.__imageUrl=this.__stickerTemplate,i.prototype.__loadImage.call(this))}})}(),ot=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="sticker-packs"></div>'},useData:!0})}(),rt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<li class="spinner"></li>\n'},useData:!0})}(),lt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;return"\n\t\t        <div class='name'>"+(0,this.escapeExpression)("function"==typeof(a=t.name||e&&e.name)?a.call(e,{name:"name",hash:{},data:n}):a)+"</div>\n\t\t    "},3:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r="\n\t\t        <div class='created-by'>";return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"By",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+" <span class='creator'>"+o("function"==typeof(s=t.creator||e&&e.creator)?s.call(e,{name:"creator",hash:{},data:n}):s)+"</span></div>\n\t\t    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s,o=this.escapeExpression;return i=t.helperMissing,o='<div class="sticker-pack-container">\n\t<div class="sticker-pack-wrapper">\n\t<div class="is-new-label"></div>\n\t\t<div class=\'product-info\' for=\'cart-item-'+o("function"==typeof(s=t.product_id||e&&e.product_id)?s.call(e,{name:"product_id",hash:{},data:n}):s)+"'>\n\t\t    <div class='cart-image'>\n\t\t        <img>\n\t\t    </div>\n\t\t    ",((a=t.if.call(e,e&&e.name,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+='\n\t\t    <div class="sticker-count">\n\t\t        <span class="single-count"></span> ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Solo",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+=',\n\t\t        <span class="cooperative-count"></span> ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Group",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+="\n\t\t    </div>\n\t\t    ",((a=t.if.call(e,e&&e.creator,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+='\n\t\t    <p class="in-inventory">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"IN INVENTORY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+="</p>\n\t\t</div>\n\t\t<p class='preview-label'>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Click to preview",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+'</p>\n\t\t<div class="sticker-picker"></div>\n\t</div>\n</div>'},useData:!0})}(),dt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="back-button"></div>'},useData:!0})}(),ct=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="sticker-menu"></div>\n<div class="catalog"></div>\n'},useData:!0})}(),ht=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<span class="tool-tip">?</span>'},3:function(e,t,i,n){var a;return'<div class="tool-tip-content">'+(0,this.escapeExpression)("function"==typeof(a=t.toolTipContent||e&&e.toolTipContent)?a.call(e,{name:"toolTipContent",hash:{},data:n}):a)+"</div>"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s,o='<div class="no-results notation">\n    <span class="standard-text">'+(i=this.escapeExpression)("function"==typeof(s=t.standard||e&&e.standard)?s.call(e,{name:"standard",hash:{},data:n}):s);return((a=t.if.call(e,e&&e.hasToolTip,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+='</span>\n    <span class="concise-text">'+i("function"==typeof(s=t.concise||e&&e.concise)?s.call(e,{name:"concise",hash:{},data:n}):s),((a=t.if.call(e,e&&e.hasToolTip,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+="</span>\n    ",((a=t.if.call(e,e&&e.hasToolTip,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+"\n</div>"},useData:!0})}(),_t=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<img class=\'sticker-thumbnail\'/>\n<div class="shimmer-container"><div class="shimmer"></div></div>'},useData:!0})}(),gt=function(e){var t=e.UiCore.UiContext;return t.extend("StickerItem",{uiContextName:"sticker_catalog_item",tagName:"li",className:"catalog-item sticker-item",dependencies:["restModelFactory","loginManager","imageManager","featureAccessManager"],trackedEvents:function(){return this.__canPreview?[{type:"click",name:"toggle_preview",handler:this.togglePreview}]:[]},initialize:function(e){this.__restModelFactory=e.restModelFactory,this.__myself=e.loginManager.getCurrentUser(),this.__imageManager=e.imageManager,this.__featureAccessManager=e.featureAccessManager,this.__canPreview=!!e.canPreview,t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.model.populated().then(function(){this.$el.html(e.template).attr({"data-id":this.model.node.id,"data-participant_count":this.model.node.get("participant_count")}),this.__imageManager.load(this.$(".sticker-thumbnail"),this.model.edge.get("thumbnail_url"),{defaultImage:"/common/withme/img/sticker_template_error.png"})}.bind(this)).catch(function(){this.$el.hide()}.bind(this))},togglePreview:function(){this.__triggerStickerPreviewSelected(),this.__preview||(this.__preview=this.createChildContext(e.StickerPreview,{$parentElement:this.$el,stickerTemplate:this.model.node.get("preview_image"),participants:[this.__myself.id],ownedPreview:!1}),this.listenTo(this.__preview,"loading-complete",this.__triggerStickerPreviewComplete)),this.$el.toggleClass("previewing").siblings().removeClass("previewing")},__triggerStickerPreviewSelected:function(){this.$el.hasClass("no-overlay")?this.collection.trigger("clear-preview"):this.collection.trigger("load-preview"),this.$el.toggleClass("no-overlay")}})}({UiCore:e["@UiCore"],template:_t,StickerPreview:st}),pt=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("StickerTemplateList",{uiContextName:"catalog_menu_list",className:"catalog-menu-list",itemFactory:e.StickerItem,dependencies:["collection","globalStringManager","selectedTab"],initialize:function(e){this.__stringManager=e.globalStringManager,t.prototype.initialize.call(this,e),this.listenTo(this.collection,"load-preview",function(){this.$(".catalog-item").removeClass("no-overlay").addClass("preview-selected")}),this.listenTo(this.collection,"clear-preview",function(){this.$(".catalog-item").removeClass("preview-selected")})},__emptyText:function(){var e=this.__stringManager.get("sticker_templates_empty_solo"),t=this.__stringManager.get("sticker_templates_empty_coop");return{emptySolo:{standard:e,concise:e},emptyCoop:{standard:t,concise:t}}},__updateEmpty:function(){if(0===this.collection.models.length&&!this.__$empty){var i=this.__emptyText();i?"single"===this.__selectedTab?(this.__$empty=$(e.emptyTemplate({standard:i.emptySolo.standard,concise:i.emptySolo.concise})),this.$el.append(this.__$empty)):"cooperative"===this.__selectedTab&&(this.__$empty=$(e.emptyTemplate({standard:i.emptyCoop.standard,concise:i.emptyCoop.concise})),this.$el.append(this.__$empty)):t.prototype.__updateEmpty.call(this)}}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],StickerItem:gt,emptyTemplate:ht}),ut=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;return'\n    <li class="segmented-control-item" data-value="'+(t=this.escapeExpression)("function"==typeof(a=null==n||!1===n?n:n.key)?a.apply(e):a)+'">\n        '+t("function"==typeof e?e.apply(e):e)+"\n    </li>\n    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i='<ul class="disable-text-selection">\n    ',((a=t.each.call(e,e&&e.options,{name:"each",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n</ul>\n"},useData:!0})}(),mt=function(e){var t=e.UiCore.UiContext;return t.extend("SegmentedControl",{className:"segmented-control",uiContextName:"segmented_control",dependencies:["loginManager","name","options","window"],trackedEvents:function(){return[{type:"click",selector:".segmented-control-item",name:"segmented_control_item_click",handler:this.__onClickItem.bind(this),allowBubble:!0}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__name=e.name,this.__options=e.options,this.__loginManager=e.loginManager,this.__isLoggedIn=this.__loginManager.isLoggedIn(),this.addToDOM(),this.$(".segmented-control-item").first().addClass("is-selected")},render:function(){this.$el.html(e.template({name:this.__name,options:this.__options}))},__select:function(t){if(!this.__isLoggedIn){var i=this.$(".segmented-control-item[data-value=comments] .counter .count");i.removeClass("count"),i.addClass("hidden"),(i=this.$(".segmented-control-item[data-value=likes] .counter .count")).removeClass("count"),i.addClass("hidden"),(i=this.$(".segmented-control-item[data-value=tags] .counter .count")).removeClass("count"),i.addClass("hidden")}(t=$(t)).hasClass("is-selected")||(e.NextUtil.DomHelper.radioClass(t,"is-selected"),t.trigger("change"))},__onClickItem:function(e){this.__select(e.currentTarget)},toggleOption:function(e,t){this.$(".segmented-control-item[data-value="+e+"]").prop("disabled",!t)},val:function(e){if(!e)return this.$(".segmented-control-item.is-selected").attr("data-value");this.__select(this.$(".segmented-control-item[data-value="+e+"]"))}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:ut}),ft=function(e){var t=e.UiCore.UiContext;return t.extend("StickerPackDetail",{className:"sticker-pack-detail",uiContextName:"sticker_pack_detail",dependencies:["globalStringManager"],trackedEvents:function(){return t.prototype.trackedEvents.call(this).concat([{type:"change",selector:".sticker-menu [data-value]",name:"sticker_types",handler:this.__onChangeStickerType,attributes:function(e){return{tab_type:e.attr("data-value")}}}])},initialize:function(e){t.prototype.initialize.call(this,e),this.__model=e.model,this.__startingTab=e.startingTab,this.__canPreview=!!e.canPreview,this.addToDOM()},render:function(){this.$el.html(e.template),this.catalogTabs=this.createChildContext(e.SegmentedControl,{$parentElement:this.$(".sticker-menu"),name:"catalogTab",options:{all:this.__globalStringManager.get("All"),single:this.__globalStringManager.get("Solo"),cooperative:this.__globalStringManager.get("Group")}}),this.catalogTabs.val(this.__startingTab),this.__showStickers()},selectTab:function(e){this.catalogTabs.val(e)},__showStickers:function(){this.__stickerTemplateList&&this.__stickerTemplateList.delete(),this.__templateCollection&&this.untrack(this.__templateCollection);var t={},i=this.catalogTabs.val();"all"!==i&&(t.type=i),i=(i=this.$(".segmented-control-item.is-selected")).eq(i.length-1).data("value"),this.__templateCollection=this.track(this.__model.searchEdgeCollection("sticker_templates",t,e.UiCore.EdgeCollection)),this.__stickerTemplateList=this.createChildContext(e.StickerTemplateList,{$parentElement:this.$(".catalog"),collection:this.__templateCollection,canPreview:this.__canPreview,selectedTab:i}),this.__templateCollection.enumerated().then(function(){this.trigger("updated")}.bind(this),function(){this.untrack(this.__templateCollection),this.__templateCollection.release(),this.trigger("error")}.bind(this))},__onChangeStickerType:function(e){this.__showStickers()}})}({UiCore:e["@UiCore"],template:ct,StickerTemplateList:pt,SegmentedControl:mt}),vt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return"New"},useData:!0})}(),bt=function(e){var t=e.UiCore.UiContext;return t.extend("IsNewTag",{className:"is-new-tag",uiContextName:"is_new_tag",tagName:"span",initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template())}})}({UiCore:e["@UiCore"],template:vt}),Ct=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("StickerPackDetailDialog",{uiContextName:"sticker_pack_detail_dialog",className:"sticker-pack-detail-dialog dialog-type-B",dependencies:["Promise","globalStringManager","restModelFactory","dialogManager"],initialize:function(i){this.__formatNumber=e.FormatNumber,this.__restModelFactory=i.restModelFactory,this.__dialogManager=i.dialogManager,t.prototype.initialize.call(this,i),this.addToDOM()},trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},postRender:function(){this.model.populated().then(function(){return this.__creatorModel=this.model.getSingleEdge("creator"),this.__creatorModel.populated()}.bind(this)).then(function(){var t=this.__getDetails();t.price=this.model.get("product_price")?this.model.get("product_price"):this.__globalStringManager.get("FREE"),this.setContent("body",e.template,t),this.$(".dialog-title").text(this.model.get("product_name")),this.$(".dialog-header").prepend(e.backButtonTemplate({})),this.$(".product-select").prop("checked",this.model.get("is_selected")),t=this.model.get("product_image"),this.imageHeight&&this.imageWidth&&(t=IMVU.URI.build(t,{width:this.imageWidth,height:this.imageHeight})),this.$("img").attr({src:t}),this.__maybeCreateNewTag(),this.createChildContext(e.StickerPackDetail,{$parentElement:this.$(".sticker-picker"),model:this.model,canPreview:!0}),_.each(["single","cooperative"],function(t){this.__restModelFactory.searchCollection(this.model.relations.sticker_templates,{type:t,limit:0},e.UiCore.EdgeCollection).populated().then(function(e){this.$("."+t+"-count").text(e.total_count)}.bind(this))}.bind(this)),"mobile"===this.serviceProvider.get("platform")?this.$(".sticker-pack-container").css("max-height",this.__window.innerHeight-50+"px"):this.$(".sticker-pack-container").scrollbar()}.bind(this))},__getDetails:function(){return{name:this.model.get("product_name"),price:this.__formatNumber.formatCredits(Number(this.model.get("product_price"))),checked:this.model.get("is_selected"),product_id:this.model.get("product_id"),creator:this.__creatorModel.get("display_name"),also_tried_on:this.model.get("also_tried_on"),isAp:"AP"===this.model.get("rating")}},__goBack:function(){this.promiseResolver.resolve(!0)},__maybeCreateNewTag:function(){this.model.get("is_new")&&this.createChildContext(e.IsNewTag,{$replaceElement:this.$(".is-new-label")})}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:lt,FormatNumber:r,StickerPackDetail:ft,backButtonTemplate:dt,IsNewTag:bt}),yt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;i=t.helperMissing;var s='\n\t<p class="in-inventory">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"IN INVENTORY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</p>\n"},3:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='\n\t<p class="in-inventory hidden">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"IN INVENTORY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+'</p>\n\t<p class="price-credits">'+o("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+"</p>\n"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return i='<div class="is-new"></div>\n<div class="image-wrapper"><img src="" /></div>\n<h1 class="is-truncated">'+(i=this.escapeExpression)("function"==typeof(s=t.product_name||e&&e.product_name)?s.call(e,{name:"product_name",hash:{},data:n}):s)+"</h1>\n\n\n",((a=t.if.call(e,e&&e.is_owned,{name:"if",hash:{},fn:this.program(1,n),inverse:this.program(3,n),data:n}))||0===a)&&(i+=a),i+"\n"},useData:!0})}(),Mt=function(e){var t=e.UiCore.ListPresenter;return t.extend("StickerCatalog",{uiContextName:"sticker_catalog",className:"sticker-catalog is-list",tagName:"ul",itemFactory:e.StickerItem,initialize:function(e){t.prototype.initialize.call(this,e)},render:function(){t.prototype.render.call(this),this.__scroller=this.$el,$(this.__scroller).on("scroll",this.__onScroll.bind(this))},addToDOM:function(){t.prototype.addToDOM.call(this)},__onScroll:function(){this.__maybePage()},__onPaged:function(){this.$el.removeClass("loading"),this.__maybePage()},__maybePage:function(){this.__shouldPage()&&this.collection.hasNextPage()&&(this.$el.addClass("loading"),this.collection.getNextPage().then(this.__onPaged.bind(this),this.__onPaged.bind(this)))},__childrenInDOM:function(){var e=_.map(_.filter(_.values(this.__registry),function(e){return e.$el}),function(e){return e.$el[0]});return this.$el.children().filter(e)},__readyToPage:function(){return!(this.isDeleted()||this.collection.isSyncing()||!this.$el.is(":visible"))&&this.__childrenInDOM().length===this.collection.length},__shouldPage:function(){if(!this.__readyToPage())return!1;var e;e=this.__scroller[0]===this.__window?this.__scroller.scrollTop()+this.__scroller.height():this.__scroller.offset().top+this.__scroller.height();var t=this.$el.children().eq(-this.triggerNextPage);return 0===t.length||t.offset().top<=e}})}({UiCore:e["@UiCore"],StickerItem:gt}),kt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;return"\n        <div class='name'>"+(0,this.escapeExpression)("function"==typeof(a=t.name||e&&e.name)?a.call(e,{name:"name",hash:{},data:n}):a)+"</div>\n    "},3:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r="\n        <div class='created-by'>";return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"By",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+" <span class='creator'>"+o("function"==typeof(s=t.creator||e&&e.creator)?s.call(e,{name:"creator",hash:{},data:n}):s)+"</span></div>\n    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r='<div class="is-new"></div>\n<input id=\'cart-item-'+i("function"==typeof(s=t.product_id||e&&e.product_id)?s.call(e,{name:"product_id",hash:{},data:n}):s)+"' class='checkbox product-select' "+i("function"==typeof(s=t.checked||e&&e.checked)?s.call(e,{name:"checked",hash:{},data:n}):s)+" type='checkbox'>\n<div class='product-info' for='cart-item-"+i("function"==typeof(s=t.product_id||e&&e.product_id)?s.call(e,{name:"product_id",hash:{},data:n}):s)+"'>\n    <div class='cart-image'>\n        <img>\n    </div>\n    ";return((a=t.if.call(e,e&&e.name,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+='\n    <div class="sticker-count">\n        <span class="single-count"></span> ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"Solo",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+=',\n        <span class="cooperative-count"></span> ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"Group",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+="\n    </div>\n    ",((a=t.if.call(e,e&&e.creator,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+="\n    <div class='price-credits'>"+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+"</div>\n</div>\n<p class='preview-label'>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"Click to preview",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+'</p>\n<div class="sticker-picker"></div>'},useData:!0})}(),xt=function(e){return{render:function(t,i){if(t.html(e.template(i)),t.find(".product-select").prop("checked",i.checked),i.preview_image){var n=i.preview_image;i.imageHeight&&i.imageWidth&&(n=IMVU.URI.build(n,{width:i.imageWidth,height:i.imageHeight})),t.find("img").attr({src:n})}i.creator&&(t.addClass("has-creator"),t.find(".creator-name").text(i.creator.display_name))}}}({template:function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return"\n    <div class='also-tried-on'>YOU ALSO TRIED ON</div>\n"},3:function(){return'<button class="btn ap ap-badge"></button>'},5:function(e,t,i,n){var a;return"\n        <div class='name'>"+(0,this.escapeExpression)("function"==typeof(a=t.name||e&&e.name)?a.call(e,{name:"name",hash:{},data:n}):a)+"</div>\n    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=this.escapeExpression;var o="";return((a=t.if.call(e,e&&e.also_tried_on,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+="\n<input id='cart-item-"+i("function"==typeof(s=t.product_id||e&&e.product_id)?s.call(e,{name:"product_id",hash:{},data:n}):s)+"' class='checkbox product-select' "+i("function"==typeof(s=t.checked||e&&e.checked)?s.call(e,{name:"checked",hash:{},data:n}):s)+" type='checkbox'>\n<label class='product-info' for='cart-item-"+i("function"==typeof(s=t.product_id||e&&e.product_id)?s.call(e,{name:"product_id",hash:{},data:n}):s)+"'>\n    <div class='cart-image'>\n        <img>\n        ",((a=t.if.call(e,e&&e.isAp,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+="\n    </div>\n    ",((a=t.if.call(e,e&&e.name,{name:"if",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+"\n    <div class='creator'></div>\n    <div class='price-credits'>"+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+"</div>\n</label>\n"},useData:!0})}()}),wt=function(e){var t=e.UiCore.UiContext;return t.extend("CartListItem",{tagName:"li",className:"cart-list-item",uiContextName:"item",dependencies:["globalStringManager","loginManager","Promise"],trackedEvents:function(){return[{type:"click",selector:".product-select",name:"change_product_select",handler:this.__changeProductSelect.bind(this)}]},initialize:function(i){t.prototype.initialize.call(this,i),this.loginManager=i.loginManager,this.__myself=i.loginManager.getCurrentUser(),this.imageHeight=i.imageHeight?i.imageHeight:null,this.imageWidth=i.imageWidth?i.imageWidth:null,this.__formatNumber=e.FormatNumber,this.__priceResolver=null,this.__pricePromise=new this.__Promise(function(e){this.__priceResolver=e}.bind(this)),this.addToDOM()},render:function(){this.model.populated().then(function(){var t=this.__getDetails();e.CartListItemUi.render(this.$el,t),this.model.getSingleEdge("creator").populated().then(function(t){this.__displayName=this.createChildContext(e.Widgets.DisplayName,{$parentElement:this.$(".creator"),user:t,size:"tiny",color:"dark",showVipBadge:!1,ignoreClicks:!0,prefix:this.__globalStringManager.get("By")})}.bind(this))}.bind(this))},__getDetails:function(){return this.__getPrice(),this.__pricePromise.then(function(e){return{name:this.model.get("product_name"),price:this.__formatNumber.formatCredits(Number(e)),checked:this.model.get("is_selected"),product_id:this.model.get("product_id"),also_tried_on:this.model.get("also_tried_on"),isAp:"AP"===this.model.get("rating"),preview_image:this.model.get("preview_image"),imageWidth:this.imageWidth,imageHeight:this.imageHeight}}.bind(this)).result},__getPrice:function(){var t=this.model.get("product_price");if(this.model.get("is_bundle")){var i=this.model.getEdgeCollection("subproducts",e.Model.ProductEdgeCollection);i.populated().then(function(){i.map(function(e){e.node.get("is_owned")&&80!=e.node.get("product_id")&&191!=e.node.get("product_id")&&(t-=e.node.get("product_price"))}.bind(this)),this.__priceResolver.accept(t)}.bind(this))}else this.__priceResolver.accept(t)},__changeProductSelect:function(e){this.model.set("is_selected",!!$(e.target).prop("checked"))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],Model:e["@Model"],CartListItemUi:xt,FormatNumber:r}),Pt=function(e){return e.CartListFactory.extend("StickerCartListItem",{tagName:"li",className:"sticker-cart-list-item",uiContextName:"item",dependencies:["restModelFactory","globalStringManager"],render:function(){this.model.populated().then(function(){return this.__creatorModel=this.model.getSingleEdge("creator"),this.__creatorModel.populated()}.bind(this)).then(function(){this.model.set("is_selected",!0);var t=this.__getDetails();t.price=this.model.get("product_price")?this.model.get("product_price"):this.__globalStringManager.get("FREE"),this.$el.html(e.template(t)),this.$(".product-select").prop("checked",this.model.get("is_selected")),t=this.model.get("product_image"),this.imageHeight&&this.imageWidth&&(t=IMVU.URI.build(t,{width:this.imageWidth,height:this.imageHeight})),this.$("img").attr({src:t}),this.__isNew(),this.createChildContext(e.StickerPackDetail,{$parentElement:this.$(".sticker-picker"),model:this.model,canPreview:!0}),_.each(["single","cooperative"],function(t){this.__restModelFactory.searchCollection(this.model.relations.sticker_templates,{type:t,limit:0},e.UiCore.EdgeCollection).populated().then(function(e){this.$("."+t+"-count").text(e.total_count)}.bind(this))}.bind(this))}.bind(this))},__isNew:function(){this.model.get("is_new")&&this.createChildContext(e.IsNewTag,{$replaceElement:this.$(".is-new")})}})}({UiCore:e["@UiCore"],template:kt,CartListFactory:wt,StickerPackDetail:ft,IsNewTag:bt}),$t=function(e){var t=e.UiCore.ListPresenter;return t.extend("StickerCartList",{uiContextName:"sticker_cart_list",className:"sticker-cart-list",initialize:function(i){i.imageWidth=80,i.imageHeight=80,this.itemFactory=i.itemFactory||e.CartListItem,t.prototype.initialize.call(this,i)}})}({UiCore:e["@UiCore"],CartListItem:Pt}),St=function(e){var t=e.UiCore.UiContext;return t.extend("StickerPack",{className:"sticker-pack",uiContextName:"sticker_pack",dependencies:["imageManager","dialogManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"",name:"sticker_pack_add_to_cart",handler:"__buyStickerPack"}]},initialize:function(e){this.__useBackButton=!0===e.useBackButton,t.prototype.initialize.call(this,e),this.addToDOM(),this.listenTo(this.model,"change",this.__maybeCreateOwnedTag)},render:function(){this.$el.html(e.template({product_name:this.model.get("product_name"),price:this.model.get("product_price")?this.model.get("product_price"):this.__globalStringManager.get("FREE"),is_owned:this.model.get("is_owned")})),this.__maybeCreateNewTag(),this.__setImage(this.model.get("product_image")),this.$el.toggleClass("is-owned",this.model.get("is_owned"))},__setImage:function(e){this.__imageManager.load(this.$("img"),e,{container:this.$el})},__buyStickerPack:function(t){this.model.get("is_owned")?this.__dialogManager.showDialog(e.StickerPackDetailDialog,{model:this.model}):this.__dialogManager.showDialog(e.Checkout.CheckoutDialog,{cart:new e.Checkout.CartCollection([this.model]),cartListFactory:e.stickerCartListFactory,isStickerCheckout:!0,stickerPackName:this.model.get("product_name"),useBackButton:this.__useBackButton})},__maybeCreateNewTag:function(){this.model.get("is_new")&&this.createChildContext(e.IsNewTag,{$replaceElement:this.$(".is-new")})},__maybeCreateOwnedTag:function(){this.model.get("is_owned")&&(this.$(".price-credits").remove(),this.$(".in-inventory").removeClass("hidden"))}})}({UiCore:e["@UiCore"],Checkout:e["@Checkout"],template:yt,StickerCatalog:Mt,Sticker:at,IsNewTag:bt,StickerPackDetailDialog:Ct,stickerCartListFactory:$t}),Ut=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("StickerPackList",{uiContextName:"sticker_pack_list",className:"sticker-packList",tagName:"section",dependencies:["globalStringManager"],initialize:function(i){this.itemFactory=i.itemFactory||e.StickerPack,t.prototype.initialize.call(this,i)},__emptyText:function(){return{standard:this.__globalStringManager.get("No Sticker Packs Available"),concise:this.__globalStringManager.get("No Sticker Packs Available")}}})}({Widgets:e["@Widgets"],template:rt,StickerPack:St}),Tt=function(t){var i={Dialogs:e["@Dialogs"]}.Dialogs.AlloyModalDialog;return i.extend("TooltipDialog",{uiContextName:"tooltip_dialog",className:"tooltip-dialog dialog-type-B text-close",trackedEvents:function(){return this.__customTrackedEvents},initialize:function(e){this.__customTrackedEvents=e.trackedEvents||[],i.prototype.initialize.call(this,e),this.title=e.title,this.__tooltipContent=e.tooltipContent,this.addToDOM()},postRender:function(){this.setContent("body",this.__tooltipContent)}})}(),Dt=function(e){var t=e.UiCore.UiContext;return t.extend("Tooltip",{className:"tooltip",uiContextName:"tooltip",dependencies:["dialogManager","timer","tooltipLayer","window"],trackedEvents:function(){return[{type:"click",selector:"a",name:"link_click",handler:"__clickedLink",allowBubble:!0}].concat(this.__customTrackedEvents)},__installTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.on("mouseenter.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.$target.off("mouseleave.tooltip")}.bind(this)),this.__tooltipLayer.$el.on("mouseleave.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=this.__timer.setTimeout(function(){this.setVisible(!1),this.__timer.clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=this.__timer.setTimeout(function(){this.__hide(),this.__installTargetMouseleave()}.bind(this),125)}.bind(this),250)}.bind(this))},__removeTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.off(".tooltip")},initialize:function(e){this.$tooltip=IMVU.requireProperty(e,"$replaceElement"),this.$target=IMVU.requireProperty(e,"$tooltipTarget"),this.tooltipTitle=IMVU.optionalProperty(e,"title",!1),this.__tooltipStyle=IMVU.optionalProperty(e,"tooltipStyle","default"),this.__customTrackedEvents=e.trackedEvents||[],t.prototype.initialize.call(this,e),this.$body=$("body"),this.$globalNav=$("nav.global-nav:visible"),"mobile"===this.__serviceProvider.get("platform")?this.$target.on("click.tooltip",function(e){e.stopPropagation(),this.__openTooltipDialog()}.bind(this)):this.$target.on("mouseenter.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.__timer.clearTimeout(this.__targetFadeinTimeout),this.__installTargetMouseleave(),this.__targetFadeinTimeout=this.__timer.setTimeout(function(){this.setVisible(!0),this.__show()}.bind(this),250)}.bind(this)),"snug"===this.__tooltipStyle&&this.$el.addClass("tooltip-snug"),this.$el.append(this.$tooltip),this.setParentUiContext(this.__tooltipLayer),this.__tooltipLayer.$el.append(this.$el)},setVisible:function(e){this.$el.toggleClass("tooltip-open",!!e)},__installTargetMouseleave:function(){this.$target.on("mouseleave.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__targetTimeout=this.__timer.setTimeout(function(){this.setVisible(!1),this.__timer.clearTimeout(this.__targetTimeout),this.__targetTimeout=this.__timer.setTimeout(function(){this.__hide()}.bind(this),125)}.bind(this),250)}.bind(this))},__show:function(){this.__installTooltipLayerEventHandlers(),this.__trackTooltip(),$(this.__window).on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this)),this.$body.find(".transparent-overlay").on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this))},__trackTooltip:function(){var e=this.$globalNav.height(),t=this.$target[0].getBoundingClientRect().top,i=this.$target[0].getBoundingClientRect().left,n=$(window).width()-(i+this.$target.outerWidth()/2),a=this.$el[0].offsetWidth;0<this.$target.parents(".dialog-manager").length&&(e=0),i=n>a?i+this.$target.width()/2:i+this.$target.width()/2-a,this.$el.css({"margin-top":Math.max(t,e),"margin-left":i})},__hide:function(){this.__removeTooltipLayerEventHandlers(),this.setVisible(!1)},__openTooltipDialog:function(){return this.__dialogManager.showDialog(e.TooltipDialog,{title:this.tooltipTitle||this.$target.text(),tooltipContent:this.$tooltip.html(),trackedEvents:this.__customTrackedEvents})},delete:function(){this.$el.removeAttr("style"),this.__timer.clearTimeout(this.__targetFadeinTimeout),this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.$target.off(".tooltip"),this.__removeTooltipLayerEventHandlers(),$(this.__window).off("scroll.tooltip"),this.$body.find(".transparent-overlay").off("scroll.tooltip"),t.prototype.delete.call(this)},__clickedLink:function(){this.__hide()}})}({UiCore:e["@UiCore"],TooltipDialog:Tt}),Lt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="tile-thumbnail">\n    <img src="/common/withme/img/default_room_image.png" alt="room background image" />\n</div>\n<div class="tile-footer">\n    <div class="tile-name is-truncated">Night Time Noir</div>\n    <div class="tile-info">\n        <span class="icon-person"><svg viewBox="0 0 32 32"><path d="M19 23.3V22c3-1 4.8-3.8 4.8-9.2 0-5.2-3.5-8.5-8-8.5S8 7.6 8 12.8c0 5.4 2 8.3 4.8 9.3v1.4H9.4c-3.2 0-6 3-6.2 6.6v2h25.4v-2c0-3.7-3-6.6-6.2-6.7H19z"/></svg></span>\n        0/10\n    </div>\n</div>\n'},useData:!0})}(),Et=function(e){var t=e.UiCore.UiContext;return t.extend("ResponsiveTileListItem",{uiContextName:"responsive_tile_list_item",className:"responsive-tile-list-item",tagName:"li",dependencies:["timer"],trackedEvents:function(){return[{type:"click",name:"list_item_on_click",handler:this.__onClick}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM(),this.__setHeightTimeout=this.__timer.setTimeout(function(){this.$(".tile-thumbnail").height(this.$(".tile-thumbnail").width())}.bind(this),0)},render:function(){this.$el.html(e.template)},delete:function(){this.__timer.clearTimeout(this.__setHeightTimeout),t.prototype.delete.call(this)},__onClick:function(){this.$el.hasClass("disabled")||(e.NextUtil.DomHelper.radioClass(this.$el,"is-selected"),this.trigger("item_selected",this.model))},__disableFilter:function(e){this.model.node.get(e.key)===e.value&&this.$el.addClass("disabled")}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:Lt}),At=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("ResponsiveTileList",{uiContextName:"responsive_tile_list",className:"responsive-tile-list",triggerNextPage:3,initialize:function(i){this.itemFactory=IMVU.optionalProperty(i,"itemFactory",e.ResponsiveTileListItem),this.__emptyTemplate=IMVU.optionalProperty(i,"emptyTemplate",!1),this.__user=i.user?i.user:null,t.prototype.initialize.call(this,i),this.$el.toggleClass("two-columns",400>this.$el.width())},__updateEmpty:function(){this.__emptyTemplate?0!==this.collection.models.length||this.__$empty?this.collection.models.length&&this.__$empty&&(this.__$empty.remove(),this.__$empty=null):(this.__$empty=$(this.__emptyTemplate({})),this.$el.append(this.__$empty),this.__$empty.find(".icon-tooltip-icon")&&this.createChildContext(e.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".icon-tooltip-icon")})):t.prototype.__updateEmpty.call(this)}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],ResponsiveTileListItem:Et,Tooltip:Dt}),It=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;i=t.helperMissing;var s='\n        <p class="in-inventory">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"IN INVENTORY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</p>\n    "},3:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='\n        <p class="in-inventory hidden">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"IN INVENTORY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+'</p>\n        <p class="price-credits">'+o("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+"</p>\n    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return i='<div class="is-new"></div>\n<div class="tile-thumbnail">\n    <div class="cover-image"></div>\n</div>\n<div class="tile-footer">\n    <div class="tile-name is-truncated">'+(i=this.escapeExpression)("function"==typeof(s=t.product_name||e&&e.product_name)?s.call(e,{name:"product_name",hash:{},data:n}):s)+"</div>\n\n    \n    ",((a=t.if.call(e,e&&e.is_owned,{name:"if",hash:{},fn:this.program(1,n),inverse:this.program(3,n),data:n}))||0===a)&&(i+=a),i+"\n</div>"},useData:!0})}(),Nt=function(e){var t=e.ResponsiveTileListItem;return t.extend("ResponsiveStickerPack",{className:"responsive-sticker-pack responsive-tile-list-item",uiContextName:"responsive_sticker_pack",dependencies:["imageManager","dialogManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"",name:"sticker_pack_add_to_cart",handler:"__buyStickerPack"}]},initialize:function(e){this.__useBackButton=!0===e.useBackButton,t.prototype.initialize.call(this,e),this.addToDOM(),this.listenTo(this.model,"change",this.__maybeCreateOwnedTag)},render:function(){this.$el.html(e.template({product_name:this.model.get("product_name"),price:this.model.get("product_price")?this.model.get("product_price"):this.__globalStringManager.get("FREE"),is_owned:this.model.get("is_owned")})),this.__maybeCreateNewTag(),this.__setImage(this.model.get("product_image")),this.$el.toggleClass("is-owned",this.model.get("is_owned"))},__setImage:function(e){this.__imageManager.loadAsBackgroundImage(this.$(".cover-image"),e,{container:this.$el})},__buyStickerPack:function(t){this.model.get("is_owned")?this.__dialogManager.showDialog(e.StickerPackDetailDialog,{model:this.model}):this.__dialogManager.showDialog(e.Checkout.CheckoutDialog,{cart:new e.Checkout.CartCollection([this.model]),cartListFactory:e.stickerCartListFactory,isStickerCheckout:!0,stickerPackName:this.model.get("product_name"),useBackButton:this.__useBackButton})},__maybeCreateNewTag:function(){this.model.get("is_new")&&this.createChildContext(e.IsNewTag,{$replaceElement:this.$(".is-new")})},__maybeCreateOwnedTag:function(){this.model.get("is_owned")&&(this.$(".price-credits").remove(),this.$(".in-inventory").removeClass("hidden"))}})}({UiCore:e["@UiCore"],Checkout:e["@Checkout"],template:It,StickerCatalog:Mt,Sticker:at,IsNewTag:bt,StickerPackDetailDialog:Ct,stickerCartListFactory:$t,ResponsiveTileListItem:Et}),Ft=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("StickerPackDialog",{uiContextName:"sticker_pack_dialog",className:"sticker-pack-dialog dialog-type-B",dependencies:"Promise dialogManager featureAccessManager globalStartupModel globalStringManager loginManager restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_to_checkout",handler:this.__backToCheckout}]},initialize:function(e){t.prototype.initialize.call(this,e),this.dialogManager=e.dialogManager,this.__myself=e.loginManager.getCurrentUser(),this.__stickerPacksEndPoint=this.__globalStartupModel.get("productEndpoint"),this.title=this.__globalStringManager.get("WithMoji Shop"),this.$el.toggleClass("is-padded",!!this.__featureAccessManager.canSeeResponsiveList()),this.addToDOM()},destroy:function(){this.hide(),this.delete()},postRender:function(){this.__myself.populated().then(function(){return this.setContent("body",e.template),this.__stickerPackCollection=this.track(this.__restModelFactory.searchCollection(this.__stickerPacksEndPoint,{cat:this.__globalStartupModel.get("stickerPackCategory")},e.Model.ProductCollection)),this.__stickerPackCollection.populated()}.bind(this)).then(function(){this.__featureAccessManager.canSeeResponsiveList()?this.createChildContext(e.ResponsiveTileList,{collection:this.__stickerPackCollection,$parentElement:this.$(".sticker-packs"),stringManager:this.__globalStringManager,itemFactory:e.ResponsiveStickerPack}):this.createChildContext(e.StickerPackList,{collection:this.__stickerPackCollection,$parentElement:this.$(".sticker-packs"),stringManager:this.__globalStringManager}),this.$(".sticker-packs").scrollbar()}.bind(this))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],Model:e["@Model"],template:ot,FormatNumber:r,StickerPackList:Ut,ResponsiveTileList:At,ResponsiveStickerPack:Nt}),Ht=function(t){var i={UiCore:e["@UiCore"]}.UiCore.NodeModel;return i.extend("ProductNode",{initialize:function(){i.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:relations",this.__triggerChanges.bind(this))},__triggerChanges:function(e,t){t=t||{},(e=e||{}).viewer_inventory!=t.viewer_inventory&&this.trigger("change:is_owned",this,t.viewer_inventory),e.viewer_wishlist!=t.viewer_wishlist&&this.trigger("change:is_wished",this,t.viewer_wishlist)},isAvatar:function(){return _.contains(this.get("categories"),"Avatars")},isCompatibleWithBodyPatterns:function(e){var t=_.contains(this.get("is"),"clothing_product"),i=_.contains(this.get("is"),"avatar_attachment");return e=0<_.intersection(e,this.get("compatible_body_patterns")).length,t&&(i||e)},getPrices:function(){return{full:this.get("product_price"),discounted:this.get("discount_price")?this.get("discount_price"):this.get("product_price")}},get:function(e){switch(e){case"is_owned":return!!this.relations.viewer_inventory;case"is_wished":return!!this.relations.viewer_wishlist;default:return i.prototype.get.apply(this,arguments)}}})}(),Rt=function(e){var t=e.UiCore.UiContext;return t.extend("RecentStickerItem",{uiContextName:"sticker_catalog_item",tagName:"li",className:"catalog-item sticker-item recent-sticker-item",dependencies:["restModelFactory","loginManager","imageManager","featureAccessManager"],trackedEvents:function(){return this.__canPreview?[{type:"click",name:"toggle_preview",handler:this.togglePreview}]:[]},initialize:function(e){this.__restModelFactory=e.restModelFactory,this.__myself=e.loginManager.getCurrentUser(),this.__imageManager=e.imageManager,this.__featureAccessManager=e.featureAccessManager,this.__canPreview=!!e.canPreview,t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.model.populated().then(function(){var t=this.model.node||this.model,i=t.get("thumb_image");this.$el.attr("data-id",t.get("template_id")),this.$el.attr("data-participant_count",t.get("participant_count")),1<this.$el.attr("data-participant_count")?this.$el.attr("data-sticker-type","cooperative"):this.$el.attr("data-sticker-type","single"),this.$el.html(e.template),this.__imageManager.load(this.$(".sticker-thumbnail"),i,{defaultImage:"/common/withme/img/sticker_template_error.png"})}.bind(this)).catch(function(){this.$el.hide()}.bind(this))},togglePreview:function(){this.__preview||(this.__preview=this.createChildContext(e.StickerPreview,{$parentElement:this.$el,stickerTemplate:this.model.node.id,participants:[this.__myself.id]})),this.$el.toggleClass("previewing").siblings().removeClass("previewing")}})}({UiCore:e["@UiCore"],template:_t,StickerPreview:st}),Bt=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("RecentStickerTemplateList",{uiContextName:"catalog_menu_list",className:"catalog-menu-list",itemFactory:e.RecentStickerItem,dependencies:["collection","globalStringManager"],initialize:function(e){this.__stringManager=e.globalStringManager,t.prototype.initialize.call(this,e)},__emptyText:function(){var e=this.__stringManager.get("recent_sticker_templates_empty");return{standard:e,concise:e}}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],RecentStickerItem:Rt}),Ot=function(e){var t=e.UiCore.UiContext;return t.extend("RecentStickerPackDetail",{className:"sticker-pack-detail recent-sticker-pack-detail",uiContextName:"sticker_pack_detail",dependencies:["Promise","globalStringManager"],trackedEvents:function(){return t.prototype.trackedEvents.call(this).concat([{type:"change",selector:".sticker-menu [data-value]",name:"sticker_types",handler:this.__onChangeStickerType,attributes:function(e){return{tab_type:e.attr("data-value")}}}])},initialize:function(e){this.__globalStringManager=e.globalStringManager,t.prototype.initialize.call(this,e),this.__Promise=e.Promise,this.__stickers=e.stickersArray,this.__startingTab=e.startingTab,this.__canPreview=!!e.canPreview,this.addToDOM()},render:function(){this.$el.html(e.template),this.catalogTabs=this.createChildContext(e.SegmentedControl,{$parentElement:this.$(".sticker-menu"),name:"catalogTab",options:{all:this.__globalStringManager.get("All"),single:this.__globalStringManager.get("Solo"),cooperative:this.__globalStringManager.get("Group")}}),this.catalogTabs.val(this.__startingTab),this.__showStickers()},selectTab:function(e){this.catalogTabs.val(e)},__showStickers:function(){this.__stickerTemplateList&&this.__stickerTemplateList.delete(),this.__templateCollection&&this.untrack(this.__templateCollection),this.$el.toggleClass("empty",0===this.__stickers.length);var t=_.map(this.__stickers,function(e){return this.__serviceProvider.create(IMVU.NamedModel,e)}.bind(this));_.each(t,function(e){e.populated=function(){return this.__Promise.resolve()}.bind(this)}.bind(this)),this.__templateCollection=this.__serviceProvider.create(IMVU.NamedCollection,t,{model:IMVU.NamedModel}),this.__templateCollection.url="synthesizedCollection/recentStickers",this.__templateCollection.enumerated=function(){return this.__Promise.resolve()}.bind(this),this.__templateCollection.populated=function(){return this.__Promise.resolve()}.bind(this),this.__templateCollection.hasNextPage=function(){return!1},this.__templateCollection.isSyncing=function(){return!1},this.__stickerTemplateList=this.createChildContext(e.RecentStickerTemplateList,{$parentElement:this.$(".catalog"),collection:this.__templateCollection,canPreview:this.__canPreview}),this.__templateCollection.enumerated().catch(function(){this.untrack(this.__templateCollection),this.__templateCollection.release(),this.trigger("error")}.bind(this))},__onChangeStickerType:function(t){this.$(".catalog-menu-list .no-results").remove(),this.$(".catalog-menu-list .sticker-item").each(function(e,i){$(i).toggleClass("hidden",$(i).attr("data-sticker-type")!==$(t.currentTarget).attr("data-value"))}),"all"===$(t.currentTarget).attr("data-value")&&this.$(".catalog-menu-list .sticker-item").removeClass("hidden");var i=this.$(".catalog-menu-list .sticker-item:not(.hidden)").length;this.__$empty=$(e.emptyTemplate({standard:this.__globalStringManager.get("recent_sticker_templates_type_empty"),concise:this.__globalStringManager.get("recent_sticker_templates_type_empty")})),0===i&&this.$(".catalog-menu-list").append(this.__$empty)}})}({UiCore:e["@UiCore"],template:ct,emptyTemplate:ht,RecentStickerTemplateList:Bt,SegmentedControl:mt}),zt=function(e){var t=e.ChatBarMenu;return t.extend("StickerMenu",{className:"chat-bar-menu sticker-menu",uiContextName:"sticker_menu",payloadName:"sticker_template",dependencies:"contextMenuManager dialogManager globalStartupModel globalStringManager localStorage loginManager prefsManager Promise restModelFactory".split(" "),trackedEvents:function(){return t.prototype.trackedEvents.call(this).concat([{type:"click",selector:".sticker-pack-item",name:"sticker_pack",handler:this.__onClickStickerPack},{type:"click",selector:".recent-stickers",name:"recent_stickers",handler:this.__onShowRecentStickers},{type:"click",selector:".add-catalog",name:"add_catalog",handler:this.__onAddCatalog},{type:"click",selector:".shuffle",name:"shuffle_partner",handler:this.__shufflePartner},{type:"click",selector:".catalog-error-content",name:"retry_load",handler:this.__retryLoad}])},initialize:function(e){t.prototype.initialize.call(this,e),this.__myself=this.track(e.loginManager.getCurrentUser()),this.__context=e.context,this.__partnerCollection=e.partnerCollection,this.listenTo(this.__partnerCollection,"add remove reset",this.__refreshShuffleButton),this.addToDOM()},render:function(){this.$el.html(e.template());var t=this.__prefsManager.get("next.last_opened_WithMoji_shop");if(t){var i=this.__restModelFactory.searchCollection(this.__globalStartupModel.get("productEndpoint"),{cat:this.__globalStartupModel.get("stickerPackCategory"),since:t,limit:0},e.Model.ProductCollection);i.enumerated().then(function(){this.$(".new-badge").toggleClass("hidden",0===i.total_count)}.bind(this))}else this.$(".new-badge").removeClass("hidden")},delete:function(){this.__stickerPackDetail&&this.__stickerPackDetail.delete(),this.__simpleScroller&&this.__simpleScroller.delete(),t.prototype.delete.call(this)},onSubmit:function(){this.__updateStickerPref(this.getSelection().template,this.getSelection().thumb_image,this.getSelection().participants.length)},preselectPartner:function(e){this.__preselectedPartner=e,this.__stickerPackDetail?this.__stickerPackDetail.selectTab("cooperative"):this.__startingTab="cooperative"},hideCatalog:function(){this.__preselectedPartner=null,t.prototype.hideCatalog.call(this)},__createCatalog:function(){this.$el.removeClass("error").addClass("loading"),this.__Promise.every([this.__myself.populated(),this.__globalStartupModel.populated()]).then(function(){return this.__stickerPackCollection=this.track(this.__myself.searchEdgeCollection("inventory",{cat:this.__globalStartupModel.get("stickerPackCategory")},e.Model.ProductEdgeCollection)),this.__myAvatar=this.track(this.__myself.getSingleEdge("avatar")),this.__Promise.every([this.__myAvatar.populated(),this.__stickerPackCollection.enumerated()])}.bind(this)).then(function(){this.listenTo(this.__myAvatar,"change:asset_url",this.__updatePreviewContent)}.bind(this)).then(function(){if(this.$el.removeClass("loading"),this.__stickerPackCollection.length){var t=this.__preselectedPackId?this.__stickerPackCollection.find(function(e){return e.node.id===this.__preselectedPackId}.bind(this)):this.__stickerPackCollection.at(0);this.__selectStickerPack(t),this.__stickerPackList=this.createChildContext(e.StickerPackList,{$parentElement:this.$(".catalog-menu-bar .catalog-menu"),collection:this.__stickerPackCollection}),this.$(".catalog-menu-bar .catalog-menu li:first-child").addClass("selected"),this.__markSelectedPack(this.$('.sticker-pack-item[data-id="'+t.node.id+'"]')),this.__simpleScroller=this.createChildContext(e.SimpleScroller,{$target:this.$(".sticker-pack-list"),$parentElement:this.$(".catalog-menu"),autoRefresh:!0})}}.bind(this)).catch(function(){this.$el.removeClass("loading").addClass("error"),this.__stickerPackCollection&&(this.untrack(this.__stickerPackCollection),this.__stickerPackCollection.release())}.bind(this))},__retryLoad:function(){this.__selectedStickerPack?this.__showPackDetails():this.__createCatalog()},__selectStickerPack:function(e){e.populated().then(function(){this.__selectedStickerPack=e,this.__showPackDetails()}.bind(this))},__refreshCatalogTabs:function(){this.__templateCollection.populated().then(function(){var e=this.__templateCollection.any(function(e){return 1===e.node.get("participant_count")}),t=this.__templateCollection.any(function(e){return 1<e.node.get("participant_count")});this.catalogTabs.toggleOption("single",e),this.catalogTabs.toggleOption("cooperative",t)}.bind(this))},__showStickers:function(){this.__stickerTemplateList?this.__stickerTemplateList.delete():this.__startingTab="cooperative"},__showPackDetails:function(){this.$el.removeClass("error"),this.__stickerPackDetail&&this.__stickerPackDetail.delete(),this.$(".catalog-container .detail-container").scrollbar(),this.__stickerPackDetail=this.createChildContext(e.StickerPackDetail,{$parentElement:this.$(".catalog-container .detail-container"),model:this.__selectedStickerPack.node,startingTab:this.__startingTab||"all"}),this.__stickerPackDetail.on("error",this.__onDetailError,this),this.__startingTab=null,this.__stickerPackDetail.on("updated",function(){this.__currentSelection&&this.$('.catalog-item[data-id="'+this.__currentSelection.template+'"]').addClass("highlighted")}.bind(this))},__onDetailError:function(){this.$el.addClass("error")},__getStickerPref:function(){return JSON.parse(this.__localStorage.getItem("next.recent_stickers-"+this.__myself.get("legacy_cid")))||[]},__updateStickerPref:function(e,t,i){var n=this.__removeStickerArray(e);n.unshift({template_id:e,thumb_image:t,participant_count:i}),n=n.slice(0,25),this.__setStickerPref(n),0!==this.$(".recent-stickers.selected").length&&this.__onShowRecentStickers()},__setStickerPref:function(e){this.__localStorage.setItem("next.recent_stickers-"+this.__myself.get("legacy_cid"),JSON.stringify(e))},__removeStickerArray:function(e){return this.__getStickerPref().filter(function(t){return t.template_id!==e})},__removeStickerPrefItem:function(e){e=this.__removeStickerArray(e),this.__setStickerPref(e)},__onClickItem:function(e){var t=$(e.currentTarget),i=t.data("id");i&&(this.__currentSelection&&i===this.__currentSelection.template?this.trigger("send"):1===t.data("participant_count")?this.__selectStickerTemplate(i):1===this.__availablePartners().length?(e=this.__availablePartners()[0],this.__selectStickerTemplate(i,(e.node||e).id)):this.__preselectedPartner?this.__selectStickerTemplate(i,this.__preselectedPartner):this.__choosePartnerFor(i,e))},__availablePartners:function(){return this.__partnerCollection.filter(function(e){return(e.node||e).id!==this.__myself.id}.bind(this))},__choosePartnerFor:function(t,i){var n=this.__partnerCollection.map(function(e){return{name:(e=e.node||e).id,user:e,classNames:this.__currentSelection&&e.id===this.__currentSelection.participants[1]&&t===this.__currentSelection.template?"currently-chosen":"",handler:this.__selectStickerTemplate.bind(this,t,e.id)}}.bind(this));this.__contextMenuManager.showMenu(i,e.CoopPartnerMenu,{items:n,displayOptions:{above:!0,right:!1}})},__selectStickerTemplate:function(t,i){var n=this.$('.sticker-item[data-id="'+t+'"]');e.NextUtil.DomHelper.radioClass(n,"highlighted"),this.__setSelection({template:t,participants:_.compact([this.__myself.id,i]),thumb_image:n.find("img").attr("src")})},__setSelection:function(e){t.prototype.__setSelection.call(this,e),this.__refreshShuffleButton()},__refreshShuffleButton:function(){this.$(".shuffle").toggle(this.__currentSelection&&1<this.__currentSelection.participants.length&&1<this.__availablePartners().length)},__shufflePartner:function(e){this.__preselectedPartner=null,this.__choosePartnerFor(this.getSelection().template,e)},__previewError:function(e,t){"STICKER_INSTANCE-001"===e.error.error&&(this.__dialogManager.alert({title:this.__globalStringManager.get("Sticker Unavailable"),text:this.__globalStringManager.get("This sticker is no longer available."),ok:this.__globalStringManager.get("OK")}),this.__removeStickerPrefItem(t),this.$('.catalog-menu-list [data-id="'+t+'"]').addClass("deleted"),this.cancelSelection())},__markSelectedPack:function(e){this.$(".catalog-menu-bar .selected").removeClass("selected"),e.addClass("selected")},__createPreviewContent:function(){var t=this.createChildContext(e.StickerPreview,{$parentElement:this.$(".preview"),stickerTemplate:this.__currentSelection.template,participants:this.__currentSelection.participants,context:this.__context});return this.listenTo(t,"preview-error",this.__previewError),t},__onShowRecentStickers:function(){this.__stickerTemplateList&&this.__stickerTemplateList.delete();var t=this.__getStickerPref();this.$el.removeClass("error"),this.__markSelectedPack(this.$(".recent-stickers")),this.__stickerPackDetail&&this.__stickerPackDetail.delete(),this.$(".catalog-container .detail-container").scrollbar(),this.__stickerPackDetail=this.createChildContext(e.RecentStickerPackDetail,{$parentElement:this.$(".catalog-container .detail-container"),stickersArray:t,startingTab:this.__startingTab||"all"}),this.__stickerPackDetail.on("error",this.__onDetailError,this),this.__startingTab=null},__onAddCatalog:function(){return this.__prefsManager.set("next.last_opened_WithMoji_shop",(new Date).toISOString()),this.$(".new-badge").addClass("hidden"),this.__dialogManager.showDialog(e.StickerPackDialog,{})},selectStickerPack:function(e){!this.__catalogCreated||this.$el.hasClass("loading")?this.__preselectedPackId=e:(this.__markSelectedPack(this.$('.sticker-pack-item[data-id="'+e+'"]')),this.__selectStickerPack(this.__stickerPackCollection.find(function(t){return t.node.id===e})))},__onClickStickerPack:function(e){(e=$(e.currentTarget).data("id"))&&this.selectStickerPack(e)}})}({UiCore:e["@UiCore"],Model:e["@Model"],NextUtil:e["@NextUtil"],template:Xe,ChatBarMenu:Ge,StickerPackList:Qe,StickerPreview:st,StickerPackDetail:ft,RecentStickerPackDetail:Ot,SimpleScroller:Pe,SegmentedControl:mt,ProductNode:Ht,CoopPartnerMenu:it,StickerPackDialog:Ft}),Wt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='preview'>\n    <div class='cancel'></div>\n</div>\n<div class='catalog-container'>\n    <div class='no-partner-message notation'>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"no_coop_partners",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n</div>"},useData:!0})}(),Vt=function(e){var t=e.ActionMenu;return t.extend("CoopActionMenu",{uiContextName:"coop_action_menu",payloadName:"coop_action",className:"chat-bar-menu coop-action-menu",actionType:"coop",dependencies:["contextMenuManager","dialogManager","globalStringManager","loginManager"],initialize:function(e){t.prototype.initialize.call(this,e),this.__contextMenuManager=e.contextMenuManager,this.__myself=e.loginManager.getCurrentUser(),this.__activeChat=e.activeChat,this.__stringManager=e.globalStringManager,this.__dialogManager=e.dialogManager,this.__preselectedPartner=null},__refreshPartners:function(){this.$el.toggleClass("no-partners",2>this.__participants.length)},render:function(){this.$el.html(e.template)},connect:function(e){t.prototype.connect.call(this,e),this.__participants&&(this.__participants.off(null,null,this),this.untrack(this.__participants)),this.__participants=this.track(e.getParticipants()),this.__refreshPartners(),this.__participants.on("add remove reset",this.__refreshPartners,this)},__onClickItem:function(e){var t=$(e.currentTarget).data("id");t&&(this.__preselectedPartner?this.__vetActionForPreselectedPartner(t):this.__choosePartner(t,e))},__onDoubleClickItem:function(){},__vetActionForPreselectedPartner:function(e){var t=this.__actionCollection.get(e);t.get("requires_ap")&&!this.__preselectedPartner.node.get("is_ap")?this.__dialogManager.alert({title:this.__stringManager.get("coop_partner_dialog_title"),text:this.__stringManager.get("coop_partner_dialog_text_ap"),ok:this.__stringManager.get("coop_partner_dialog_ok")}):t.get("requires_friend")&&!this.__preselectedPartner.node.relations.viewer_friend?this.__dialogManager.alert({title:this.__stringManager.get("coop_partner_dialog_title"),text:this.__stringManager.get("coop_partner_dialog_text_friend"),ok:this.__stringManager.get("coop_partner_dialog_ok")}):this.__selectCoopAction(e,this.__preselectedPartner)},hideCatalog:function(){t.prototype.hideCatalog.call(this),this.__maybeClearPreselected()},cancelSelection:function(){t.prototype.cancelSelection.call(this),this.__maybeClearPreselected()},__maybeClearPreselected:function(){this.getSelection()||this.$el.hasClass("showing-catalog")||(this.__preselectedPartner=null)},preselectPartner:function(e){this.__preselectedPartner=this.__participants.find(function(t){return t.node&&t.node.id===e.id}),this.cancelSelection()},__choosePartner:function(t,i){this.__preselectedPartner=null;var n=_.compact(this.__participants.map(function(e){if(e.node&&e.node.id!==this.__myself.id)return{name:e.edge.id,user:e.node,handler:this.__selectCoopAction.bind(this,t,e)}}.bind(this))),a=this.__actionCollection.get(t);this.__contextMenuManager.showMenu(i,e.CoopPartnerMenu,{items:n,displayOptions:{above:!0,right:!1},requirements:{ap:!!a.get("requires_ap"),friend:!!a.get("requires_friend")}})},__selectCoopAction:function(t,i){var n=this.$('[data-id="'+t+'"]');e.NextUtil.DomHelper.radioClass(n,"highlighted"),this.__setSelection({action:this.__actionCollection.get(t),partner:i})},__createPreviewContent:function(){var t=this.createChildContext(e.ActionCatalogItem,{$parentElement:this.$(".preview"),model:this.getSelection().action,partner:this.getSelection().partner});return t.on("change-partner",this.__choosePartner.bind(this,this.getSelection().action.id)),t},delete:function(){this.__participants&&this.__participants.off(null,null,this),t.prototype.delete.call(this)}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],ActionMenu:Ke,CoopPartnerMenu:it,ActionCatalogItem:Re,template:Wt}),qt=function(e){var t=e.ActionMenu;return t.extend("SoloActionMenu",{uiContextName:"solo_action_menu",payloadName:"solo_action",className:"chat-bar-menu solo-action-menu",actionType:"solo",__setSelection:function(e){t.prototype.__setSelection.call(this,e?this.__actionCollection.get(e):null)},getSelectionId:function(){return this.__currentSelection?this.__currentSelection.id:this.__currentSelection},__createPreviewContent:function(){return this.createChildContext(e.ActionCatalogItem,{$parentElement:this.$(".preview"),model:this.getSelection()})}})}({UiCore:e["@UiCore"],ActionMenu:Ke,ActionCatalogItem:Re}),Gt=function(e){var t=e.UiCore.UiContext;return t.extend("ExpandingChatBar",{className:"chat-bar",uiContextName:"expanding_chat_bar",dependencies:["timer","loginManager","featureAccessManager","globalStringManager","cardManager"],trackedEvents:function(){return[{type:"click",selector:".menu-toggle",name:"toggle_menu",handler:"__toggleMenus"},{type:"click",selector:".btn-send",name:"chat",handler:"__send",attributes:function(){return{number_of_windows:this.__serviceProvider.get("windowManager").getTotalOpenWindows(),sent_from:this.__isInWindow?"Window":"Mode"}}.bind(this)},{type:"click",selector:".menu-tabs li",name:"menu_tab",handler:"__onClickMenuTab",attributes:function(e){return{menu:e.attr("data-menu")}}},{type:"keydown",selector:"textarea",name:"keydown",handler:"__onKeydown",attributes:{repeats:1}},{type:"keypress",selector:"textarea",name:"keypress",handler:"__onKeypress",attributes:{repeats:1}},{type:"input",selector:"textarea",name:"input",handler:"__onInput",attributes:{repeats:1}}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__serviceProvider=i.serviceProvider,this.__timer=i.timer,this.__globalStringManager=i.globalStringManager,this.__featureAccessManager=i.featureAccessManager,this.__loginManager=i.loginManager,this.__placeholder=i.placeholder,this.__cardManager=i.cardManager,this.__isInWindow=!!i.isInWindow,this.__actionCategoryListFactory=i.actionCategoryListFactory,this.__menus={},this.__currentMenu=null,this.__context=IMVU.optionalProperty(i,"context"),this.__partnerCollection=IMVU.optionalProperty(i,"partnerCollection"),this.__menuFactories=i.menuFactories||!!this.__serviceProvider.services.menuFactories&&this.__serviceProvider.get("menuFactories")||{stickers:e.StickerMenu,solo_actions:e.SoloActionMenu,pid_actions:e.PidActionMenu,coop_actions:e.CoopActionMenu},this.addToDOM(),this.__createMenus(i.menus)},coopActionWith:function(e){this.showMenu("coop_actions"),this.__menus.coop_actions.preselectPartner(e)},coopStickerWith:function(e){this.showMenu("stickers"),this.__menus.stickers.preselectPartner(e)},delete:function(){this.__inputActivityTimeoutHandle&&this.__timer.clearTimeout(this.__inputActivityTimeoutHandle),_.each(this.__menus,function(e){e.delete()}),t.prototype.delete.call(this)},connect:function(e){_.each(this.__menus,function(t){t.connect(e),t.preloadCatalog()})},toggle:function(e){this.$el.toggleClass("disabled",!e),this.$("textarea").blur()},render:function(){this.$el.html(e.template),this.__loginManager.isLoggedIn()?(this.__placeholder&&this.$("textarea").attr("placeholder",this.__placeholder),e.NextUtil.DomHelper.enhanceTextarea(this.$("textarea"))):this.$("textarea").attr("disabled","disabled")},__createMenus:function(e){e&&e.length?(_.each(e,function(e){var t=this.createChildContext(this.__menuFactories[e],{$parentElement:this.$el,context:this.__context,partnerCollection:this.__partnerCollection,actionCategoryListFactory:this.__actionCategoryListFactory});t.on("change",this.__updateSendButton.bind(this)),t.on("send",this.__send.bind(this)),this.__menus[e]=t;var i=$("<li />").text(this.__globalStringManager.get(e+"_tab"));i.attr("data-menu",e),this.$(".menu-tabs").append(i),t.on("item_list",this.__updateItemCount.bind(this,i,t))}.bind(this)),2>e.length&&this.$(".menu-bar").remove()):this.$(".menu-toggle").remove()},__onClickMenuTab:function(e){this.__switchToMenu($(e.currentTarget).attr("data-menu"))},__toggleMenus:function(){this.$(".menu-toggle").hasClass("disabled")||(this.$el.hasClass("menu-open")?this.collapseMenus():this.__expandMenus())},__switchToMenu:function(e){e!==this.__currentMenu&&(this.__menus[this.__currentMenu].cancelSelection(),this.__menus[this.__currentMenu].hideCatalog(),this.__openMenu(e))},showMenu:function(e){this.__expandMenus(),this.__switchToMenu(e)},__setSelectedMenu:function(t){this.__currentMenu=t,(t=this.$('.menu-tabs li[data-menu="'+t+'"]')).length&&(e.NextUtil.DomHelper.radioClass(t,"active"),this.$(".menu-bar .magic-line").show().css({"margin-left":t.position().left+parseInt(t.css("margin-left"),10)+"px",width:t.outerWidth()}))},__openMenu:function(e){this.__setSelectedMenu(e),this.__menus[e].showCatalog()},__expandMenus:function(){this.$el.addClass("menu-open"),this.__openMenu(this.__currentMenu||_.keys(this.__menus)[0])},collapseMenus:function(){this.$el.removeClass("menu-open"),this.__currentMenu&&this.__menus[this.__currentMenu].hideCatalog()},toggleStickerButton:function(e){!e&&this.__currentMenu&&(this.__menus[this.__currentMenu].cancelSelection(),this.collapseMenus()),this.$(".menu-toggle").toggleClass("disabled",!e)},showStickerPack:function(e){this.toggleStickerButton(!0),this.showMenu("stickers"),this.__menus.stickers.selectStickerPack(e.id)},hasInput:function(){return this.get().trim()||_.any(this.__menus,function(e){return e.getSelection()})},__updateSendButton:function(){this.$(".btn-send").prop("disabled",!this.hasInput())},__updateItemCount:function(e,t,i){0<i?e.removeClass("hidden"):(t.cancelSelection(),t.hideCatalog(),e.addClass("hidden"),e=this.$(".menu-tabs li[data-menu]:first-child").attr("data-menu"),this.__setSelectedMenu(e))},__onInput:function(){this.__updateSendButton(),this.trigger("input",this.get())},__onKeypress:function(t){t.keyCode!==e.NextUtil.Keys.VK_ENTER||t.shiftKey||(this.__recordEvent("click",{name:"send",pressed_enter:1,number_of_windows:this.__serviceProvider.get("windowManager").getTotalOpenWindows(),sent_from:this.__isInWindow?"Window":"Mode"}),this.__send(t),t.preventDefault())},__onKeydown:function(e){this.__inputActivityMonitor&&(this.__inputActivityTimeoutHandle?this.__timer.clearTimeout(this.__inputActivityTimeoutHandle):this.__inputActivityMonitor.startChat(),this.__inputActivityTimeoutHandle=this.__timer.setTimeout(function(){this.__inputActivityMonitor.stopChat(),this.__inputActivityTimeoutHandle=null}.bind(this),1e3))},__send:function(e){if(!this.hasInput())return!1;var t={message:this.get().trim()?this.get():this.get().trim()};return _.each(this.__menus,function(e,i){var n=e.getSelection();n&&(t[e.payloadName]=n,e.onSubmit)&&e.onSubmit()}.bind(this)),this.clear(),this.trigger("sendInput",t),!1},get:function(){return this.$(".input-text").val()},set:function(e){this.$(".input-text").val(e)},clear:function(){_.each(this.__menus,function(e){e.cancelSelection()}.bind(this)),this.collapseMenus(),this.$(".input-text").val("").trigger("refresh"),this.__updateSendButton()},registerInputActivityMonitor:function(e){this.__inputActivityMonitor=e},focusOnInput:function(){this.$(".input-text")[0].focus()},hasFocus:function(){return this.$(".input-text")[0]===document.activeElement}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:Ie,StickerMenu:zt,SoloActionMenu:qt,PidActionMenu:Ye,CoopActionMenu:Vt,SoloStickerMenu:qt,CoopStickerMenu:Vt}),jt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<ul class='items'>\n</ul>\n<div class='more hidden'>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_more_likes",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>"},useData:!0})}(),Kt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="username"></div>\n<div class="friend-actions">\n    <button class="btn btn-primary btn-xsmall add-friend">Add friend</button>\n    <button class="btn btn-ghost btn-xsmall is-friend" disabled>Friends</button>\n    <button class="btn btn-ghost btn-xsmall pending-friend" disabled>Pending...</button>\n</div>'},useData:!0})}(),Yt=function(e){var t=e.UiCore.UiContext;return t.extend("LikeListItem",{uiContextName:"like_list_item",className:"like-list-item",dependencies:["model","loginManager"],trackedEvents:function(){return[{type:"click",selector:".btn.add-friend",name:"add_friend",handler:"__addFriend"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__serviceProvider.has("friendManager")&&(this.__friendManager=this.__serviceProvider.get("friendManager")),e.loginManager.isLoggedIn()&&(this.__myself=e.loginManager.getCurrentUser()),this.addToDOM()},render:function(){this.__model.populated().then(function(){this.__loginManager.isLoggedIn()&&this.$el.toggleClass("is-me",this.__model.node.id===this.__myself.id),this.$el.html(e.template),this.__updateFriendButtons(),this.listenTo(this.__model.node,"change:relations",this.__updateFriendButtons.bind(this)),this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".username"),user:this.__model.node,configuration:"small-single-lightbg"})}.bind(this))},__updateFriendButtons:function(){this.__loginManager.isLoggedIn()?(this.$(".btn.add-friend").toggleClass("hidden",!(!this.__model.node.relations.viewer_friend&&!this.__model.node.relations.viewer_outbound_friend_request)),this.$(".btn.is-friend").toggleClass("hidden",!this.__model.node.relations.viewer_friend),this.$(".btn.pending-friend").toggleClass("hidden",!this.__model.node.relations.viewer_outbound_friend_request)):(this.$(".friend-actions").toggleClass("hidden",!0),this.$(".btn.add-friend").toggleClass("hidden",!0),this.$(".btn.is-friend").toggleClass("hidden",!0),this.$(".btn.pending-friend").toggleClass("hidden",!0))},__addFriend:function(){this.__loginManager.isLoggedIn()&&this.__friendManager&&(this.$(".btn.add-friend").toggleClass("hidden",!0),this.$(".btn.pending-friend").toggleClass("hidden",!1),(this.__model.node.relations.viewer_inbound_friend_request?this.__friendManager.acceptFriendRequest(this.__model.node):this.__friendManager.addFriend(this.__model.node)).catch(this.__updateFriendButtons.bind(this)))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:Kt}),Xt=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("LikeList",{uiContextName:"like_list",className:"like-list",tagName:"div",itemFactory:e.LikeListItem,dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".more",name:"view_more",handler:"viewMore"}]},initialize:function(e){e.manuallyPage=!0,t.prototype.initialize.call(this,e),this.collection.populated().then(function(){this.__refreshMore(),this.listenTo(this.collection,"add remove reset",this.__refreshMore.bind(this,!0))}.bind(this))},renderTemplate:function(){this.$el.html(e.template),this.$itemContainer=this.$(".items"),t.prototype.renderTemplate.call(this)},__refreshMore:function(e){this.$(".more").toggleClass("hidden",!this.collection.hasNextPage())},__childrenInDOM:function(){var e=_.map(_.filter(_.values(this.__registry),function(e){return e.$el}),function(e){return e.$el[0]});return this.$itemContainer.children().filter(e)},__emptyText:function(){return{standard:this.__globalStringManager.get("post_has_no_likes"),concise:this.__globalStringManager.get("post_has_no_likes")}}})}({Widgets:e["@Widgets"],template:jt,LikeListItem:Yt}),Jt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'\n\t<div class="caption secondary-text hidden"/>\n'},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class=\"main-info\">\n    <div class='picture tile-body'>\n    </div>\n    <div class='text'>\n        <div class='primary-text'></div>\n        <div class='photo-with secondary-text is-truncated'><span>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"with",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+=" </span><span class='username-placeholder'> </span><span class='with-others'></span></div>\n",((a=t.if.call(e,e&&e.canSeeFeedCaptions,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+="\n        <div class='secondary-text posted-timestamp'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"posted",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+" </div>\n    </div>\n</div>\n"},useData:!0})}(),Zt=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){i=t.helperMissing;var a=this.escapeExpression;return'<div class="expanding-text-text" />\n<a class="helip hidden" data-more="'+a((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"...more",{name:"i18n-g",hash:{},data:n}))+'" data-less="'+a((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"...less",{name:"i18n-g",hash:{},data:n}))+'" />\n'},useData:!0})}(),Qt=function(e){var t=e.UiCore.UiContext;return t.extend("ExpandingText",{className:"expanding-text",uiContextName:"expanding_text",dependencies:["textValue"],trackedEvents:function(){return[{type:"click",selector:".helip",name:"expanding_text_helip_click",handler:"__onHelipClick"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template()),this.__expanding=this.createChildContext(e.UserText,{$replaceElement:this.$(".expanding-text-text"),text:this.__textValue}),this.__expanding.$el.addClass("expanding-text-text"),this.__expanding.waitForVisible().then(function(){this.__expanding.isOverflowed()&&(this.__expanding.handleOverflow(),this.$(".helip").removeClass("hidden"))}.bind(this))},changeText:function(e){this.__expanding.shortText=null,this.__expanding.text=e||"",this.__expanding.render(),this.__expanding.waitForVisible().then(function(){var e=!1;this.$el.hasClass("open")&&(e=!0,this.$el.toggleClass("open")),this.__expanding.isOverflowed()?this.$(".helip").removeClass("hidden"):this.$(".helip").addClass("hidden"),e&&this.$el.toggleClass("open")}.bind(this))},__onHelipClick:function(e){this.$el.toggleClass("open"),this.__expanding.handleOverflow(),this.trigger("openText")}})}({UiCore:e["@UiCore"],UserText:q,template:Zt}),ei=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("Timestamp",{className:"timestamp-widget",uiContextName:"timestamp",tagName:"timestamp",dependencies:["timestampHelper","moment","timestamp"],initialize:function(e){i.prototype.initialize.call(this,e),this.__timestampHelper=e.timestampHelper,this.__moment=e.moment,this.__timestampHelper.setDifference(e.timestamp),this.addToDOM(),this.$el.attr("data-actual-date",this.__timestampHelper.now().toString())},render:function(){this.$el.text(this.__timestampHelper.formatTime())}})}(),ti=function(t){var i={UiCore:e["@UiCore"],Timestamp:ei}.Timestamp;return i.extend("FeedItemTimestamp",{className:"timestamp-widget feed-item-timestamp system-info-detail",uiContextName:"feed_item_timestamp",initialize:function(e){this.__includeAgo=!!e.includeAgo,i.prototype.initialize.call(this,e)},render:function(){this.$el.text(this.__timestampHelper.feedItem(this.__includeAgo))}})}(),ii=function(e){var t=e.StandardHeadpiece;return e.UiCore.UiContext.extend("FeedHeadpiece",{className:"feed-headpiece standard-headpiece",uiContextName:"feed_headpiece",dependencies:"Promise contextMenuManager dialogManager featureAccessManager globalStartupModel globalStringManager loginManager model restModelFactory".split(" "),trackedEvents:function(){return[]},initialize:function(e){t.prototype.initialize.call(this,e)},delete:function(){t.prototype.delete.call(this),this.model.off(void 0,void 0,this)},render:function(){this.$el.html(e.template({canSeeFeedCaptions:this.__featureAccessManager.canSeeFeedCaptions()})),this.model.populated().then(function(){if(this.__actor=this.model.getSingleEdge("actor"),this.createChildContext(e.Widgets.ProfileIcon,{user:this.__actor,$parentElement:this.$(".picture"),ignoreClicks:!1}),this.createChildContext(e.Widgets.DisplayName,{$parentElement:this.$(".primary-text"),user:this.__actor,size:"large",color:"dark",ignoreClicks:!1}),this.__featureAccessManager.canSeeFeedCaptions()&&"photo"===this.model.get("type")){var t=this.model.get("payload.message");t&&0<t.length&&(this.__caption=this.createChildContext(e.ExpandingText,{$parentElement:this.$(".caption"),textValue:t}),this.$(".main-info").addClass("has-caption"),this.$(".caption").removeClass("hidden"),this.listenTo(this.__caption,"openText",this.__toggleOpen.bind(this)))}this.createChildContext(e.FeedItemTimestamp,{$parentElement:this.$(".posted-timestamp"),timestamp:this.model.get("time"),includeAgo:!0}),this.model.relations.photo&&this.__showPhotoWith(),this.model.on("change",this.__onModelChange,this)}.bind(this))},__onModelChange:function(){if("photo"===this.model.get("type")){var t=this.model.get("payload.message");this.__caption?this.__caption.changeText(t):!this.__caption&&t&&0<t.length&&(this.__caption=this.createChildContext(e.ExpandingText,{$parentElement:this.$(".caption"),textValue:t}),this.listenTo(this.__caption,"openText",this.__toggleOpen.bind(this)),this.$(".caption").removeClass("hidden"))}},__toggleOpen:function(){this.$(".main-info").toggleClass("open")},__showPhotoWith:function(){this.model.getSingleEdge("photo").populated().then(function(e){return e.getSingleEdge("photo_details").populated()}.bind(this)).then(function(t){return t=_.without(_.pluck(t.get("users"),"id"),this.__actor.id),this.__Promise.every(_.map(t,function(t){return this.__restModelFactory.readModel(t,e.UiCore.NodeModel).populated()}.bind(this)))}.bind(this)).then(function(t){t&&0<t.length&&(this.$(".photo-with").show(),this.createChildContext(e.Widgets.DisplayName,{$replaceElement:this.$(".photo-with .username-placeholder"),user:t[0],size:"small",color:"dark",showVipBadge:!1}),1<t.length&&this.$(".photo-with .with-others").text(2===t.length?this.__globalStringManager.get("with_1_other"):this.__globalStringManager.get("with_x_others",{count:t.length-1})))}.bind(this))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],ContextMenu:A,ExpandingText:Qt,FeedItemTimestamp:ti,StandardHeadpiece:h,template:Jt}),ni=function(e){var t=e.LightboxDialog;return t.extend("FeedLightbox",{uiContextName:"feed_lightbox",className:"feed-lightbox lightbox-dialog",trackedEvents:function(){return t.prototype.trackedEvents.call(this).concat([{type:"click",selector:".feed-photo",name:"expand_photo",handler:"__expandPhoto"},{type:"click",selector:".feed-photo .expanded-photo",name:"collapse_photo",handler:"__collapsePhoto"}])},dependencies:"featureAccessManager globalStringManager loginManager model platform restModelFactory defer".split(" "),initialize:function(i){t.prototype.initialize.call(this,i),this.__myself=this.track(i.loginManager.getCurrentUser()),this.linkToDetailsSubmode("feed",this.model),this.model.populated().then(function(){(this.isPhoto="photo"===this.model.get("type"))?this.addWidgetToMainContainer(e.FeedPhoto,{model:this.model}):this.addWidgetToMainContainer(e.FeedText,{model:this.model}),this.__setupHeadpiece(),this.__setupComments(),this.__setupLikes(),this.isPhoto&&this.__setupTags(),i.tab&&this.__selectPanel(i.tab)}.bind(this))},__setupHeadpiece:function(){this.addWidgetToHeadpiece(e.FeedHeadpiece,{model:this.model});var t=this.addWidgetToHeadpiece(e.ActionBar,{model:this.model});this.listenTo(t,"item-reported",this.__onReported.bind(this))},__setupLikes:function(){this.__likesCollection=this.track(this.model.searchEdgeCollection("liked_by",{limit:20},e.UiCore.EdgeCollection,{appendToSearchCollection:!0})),this.__likesCollection.on("add remove reset",this.__updateLikes,this),this.addWidgetToSidebarPanel(e.LikeList,{collection:this.__likesCollection,addCounter:!0},"likes")},__updateLikes:function(){this.$(".counter-likes").text(e.FormatNumber.formatMini(this.__likesCollection.total_count))},__setupTags:function(){this.addWidgetToSidebarPanel(e.TagPanel,{addCounter:!0,model:this.model},"tags"),this.model.getSingleEdge("photo").populated().then(function(e){return e.getSingleEdge("photo_details").populated()}.bind(this)).then(function(e){this.__userTags=new IMVU.NamedCollection,_.each(e.get("users"),function(e){this.__userTags.add(this.__serviceProvider.create(IMVU.NamedModel,e))}.bind(this)),this.$(".counter-tags").text(this.__userTags.length)}.bind(this))},__setupComments:function(){this.__commentsCollection=this.track(this.model.searchEdgeCollection("comments",{limit:10},e.Model.FeedCommentCollection,{appendToSearchCollection:!0})),this.__commentsCollection.on("add remove reset",this.__updateComments,this),this.addWidgetToSidebarPanel(e.CommentList,{addCounter:!0,collection:this.__commentsCollection,feedModel:this.model},"comments");var t=this.addFooterToSidebarPanel(e.ChatBar,{placeholder:this.__globalStringManager.get("Type something...")},"comments");this.listenTo(t,"sendInput",this.__sendComment.bind(this)),this.__commentsCollection.populated().then(function(){this.__updateComments(),this.__scrollToLastComment()}.bind(this))},__sendComment:function(t){var i=function(e){e.populated().then(function(){e.node.getSingleEdge("author").id===this.__myself.id&&(this.__commentsCollection.off("add",i,this),this.__defer(this.__scrollToLastComment.bind(this)))}.bind(this))};this.__commentsCollection.on("add",i,this),this.__restModelFactory.createModel(this.__commentsCollection.url,e.UiCore.EdgeModel,{comment_text:t.message}).catch(function(){this.__commentsCollection.off("add",i,this)}.bind(this))},__updateComments:function(){this.$(".counter-comments").text(e.FormatNumber.formatMini(this.__commentsCollection.total_count))},__scrollToLastComment:function(){if("mobile"!==this.__platform){var e=this.$("[data-panel=comments] .feed-comments").outerHeight(!0);this.$("[data-panel=comments] .scroller:not(.scroll-wrapper)").scrollbar().scrollTop(e)}},__onReported:function(){this.hide(),this.promiseResolver.reject()},__expandPhoto:function(){"mobile"===this.__platform&&this.$el.addClass("is-expanded")},__collapsePhoto:function(){this.$el.removeClass("is-expanded")},delete:function(){this.__commentsCollection&&this.__commentsCollection.off(null,null,this),this.__likesCollection&&this.__likesCollection.off(null,null,this),t.prototype.delete.call(this)}})}({UiCore:e["@UiCore"],Model:e["@Model"],ActionBar:Ae,ChatBar:Gt,CommentList:le,Counter:K,FeedHeadpiece:ii,FeedPhoto:ce,FeedText:G,FormatNumber:r,LightboxDialog:x,LikeList:Xt,TagPanel:ne}),ai=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="avatar-container"></div>\n<div class="shields"></div>'},useData:!0})}(),si=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="upgrade-products">\n    <div class="products"></div>\n</div>\n<footer class="dialog-footer"></footer>'},useData:!0})}(),oi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<button class="btn btn-primary buy-now" disabled>';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"CHECKOUT",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>"},useData:!0})}(),ri=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="alert-message">\n';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"already_have_vip_subscription_text_before_link",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n<a href="https://help.imvu.com" target="_blank">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"already_have_vip_subscription_text_link",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</a>\n",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"already_have_vip_subscription_text_after_link",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"\n</div>"},useData:!0})}(),li=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='\n            <div class="order-row order-total-row">\n                <div class="order-row-name">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Total",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+" ("+o("function"==typeof(s=t.itemCount||e&&e.itemCount)?s.call(e,{name:"itemCount",hash:{},data:n}):s)+')</div>\n                <div class="order-row-amount">$<span class="order-total"></span></div>\n            </div>\n            '},3:function(e,t,i,n){var a;i=t.helperMissing;var s="\n        <div class=\"vip-block\">\n            <input id='vip-checkbox' class=\"vip checkbox\" tabindex='13' type=\"checkbox\"><label for='vip-checkbox'>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"I agree to the VIP",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</label> <a class="vip-terms-link vip-toc-link tooltip-target">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Terms and Conditions",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</a>\n            <div class="vip-toc-tooltip">\n                <div class="tooltip-header">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_dialog_title",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n                <div class="tooltip-body">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_dialog_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n            </div>\n        </div>\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='<div class="content-container">\n    <div class="error-block">\n        <ul>\n            <li class="error-message invalid-product">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_invalid_product",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</li>\n            <li class="error-message vip-checkbox-missing">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</li>\n        </ul>\n    </div>\n    <div class="padded-content-container">\n        <div class="order-block">\n            <legend class="system-info-header">\n                ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Cart",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='\n            </legend>\n            <div class="order-list-placeholder"></div>\n            ',((a=t.if.call(e,e&&e.showTotal,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+="\n        </div>\n        ",((a=t.if.call(e,e&&e.hasVip,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+='\n        <div class="payment-block">\n            <legend class="system-info-header">\n                ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Payment Method",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='\n            </legend>\n            <div class="savedcard-container"></div>\n            <div class="action-row add-credit-card"><div class="icon-payment-cc icon"></div> ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Check Out With New Credit Card",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+=' <div class="right-arrow"></div></div>\n            <div class="action-row paypal-checkout"><svg class="paypal-icon" width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><g fill="none"><path d="M3.15 18.146H1.227a.267.267 0 0 0-.264.227L.187 23.33a.16.16 0 0 0 .16.186h.916a.267.267 0 0 0 .264-.227l.21-1.338A.267.267 0 0 1 2 21.726h.608c1.265 0 1.996-.617 2.186-1.837.086-.536.004-.955-.245-1.25-.274-.322-.758-.493-1.4-.493zm.22 1.81c-.104.694-.63.694-1.14.694h-.29l.203-1.295a.16.16 0 0 1 .158-.136h.134c.347 0 .674 0 .844.198.1.12.13.295.093.54zm5.522-.022h-.92a.16.16 0 0 0-.16.136l-.04.26-.064-.095c-.2-.29-.643-.388-1.086-.388-1.017 0-1.885.775-2.054 1.86-.088.544.037 1.06.343 1.423.28.333.682.47 1.16.47.82 0 1.273-.53 1.273-.53l-.04.258a.16.16 0 0 0 .157.187h.828a.267.267 0 0 0 .264-.227l.497-3.168a.16.16 0 0 0-.158-.186zM7.61 21.736a1.027 1.027 0 0 1-1.04.883c-.266 0-.48-.087-.616-.25-.136-.162-.188-.393-.145-.65.082-.525.506-.89 1.03-.89.26 0 .474.086.614.25.14.167.195.4.155.656zm6.18-1.802h-.923a.267.267 0 0 0-.22.118l-1.276 1.89-.54-1.816a.268.268 0 0 0-.256-.192h-.91a.16.16 0 0 0-.15.213l1.018 3.007-.958 1.36a.16.16 0 0 0 .13.254h.924c.088 0 .17-.043.22-.116l3.074-4.465a.16.16 0 0 0-.13-.253z" fill="#253B80"/><path d="M16.852 18.146H14.93a.267.267 0 0 0-.263.227l-.777 4.956a.16.16 0 0 0 .158.185h.986c.09 0 .17-.067.184-.16l.22-1.404a.267.267 0 0 1 .264-.225h.608c1.266 0 1.996-.617 2.187-1.837.086-.535.003-.954-.246-1.248-.27-.323-.755-.494-1.4-.494zm.22 1.81c-.103.694-.63.694-1.14.694h-.29l.204-1.295a.16.16 0 0 1 .158-.136h.133c.347 0 .674 0 .843.198.1.12.132.295.093.54zm5.522-.022h-.92a.16.16 0 0 0-.157.136l-.04.26-.066-.095c-.198-.29-.642-.388-1.085-.388-1.017 0-1.885.775-2.054 1.86-.086.544.038 1.06.344 1.423.28.333.68.47 1.158.47.82 0 1.274-.53 1.274-.53l-.04.258a.16.16 0 0 0 .157.187h.83a.267.267 0 0 0 .262-.227l.498-3.168a.16.16 0 0 0-.16-.186zm-1.282 1.802a1.027 1.027 0 0 1-1.038.883c-.267 0-.48-.087-.618-.25-.136-.162-.187-.393-.144-.65.083-.525.507-.89 1.03-.89.262 0 .474.086.614.25.14.167.196.4.156.656zm2.366-3.454l-.788 5.047a.16.16 0 0 0 .158.185h.792a.267.267 0 0 0 .264-.227l.778-4.956a.16.16 0 0 0-.158-.186h-.888a.16.16 0 0 0-.158.136z" fill="#179BD7"/><path d="M10.47 15.845l.285-1.806-.633-.016H7.098L9.2.702a.172.172 0 0 1 .17-.146h5.1c1.69 0 2.86.353 3.47 1.048.285.326.467.667.555 1.042.092.393.094.863.004 1.437l-.008.04v.37l.286.16c.24.13.432.275.58.442.244.28.402.633.47 1.053.068.432.045.947-.068 1.53-.13.67-.342 1.25-.626 1.73-.262.44-.596.803-.992 1.085a4.024 4.024 0 0 1-1.336.603 6.662 6.662 0 0 1-1.67.193h-.396c-.284 0-.56.1-.776.284-.217.187-.36.443-.404.722l-.03.163-.502 3.18-.023.118c-.006.037-.016.055-.032.068a.084.084 0 0 1-.052.02h-2.45z" fill="#253B80"/><path d="M19.048 4.167a8.915 8.915 0 0 1-.052.3c-.673 3.45-2.973 4.643-5.91 4.643H11.59c-.36 0-.662.26-.718.615l-.765 4.857-.217 1.376a.383.383 0 0 0 .377.443h2.653a.638.638 0 0 0 .63-.537l.027-.135.5-3.17.03-.174a.638.638 0 0 1 .63-.54h.398c2.57 0 4.582-1.042 5.17-4.062.246-1.26.12-2.315-.53-3.055a2.536 2.536 0 0 0-.727-.56z" fill="#179BD7"/><path d="M18.345 3.886a5.303 5.303 0 0 0-.654-.145 8.307 8.307 0 0 0-1.318-.095h-3.995a.634.634 0 0 0-.63.54l-.85 5.383-.025.157a.726.726 0 0 1 .718-.615h1.496c2.937 0 5.237-1.193 5.91-4.644.02-.102.037-.202.052-.3a3.584 3.584 0 0 0-.703-.28z" fill="#222D65"/><path d="M11.747 4.184a.635.635 0 0 1 .63-.538h3.995c.474 0 .916.03 1.32.096a5.303 5.303 0 0 1 .804.192c.198.065.382.143.552.233.2-1.276 0-2.144-.69-2.93C17.596.37 16.223 0 14.468 0H9.37a.73.73 0 0 0-.72.616l-2.123 13.46a.438.438 0 0 0 .432.506h3.147l.79-5.014.85-5.384z" fill="#253B80"/></g></svg> ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Check Out With PayPal",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+=' <div class="right-arrow"></div></div>\n            <div class="info-row">\n                ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"original_store_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+=' <br><a class="core-store-link" href="/store/index/?platform='+o("function"==typeof(s=t.platformId||e&&e.platformId)?s.call(e,{name:"platformId",hash:{},data:n}):s)+'" target="_blank">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"original_store_link_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</a>\n            </div>\n        </div>\n    </div>\n</div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BUY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+=' <span class="item-count"></span> ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ITEM FOR",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+' $<span class="order-total"></span></button>\n<\/script>\n'},useData:!0})}(),di=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a,s;i=this.escapeExpression;var o='\n    <div class="order-row">\n        <div class="order-item">\n            ';return((a=t.if.call(e,e&&e.image,{name:"if",hash:{},fn:this.program(2,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+'\n            <div class="item-info">\n                <div class="item-name">'+i("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:n}):s)+'</div>\n                <div class="product-price">$'+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+"</div>\n            </div>\n        </div>\n    </div>\n"},2:function(e,t,i,n){var a;return'\n            <div class="image-container"><img src="'+(0,this.escapeExpression)("function"==typeof(a=t.image||e&&e.image)?a.call(e,{name:"image",hash:{},data:n}):a)+'"></div>\n            '},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return(a=t.each.call(e,e&&e.cart,{name:"each",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a?a:""},useData:!0})}(),ci=function(e){var t=e.UiCore.UiContext;return t.extend("OrderList",{className:"order-list",uiContextName:"orderlist",initialize:function(e){t.prototype.initialize.call(this,e),this.__cart=IMVU.requireProperty(e,"cart"),this.addToDOM()},render:function(){_.each(this.__cart,function(e){e.price=parseFloat(e.price).toFixed(2),e.image&&-1===e.image.indexOf("/")&&(e.image="/common/withme/img/store/"+e.image)}),this.$el.html(e.template({cart:this.__cart}))}})}({UiCore:e["@UiCore"],template:di}),hi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="dropdown-label is-truncated"><span>&nbsp;</span></div>\n<div class="dropdown-option-list-container">\n    <div class="dropdown-scroll-up"></div>\n    <div class="dropdown-scroll-down"></div>\n    <ul class="dropdown-option-list">\n        <li class="dropdown-option is-truncated" data-value="" tabindex="-1"></li>\n    </ul>\n</div>\n'},useData:!0})}(),_i=function(e){function t(e){e=$(e.target).closest(".dropdown"),$(".dropdown").not(e).each(function(e,t){$(t).data("dropdown-instance").__hide()})}var i=e.UiCore.UiContext,n=e.NextUtil.Keys;return i.extend("Dropdown",{globalSetup:function(){document.addEventListener("click",t,!0),document.addEventListener("touchend",t,!0)},globalTearDown:function(){document.removeEventListener("click",t,!0),document.removeEventListener("touchend",t,!0)},uiContextName:"dropdown",className:"dropdown disable-text-selection",ITEM_HEIGHT:40,AUTO_SCROLL_BY:2,dependencies:["window","timer"],trackedEvents:function(){return[{type:"click",selector:".dropdown-label",name:"dropdown_label_click",handler:"toggleOpen"},{type:"click",selector:".dropdown-option",name:"dropdown_option_click",handler:"clickOption"},{type:"keydown",selector:"",name:"dropdown_keydown",handler:this.__onKeydown.bind(this,[])},{type:"mousemove",selector:".dropdown-option",name:"dropdown_option_mouseenter",handler:this.__onMousemove.bind(this,{x:0,y:0})},{type:"mouseenter",selector:".dropdown-label",name:"dropdown_label_mouseenter",handler:"__onMouseenterLabel"},{type:"mouseenter",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseenter",handler:"__onScrollUpMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseleave",handler:"__onScrollUpMouseleave"},{type:"mouseenter",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseenter",handler:"__onScrollDownMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseleave",handler:"__onScrollDownMouseleave"}]},__onMousemove:function(e,t){e.x==t.screenX&&e.y==t.screenY||(e.x=t.screenX,e.y=t.screenY,this.$el.focus(),this.setActiveElement($(t.target)))},__onBlur:function(e){this.$el.removeClass("is-open")},__onMouseenterLabel:function(e){this.$(".is-selected").removeClass("is-selected")},initialize:function(e){if(this.$select=IMVU.requireProperty(e,"$replaceElement"),!this.$select.is("select"))throw Error("$replaceElement must be a <select> element. got: "+this.$select[0].tagName);if(this.$select.closest("label").length)throw Error("do not wrap custom dropdowns with <label> tags; it disrupts event handling");i.prototype.initialize.call(this,e),this.window=e.window,this.timer=e.timer,this.boundingBox=e.boundingBox||this.getDefaultBoundingBox(),this.document=e.document||document,this.__keyArray=[],(this.dismissOnScroll=e.dismissOnScroll)&&$(e.dismissOnScroll).on("scroll.dropdown",function(){this.__hide()}.bind(this)),$(".dropdown-layer").length||$("body").append('<div class="dropdown-layer"/>'),this.$dropdownLayer=$(".dropdown-layer"),e.dimNoValue&&this.$el.addClass("dim-no-value"),this.$el.data("dropdown-instance",this),this.addToDOM()},delete:function(){this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray),this.dismissOnScroll&&$(this.dismissOnScroll).off("scroll.dropdown"),$(this.window).off("resize.dropdown"),i.prototype.delete.call(this)},__onHidden:function(){this.$el.is(":visible")&&this.remove(),i.prototype.__onHidden.apply(this,arguments)},getDefaultBoundingBox:function(){var e=this.$el.position().top-5*this.ITEM_HEIGHT,t=e+11*this.ITEM_HEIGHT;return 0>e&&(e=0),t>$(this.window).height()&&(t=$(this.window).height()),{x:0,y:e,w:$(this.window).width(),h:t-e}},render:function(){this.$placeholder=$("<div/>"),this.$el.html(e.template),this.$label=this.$(".dropdown-label"),this.$optionList=this.$(".dropdown-option-list"),this.$optionListContainer=this.$(".dropdown-option-list-container");var t=this.$optionList.find(".dropdown-option");this.$select.addClass("is-enhanced"),this.refreshLabel(this.$select.find(":selected")),t.remove(),this.$select.children().each(function(e,i){var n=t.clone(!0);n.text($(i).text()),n.attr("data-text",$(i).text().toLowerCase()),n.attr("data-value",$(i).val()),this.$optionList.append(n)}.bind(this)),this.$el.addClass(this.$select[0].className).removeClass("dropdown-template").addClass("dropdown"),this.$label.append(this.$select),this.$el.attr("tabindex",this.$select.attr("tabindex")||"0"),this.$select.attr("tabindex",-1),this.$optionList.on("scroll",this.__onScroll.bind(this)),this.$select.on("change",this.__changedOption.bind(this)),this.$el.addClass("is-ready")},__fullHeight:function(){return this.$select.children().length*this.ITEM_HEIGHT},__getSelectedIndex:function(){return this.$select[0].selectedIndex},__getTopEdgeInViewport:function(e){return e.offset().top-$(this.document).scrollTop()},__getComputedInfo:function(){var e=this.__getTopEdgeInViewport(this.$el),t=this.__fullHeight(),i=this.__getSelectedIndex()*this.ITEM_HEIGHT,n=this.getDefaultBoundingBox().y,a=this.getDefaultBoundingBox().y+this.getDefaultBoundingBox().h,s=e-i,o=s+t,r=0;return s<n&&(s=n),o>a&&(r=o-a,o=a,s>n&&(s-=Math.min(s-n,r))),{projectedTopDiff:s-e,computedHeight:o-s,selectedTop:i,maxTop:n,maxBottom:a,fullHeight:t}},__refreshScrollers:function(){var e=this.$optionList[0].scrollHeight-this.$optionList.innerHeight(),t=0<this.$optionList.scrollTop();e=Math.round(this.$optionList.scrollTop())<e;this.$el.toggleClass("can-scroll-up",t).toggleClass("can-scroll-down",e)},isOpen:function(){return this.$el.hasClass("is-open")},__hide:function(){this.isOpen()&&($(this.window).off("resize.dropdown"),this.$el.removeClass("is-open"),this.$placeholder.before(this.$el).detach(),this.$el.removeAttr("style"))},__show:function(){if(!this.isOpen()){$(this.window).on("resize.dropdown",t);var e=this.$el.offset(),i=this.$el.width(),n=this.$el.height(),a=this.$el.css("margin-left"),s=this.$el.css("margin-right"),o=this.$el.css("margin-top"),r=this.$el.css("margin-bottom"),l=this.$el.css("float");this.$placeholder.css({width:i,height:n,"margin-left":a,"margin-right":s,"margin-top":o,"margin-bottom":r,float:l}),this.$el.addClass("is-open").css({top:this.__getTopEdgeInViewport(this.$el),left:e.left,width:i,height:n,"margin-left":0,"margin-right":0,"margin-top":0,"margin-bottom":0}),this.$el=this.$el.before(this.$placeholder).detach(),this.$dropdownLayer.append(this.$el)}},toggleOpen:function(e){return this.isOpen()?this.__hide():(this.__show(),e=this.__getComputedInfo(),this.$optionListContainer.css({top:e.projectedTopDiff,height:e.computedHeight}),this.$el.focus(),e=e.selectedTop+e.projectedTopDiff,this.$optionList.scrollTop(e),this.__lastScrollTop=e,this.setActiveElement(this.$(".dropdown-option").eq(this.__getSelectedIndex())),this.__refreshScrollers()),!1},refreshLabel:function(e){this.$label.find("> span").text(e.text()).toggleClass("no-value",""===e.val())},clickOption:function(e){this.__hide(),this.$select.val($(e.target).attr("data-value")),this.$select.trigger("change"),t(e)},selectByValue:function(e){this.$(".is-selected").removeClass("is-selected"),this.$('.dropdown-option[data-value="'+e+'"]').addClass("is-selected"),this.$("select").val(e),e=this.$("select").find(":selected"),this.refreshLabel(e)},val:function(){return this.$("select").val()},__changedOption:function(e){e=$(e.target).find(":selected"),this.refreshLabel(e)},__maybeScrollOptionIntoView:function(e,t){if(e[0]){var i=this.$el.hasClass("can-scroll-up"),n=this.$el.hasClass("can-scroll-down"),a=this.$optionList,s=a.height(),o=a.offset().top,r=o+s,l=e.outerHeight(),d=e.offset().top,c=d+l,h=d-o+a.scrollTop(),_=s/2-l/2*3;d<o+(i?l:0)?(t&&(h-=_),a.scrollTop(h-(i?this.ITEM_HEIGHT:0))):c>r-(n?l:0)&&(t&&(h+=_),a.scrollTop(h-(s-l)+(n?l:0)))}},__open:function(t){return this.isOpen()&&this.$select.val(this.$optionList.find(".is-selected").attr("data-value")).change(),this.toggleOpen(t),t=this.$optionList.children().eq(this.$select[0].selectedIndex),e.NextUtil.DomHelper.radioClass(t,"is-selected"),t},__moveSelection:function(t){return 0>(t=this.$optionList.children().index(this.$optionList.find(".is-selected"))+t)?t=0:t>this.$select.children().length-1&&(t=this.$select.children().length-1),t=this.$optionList.children().eq(t),e.NextUtil.DomHelper.radioClass(t,"is-selected"),t},setActiveElement:function(t){this.__activeElement=t,e.NextUtil.DomHelper.radioClass(t,"is-selected")},__onKeydown:function(i,a){if(!this.isOpen()&&n.is(a,"VK_ENTER")||!this.isOpen()&&n.is(a,"VK_DOWN"))t(this.$el),this.__open(a);else{var s=this.__activeElement&&this.__activeElement.parent()[0]===this.$optionList[0]?this.__activeElement:this.$(".dropdown-option").first();if(n.is(a,"VK_DOWN"))this.__maybeScrollOptionIntoView(s.next()),s.next()[0]&&this.setActiveElement(s.next());else if(n.is(a,"VK_UP"))this.__maybeScrollOptionIntoView(s.prev()),s.prev()[0]&&this.setActiveElement(s.prev());else if(n.is(a,"VK_ENTER"))this.__hide(),this.$select.val(this.__activeElement.attr("data-value")),this.$select.trigger("change"),t(a);else if(n.is(a,"VK_ESC"))t(this.$el);else{var o=n.getAlphaNumericChar(a);if(!1!==o){var r=s[0];this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray),i.push(o);var l=i.join("").toLowerCase();for(this.__keyValueArray=this.timer.setTimeout(function(){i.length=0}.bind(this),1e3);r.nextSibling;)if(r=r.nextSibling,(o=$(r)).attr("data-text")[0]&&e.NextUtil.string.startsWith(o.attr("data-text"),l))return this.isOpen()||this.toggleOpen(a),this.setActiveElement(o),void this.__maybeScrollOptionIntoView(o,o[0]!=s[0].nextSibling&&o[0]!=s[0].prevSibling);for(r=this.$(".dropdown-option")[0];r&&r!=s[0];){if((o=$(r)).attr("data-text")[0]&&e.NextUtil.string.startsWith(o.attr("data-text"),l)){this.isOpen()||this.toggleOpen(a),this.setActiveElement(o),this.__maybeScrollOptionIntoView(o,o[0]!=s[0].nextSibling&&o[0]!=s[0].prevSibling);break}r=r.nextSibling}}}}},__onScroll:function(e){e=this.$optionList.scrollTop(),this.__refreshScrollers(),this.__lastScrollTop=e},__doScrollUp:function(e,t){var i=this.__getComputedInfo(),n=void 0===t?this.AUTO_SCROLL_BY:t;if(this.$optionListContainer.offset().top+this.$optionListContainer.height()+n<i.maxBottom){var a=this.$optionListContainer.height()+n;a>i.fullHeight&&(a=i.fullHeight),this.$optionListContainer.css({height:a}),this.$optionList[0].scrollTop-=n,this.__refreshScrollers(this.$dropdown)}else void 0===t&&(this.$optionList[0].scrollTop-=this.AUTO_SCROLL_BY)},__onScrollUpMouseenter:function(e){this.timer.clearInterval(this.__autoScrollInterval),this.__autoScrollIntervalCounter=0,this.__autoScrollInterval=this.timer.setInterval(function(){this.__doScrollUp(e)}.bind(this),1)},__onScrollUpMouseleave:function(e){this.timer.clearInterval(this.__autoScrollInterval)},__doScrollDown:function(e,t){var i=this.__getComputedInfo(),n=void 0===t?this.AUTO_SCROLL_BY:t;if((s=this.$optionListContainer.offset().top-n)>i.maxTop){var a=this.$optionListContainer.height()+n,s=this.$optionListContainer.position().top-n;a>i.fullHeight?a=i.fullHeight:this.$optionListContainer.css({top:s}),this.$optionListContainer.css({height:a}),this.$optionList[0].scrollTop+=n,this.__refreshScrollers(this.$dropdown)}else void 0===t&&(this.$optionList[0].scrollTop+=this.AUTO_SCROLL_BY)},__onScrollDownMouseenter:function(e){this.timer.clearInterval(this.__autoScrollDownInterval),this.__autoScrollDownIntervalCounter=0,this.__autoScrollDownInterval=this.timer.setInterval(function(){this.__doScrollDown(e)}.bind(this),1)},__onScrollDownMouseleave:function(e){this.timer.clearInterval(this.__autoScrollDownInterval)}})}({UiCore:e["@UiCore"],template:hi,NextUtil:e["@NextUtil"]}),gi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e){var t=this.escapeExpression;return'\n                        <option value="'+t("function"==typeof e?e.apply(e):e)+'">'+t("function"==typeof e?e.apply(e):e)+"</option>\n                        "},3:function(){return' checked="checked" '},5:function(e,t,i,n){var a;return'\n                    <option value="'+(t=this.escapeExpression)("function"==typeof(a=null==n||!1===n?n:n.key)?a.apply(e):a)+'">'+t("function"==typeof e?e.apply(e):e)+"</option>\n                    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="content-container">\n    <div class="error-block">\n        <ul>\n            <li class="error-message field-missing">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_field_missing",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</li>\n            <li class="error-message cardnumber-invalid">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_card_number_invalid",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</li>\n            <li class="error-message exp-date-expired">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_exp_date_expired",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</li>\n            <li class="error-message security-code-invalid">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_security_code_invalid",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</li>\n            <li class="error-message zip-invalid">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_zip_invalid",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</li>\n            <li class="error-message postal-invalid">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_postal_invalid",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</li>\n            <li class="error-message vip-checkbox-missing">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</li>\n            <li class="error-message cardname-invalid">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_invalid_cc_name",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</li>\n        </ul>\n    </div>\n    <div class="payment-block">\n        <legend class="system-info-header">\n            ',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Payment Method",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n        </legend>\n\n        <div class="input-row card-number-container">\n            <div class="input-label">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Credit Card Number",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n            <input class=\'cardnumber\' tabindex=\'1\' required maxlength=\'20\' placeholder=\'XXXX-XXXX-XXXX-XXXX\'> \n            <div class="cardimages-container">\n                <div class="cardimage mastercard icon icon-cc-mastercard"></div> \n                <div class="cardimage visa icon icon-cc-visa"></div> \n                <div class="cardimage americanexpress icon icon-cc-amex"></div> \n                <div class="cardimage discover icon icon-cc-discover"></div> \n                <div class="cardimage jcb icon icon-cc-jcb"></div>\n            </div>\n        </div>\n        <div class="input-row">\n            <div class="half-row">\n                <div class="exp-date input-container">\n                    <div class="input-label">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Expiration",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</div>\n                    <div class='exp-date-container input-container'>\n                        <select class='exp-month' tabindex='2' required >\n                        <option selected value=\"\">",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Month",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</option>\n                        ",((a=t.each.call(e,e&&e.monthRange,{name:"each",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+="\n                        </select>\n                    </div>\n                    <div class='exp-date-container input-container'>\n                        <select class='exp-year' tabindex='3' required >\n                        <option selected value=\"\">",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Year",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</option>\n                        ",((a=t.each.call(e,e&&e.yearRange,{name:"each",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+="\n                        </select>\n                    </div>\n                </div>\n            </div>\n            <div class='input-container'>\n                <div class=\"input-label\">",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Security",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n                <div class="security-code-row">\n                    <input class=\'security-code\' tabindex=\'4\' required maxlength=\'4\' placeholder="CSC">\n                    <div class="icon icon-tooltip-icon security-code-help-link"></div>\n                    <div class="security-code-tooltip">\n                        <div class="tooltip-header">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"security_code_help_title",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n                        <div class="tooltip-body">\n                            <div class="icon icon-payment-csc"></div>\n                            <div>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"security_code_help_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="input-row">\n            <input id=\'save-for-later-checkbox\' class="save-for-later checkbox" tabindex=\'13\' type="checkbox" \n            ',((a=t.if.call(e,e&&e.saveCard,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+=" ><label for='save-for-later-checkbox'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Save For Later",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</label>\n        </div>\n    </div>\n    <div class="billing-address-block">\n        <legend class="system-info-header">\n            ',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Billing Information",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="\n        </legend>\n        <div class=\"input-row\">\n            <input class='name-on-card' maxlength='50' tabindex='5' required placeholder='",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Name on Card",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='address' maxlength='50' tabindex='6' required placeholder='",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Address",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='city' maxlength='20' tabindex='7' required placeholder='",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"City",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="'>\n            <div class='us-fields state-province-container input-container'>\n                <select class='state' tabindex='8' >\n                    <option selected value=\"\">",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"State",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</option>\n                    ",((a=t.each.call(e,e&&e.states,{name:"each",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+="\n                </select>\n            </div>\n            <div class='non-us-fields ca-province state-province-container input-container'>\n                <select class='province' tabindex='10'>\n                    <option selected value=\"\">",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Province",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</option>\n                    ",((a=t.each.call(e,e&&e.provinces,{name:"each",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+="\n                </select>\n            </div>\n            <input class='us-fields zip' maxlength='5' tabindex='9' placeholder='",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Zipcode",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="'>\n            <input class='non-us-fields postal' maxlength='12' tabindex='11' placeholder='",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Postal Code",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="'>\n            <div class='country-container input-container us'>\n                <select class='country' tabindex='12' required>\n                    <option value=''>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Country",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</option>\n                    ",((a=t.each.call(e,e&&e.countries,{name:"each",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+='\n                </select>\n            </div>\n        </div>\n    </div>\n</div>    \n\n<footer class="dialog-footer">\n    <button class="btn btn-primary continue-checkout">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Continue to Checkout",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>\n</footer>\n"},useData:!0})}(),pi=function(e){var t=[{name:"americanexpress",pattern:/^3[47]/},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/},{name:"visa",pattern:/^4/},{name:"mastercard",pattern:/^5[1-5]/},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/}];return{getType:function(e){for(var i=0;i<t.length;i++){var n=t[i];if(e.match(n.pattern))return n.name}return null},passesChecksum:function(e){for(var t=0,i=!1,n=e.length-1;0<=n;n--){var a=e.charAt(n);a=parseInt(a,10);i&&(9<(a*=2)&&(a-=9)),t+=a,i=!i}return 0==t%10}}}(),ui=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="back-button"></div>'},useData:!0})}(),mi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="content-container">\n    <div class="content-container-content">\n        <legend class="system-info-header">\n            ';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Payment Method",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n        </legend>\n        <div class="info-block">\n            <div class="billing-info"></div>\n        </div>\n        <legend class="system-info-header">\n            ',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Cart",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n        </legend>\n        <div class="order-block">\n            <div class="order-list"></div>\n        </div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BUY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+=' <span class="item-count"></span> ',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ITEM FOR",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+' $<span class="order-total"></span></button>\n<\/script>'},useData:!0})}(),fi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a,s,o='\n<div class="info-line address">'+(i=this.escapeExpression)("function"==typeof(s=t.address||e&&e.address)?s.call(e,{name:"address",hash:{},data:n}):s)+'</div>\n<div class="info-line">'+i("function"==typeof(s=t.city||e&&e.city)?s.call(e,{name:"city",hash:{},data:n}):s)+", ";return((a=t.if.call(e,e&&e.state,{name:"if",hash:{},fn:this.program(2,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+=" ",((a=t.if.call(e,e&&e.postal_code,{name:"if",hash:{},fn:this.program(4,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+i("function"==typeof(s=t.country||e&&e.country)?s.call(e,{name:"country",hash:{},data:n}):s)+"</div>\n"},2:function(e,t,i,n){var a;return" "+(0,this.escapeExpression)("function"==typeof(a=t.state||e&&e.state)?a.call(e,{name:"state",hash:{},data:n}):a)+" "},4:function(e,t,i,n){var a;return" "+(0,this.escapeExpression)("function"==typeof(a=t.postal_code||e&&e.postal_code)?a.call(e,{name:"postal_code",hash:{},data:n}):a)+", "},6:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r='\n<div class="info-line card-type">'+i("function"==typeof(s=t.card_type||e&&e.card_type)?s.call(e,{name:"card_type",hash:{},data:n}):s)+" ";return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"ending in",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+" -"+i("function"==typeof(s=t.last_four_digits||e&&e.last_four_digits)?s.call(e,{name:"last_four_digits",hash:{},data:n}):s)+"</div>\n"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return i='<div class="info-line name-on-card">'+(i=this.escapeExpression)("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:n}):s)+"</div>\n",((a=t.if.call(e,e&&e.address,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n",((a=t.if.call(e,e&&e.last_four_digits,{name:"if",hash:{},fn:this.program(6,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i},useData:!0})}(),vi=function(e){var t=e.UiCore.UiContext;return t.extend("BillingInfo",{className:"billing-info",uiContextName:"billing_info",dependencies:["globalStringManager"],initialize:function(i){t.prototype.initialize.call(this,i),this.__billingInfo=IMVU.requireProperty(i,"billingInfo"),this.__CCValidator=e.CCValidator,this.addToDOM()},render:function(){var t="",i="";this.__billingInfo.credit_card&&(t=this.__CCValidator.getType(this.__billingInfo.credit_card),i=this.__billingInfo.credit_card.substring(this.__billingInfo.credit_card.length-4)),this.$el.html(e.template({name:this.__billingInfo.name,address:this.__billingInfo.address,city:this.__billingInfo.city,state:this.__billingInfo.state,postal_code:this.__billingInfo.postal_code,country:this.__billingInfo.country,card_type:this.__globalStringManager.get("card_type_"+(t||"other")),last_four_digits:i}))}})}({UiCore:e["@UiCore"],template:fi,CCValidator:pi}),bi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='alert-message'>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_pending_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+=" <a target='_blank' href='/next/settings/order'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_pending_link_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</a>.</div>\n<div class='alert-message'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_pending_after_link_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n"},useData:!0})}(),Ci=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='alert-message'>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_unknown_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+=" <a target='_blank' href='/next/settings/order'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_unknown_link_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</a>.</div>\n<div class='alert-message'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_unknown_after_link_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n"},useData:!0})}(),yi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='<div class="content-container">\n    <div class="info-block message">\n        <div class="title">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"order_thankyou",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</div>\n        <div class="text">'+o("function"==typeof(s=t.status_message||e&&e.status_message)?s.call(e,{name:"status_message",hash:{},data:n}):s)+'</div>\n    </div>\n    <legend class="system-info-header">\n        ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BILLED TO",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='\n    </legend>\n    <div class="info-block">\n        <div class="billing-info"></div>\n    </div>\n    <legend class="system-info-header">\n        ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"YOUR ORDER",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='\n    </legend>\n    <div class="order-block">\n        <div class="order-list"></div>\n    </div>\n    <div class="info-block">\n        <div>',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Order",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+=" #"+o("function"==typeof(s=t.order_id||e&&e.order_id)?s.call(e,{name:"order_id",hash:{},data:n}):s)+"</div>\n        <div>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Purchase date",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+=": "+o("function"==typeof(s=t.order_date||e&&e.order_date)?s.call(e,{name:"order_date",hash:{},data:n}):s)+'</div>\n        <div class="order-total">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"TOTAL",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+" $"+o("function"==typeof(s=t.order_total||e&&e.order_total)?s.call(e,{name:"order_total",hash:{},data:n}):s)+"</div>\n    </div>\n</div>"},useData:!0})}(),Mi=function(e){var t=e.Dialogs.AlloyAlertDialog;return t.extend("PaymentSuccessDialog",{uiContextName:"payment_success_dialog",className:"payment-success-dialog dialog-type-B",dependencies:"billingInfo globalStringManager loginManager orderResponse originalCart timestampHelper".split(" "),__recordShown:!0,initialize:function(i){this.__stringManager=i.globalStringManager,this.__billingInfo=i.billingInfo,this.__orderResponse=i.orderResponse,this.__originalCart=i.originalCart,i.title=this.__stringManager.get("payment_success_title"),i.ok=this.__stringManager.get("payment_success_button"),this.__CCValidator=e.CCValidator,t.prototype.initialize.call(this,i),this.$el.removeClass("can-dismiss"),this.__loginManager.getCurrentUser().invalidate()},postRender:function(){t.prototype.postRender.call(this),this.__orderResponse.populated().then(function(){this.__cart=this.__filterCart();var t=this.__timestampHelper.orderDate(this.__orderResponse.get("order_date"));this.$(".id-body-contents").html(e.template({order_date:t,order_id:this.__orderResponse.get("order_id"),order_total:this.__orderTotal.toFixed(2),status_message:this.__stringManager.get("order_status_message",{product:this.__getProduct()})})),this.createChildContext(e.BillingInfo,{$replaceElement:this.$(".billing-info"),billingInfo:this.__billingInfo}),this.createChildContext(e.OrderList,{$replaceElement:this.$(".order-list"),cart:this.__originalCart}),this.$(".content-container").scrollbar()}.bind(this))},__filterCart:function(){var e=[];return this.__orderTotal=0,_.each(this.__originalCart,function(t){var i={};i.price=t.price,i.name=t.name,e.push(i),this.__orderTotal+=parseFloat(i.price)}.bind(this)),e},__getProduct:function(){var e=!1,t=!1;return _.each(this.__orderResponse.get("cart"),function(i){-1<i.product_name.toLowerCase().indexOf("credit")&&(t=!0),-1<i.product_name.toLowerCase().indexOf("vip")&&(e=!0)}.bind(this)),e&&t?this.__stringManager.get("Credits")+this.__stringManager.get("and")+this.__stringManager.get("VIP"):e&&!t?this.__stringManager.get("VIP"):!e&&t?this.__stringManager.get("Credits"):void 0}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:yi,CCValidator:pi,OrderList:ci,BillingInfo:vi}),ki=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='alert-message'>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_processing_error_text_1",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</div>\n<div class='alert-message'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_processing_error_text_2",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</div>\n<div class='alert-message'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_processing_error_text_3",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+" <a target='_blank' href='https://help.imvu.com'>www.imvu.com/help</a>.</div>\n"},useData:!0})}(),xi=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PaymentBaseDialog",{uiContextName:"payment_base_dialog",className:"payment-base-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager leanplum loginManager prefsManager restModelFactory window".split(" "),initialize:function(e){t.prototype.initialize.call(this,e),this.__context=IMVU.optionalProperty(e,"context",null),this.__orderPostUrl=this.__globalStartupModel.get("accountOrdersUrl"),this.__loginManager.isLoggedIn()||(this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot),this.__orderSuccess=!1},delete:function(){this.__closePaypalWindow(),this.promiseResolver&&this.promiseResolver.resolve(this.__orderSuccess),t.prototype.delete.call(this)},__destroy:function(){this.hide(),this.delete()},__filterCart:function(){var e=[];return _.each(this.__cart,function(t){var i={};i.price=t.price,i.sku=t.sku,i.pid=t.pid,i.type=t.type,e.push(i)}.bind(this)),e},__setProcessing:function(e){this.$(".buy-now").prop("disabled",e),this.$(".add-credit-card").prop("disabled",e),this.$(".paypal-checkout").prop("disabled",e),this.$el.toggleClass("loading",e),this.$(".payment-input").prop("disabled",e),this.$(".dialog-x").prop("disabled",e)},__openPaypalWindow:function(){this.__closePaypalWindow(),this.__paypalWindow=this.__window.open("/paypal/loading/","_blank")},__closePaypalWindow:function(){this.__paypalWindow&&(this.__paypalWindow.close(),this.__paypalWindow=null)},__displayPaypalOrderUpdate:function(){if(this.stopListening(this.__paypalOrderResponse),this.__closePaypalWindow(),!this.__orderStatus)switch(this.__orderStatus=this.__paypalOrderResponse.get("status"),this.__orderStatus){case"attempted":case"abandoned":break;case"external review":case"review":this.__displayPendingOrderDialog();break;case"validating":case"waiting for payment":case"being delivered":case"approved":case"paid":case"delivered":this.__displayPaypalSuccessDialog();break;case"rejected":case"failed cc check":case"blocked":this.__displayProcessingErrorDialog();break;default:this.__displayUnknownOrderDialog()}},__submitOrder:function(t){this.__restModelFactory.createModel(this.__orderPostUrl,e.UiCore.NodeModel,t).then(function(e){this.__setProcessing(!1),t.paypal_payment?"review"!==e.get("status")&&e.get("paypal_url")?this.__paypalWindow&&!this.__paypalWindow.closed&&(this.__paypalOrderResponse=e,this.__paypalWindow.location.href="https://www.paypal.com/cgi-bin/webscr?cmd=_express-checkout&useraction=commit&token="+e.get("paypal_url"),this.listenTo(this.__paypalOrderResponse,"change",this.__displayPaypalOrderUpdate)):(this.__leanplum.recordEvent("payment_error",{error:"paypal_error",type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__displayProcessingErrorDialog(),this.__closePaypalWindow()):(this.__displayPaymentSuccessDialog(t,e),t.cc_payment&&this.__prefsManager.populated().then(function(){var e=this.__prefsManager.getBool("next.payment.creditcard.save_card.disable"),i=!t.cc_payment.save_card;i!==e&&this.__prefsManager.setBool("next.payment.creditcard.save_card.disable",i)}.bind(this)))}.bind(this)).catch(function(e){switch(this.__setProcessing(!1),this.__closePaypalWindow(),e.error&&"Not authorized for request"===e.error.message&&(this.__leanplum.recordEvent("payment_error",{error:"not authorized",type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot),this.__errorType="Unknown",e.error&&e.error.error&&(this.__errorType=e.error.error,this.__errorMessage=e.error.message),this.__leanplum.recordEvent("payment_error",{error:this.__errorType,type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__errorType){case"ACCOUNT_ORDER_PENDING":t.paypal_payment?this.__displayProcessingErrorDialog():this.__displayPendingOrderDialog();break;case"ACCOUNT_ORDER_PRICE_DISCREPANCY":case"ACCOUNT_ORDER_INVALID_STORE_PRODUCT":case"ACCOUNT_ORDER_EMPTY_CART":this.__displayInvalidPriceDialog();break;case"ACCOUNT_ORDER_FAILURE":case"ACCOUNT_ORDER_INVALID_COUNTRY_CODE":case"INBOUND VALIDATION-001":case"ACCOUNT_ORDER_INVALID_CARD_NUMBER":this.__displayFailedOrderDialog();break;case"ACCOUNT_ORDER_BLOCKED":case"ACCOUNT_ORDER_PAYPAL_SUBMIT_PAYMENT":case"ACCOUNT_ORDER_PAYPAL_PAYMENT_INFO":this.__displayProcessingErrorDialog();break;default:this.__displayUnknownOrderDialog()}}.bind(this))},__displayPaypalSuccessDialog:function(){this.__displayPaymentSuccessDialog({paypal_payment:!0},this.__paypalOrderResponse)},__displayPaymentSuccessDialog:function(t,i){var n;return this.__leanplum.recordEvent("payment_success",{type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__orderSuccess=!0,t.cc_payment?n=t.cc_payment:t.paypal_payment?n={name:"Paypal"}:t.saved_cc_payment&&(n={card_type:this.__selectedCard.get("card_type"),name:this.__selectedCard.get("name"),last_four_digits:this.__selectedCard.get("card_last_digits")}),this.__dialogManager.showDialog(e.PaymentSuccessDialog,{billingInfo:n,orderResponse:i,originalCart:this.__cart}).finished.then(function(e){this.__checkForVerifiedEmailAndExit()}.bind(this)).catch(function(e){this.__checkForVerifiedEmailAndExit()}.bind(this))},__checkForVerifiedEmailAndExit:function(){this.__loginManager.getCurrentUser().populated().then(function(e){e.get("is_email_verified")?this.__destroy():this.__displayEmailVerificationDialog()}.bind(this))},__displayEmailVerificationDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("verify_email_dialog_title"),text:this.__globalStringManager.get("verify_email_dialog_text")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayInvalidPriceDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_invalid_price_title"),text:this.__globalStringManager.get("payment_invalid_price_text"),ok:this.__globalStringManager.get("payment_invalid_price_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayFailedOrderDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_failed_title"),text:this.__globalStringManager.get("payment_failed_text"),ok:this.__globalStringManager.get("payment_failed_button")}).finished},__displayUnknownOrderDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_unknown_title"),html:e.UnknownOrderDialog({}),ok:this.__globalStringManager.get("payment_unknown_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayProcessingErrorDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_processing_error_title"),html:e.ProcessingErrorDialog({}),ok:this.__globalStringManager.get("payment_processing_error_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayPendingOrderDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_pending_title"),html:e.PendingOrderDialog({}),ok:this.__globalStringManager.get("payment_pending_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],PaymentSuccessDialog:Mi,PendingOrderDialog:bi,ProcessingErrorDialog:ki,UnknownOrderDialog:Ci}),wi=function(e){var t=e.PaymentBaseDialog;return t.extend("CreditCardPaymentReviewDialog",{uiContextName:"credit_card_payment_review_dialog",className:"credit-card-payment-review-dialog dialog-type-B",dependencies:"globalStartupModel globalStringManager dialogManager channel billingInfo cart orderTotal itemCount restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-now",name:"buy_now",handler:this.__creditCardCheckout},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(e){t.prototype.initialize.call(this,e),this.$el.removeClass("can-dismiss"),this.title=this.__globalStringManager.get("credit_card_review_title"),this.addToDOM()},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend(e.backButtonTemplate({})),this.setContent("body",e.template),this.setContent("footer",this.$(".dialog-footer-template").text()),this.createChildContext(e.BillingInfo,{$replaceElement:this.$(".billing-info"),billingInfo:this.__billingInfo}),this.createChildContext(e.OrderList,{$replaceElement:this.$(".order-list"),cart:this.__cart}),this.$(".order-total").text(this.__orderTotal.toFixed(2)),this.$(".item-count").text(this.__itemCount),this.$(".content-container").scrollbar()},__creditCardCheckout:function(){this.__setProcessing(!0);var e={cart:this.__filterCart(),channel:this.__channel,payment_method:"cc_payment",cc_payment:this.__billingInfo};this.__submitOrder(e)},__goBack:function(){this.hide(),this.promiseResolver.reject()}})}({UiCore:e["@UiCore"],PaymentBaseDialog:xi,template:mi,CCValidator:pi,OrderList:ci,BillingInfo:vi,backButtonTemplate:ui}),Pi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='alert-message'><img src='/catalog/web_images/veri_code.gif'></div>\n\n<div class='alert-message'>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"security_code_help_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n"},useData:!0})}(),$i=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("AddCreditCardDialog",{uiContextName:"add_credit_card_dialog",className:"add-credit-card-dialog dialog-type-B",dependencies:"channel cart dialogManager featureAccessManager globalStringManager itemCount leanplum loginManager orderTotal prefsManager timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:".continue-checkout",name:"continue_checkout",handler:this.__continueCheckout},{type:"keyup",selector:".cardnumber",name:"changing_cardnumber",handler:this.__isBlankCardNumber},{type:"blur",selector:".cardnumber",name:"changed_cardnumber",handler:this.__validateCardNumber},{type:"change",selector:".exp-month",name:"change_exp_month_select",handler:this.__validateExpMonth},{type:"change",selector:".exp-year",name:"change_exp_year_select",handler:this.__validateExpYear},{type:"keyup",selector:".security-code",name:"changing_security_code",handler:this.__isBlankSecurityCode},{type:"blur",selector:".security-code",name:"changed_security_code",handler:this.__validateSecurityCode},{type:"keyup",selector:".name-on-card",name:"changing_name",handler:this.__isBlankNameOnCard},{type:"blur",selector:".name-on-card",name:"changed_name",handler:this.__validateNameOnCard},{type:"keyup",selector:".address",name:"changing_address",handler:this.__isBlankAddress},{type:"blur",selector:".address",name:"changed_address",handler:this.__validateAddress},{type:"keyup",selector:".city",name:"change_city",handler:this.__isBlankCity},{type:"blur",selector:".city",name:"change_city",handler:this.__validateCity},{type:"change",selector:".state",name:"change_state_select",handler:this.__validateState},{type:"keyup",selector:".zip",name:"changing_zip",handler:this.__isBlankZip},{type:"blur",selector:".zip",name:"changed_zip",handler:this.__validateZip},{type:"change",selector:".province",name:"change_province_select",handler:this.__validateProvince},{type:"keyup",selector:".postal",name:"changing_postal",handler:this.__isBlankPostal},{type:"blur",selector:".postal",name:"changed_postal",handler:this.__validatePostal},{type:"change",selector:".country",name:"change_country_select",handler:this.__validateCountry},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(i){t.prototype.initialize.call(this,i),this.shouldFocusOnPrimaryButton=!1,i.loginManager.isLoggedIn()||(this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot),this.title=this.__globalStringManager.get("Add New Credit Card"),this.__monthRange="01 02 03 04 05 06 07 08 09 10 11 12".split(" "),this.__getYearRange(),this.__states=e.StateMap,this.__provinces=e.ProvinceMap,this.__countries=e.CountryMap,this.__CCValidator=e.CCValidator,this.__missingFields=[],this.addToDOM()},delete:function(){t.prototype.delete.call(this),this.__tooltip&&this.__tooltip.delete()},__destroy:function(){this.hide(),this.delete()},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend(e.backButtonTemplate({})),this.__prefsManager.populated().then(function(){this.setContent("body",e.template,{monthRange:this.__monthRange,yearRange:this.__yearRange,states:this.__states,provinces:this.__provinces,countries:this.__countries,saveCard:!this.__prefsManager.getBool("next.payment.creditcard.save_card.disable")}),this.$(".non-us-fields").hide(),this.$('.country option[value="US"]').prop("selected",!0),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".exp-month")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".exp-year")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".state")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".province")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".country")}),this.$(".content-container").scrollbar(),this.__tooltip=this.serviceProvider.create(e.Tooltip,{$replaceElement:this.$(".security-code-tooltip"),$tooltipTarget:this.$(".security-code-help-link")})}.bind(this))},__getYearRange:function(){this.__yearRange=[];for(var e=this.__timer.getDate().getFullYear(),t=0;20>t;t++)this.__yearRange.push(t+e)},__validateInputs:function(){this.__validateCardNumber(),this.__validateSecurityCode(),this.__validateExpMonth(),this.__validateExpYear(),this.__validateNameOnCard(),this.__validateCardName(),this.__validateAddress(),this.__validateCity(),this.__validateCountry(),"US"===this.$(".country select").val()?(this.__validateZip(),this.__validateState()):"CA"===this.$(".country select").val()&&(this.__validatePostal(),this.__validateProvince())},__errorIfBlank:function(e,t){var i=t?""===this.$("."+e+" select").val():""===this.$("."+e).val().trim();return this.__updateMissingFields(e,i),i},__updateMissingFields:function(e,t){this.$("."+e).toggleClass("payment-error",t);var i=this.__missingFields.indexOf(e);t&&0>i?this.__missingFields.push(e):!t&&-1<i&&this.__missingFields.splice(i,1),this.$(".field-missing").toggleClass("error-visible",0!==this.__missingFields.length)},__isBlankCardNumber:function(e){-1<this.__missingFields.indexOf("cardnumber")&&this.__errorIfBlank("cardnumber"),this.__displayCardIcon(this.$(".cardnumber").val()),this.__updateErrorStatus()},__validateCardNumber:function(){if(this.__errorIfBlank("cardnumber"))this.$(".cardnumber-invalid").removeClass("error-visible");else{this.__leanplum.recordEvent("add_cc_cc_change");var e=this.$(".cardnumber").val().replace(/[ \-]/g,"");e.match(/^\d{13,16}$/)&&this.__CCValidator.passesChecksum(e)?(this.$(".cardnumber-invalid").removeClass("error-visible"),this.$(".cardnumber").removeClass("payment-error")):(this.$(".cardnumber-invalid").addClass("error-visible"),this.$(".cardnumber").addClass("payment-error"))}this.__updateErrorStatus()},__validateCardName:function(){var e=this.$(".name-on-card").val().trim(),t=e.trim().split(/\s+/).length;/\d/.test(e)||2>t?(this.$(".cardname-invalid").addClass("error-visible"),this.$(".name-on-card").addClass("payment-error")):(this.$(".cardname-invalid").removeClass("error-visible"),this.$(".name-on-card").removeClass("payment-error")),this.__updateErrorStatus()},__displayCardIcon:function(e){(e=this.__CCValidator.getType(e))?(this.$(".cardimage").addClass("card-number-present"),this.$(".cardimage."+e).addClass("card-type-active")):(this.$(".cardimage").removeClass("card-number-present"),this.$(".cardimage").removeClass("card-type-active")),this.__updateErrorStatus()},__isBlankSecurityCode:function(){-1<this.__missingFields.indexOf("security-code")&&this.__errorIfBlank("security-code"),this.__updateErrorStatus()},__validateSecurityCode:function(){this.__errorIfBlank("security-code")?this.$(".security-code-invalid").removeClass("error-visible"):(this.__leanplum.recordEvent("add_cc_security_code_change"),this.$(".security-code").val().trim().match(/^\d\d\d\d?$/)?(this.$(".security-code-invalid").removeClass("error-visible"),this.$(".security-code").removeClass("payment-error")):(this.$(".security-code-invalid").addClass("error-visible"),this.$(".security-code").addClass("payment-error"))),this.__updateErrorStatus()},__validateExpMonth:function(){this.__errorIfBlank("exp-month",!0)||(this.__leanplum.recordEvent("add_cc_exp_month_change"),this.__validateExpDate()),this.__updateErrorStatus()},__validateExpYear:function(){this.__errorIfBlank("exp-year",!0)||(this.__leanplum.recordEvent("add_cc_exp_year_change"),this.__validateExpDate()),this.__updateErrorStatus()},__validateExpDate:function(){var e=parseInt(this.$(".exp-year select").val(),10),t=parseInt(this.$(".exp-month select").val(),10);if(0<e&&0<t){var i=(n=this.__timer.getDate()).getFullYear(),n=n.getMonth()+1;i>e||i===e&&n>t?(this.$(".exp-date-expired").addClass("error-visible"),this.$(".exp-month").addClass("payment-error"),this.$(".exp-year").addClass("payment-error")):(this.$(".exp-date-expired").removeClass("error-visible"),this.$(".exp-month").removeClass("payment-error"),this.$(".exp-year").removeClass("payment-error"))}else this.$(".exp-date-expired").removeClass("error-visible");this.__updateErrorStatus()},__isBlankNameOnCard:function(){-1<this.__missingFields.indexOf("name-on-card")&&this.__errorIfBlank("name-on-card"),this.__updateErrorStatus()},__validateNameOnCard:function(){this.__errorIfBlank("name-on-card"),this.__updateErrorStatus()},__isBlankAddress:function(){-1<this.__missingFields.indexOf("address")&&this.__errorIfBlank("address"),this.__updateErrorStatus()},__validateAddress:function(){this.__errorIfBlank("address"),this.__leanplum.recordEvent("add_cc_address_change"),this.__updateErrorStatus()},__isBlankCity:function(){-1<this.__missingFields.indexOf("city")&&this.__errorIfBlank("city"),this.__updateErrorStatus()},__validateCity:function(){this.__errorIfBlank("city"),this.__updateErrorStatus()},__validateState:function(){this.__errorIfBlank("state",!0),this.__leanplum.recordEvent("add_cc_state_change"),this.__updateErrorStatus()},__validateProvince:function(){this.__errorIfBlank("province",!0),this.__leanplum.recordEvent("add_cc_province_change"),this.__updateErrorStatus()},__isBlankZip:function(){-1<this.__missingFields.indexOf("zip")&&this.__errorIfBlank("zip"),this.__updateErrorStatus()},__validateZip:function(){this.__errorIfBlank("zip")?this.$(".zip-invalid").removeClass("error-visible"):(this.__leanplum.recordEvent("add_cc_zip_change"),this.$(".zip").val().trim().match(/^\d\d\d\d\d$/)?(this.$(".zip-invalid").removeClass("error-visible"),this.$(".zip").removeClass("payment-error")):(this.$(".zip-invalid").addClass("error-visible"),this.$(".zip").addClass("payment-error"))),this.__updateErrorStatus()},__isBlankPostal:function(){"CA"===this.$(".country select").val()&&-1<this.__missingFields.indexOf("postal")&&this.__errorIfBlank("postal"),this.__updateErrorStatus()},__validatePostal:function(){"CA"===this.$(".country select").val()&&(this.__leanplum.recordEvent("add_cc_postal_change"),this.__errorIfBlank("postal")?this.$(".postal-invalid").removeClass("error-visible"):this.$(".postal").val().trim().match(/^[A-Za-z]\d[A-Za-z]\s*\d[A-Za-z]\d$/)?(this.$(".postal-invalid").removeClass("error-visible"),this.$(".postal").removeClass("payment-error")):(this.$(".postal-invalid").addClass("error-visible"),this.$(".postal").addClass("payment-error"))),this.__updateErrorStatus()},__validateCountry:function(){this.__leanplum.recordEvent("add_cc_country_change"),this.$(".zip-invalid").removeClass("error-visible"),this.$(".postal-invalid").removeClass("error-visible"),this.__updateMissingFields("zip",!1),this.__updateMissingFields("state",!1),this.__updateMissingFields("postal",!1),this.__updateMissingFields("province",!1),this.__errorIfBlank("country",!0),"US"===this.$(".country select").val()?(this.$(".us-fields").show(),this.$(".non-us-fields").hide(),this.$(".country-container").addClass("us"),this.$(".postal").val(""),this.$('.ca-province option[value=""]').prop("selected",!0)):(this.$(".country-container").removeClass("us"),this.$(".us-fields").hide(),this.$(".zip").val(""),this.$('.state option[value=""]').prop("selected",!0),this.$(".non-us-fields").show(),"CA"===this.$(".country select").val()?(this.$(".ca-province").show(),this.$(".country-container").addClass("canada"),this.$(".postal").removeClass("intl")):(this.$(".postal").addClass("intl"),this.$(".ca-province").hide(),this.$('.ca-province option[value=""]').prop("selected",!0),this.$(".country-container").removeClass("canada"))),this.__updateErrorStatus()},__updateErrorStatus:function(){this.$(".error-block").toggleClass("has-error",0<this.$(".error-visible").length)},__continueCheckout:function(){this.__validateInputs(),0<this.$(".payment-error").length?this.$(".dialog-body").scrollTop(0):this.__dialogManager.showDialog(e.CreditCardPaymentReviewDialog,{billingInfo:this.__getBillingInfo(),channel:this.__channel,cart:this.__cart,orderTotal:this.__orderTotal,itemCount:this.__itemCount}).finished.then(function(e){this.promiseResolver.accept(),this.__destroy()}.bind(this)).catch(function(e){}.bind(this))},__getBillingInfo:function(){var e=this.$(".country select").val(),t=this.$(".state select").val(),i=this.$(".zip").val().trim();return"CA"===e?(t=this.$(".province select").val(),i=this.$(".postal").val().trim()):"US"!==e&&(t="",i=this.$(".postal").val().trim()),{name:this.$(".name-on-card").val().trim(),address:this.$(".address").val().trim(),city:this.$(".city").val().trim(),state:t,postal_code:i,country:e,credit_card:this.$(".cardnumber").val().replace(/[ \-]/g,""),exp_month:this.$(".exp-month select").val(),exp_year:this.$(".exp-year select").val(),cvc:this.$(".security-code").val().trim(),save_card:this.$("#save-for-later-checkbox").prop("checked")}},__goBack:function(){this.hide(),this.promiseResolver.reject()}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:gi,SecurityCodeHelpDialog:Pi,CountryMap:e["json!/common/js/JSON/Countries.json"],StateMap:e["json!/common/js/JSON/States.json"],ProvinceMap:e["json!/common/js/JSON/Provinces.json"],Dropdown:_i,CCValidator:pi,Tooltip:Dt,CreditCardPaymentReviewDialog:wi,backButtonTemplate:ui}),Si=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s,o=this.escapeExpression;return i=t.helperMissing,o='<div class="card-row">\n    <div class="card-wrap">\n        <div class="card-info">\n            <div class="number">XXXX-XXXX-XXXX-'+o("function"==typeof(s=t.cardNumber||e&&e.cardNumber)?s.call(e,{name:"cardNumber",hash:{},data:n}):s)+'</div>\n            <div><span class="type">'+o("function"==typeof(s=t.type||e&&e.type)?s.call(e,{name:"type",hash:{},data:n}):s)+'</span></div>\n        </div>\n        <div class="primary">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Primary",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+='</div>\n        <div class="context">\n            <span class="icon icon-action-more context-menu-button"></span>\n        </div>\n    </div>\n    <div class="primary">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Primary",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+"</div>\n</div>"},useData:!0})}(),Ui=function(e){var t=e.UiCore.UiContext;return t.extend("SavedCreditCardListItem",{className:"saved-credit-card-list-item",uiContextName:"saved_credit_card_list_item",tagName:"li",dependencies:"context contextMenuManager dialogManager globalStringManager rest selectedCard".split(" "),trackedEvents:function(){return[{type:"click",name:"select_card",handler:this.__selectCard},{type:"click",name:"show_context_menu",selector:".context-menu-button",handler:this.__showContextMenu}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM(),this.listenTo(this.model,"select",this.__selectCard)},render:function(){this.model.populated().then(function(){var t=this.model.get("card_type")?this.model.get("card_type"):"other";this.__cardTypeString=this.__globalStringManager.get("card_type_"+t),this.$el.html(e.template({cardNumber:this.model.get("card_last_digits"),type:this.__cardTypeString})),this.model.get("is_primary")&&this.$el.addClass("is-primary"),null!==this.__selectedCard&&this.model.get("is_primary")&&this.__selectCard()}.bind(this))},__showContextMenu:function(t){var i=this.model.get("is_primary")?[{name:"delete_card",text:this.__globalStringManager.get("Delete"),handler:this.__deleteCard.bind(this)}]:[{name:"make_primary",text:this.__globalStringManager.get("Make Primary"),handler:this.__makePrimary.bind(this)},{name:"delete_card",text:this.__globalStringManager.get("Delete"),handler:this.__deleteCard.bind(this)}];this.__contextMenuManager.showMenu(t,e.ContextMenu,{items:i,displayOptions:{above:!1,right:!1}})},__selectCard:function(){e.NextUtil.DomHelper.radioClass(this.$el,"selected-card"),null!==this.__selectedCard&&(this.__selectedCard.set({id:parseInt(this.model.id.match(/\d+/)[0].replace("saved_card-","")),card_type:this.__cardTypeString,name:this.model.get("name"),card_last_digits:this.model.get("card_last_digits")}),this.__selectedCard.trigger("selected"))},__makePrimary:function(){this.$el.hasClass("is-primary")||this.model.save({default:!0}).then(function(){this.$el.addClass("is-primary")}.bind(this))},__deleteCard:function(){this.__dialogManager.confirm({title:this.__globalStringManager.get("Delete Payment Method"),text:this.__globalStringManager.get("Are you sure you want to delete this payment method?"),yes:this.__globalStringManager.get("Delete"),no:this.__globalStringManager.get("Cancel")}).finished.then(function(){this.__selectedCard&&null!==this.__selectedCard.get("id")&&this.__selectedCard.get("id")===parseInt(this.model.id.match(/\d+/)[0].replace("saved_card-",""))&&(this.__selectedCard=new IMVU.NamedModel({id:null}),this.__context.trigger("selected_card_deleted")),this.__rest.delete(this.model.id),this.__context.trigger("card_deleted"),this.delete()}.bind(this))}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:Si,ContextMenu:A}),Ti=function(e){var t=e.UiCore.ListPresenter;return t.extend("SavedCreditCardList",{className:"saved-credit-card-list",uiContextName:"saved_credit_card_list",tagName:"ul",itemFactory:e.SavedCreditCardListItem,dependencies:["globalStringManager"],initialize:function(e){t.prototype.initialize.call(this,e),this.__showEmptyText=IMVU.optionalProperty(e,"showEmptyText",!1)},__emptyText:function(){if(this.$el.addClass("is-empty"),this.__showEmptyText)return{standard:this.__globalStringManager.get("No Saved Card"),concise:this.__globalStringManager.get("No Saved Card")}}})}({UiCore:e["@UiCore"],SavedCreditCardListItem:Ui}),Di=function(e){var t=e.PaymentBaseDialog;return t.extend("PaymentDialog",{uiContextName:"payment_dialog",className:"payment-dialog dialog-type-B",dependencies:"cart dialogManager globalStringManager globalStartupModel googleAnalytics leanplum platform restModelFactory".split(" "),trackedEvents:function(){return[{type:"change",selector:".vip",name:"vip_checkbox_changed",handler:"__validateVipCheckbox"},{type:"click",selector:".core-store-link",name:"go_to_core_store",handler:"__goToCoreStore",allowBubble:!0},{type:"click",selector:".add-credit-card",name:"add_credit_card",handler:"__addCreditCard"},{type:"click",selector:".paypal-checkout",name:"paypal_checkout",handler:"__paypalCheckout"},{type:"click",selector:".buy-now",name:"buy_now",handler:"__creditCardCheckout"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("payment_dialog_title"),this.shouldFocusOnPrimaryButton=!1,this.__channel=IMVU.optionalProperty(e,"channel","unknown"),this.__platformId=(this.__isMobile="mobile"===this.__platform)?10:9,this.__selectedCard=new IMVU.NamedModel({id:null}),this.listenTo(this.__selectedCard,"selected",this.__toggleCheckoutButton.bind(this,!0)),this.listenTo(this,"selected_card_deleted",this.__toggleCheckoutButton.bind(this,!1)),this.addToDOM()},postRender:function(){this.__validateCart(),this.setContent("body",e.template,{hasVip:this.__hasVip,platformId:this.__platformId,itemCount:this.__cart.length,showTotal:1<this.__cart.length}),this.setContent("footer",this.$(".dialog-footer-template").text()),this.__invalidProduct?(this.$(".buy-now").prop("disabled",!0),this.$(".invalid-product").addClass("error-visible")):this.createChildContext(e.OrderList,{$replaceElement:this.$(".order-list-placeholder"),cart:this.__cart}),this.__toggleCheckoutButton(!1),this.__savedCreditCards=this.track(this.__restModelFactory.readCollection(this.__globalStartupModel.get("savedCreditCardUrl"),e.UiCore.NodeCollection)),this.listenTo(this.__savedCreditCards,"reset",this.__loadSavedCard),this.__loadSavedCard(),this.$(".order-total").text(this.__orderTotal.toFixed(2)),this.$(".item-count").text(this.__itemCount),this.__hasVip&&this.createChildContext(e.Tooltip,{$replaceElement:this.$(".vip-toc-tooltip"),$tooltipTarget:this.$(".vip-toc-link")}),this.$(".content-container").scrollbar()},__toggleCheckoutButton:function(e){this.$(".buy-now").prop("disabled",!e)},__validateCart:function(){return this.__itemCount=this.__orderTotal=0,this.__invalidProduct=this.__hasVip=!1,0===this.__cart.length&&(this.__invalidProduct=!0),_.each(this.__cart,function(e){!e.name||!e.sku||!e.price||0>e.price?this.__invalidProduct=!0:0<e.sku.indexOf(".vip.")&&(this.__hasVip=!0),this.__itemCount++,this.__orderTotal+=e.price,e.price=e.price.toFixed(2)}.bind(this)),!this.__invalidProduct},__validateVipCheckbox:function(){this.$(".vip").prop("checked")?(this.$(".vip-checkbox-missing").removeClass("error-visible"),this.$(".vip-block label").removeClass("payment-error")):(this.$(".vip-checkbox-missing").addClass("error-visible"),this.$(".vip-block label").addClass("payment-error")),this.__updateErrorStatus()},__updateErrorStatus:function(){this.$(".error-block").toggleClass("has-error",0<this.$(".error-visible").length)},__scrollTop:function(){this.$(".content-container").scrollTop(0)},__creditCardCheckout:function(){this.__hasVip&&this.__validateVipCheckbox(),0<this.$(".payment-error").length?this.__scrollTop():(this.__leanplum.recordEvent("dollar_store_buy_start",{type:this.__cart[0].type,sku:this.__cart[0].sku,price:this.__cart[0].price,pid:this.__cart[0].pid}),this.__googleAnalytics.recordDollarStore("buy",this.__cart[0].sku),this.__setProcessing(!0),this.__submitOrder(this.__createSavedCreditCardOrder()))},__createSavedCreditCardOrder:function(){return{cart:this.__filterCart(),channel:this.__channel,payment_method:"saved_cc_payment",saved_cc_payment:{id:this.__selectedCard.get("id")}}},__paypalCheckout:function(){this.__hasVip&&this.__validateVipCheckbox(),0<this.$(".payment-error").length?this.__scrollTop():(this.__setProcessing(!0),this.__openPaypalWindow(),this.__submitOrder({cart:this.__filterCart(),channel:this.__channel,payment_method:"paypal_payment",paypal_payment:{}}))},__goToCoreStore:function(){},__loadSavedCard:function(){this.__savedCreditCards.populated().then(function(){this.$(".savedcard-container").html("");var t=_.filter(this.__savedCreditCards.models,function(e){return"co"!==e.attributes.system}.bind(this));t=new IMVU.NamedCollection(t);this.__savedCard=this.createChildContext(e.SavedCreditCardList,{$parentElement:this.$(".savedcard-container"),collection:t,context:this,selectedCard:this.__selectedCard});var i=!1;_.each(t.models,function(e){e.get("is_primary")&&(i=!0)}),!i&&0<t.models.length&&t.models[0].trigger("select")}.bind(this))},__addCreditCard:function(){if(this.__hasVip&&this.__validateVipCheckbox(),!(0<this.$(".payment-error").length))return this.__dialogManager.showDialog(e.AddCreditCardDialog,{channel:this.__channel,cart:this.__cart,orderTotal:this.__orderTotal,itemCount:this.__itemCount}).finished.then(function(e){this.promiseResolver.accept(),this.__destroy()}.bind(this)).catch(function(e){}.bind(this));this.__scrollTop()}})}({UiCore:e["@UiCore"],PaymentBaseDialog:xi,AddCreditCardDialog:$i,Dropdown:_i,OrderList:ci,SavedCreditCardList:Ti,Tooltip:Dt,template:li}),Li=function(e){var t=e.UiCore.UiContext;return t.extend("CheckoutButton",{uiContextName:"checkout_button",className:"inline-purchase-checkout-button",dependencies:["globalStringManager","dialogManager","loginManager"],trackedEvents:function(){return[{type:"click",selector:".buy-now",name:"store_checkout",handler:this.__storeCheckout}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__stringManager=i.globalStringManager,this.__formatNumber=e.FormatNumber,this.dialogManager=i.dialogManager,this.__selectedCredit=IMVU.optionalProperty(i,"selectedCredit",new IMVU.NamedModel({price:0})),this.__selectedVip=IMVU.optionalProperty(i,"selectedVip",new IMVU.NamedModel({price:0})),this.__context=IMVU.optionalProperty(i,"context",null),this.listenTo(this.__selectedCredit,"change",this.__updateCheckoutButton),this.listenTo(this.__selectedVip,"change",this.__updateCheckoutButton),this.addToDOM(),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__updateCheckoutButton()},render:function(){this.$el.html(e.template())},__updateCheckoutButton:function(){var e;this.__getNumber()?(this.$("button.buy-now").prop("disabled",!1),e=1===this.__getNumber()?this.__stringManager.get("checkout_dialog_buy_now_message_singular",{totalCredits:"$"+this.__formatNumber.formatCredits(this.__getTotalPrice())}):this.__stringManager.get("checkout_dialog_buy_now_message_plural",{howMany:this.__getNumber(),totalCredits:"$"+this.__formatNumber.formatCredits(this.__getTotalPrice())}),this.$("button.buy-now").text(e)):(this.$("button.buy-now").prop("disabled",!0),this.$("button.buy-now").text(this.__stringManager.get("CHECKOUT")))},__getNumber:function(){var e=0;return 0<this.__selectedCredit.get("price")&&e++,0<this.__selectedVip.get("price")&&e++,e},__getTotalPrice:function(){return(this.__selectedCredit.get("price")+this.__selectedVip.get("price")).toFixed(2)},__storeCheckout:function(){this.$("button.buy-now").prop("disabled",!0),this.__myself.populated().then(function(t){if(t.get("is_on_hold"))return this.dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("payment_failed_account_holdon_title"),text:this.__stringManager.get("payment_failed_account_holdon_text"),ok:this.__stringManager.get("payment_failed_account_holdon_button")}).finished.then(function(){this.__context&&this.__context.destroy()}.bind(this));0<this.__selectedVip.get("price")&&this.__myself.get("is_vip")?this.__myself.getEdgeCollection("vip_subscriptions").populated().then(function(t){for(var i=!1,n=0;n<t.models.length;n++){var a=t.models[n].node;a.get("date_stopped")||a.relations.buyer!==this.__myself.id||a.relations.recipient!==this.__myself.id||(i=!0)}if(i)return this.dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("already_have_vip_subscription_title"),html:e.AlreadyHaveVipDialog({}),ok:this.__stringManager.get("already_have_vip_subscription_button")}).finished.then(function(){this.__context&&this.__context.destroy()}.bind(this));this.__checkout()}.bind(this)):this.__checkout()}.bind(this))},__checkout:function(){var t=[];return _.each([this.__selectedCredit,this.__selectedVip],function(e){e.get("price")&&t.push({pid:e.get("pid"),sku:e.get("sku"),name:e.get("name"),original_price:e.get("original_price"),price:e.get("price"),type:e.get("type"),frequency_code:e.get("frequency_code"),image:e.get("image")})}),this.dialogManager.showDialog(e.PaymentDialog,{cart:t,channel:"next-inline",context:this.__context}).finished.then(function(){this.__context&&(this.__context.purchaseComplete=!0,this.__context.destroy())}.bind(this)).catch(function(){this.__context&&this.__context.includeBuyCredits&&this.__context.trigger("refresh_items",!0),this.$("button.buy-now").prop("disabled",!1)}.bind(this))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:oi,AlreadyHaveVipDialog:ri,FormatNumber:r,PaymentDialog:Di}),Ei=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<a class="back-button">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Back",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</a>"},useData:!0})}(),Ai=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;return'\n    <legend class="system-info-header">'+(0,this.escapeExpression)("function"==typeof(a=t.titleText||e&&e.titleText)?a.call(e,{name:"titleText",hash:{},data:n}):a)+"</legend>\n"},3:function(e,t,i,n){var a;i=t.helperMissing;var s='\n    <div class="vip-description">\n        <div class="crown-icon">\n            <svg class="image" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 80 80" class="color-gold" fill-rule="evenodd"><path d="M58 17.272a2.218 2.218 0 0 0-4.434 0c0 .594.234 1.128.612 1.524l-6.216 6.108a.422.422 0 0 1-.681-.129l-6.033-13.698a2.212 2.212 0 0 0 1.017-1.86 2.218 2.218 0 0 0-4.437 0c0 .78.405 1.464 1.017 1.86l-6.033 13.698a.422.422 0 0 1-.681.129l-6.267-6.156c.351-.393.57-.906.57-1.476a2.218 2.218 0 0 0-4.434 0 2.21 2.21 0 0 0 1.992 2.196c.351 2.916 1.941 16.161 1.98 16.212.549 1.272 6.633 2.274 14.076 2.274 7.44 0 13.524-1.002 14.073-2.274.039-.051 1.632-13.326 1.98-16.224A2.208 2.208 0 0 0 58 17.272M24.71 70.81h-3.836L10.633 46h4.786l7.426 18.933L30.235 46h4.68L24.71 70.81zm14.674-.177V46h4.329v24.633h-4.329zm20.13-7.917h-4.892v7.918h-4.328V46h9.712c5.772 0 9.36 3.272 9.36 8.305 0 5.525-4.433 8.41-9.852 8.41zm.14-12.774h-5.032v8.868h5.033c3.272 0 5.313-1.83 5.313-4.4v-.07c0-2.885-2.076-4.398-5.313-4.398z"/></svg>\n        </div>\n        <div class="title">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_title",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n        <div class="sentence">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_sentence",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</div>\n        ",((a=t.if.call(e,e&&e.showLearnLink,{name:"if",hash:{},fn:this.program(4,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+"\n    </div>\n"},4:function(e,t,i,n){var a;i=t.helperMissing;var s='\n            <div class="learn-link-outer">\n                <div class="learn-link-inner">\n                    ';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_learn_link",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"\n                </div>\n            </div>\n        "},6:function(e,t,i,n){var a;i=t.helperMissing;var s='\n    <legend class="system-info-header">\n        ';return((a=t.if.call(e,e&&e.isInCreditDialog,{name:"if",hash:{},fn:this.program(7,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+="\n        ",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"UPGRADES",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"\n    </legend>\n"},7:function(e,t,i,n){var a;i=t.helperMissing;var s="\n            ";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"RECOMMENDED",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i="",((a=t.if.call(e,e&&e.titleShow,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n",((a=t.if.call(e,e&&e.clubSubscriptionShow,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n",((a=t.unless.call(e,e&&e.titleShow,{name:"unless",hash:{},fn:this.program(6,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n"},useData:!0})}(),Ii=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;i=t.helperMissing;var s='\n    <div class="promo-banner sale">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"SALE",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'<div class="triangle"></div></div>\n'},3:function(e,t,i,n){var a;i=t.helperMissing;var s='\n    <div class="promo-banner most-popular">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"MOST POPULAR",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'<div class="triangle"></div></div>\n'},5:function(e,t,i,n){var a;i=t.helperMissing;var s='\n    <div class="promo-banner best-value">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BEST VALUE",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'<div class="triangle"></div></div>\n'},7:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r='\n    <div class="item-info">\n        <div class="image-container"><span class="helper"></span><img></div>\n    </div>\n    <div class="item-price">\n        <div class="subscription-title">'+i("function"==typeof(s=t.description||e&&e.description)?s.call(e,{name:"description",hash:{},data:n}):s)+'</div>\n        <div class="prices">\n            <div class="show-price">\n            ';return((a=t.if.call(e,e&&e.has_discount,{name:"if",hash:{},fn:this.program(8,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+="\n            $"+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+'\n            </div>\n            <div class="show-active">\n                ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"ACTIVE",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+"\n            </div>\n        </div>\n    </div>\n"},8:function(e,t,i,n){var a;return'\n                <span class="original-price">$'+(0,this.escapeExpression)("function"==typeof(a=t.original_price||e&&e.original_price)?a.call(e,{name:"original_price",hash:{},data:n}):a)+"</span>\n            "},10:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r='\n    <div class="item-info">\n        <div class="image-container"><img></div>\n        '+i("function"==typeof(s=t.itemLabels||e&&e.itemLabels)?s.call(e,{name:"itemLabels",hash:{},data:n}):s)+'\n        <div class="check-mark check-mark-hidden">\n            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25">\n                <path fill="#404040" fill-rule="evenodd" d="M11.082 15.579l-3.536-3.536-1.414 1.414 4.243 4.243.707.707 8.485-8.485-1.414-1.415-7.071 7.072zM12.5 22.5c-5.523 0-10-4.477-10-10s4.477-10 10-10 10 4.477 10 10-4.477 10-10 10z"/>\n            </svg>\n        </div>\n    </div>\n    <div class="item-price">\n        <div class="show-price">\n        ';return((a=t.if.call(e,e&&e.has_discount,{name:"if",hash:{},fn:this.program(11,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+="\n        $"+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+'\n        </div>\n        <div class="show-active">\n            ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"ACTIVE",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+"\n        </div>\n    </div>\n"},11:function(e,t,i,n){var a;return'\n            <span class="original-price">$'+(0,this.escapeExpression)("function"==typeof(a=t.original_price||e&&e.original_price)?a.call(e,{name:"original_price",hash:{},data:n}):a)+"</span>\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i='<div class="wrapper">  \n\n',((a=t.if.call(e,e&&e.is_sale,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n",((a=t.if.call(e,e&&e.is_popular,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n",((a=t.if.call(e,e&&e.is_best,{name:"if",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n",((a=t.if.call(e,e&&e.showRows,{name:"if",hash:{},fn:this.program(7,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n",((a=t.unless.call(e,e&&e.showRows,{name:"unless",hash:{},fn:this.program(10,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n</div>\n"},useData:!0})}(),Ni=function(e){var t=e.UiCore.UiContext;return t.extend("BuyUpgradeListItem",{uiContextName:"buy_upgrade_list_item",tagName:"article",className:"buy-upgrade-list-item",dependencies:"globalStringManager imageManager loginManager model googleAnalytics window".split(" "),trackedEvents:function(){return[{type:"click",name:"choose_upgrade_item",handler:"__onClickItem"}]},initialize:function(e){this.__width=void 0===e.width?"":e.width,""!==this.__width&&(this.__width="width-"+this.__width),this.__selectedVip=IMVU.requireProperty(e,"selectedVip"),this.__style=IMVU.optionalProperty(e,"style",""),this.__model=e.model,this.__globalStringManager=e.globalStringManager,this.__imageManager=e.imageManager,this.__isInStore=IMVU.optionalProperty(e,"isInStore",!1),this.__context=IMVU.optionalProperty(e,"context",null),this.__isResponsive=IMVU.optionalProperty(e,"isResponsive",!1),t.prototype.initialize.call(this,e),this.__itemLabels=void 0===e.itemLabels?"SUBSCRIPTION":e.itemLabels,this.__itemLabels=this.__globalStringManager.get(this.__itemLabels),this.__scheme=void 0===e.scheme?"":e.scheme,this.__width=void 0===e.width?"":e.width,this.__platform=this.__serviceProvider.get("platform"),this.__myself=this.__loginManager.getCurrentUser(),this.__isActive=!1,this.$el.toggleClass("is-responsive-tile-list-item",this.__isResponsive),this.addToDOM()},render:function(){t.prototype.render.call(this),this.__myself.populated().then(function(){return this.__model.populated()}.bind(this)).then(function(){this.__hasDiscount=this.__model.get("original_price")>this.__model.get("independent_purchase_price");var t=!1;switch("in-dialog"!==this.__style||"mobile"!==this.__platform||this.__isResponsive||(t=!0,this.__scheme="rows"),this.$el.html(e.template({has_discount:this.__hasDiscount,original_price:this.__model.get("original_price").toFixed(2),price:this.__model.get("independent_purchase_price").toFixed(2),is_sale:this.__hasDiscount,is_best:!this.__hasDiscount&&this.__model.get("best"),is_popular:!this.__hasDiscount&&!this.__model.get("best")&&this.__model.get("popular"),showRows:t,description:this.__globalStringManager.get("vip_sbuscription_freq_"+this.__model.get("frequency_code")),itemLabels:this.__itemLabels})),this.__imageManager.load(this.$(".image-container > img"),this.__getImageSrc(this.__model.get("image"))),(this.__hasDiscount||this.__model.get("best")||this.__model.get("popular"))&&this.$el.addClass("has-promo"),this.__myself.get("is_vip")&&this.$el.addClass("clickblocked"),this.__setChecked(!1),"width140"!==this.__width||this.__isResponsive||(this.$el.addClass("width140"),this.$el.addClass("height180"),this.$(".item-info").addClass("width140"),this.$(".item-info").addClass("height140")),this.__modelFrequency="",this.__model.get("frequency_code")){case this.constructor.VIP_MONTHLY:this.__modelFrequency="monthly";break;case this.constructor.VIP_QUARTERLY:this.__modelFrequency="quarterly";break;case this.constructor.VIP_YEARLY:this.__modelFrequency="yearly"}this.__checkForActiveSubscription(),this.listenTo(this.__myself,"change:vip_expires",this.__checkForActiveSubscription)}.bind(this))},__checkForActiveSubscription:function(){this.__myself.get("is_vip")?(this.__vipSubscriptions||(this.__vipSubscriptions=this.__myself.getEdgeCollection("vip_subscriptions")),this.__vipSubscriptions.populated().then(function(e){this.__vipNode=null,this.__isActive=!1,this.__subscriptionFrequency="";for(var t=0;t<e.models.length;t++){var i=e.models[t].node;i.get("date_stopped")||i.relations.buyer!==this.__myself.id||i.relations.recipient!==this.__myself.id||i.get("frequency")!==this.__modelFrequency||(this.__vipNode=i,this.__isActive=!0)}this.$el.toggleClass("active",this.__isActive),this.$el.removeClass("clickblocked"),this.__vipNode&&this.listenTo(this.__vipNode,"change:date_stopped",this.__subscriptionCancelled)}.bind(this))):(this.$el.removeClass("active"),this.$el.removeClass("clickblocked"))},__subscriptionCancelled:function(){this.stopListening(this.__vipNode),this.__vipNode=null,this.__isActive=!1,this.$el.removeClass("active"),this.$el.removeClass("clickblocked")},__getImageSrc:function(e){return"/common/withme/img/store/"+e},__setChecked:function(e){if(this.$el.toggleClass("selected-item",e),"white_charcoal"===this.__scheme){this.$el.siblings().find(".check-mark").addClass("check-mark-hidden"),this.$el.siblings().removeClass("selected-item"),this.$el.siblings().find(".item-price").removeClass("item-price-charcoal"),this.$el.siblings().find(".item-price").addClass("item-price-white");var t=this.$(".item-price");!0===e?(this.$(".check-mark").removeClass("check-mark-hidden"),t.hasClass("item-price-white")&&t.removeClass("item-price-white"),t.addClass("item-price-charcoal")):(this.$(".check-mark").addClass("check-mark-hidden"),t.hasClass("item-price-charcoal")&&t.removeClass("item-price-charcoal"),t.addClass("item-price-white"))}},__onClickItem:function(){this.__isActive||this.$el.hasClass("clickblocked")||"vip"!==this.__model.get("type")||(this.__isInStore?(this.__selectedVip.set({name:this.__model.get("title"),price:this.__model.get("independent_purchase_price"),original_price:this.__model.get("original_price"),sku:this.__model.get("sku"),pid:this.__model.get("pid"),frequency_code:this.__model.get("frequency_code"),type:this.__model.get("type"),image:this.__model.get("image")}),this.__googleAnalytics.recordDollarStore("view",this.__model.get("sku")),this.__selectedVip.trigger("click")):(this.$el.toggleClass("selected-item"),this.$el.hasClass("selected-item")?(this.__setChecked(!0),e.NextUtil.DomHelper.radioClass(this.$el,"selected-item"),this.__selectedVip.set({name:this.__model.get("title"),price:this.__model.get("independent_purchase_price"),original_price:this.__model.get("original_price"),sku:this.__model.get("sku"),pid:this.__model.get("pid"),frequency_code:this.__model.get("frequency_code"),type:this.__model.get("type"),image:this.__model.get("image")}),this.__context&&this.__context.trigger("add_vip_item",!0)):(this.__setChecked(!1),this.__selectedVip.set({price:0}),this.__context&&this.__context.trigger("add_vip_item",!1))))}},{VIP_MONTHLY:2,VIP_QUARTERLY:4,VIP_YEARLY:5})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:Ii}),Fi=function(e){var t=e.UiCore.ListPresenter;return t.extend("BuyUpgradeList",{uiContextName:"buy_upgrade_list",className:"buy-upgrade-list",tagName:"section",dependencies:["featureAccessManager","globalStringManager","modeManager"],trackedEvents:function(){return[{type:"click",selector:".learn-link-inner",name:"vip_description_learn_link",handler:"__onClickLearnLink"}]},itemFactory:e.BuyUpgradeListItem,initialize:function(i){t.prototype.initialize.call(this,i),this.__width=void 0===i.width?"":i.width,this.__style=IMVU.optionalProperty(i,"style",""),this.__isResponsive=IMVU.optionalProperty(i,"isResponsive",!1),this.__titleShow=-1===["in-dialog","in-credit-dialog"].indexOf(this.__style)||void 0!==i.titleText,this.__titleText=void 0===i.titleText?"UPGRADE TO VIP":i.titleText,this.__titleText=this.__globalStringManager.get(this.__titleText),this.__clubSubscriptionShow=(-1===["in-dialog","in-credit-dialog"].indexOf(this.__style)||!0===i.clubSubscriptionShow)&&!1!==i.clubSubscriptionShow,this.__showLearnLink=this.__featureAccessManager.canSeeVipUpsell(),this.__scheme=void 0===i.scheme?"":i.scheme,this.__bottomPadding=!0===i.bottomPadding,this.$el.toggleClass("is-responsive-tile-list",this.__isResponsive),this.$el.toggleClass("two-columns",400>this.$el.width()),this.$el.prepend(e.template({width:this.__width,titleShow:this.__titleShow,titleText:this.__titleText,clubSubscriptionShow:this.__clubSubscriptionShow,showLearnLink:this.__showLearnLink,itemLabels:i.itemLabels,isInCreditDialog:"in-credit-dialog"===this.__style,scheme:this.__scheme})),this.__bottomPadding&&this.$el.addClass("bottom-padding")},__onClickLearnLink:function(e){this.__modeManager.openMode({mode:{id:"store"},submode:{id:"vip"}})}})}({UiCore:e["@UiCore"],BuyUpgradeListItem:Ni,template:Ai}),Hi=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("BuyUpgradeDialog",{uiContextName:"buyupgrade_dialog",className:"buyupgrade-dialog dialog-type-B",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager Promise restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-upgrade-now",name:"buy_upgrade",handler:this.__buyUpgradeNow},{type:"click",selector:".back-button",name:"go_back",handler:this.__goBack}]},initialize:function(i){t.prototype.initialize.call(this,i),this.purchaseComplete=!1,this.Promise=i.Promise,this.serviceProvider=i.serviceProvider,this.dialogManager=i.dialogManager,this.__stringManager=i.globalStringManager,this.restModelFactory=i.restModelFactory,this.__platform=this.__serviceProvider.get("platform"),this.__formatNumber=e.FormatNumber,this.__storeCatalogUrl=i.globalStartupModel.get("storeCatalogUrl"),this.__storeCatalog=this.restModelFactory.readModel(this.__storeCatalogUrl,e.UiCore.NodeModel),this.title=this.__stringManager.get("buyupgrade_title"),this.__selectedProduct=new IMVU.NamedModel,this.addToDOM()},destroy:function(){this.promiseResolver&&this.promiseResolver.resolve(this.purchaseComplete),this.hide(),this.delete()},postRender:function(){this.setContent("body",e.template),this.createChildContext(e.CheckoutButton,{$parentElement:this.$(".dialog-footer"),selectedVip:this.__selectedProduct,globalStringManager:this.__stringManager,context:this}),this.__storeCatalog.populated().then(function(e){return e.getEdgeCollection("items").populated()}.bind(this)).then(function(t){var i=new IMVU.NamedCollection;_.each(t.models,function(e){"vip"===(e=e.edge).get("type")&&i.add(e)}.bind(this)),("mobile"!==this.__platform||this.__featureAccessManager.canSeeResponsiveList())&&this.$(".dialog-body").addClass("list-like-submode"),this.createChildContext(e.BuyUpgradeList,{$parentElement:this.$(".products"),collection:i,selectedVip:this.__selectedProduct,clubSubscriptionShow:!0,itemLabels:"MEMBERSHIP",scheme:"white_charcoal",width:"width140",style:"in-dialog",isResponsive:!!this.__featureAccessManager.canSeeResponsiveList()}),this.$(".upgrade-products").scrollbar()}.bind(this))},__goBack:function(){this.destroy()}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],Model:e["@Model"],template:si,backButtonTemplate:Ei,FormatNumber:r,BuyUpgradeList:Fi,CheckoutButton:Li}),Ri=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="error-title">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"profile_look_load_error_title",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n<div class="error-text">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"profile_look_load_error_text",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n<div class="error-button">\n    <button class="btn btn-ghost-light btn-xsmall">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"reload",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>\n</div>"},useData:!0})}(),Bi=function(e){var t=e.UiCore.UiContext;return t.extend("ProfileLookError",{className:"profile-look-error",uiContextName:"profile_look_error",trackedEvents:function(){return[{type:"click",selector:"button.reload",name:"reload_profile_look",handler:"__reloadLook"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template)},__reloadLook:function(){}})}({UiCore:e["@UiCore"],template:Ri}),Oi=function(e){var t=e.UiCore.UiContext;return t.extend("ProfileLook",{className:"profile-look",uiContextName:"profile_look",dependencies:["dialogManager","loginManager","user"],trackedEvents:function(){return[{type:"click",selector:"button.vip",name:"button_vip",handler:"__openVIPDialog"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__isColumnView=IMVU.optionalProperty(e,"isColumnView",!1),this.shown={age:!0,gender:!0,ap:!0,av:!0,staff:!0,vip:!0},(this.__isLoggedIn=this.__loginManager.isLoggedIn())&&(this.__myself=this.__loginManager.getCurrentUser()),this.__imageFactory=e.imageFactory,this.addToDOM(),this.$el.toggleClass("column-view",this.__isColumnView)},render:function(){if(this.$el.html(e.template),this.__showError(),this.__isLoggedIn){var t=[];_.each({staff:this.__user.get("is_staff")&&this.shown.staff,ap:this.__user.get("is_ap")&&this.shown.ap,vip:this.__user.get("is_vip")&&this.shown.vip,"age-verified":this.__user.get("is_ageverified")&&this.shown.av,married:void 0!==this.__user.relations.spouse},function(e,i){e&&t.push(i)}),this.setShields(t),_.has(this,"__myself")&&!this.__myself.get("is_vip")&&this.$(".shields button.vip").prop("disabled",!1)}},setShields:function(e){var t=this.$(".shields").empty();_.each(e,function(e){e=$('<button class="btn '+e+'" disabled></button>'),t.append(e)}.bind(this))},__openVIPDialog:function(){return this.__dialogManager.showDialog(e.BuyUpgradeDialog,{})},__showError:function(){this.__error=this.createChildContext(e.ProfileLookError,{$parentElement:this.$(".avatar-container")}),this.listenTo(this.__error,"reload",this.__reload)},__addAvatar:function(){this.__avatarWidget=this.createChildContext(e.Avatar,{$parentElement:this.$(".avatar-container"),model:this.__dressUpAvatarManager.getLookModel(),imageFactory:this.__imageFactory,showLoadingProgress:!0,sceneContext:"shop_clothing"})},__reload:function(){}})}({UiCore:e["@UiCore"],BuyUpgradeDialog:Hi,Avatar:L,DressUpAvatarManager:O,ProfileLookError:Bi,template:ai}),zi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<a href="#" class="header-button edit-profile">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Edit",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</a>"},useData:!0})}(),Wi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="profile-posts-container"></div>'},useData:!0})}(),Vi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<img src='/common/withme/img/post.png'/>\n<button class=\"btn btn-ghost btn-dark btn-small\">";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Post Now",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>"},useData:!0})}(),qi=function(e){var t=e.UiCore.UiContext;return t.extend("ProfileFeedPostNow",{className:"profile-feed-post-now",uiContextName:"profile_feed_post_now",dependencies:["dialogManager","globalStringManager","modeManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"post_now",handler:"__openPhotoBooth"}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__dressUpAvatarManager=i.dressUpAvatarManager||i.serviceProvider.create(e.DressUpAvatarManager,{persistLooks:!1}),this.addToDOM()},render:function(){this.$el.html(e.template({}))},__openPhotoBooth:function(){this.__dressUpAvatarManager.populated().then(function(){this.__dressUpAvatarManager.containsAPProduct()?this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_photobooth_ap_error_title"),text:this.__globalStringManager.get("dialog_photobooth_ap_error_text"),ok:this.__globalStringManager.get("dialog_photobooth_ap_error_button")}):this.__dialogManager.showDialog(e.PhotoBoothDialog)}.bind(this))}})}({UiCore:e["@UiCore"],DressUpAvatarManager:O,PhotoBoothDialog:Le,template:Vi}),Gi=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;return i='\n<div class="feed-item-container">\n    <div class="dummy"></div>\n    <div class="feed-item-photo">\n        <img class="cover-image"/>\n    </div>\n</div>\n',((a=t.if.call(e,e&&e.canSeeFeedCaptions,{name:"if",hash:{},fn:this.program(2,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n"},2:function(){return'\n    <div class="caption hidden" />\n'},4:function(e,t,i,n){var a;i=t.helperMissing;var s=this.escapeExpression,o='\n<div class="feed-item-container">\n    <div class="dummy"></div>\n    <div class="feed-item-text" ';return((a=t.if.call(e,e&&e.background_color,{name:"if",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+">\n        <div class='message'></div>\n        <div class=\"more-indicator\">"+s((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"See more",{name:"i18n-g",hash:{},data:n}))+"</div>\n    </div>\n</div>\n"},5:function(e,t,i,n){var a;return'style="background-color: #'+(0,this.escapeExpression)("function"==typeof(a=t.background_color||e&&e.background_color)?a.call(e,{name:"background_color",hash:{},data:n}):a)+'"'},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s=this.escapeExpression,o='<header class="feed-item-header-placeholder"></header>\n';return((a=t.if.call(e,e&&e.is_photo,{name:"if",hash:{},fn:this.program(1,n),inverse:this.program(4,n),data:n}))||0===a)&&(o+=a),o+'\n<footer class="feed-item-footer">\n    <ul class="action-bar-placeholder"></ul>\n    <ul class="extension-bar bar">\n        <li class="count-comments-container">\n            <span class="count-comments"></span>\n            <span class="comments-labels">\n                <span class="comments-text-singular">'+s((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Comment",{name:"i18n-g",hash:{},data:n}))+'</span>\n                <span class="comments-text-plural">'+s((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Comments",{name:"i18n-g",hash:{},data:n}))+'</span>\n            </span>\n        </li>\n        <li class="count-likes-container">\n            <span class="count-likes"></span>\n            <span class="likes-labels">\n                <span class="likes-text-singular">'+s((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Like",{name:"i18n-g",hash:{},data:n}))+'</span>\n                <span class="likes-text-plural">'+s((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Likes",{name:"i18n-g",hash:{},data:n}))+"</span>\n            </span>\n        </li>\n    </ul>\n</footer>\n"},useData:!0})}(),ji=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="bar">\n    <div class="name-widget-goes-here"></div>\n</div>'},useData:!0})}(),Ki=function(e){var t=function(){return function(e){var t,i=+this;t=!e;var n=this.lang(),a=Math.round(Math.abs(i)/1e3),s=Math.round(a/60),o=Math.round(s/60),r=Math.round(o/24),l=Math.round(r/365);return(a=45>a&&["s",a]||1===s&&["m"]||45>s&&["mm",s]||1===o&&["h"]||22>o&&["hh",o]||1===r&&["d"]||345>=r&&["dd",r]||1===l&&["y"]||["yy",l])[2]=t,a[3]=0<i,a[4]=n,t=function(e,t,i,n,a){return a.relativeTime(t||1,!!i,e,n)}.apply({},a),e&&(t=this.lang().pastFuture(i,t)),t}}();return e.moment.lang("IOSRelativeTime",{relativeTime:{future:"in %s",past:"%s ago",s:"Just now",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:function(e){return 7>e?e+"d":Math.floor(e/7)+"w"},y:"1y",yy:"%dy"}}),e.moment.lang("en"),function(i){var n=e.moment.apply(this,Array.prototype.slice.call(arguments,1));return n.lang("IOSRelativeTime"),n.from=function(n,a){var s=t.call(e.moment.duration(this.diff(n)).lang(this.lang()._abbr),!a);return i.get("globalStringManager").getWithDefault(s,s)},n}}({moment:e["@moment"]}),Yi=function(e){var t=e.UiCore.UiContext;return t.extend("FeedItemHeader",{uiContextName:"feed_item_header",tagName:"header",className:"feed-item-header",dependencies:["featureAccessManager","timer"],initialize:function(e){t.prototype.initialize.call(this,e),this.__timer=e.timer,this.__featureAccessManager=e.featureAccessManager,this.__model=e.model,this.__ignoreUserClicks=!!e.ignoreUserClicks,this.__feedType=e.feedType,this.__viewType=e.viewType,this.addToDOM()},setUseCase:function(e){if(void 0!==e){if(this.__useCase=e,this.__dualName)switch(this.__useCase){case"FeedToggleToGrid":this.__dualName.setConfiguration("small-single-split-darkbg"),this.__dualName.drawIt();break;case"FeedToggleToColumn":this.__dualName.setConfiguration("small-single-lightbg"),this.__dualName.drawIt()}}else if(this.__useCase="FeedItemCard","grid"===this.__viewType)this.__useCase="FeedItemGrid";else switch(this.__feedType){case"subscribed_feed":case"recommended_feed":case"adult_feed":case"teen_feed":this.__useCase="FeedItemColumn";break;case"user_profile_card":this.__useCase="FeedItemUserProfile";break;default:"feed_detail_widget"!==this.__parentUiContext.uiContextName&&(this.__useCase="FeedItemUserProfile")}},shouldShowCaption:function(){return this.__useCase.match(/column$/i)||"FeedItemUserProfile"===this.__useCase},render:function(){this.model.populated().then(function(){this.$el.html(e.template),this.createChildContext(e.FeedItemTimestamp,{$parentElement:this.$(".bar"),timestamp:this.model.get("time")}),this.actor=this.model.getSingleEdge("actor"),this.actor.populated().then(function(){switch(this.setUseCase(),this.__useCase){case"FeedItemGrid":this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".name-widget-goes-here"),user:this.actor,configuration:"small-single-split-darkbg",ignoreClicks:this.__ignoreUserClicks});break;case"FeedItemColumn":this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".name-widget-goes-here"),user:this.actor,configuration:"small-single-lightbg",ignoreClicks:this.__ignoreUserClicks});break;case"FeedItemCard":this.__dualName=this.createChildContext(e.Widgets.DualName,{$parentElement:this.$(".name-widget-goes-here"),user:this.actor,configuration:"small-single-darkbg",ignoreClicks:this.__ignoreUserClicks});break;case"FeedItemUserProfile":this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".name-widget-goes-here"),user:this.actor,configuration:"small-single-lightbg",ignoreClicks:this.__ignoreUserClicks})}}.bind(this))}.bind(this))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],FeedItemTimestamp:ti,IOSRelativeTime:Ki,template:ji}),Xi=function(e){var t=e.UiCore.UiContext;return t.extend("FeedItem",{uiContextName:"feed_list_item",tagName:"article",className:"feed-item",dependencies:"contextMenuManager dialogManager featureAccessManager globalStartupModel globalStringManager googleAnalytics imageManager loginManager modeManager platform restModelFactory timer".split(" "),trackedEvents:function(){return[e.NextUtil.DomHelper.trackClickOrDouble({selector:".feed-item-container",clickName:"feed_item_click",doubleclickName:"feed_item_like",clickHandler:this.__triggerDetails.bind(this,!1),doubleclickHandler:this.__like}),{type:"click",selector:".count-comments, .comments-text-singular, .comments-text-plural",name:"feed_item_click",handler:this.__triggerDetails.bind(this,!1)},{type:"click",selector:".count-likes, .likes-text-singular, .likes-text-plural",name:"show_like_list",handler:this.__showLikeList}]},setViewType:function(e){this.__viewType=e},initialize:function(e){this.__featureAccessManager=e.featureAccessManager,this.uiAttributes={repeats:1},t.prototype.initialize.call(this,e),this.__imageManager=e.imageManager,this.__loginManager=e.loginManager,this.__modeManager=e.modeManager,this.__googleAnalytics=e.googleAnalytics,this.__dialogManager=e.dialogManager,this.__ignoreUserClicks=!!e.ignoreUserClicks,this.__feedType=e.feedType,this.__platform=e.platform,this.__timer=e.timer,this.__reportUrl=this.__globalStartupModel.get("safetyReportUrl"),this.__showHeader=IMVU.optionalProperty(e,"showHeader",!0),this.setViewType(e.viewType),this.addToDOM(),this.model.on("change",this.__onModelChange,this),this.on("shown",this.updateTextTruncation.bind(this))},delete:function(){t.prototype.delete.call(this),this.model.off(void 0,void 0,this),this.likedby&&this.likedby.off(void 0,void 0,this),this.commentsSummary&&this.commentsSummary.off(void 0,void 0,this)},updateTextTruncation:function(){"photo"!==this.model.node.get("type")&&e.NextUtil.DomHelper.truncateMultilineText(this.$(".message"),this.$(".more-indicator"))},setUseCase:function(e){void 0!==this.feedItemHeader&&(this.__featureAccessManager.canSeeFeedCaptions()&&this.$(".caption")[0]&&this.$(".caption").addClass("hidden"),this.feedItemHeader.setUseCase(e),this.__featureAccessManager.canSeeFeedCaptions()&&this.$(".caption")[0]&&this.$(".caption").toggleClass("hidden",!this.feedItemHeader.shouldShowCaption()))},render:function(){this.model.sorted()||this.$el.addClass("sorting"),this.model.populated().then(function(){this.actor=this.model.node.getSingleEdge("actor"),this.$el.removeClass("sorting");var t=(n=this.model.node).get("payload.message")||"",i="photo"===n.get("type"),n={id:n.id,img_src:n.get("payload.thumbnail_url"),is_photo:i,background_color:n.get("payload.background_color"),time:this.__serviceProvider.get("timestampHelper").formatSingleUnit(n.get("time")),canSeeFeedCaptions:this.__featureAccessManager.canSeeFeedCaptions()};this.$el.html(e.template(n)),this.$el.attr("data-item",n.id),this.__showHeader&&(this.feedItemHeader=this.createChildContext(e.FeedItemHeader,{model:this.model.node,$replaceElement:this.$(".feed-item-header-placeholder"),ignoreUserClicks:this.__ignoreUserClicks,feedType:this.__feedType,viewType:this.__viewType,isList:this.__isList}));var a=this.createChildContext(e.FeedActionBar,{model:this.model.node,$replaceElement:this.$(".action-bar-placeholder"),feedType:this.__feedType,imageManager:this.__imageManager,isAbbreviated:!0});a.on("action-tags",this.__showProducts.bind(this)),a.on("action-tag-count",this.__showProducts.bind(this)),a.on("action-comments",this.__triggerDetails.bind(this,!0)),a.on("action-comment-count",this.__triggerDetails.bind(this,!0)),a.on("action-like-count",this.__showLikeList.bind(this)),a.on("item-reported",this.__onItemReported.bind(this)),i||(this.__userText=this.createChildContext(e.UserText,{$parentElement:this.$(".feed-item-text .message"),text:t})),n.is_photo?(i=this.$(".feed-item-photo > img"),this.__imageManager.load(i,n.img_src,{}).then(function(){}.bind(this)).catch(function(){}.bind(this)),this.__featureAccessManager.canSeeFeedCaptions()&&(this.__caption=this.createChildContext(e.ExpandingText,{$parentElement:this.$(".caption"),textValue:t}),this.listenTo(this.__caption,"helip",this.__toggleCaption.bind(this)),this.feedItemHeader&&(this.feedItemHeader.setUseCase(),this.$(".caption").toggleClass("hidden",!this.feedItemHeader.shouldShowCaption())))):this.updateTextTruncation(),this.__onModelChange()}.bind(this))},__onItemReported:function(){this.$el.hide()},__onModelChange:function(){this.commentsSummary&&this.commentsSummary.off(void 0,void 0,this),this.commentsSummary=this.model.node.getSummaryCollection("comments"),this.commentsSummary.on("update add remove reset",this.__onCommentsCollectionChange,this),this.__onCommentsCollectionChange(),this.likedby&&this.likedby.off(void 0,void 0,this),this.likedby=this.model.node.searchEdgeCollection("liked_by",{limit:0},e.UiCore.EdgeCollection),this.likedby.on("update add remove reset",this.__onLikeCollectionChange,this),this.__onLikeCollectionChange(),this.__caption&&"photo"===this.model.node.get("type")&&this.__caption.changeText(this.model.node.get("payload.message"))},__refreshExtensionBar:function(){var e=!!(this.likedby&&0+this.likedby.total_count),t=!!(this.commentsSummary&&0+this.commentsSummary.total_count);1==this.commentsSummary.total_count?(this.$(".comments-text-singular").show(),this.$(".comments-text-plural").hide()):(this.$(".comments-text-singular").hide(),this.$(".comments-text-plural").show()),e?1==0+this.likedby.total_count?(this.$(".likes-text-singular").show(),this.$(".likes-text-plural").hide()):(this.$(".likes-text-singular").hide(),this.$(".likes-text-plural").show()):this.$(".likes-text-singular").hide(),this.$(".extension-bar").toggleClass("has-likes-or-comments",e||t)},__onCommentsCollectionChange:function(){this.$(".count-comments").text(e.FormatNumber.formatMini(this.commentsSummary.total_count)),this.__refreshExtensionBar()},__onLikeCollectionChange:function(){this.$(".count-likes").text(e.FormatNumber.formatMini(this.likedby.total_count)),this.likedby.populated().then(this.__refreshExtensionBar.bind(this))},__showLightbox:function(e){this.__dialogManager.showLightbox("FeedLightbox",_.extend({model:this.model.node,feedType:this.__feedType},e||{}))},__triggerDetails:function(e){this.__showLightbox({focusComments:!!e})},__showProducts:function(){this.__showLightbox({tab:"tags"})},__showLikeList:function(){this.__showLightbox({tab:"likes"})},__like:function(){this.model.node.like(),e.NextUtil.DomHelper.applyTemporaryClass(this.__timer,this.$(".feed-item-container"),"liking",1e3)},__toggleCaption:function(){this.$(".caption").toggleClass("open")}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],ContextMenu:A,ExpandingText:Qt,FeedActionBar:Ee,FeedItemHeader:Yi,FormatNumber:r,UserText:q,template:Gi}),Ji=function(e){var t=e.Widgets.AdsListPresenter;return t.extend("Feed",{uiContextName:"feed_list",className:"feed",tagName:"section",dependencies:["globalStringManager","Promise"],triggerNextPage:3,initialize:function(i){this.itemFactory=i.itemFactory||e.FeedItem,i.firstAdPositionInColumnView=8,i.showAdEveryNItemsInColumnView=7,i.firstAdAfterNRow=3,i.showAdAfterEveryNRowsInGridView=3,t.prototype.initialize.call(this,i)},onAdd:function(e){t.prototype.onAdd.apply(this,arguments),this.__setUseCase()},refresh:function(){this.collection.invalidate(),this.collection.reset()},onReset:function(e,i){var n=this.collection.length,a=function(){0===--n&&(t.prototype.onReset.call(this,e,i),this.__onScroll())}.bind(this);_.each(this.collection.models,function(e){e.populated().then(a,a)})},onInitError:function(){t.prototype.onInitError.call(this),this.trigger("initError")},onPageError:function(e){window.console.log("Feed Error:",e),t.prototype.onPageError.call(this,e),this.trigger("pageError")},setViewType:function(e){this.__viewType=e},__setUseCase:function(){void 0!==this.__viewType&&_.each(this.__childContexts,function(e){switch(this.__viewType){case"grid":e.setUseCase("FeedToggleToGrid");break;case"column":e.setUseCase("FeedToggleToColumn")}}.bind(this))},refreshSize:function(e){this.__maybePage(),this.setViewType(e),_.each(this.__childContexts,function(e){e.updateTextTruncation()}),this.__setUseCase(),e&&this.__rearrangeAdSlots(this.__viewType)},__emptyText:function(){return{standard:this.__globalStringManager.get("No posts"),concise:this.__globalStringManager.get("No posts")}},__refreshPage:function(){this.$(".collection-error").remove(),this.__noVisibilityChecks=!1,this.refresh()}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],FeedItem:Xi}),Zi=function(e){var t=e.Feed;return t.extend("ProfileFeedListPresenter",{uiContextName:"profile_feed_list_presenter",className:"profile-feed",initialize:function(e){this.__isMyself=IMVU.optionalProperty(e,"isMyself",!1),t.prototype.initialize.call(this,e)},__updateEmpty:function(){this.__isMyself?0!==this.collection.models.length||this.__$empty?this.collection.models.length&&this.__$empty&&(this.__$empty.remove(),this.__$empty=null):(this.__postNow=this.createChildContext(e.ProfileFeedPostNow,{$parentElement:this.$el,dressUpAvatarManager:this.__dressUpAvatarManager}),this.__$empty=this.__postNow.$el):t.prototype.__updateEmpty.call(this)}})}({UiCore:e["@UiCore"],Feed:Ji,ProfileFeedPostNow:qi}),Qi=function(e){var t=e.UiCore.UiContext;return t.extend("ProfilePosts",{className:"profile-posts",uiContextName:"profile_posts",dependencies:["loginManager","user"],trackedEvents:function(){return[]},initialize:function(i){t.prototype.initialize.call(this,i),this.__feedItemFactory=i.feedItemFactory||e.FeedItem,(this.__isLoggedIn=!!this.__loginManager.isLoggedIn())&&(this.__isMyself=!1,this.__isLoggedIn&&(this.__myself=this.__loginManager.getCurrentUser(),this.__user.id===this.__myself.id&&(this.__isMyself=!0)),this.addToDOM())},render:function(){this.$el.html(e.template({})),this.__initializeFeed()},__initializeFeed:function(){this.__feedInitialized||(this.$el.addClass("loading-feed"),this.$(".profile-posts-container").on("scroll.initializeFeed",this.__maybeShowFeed.bind(this)),this.__maybeShowFeed(),this.__feedInitialized=!0)},__showFeed:function(){var t=this.__user.getSingleEdge("personal_feed");t.populated().then(function(){this.$el.removeClass("loading-feed"),this.__feed=this.createChildContext(e.Feed,{$parentElement:this.$(".profile-posts-container"),collection:this.track(t.getEdgeCollection("elements",e.Model.FeedCollection)),scroller:this.$(".profile-posts-container"),itemFactory:this.__feedItemFactory,ignoreUserClicks:!0,feedType:"user_profile_card",userProfileCard:!0,showAds:!1,showHeader:!1,isMyself:this.__isMyself})}.bind(this))},__maybeShowFeed:function(){if(0<this.$(".profile-posts-container").children().length){var e=this.$(".profile-posts-container").children().last(),t=this.$el.offset().top+this.$el.height();e.offset().top+e.height()<=t&&(this.$(".profile-posts-container").off("scroll.initializeFeed"),this.__showFeed())}else this.__showFeed()}})}({UiCore:e["@UiCore"],Model:e["@Model"],Feed:Zi,FeedItem:Xi,template:Wi}),en=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<a href="#" class="header-button save-profile">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Save",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</a>"},useData:!0})}(),tn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='\n<div class=\'profile\'>\n    <fieldset>\n        <div class="change-profile background-container">\n            <div class="profile-icon-placeholder"></div>\n            <form class="customProfileImage">\n                <label class="change-profile-image" for="custom-profile-image">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"change profile image",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</label>\n                <input class="change-profile-image-input" type="file" accept="image/*" name="custom-profile-image" id="custom-profile-image" />\n            </form>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'edit-profile-header\'>',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"name",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</legend>\n        <div class=\'edit-profile-attribute displayName\'>\n            <textarea id="display_name" type="text" class="value" placeholder="',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"display name",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+="\"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"age",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</legend>\n        <div class="edit-profile-attribute background-container show-label">\n            <input id=\'profile-checkbox-show-age\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_age" data-pref-default=1>\n            <label id="display-age-toggle" for=\'profile-checkbox-show-age\'>\n                <div>\n                    ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"show age",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+="<br>\n                    <span class='description'>"+o("function"==typeof(s=t.age_description||e&&e.age_description)?s.call(e,{name:"age_description",hash:{},data:n}):s)+' <a class="help-center" href="https://help.imvu.com" target="_blank">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"help center",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+=".</a></span>\n                </div>\n            </label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"gender",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+="</legend>\n        <div class='edit-profile-attribute gender show-label background-container'>\n            <input id='profile-checkbox-show-gender' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_gender\" data-pref-default=1><label for='profile-checkbox-show-gender'>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"show gender",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</label>\n        </div>\n        <div class="separator"/>\n        <div class=\'edit-profile-attribute gender\'>\n            <select id="gender" class="value"></select>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'edit-profile-header\'>',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"location",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+="</legend>\n        <div class='edit-profile-attribute geo-location show-label background-container'>\n            <input id='profile-checkbox-show-geo-location' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_geo_location\" data-pref-default=1><label for='profile-checkbox-show-geo-location'>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"show location",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</label>\n        </div>\n        <div class="separator"/>\n        <div class=\'edit-profile-attribute location background-container\' id="location"></div>\n        <div class=\'location-container hidden\'>\n            <div class=\'edit-profile-attribute country\'>\n                <select id="country" class="value"></select>\n            </div>\n             <div class="separator"/>\n            <div class=\'edit-profile-attribute state not-applicable\'>\n                <select id="state" class="value"></select>\n            </div>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'edit-profile-header\'>',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"bio",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</legend>\n        <div class=\'edit-profile-attribute tagline\'>\n            <textarea id="tagline" type="text" class="value" placeholder="',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"profile_bio",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+="\"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"interests",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</legend>\n        <div class=\'edit-profile-attribute interests\'>\n            <textarea id="interests" class="value" placeholder="',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"profile_interests",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+="\"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class='edit-profile-header'>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"affinity",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+="</legend>\n        <div class='edit-profile-attribute relationship_status affinity'>\n            <span class=\"descriptor\">",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"relationship",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+=':</span>\n            <select id="relationship_status" class="value"></select>\n        </div>\n        <div class="separator"/>\n        <div class=\'edit-profile-attribute looking_for affinity\'>\n            <span class="descriptor">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"here for",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+':</span>\n            <select id="looking_for" class="value"></select>\n        </div>\n    </fieldset>\n\n</div>\n'},3:function(e,t,i,n){var a;return i='\n<div class=\'profile\'>\n    <fieldset>\n        <legend class=\'system-info-header\'>Profile Photo</legend>\n        <div class="drawer-profile large-profile background-container">\n            <div class="profile-icon-placeholder"></div>\n            <div class=\'related-pref\'>\n                <form class="customProfileImage">\n                    <label class="change-icon change-profile-image" for="custom-profile-image">Change</label>\n                    <input class="change-profile-image-input" type="file" accept="image/*" name="custom-profile-image" id="custom-profile-image" />\n                </form>\n            </div>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Name</legend>\n        <div class=\'edit-profile-attribute displayName\'>\n            <textarea id="display_name" type="text" class="value" placeholder="Type something"></textarea>\n        </div>\n    </fieldset>\n    <fieldset>\n        <legend class=\'system-info-header\'>Avatar Name</legend>\n        <div class=\'edit-profile-attribute avatarName background-container\' id=\'username\'></div>\n    </fieldset>\n    <fieldset>\n        <legend class=\'system-info-header\'>Tagline</legend>\n        <div class=\'edit-profile-attribute tagline\'>\n            <textarea id="tagline" type="text" class="value" placeholder="Type something"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Chat Room</legend>\n        <div class="background-container">\n            <input id=\'profile-checkbox-show-chat-room\' type="checkbox" class="toggle-switch" data-pref="client.is_current_location_hidden" data-pref-invert=1><label for=\'profile-checkbox-show-chat-room\'>Show Chat Room Location</label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Age</legend>\n        <div class="edit-profile-attribute background-container age-container">\n            <div class=\'age\'></div>\n        </div>\n        <div class="edit-profile-attribute background-container show-label">\n            <input id=\'profile-checkbox-show-age\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_age" data-pref-default=1><label id="display-age-toggle" for=\'profile-checkbox-show-age\'>Show Age</label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Gender</legend>\n        <div class=\'edit-profile-attribute gender\'>\n            <select id="gender" class="value"></select>\n        </div>\n        <div class=\'edit-profile-attribute gender show-label background-container\'>\n            <input id=\'profile-checkbox-show-gender\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_gender" data-pref-default=1><label for=\'profile-checkbox-show-gender\'>Show Gender</label>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Location</legend>\n        <div class=\'edit-profile-attribute country\'>\n            <select id="country" class="value"></select>\n        </div>\n        <div class=\'edit-profile-attribute state not-applicable\'>\n            <select id="state" class="value"></select>\n        </div>\n        ',((a=t.if.call(e,e&&e.canHideGeoLocation,{name:"if",hash:{},fn:this.program(4,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+'\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Interests</legend>\n        <div class=\'edit-profile-attribute interests\'>\n            <textarea id="interests" class="value" placeholder="Type something"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>Affinity</legend>\n        <div class=\'edit-profile-attribute relationship_status affinity\'>\n            <span class="descriptor">Relationship:</span>\n            <select id="relationship_status" class="value"></select>\n        </div>\n\n        <div class=\'edit-profile-attribute looking_for affinity\'>\n            <span class="descriptor">Looking For:</span>\n            <select id="looking_for" class="value"></select>\n        </div>\n    </fieldset>\n\n</div>\n<footer class="dialog-footer">\n    <button class="btn btn-primary submit" disabled></button>\n</footer>\n'},4:function(){return"\n            <div class='edit-profile-attribute geo-location show-label background-container'>\n                <input id='profile-checkbox-show-geo-location' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_geo_location\" data-pref-default=1><label for='profile-checkbox-show-geo-location'>Show Location</label>\n            </div>\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i="",((a=t.if.call(e,e&&e.canSeeNewEditProfileDesign,{name:"if",hash:{},fn:this.program(1,n),inverse:this.program(3,n),data:n}))||0===a)&&(i+=a),i+'\n<option class="dropdown-item hidden"></option>\n\n'},useData:!0})}(),nn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<footer class="dialog-footer">\n    <a href="javascript:;" class="post footer-post-btn btn btn-primary"></a>\n</footer>'},useData:!0})}(),an=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="back-button"></div>'},useData:!0})}(),sn=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("EditProfileImageDialog",{uiContextName:"edit_profile_image_dialog",className:"edit-profile-image-dialog dialog-type-B can-dismiss",dependencies:["globalStringManager","dialogManager","modeManager","timer"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:this.__post},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__stringManager=e.globalStringManager,this.title=this.__stringManager.get("dialog_edit_profile_image_title"),this.__file=IMVU.requireProperty(e,"file",null),this.__modeManager=e.modeManager,_.has(this.__serviceProvider.services,"editProfileImage")||_.has(e,"editProfileImage")?(this.__editProfileImage=e.editProfileImage||this.__serviceProvider.get("editProfileImage"),this.addToDOM()):module.run({EditProfile:"@EditProfileImage"},this.__completeInit.bind(this))},__completeInit:function(e,t){this.__editProfileImage=this.__modeManager.createChildContext(e.EditProfile,{$parentElement:this.__modeManager.$el}),this.__serviceProvider.register("editProfileImage",this.__editProfileImage),this.addToDOM()},postRender:function(){this.setContent("body",e.template),"mobile"===this.serviceProvider.get("platform")&&(this.$(".dialog-header").prepend(e.backButtonTemplate({})),this.$(".dialog-x").remove()),this.$post=this.$(".footer-post-btn").text(this.__stringManager.get("dialog_profile_image_edit_post")),this.__editProfileImage.attach(this.$(".dialog-body")),this.__editProfileImage.restoreScrollValues(),this.__editProfileImage.on("exit",this.hide,this),this.__editProfileImage.on("uploadError",this.__uploadError,this),this.__editProfileImage.on("canPost",this.setPostStatus,this),this.__editProfileImage.changeCustomProfile(this.__file)},__uploadError:function(){this.__timer.setTimeout(function(){this.promiseResolver.resolve(!0),this.__dialogManager.alert({title:this.__stringManager.get("dialog_edit_profile_invalid_image_title"),text:this.__stringManager.get("dialog_edit_profile_invalid_image_text")})}.bind(this),0)},setPostStatus:function(e){this.$post.toggleClass("disabled",!e)},__post:function(){this.__editProfileImage.post()},delete:function(){this.__editProfileImage.reset(),this.__editProfileImage.saveScrollValues(),this.__editProfileImage.detach(),this.__editProfileImage.off(null,null,this),t.prototype.delete.call(this)},__goBack:function(){this.promiseResolver.resolve(!0)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:nn,backButtonTemplate:an}),on=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("EditProfileDialog",{uiContextName:"edit_profile_dialog",className:"edit-profile-dialog dialog-type-B",dependencies:"dialogManager featureAccessManager globalStringManager loginManager platform prefsManager Promise".split(" "),trackedEvents:function(){return[{type:"change",selector:".change-profile-image-input",name:"change_profile_image",handler:this.__changeProfileImage},{type:"click",selector:"button.submit",name:"submit",handler:this.__submitChanges},{type:"click",selector:"button.cancel",name:"cancel",handler:this.__cancel},{type:"click",selector:".save-profile",name:"submit",handler:this.__submitChanges},{type:"change",selector:"#country",name:"country",handler:this.__handleCountryChange},{type:"change",selector:"#state",name:"state",handler:this.__handleFieldChange},{type:"click",selector:"#location",name:"location",handler:this.__showLocationDropdown},{type:"change",selector:"#gender",name:"gender",handler:this.__handleFieldChange},{type:"change",selector:"#looking_for",name:"looking_for",handler:this.__handleFieldChange},{type:"change",selector:"#relationship_status",name:"relationship_status",handler:this.__handleFieldChange},{type:"input",selector:"#display_name",name:"display_name",handler:this.__handleFieldChange,repeats:1},{type:"input",selector:"#interests",name:"interests",handler:this.__handleFieldChange,repeats:1},{type:"input",selector:"#tagline",name:"tagline",handler:this.__handleFieldChange,repeats:1},{type:"change",selector:"input[data-pref]",name:"preference",handler:this.__handleFieldChange,attributes:function(e){return{pref:e.data("pref")}}}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__stringManager=i.globalStringManager,this.__myself=i.loginManager.getCurrentUser(),this.__curtainDelay=i.curtainDelay||700,this.__canSeeNewEditProfileDesign=this.__featureAccessManager.canSeeProfileLightbox(),this.title=this.__stringManager.get("dialog_edit_profile_title"),this.userFieldsToPopulate="country state gender looking_for relationship_status tagline".split(" "),this.addToDOM(),this.__canSeeNewEditProfileDesign&&(this.$el.addClass("new-design"),this.$(".dialog-header").append(e.SaveButtonTemplate()),i=738<$(this.__window).width(),"desktop"===this.__platform||i)&&(this.$(".dialog-header").before(e.SaveButtonTemplate()),this.$(".dialog-x").addClass("cancel-button").text(this.__globalStringManager.get("Cancel")),this.$(".dialog-header").before(this.$(".dialog-title").addClass("title-outside")),this.$(".dialog-header").before(e.SaveButtonTemplate()),this.$(".dialog-container").addClass("no-header"))},postRender:function(){this.setContent("body",e.template({canSeeNewEditProfileDesign:this.__canSeeNewEditProfileDesign,age_description:this.__globalStringManager.get("age_description",{age:this.__myself.get("age")})})),this.$(".profile").scrollbar(),this.__setupDropDowns(),this.__canSeeNewEditProfileDesign?(e.NextUtil.DomHelper.enhanceTextarea(this.$("#tagline"),100,45),e.NextUtil.DomHelper.enhanceTextarea(this.$("#interests"),256,64),e.NextUtil.DomHelper.enhanceTextarea(this.$("#display_name"),30,45)):(e.NextUtil.DomHelper.enhanceTextarea(this.$("#tagline"),100),e.NextUtil.DomHelper.enhanceTextarea(this.$("#interests"),256),e.NextUtil.DomHelper.enhanceTextarea(this.$("#display_name"),30)),this.__uploadCurtain=this.createChildContext(e.UploadCurtain,{$parentElement:this.$el,completeDelay:this.__curtainDelay}),this.__myself.populated().then(function(){this.__profileIcon=this.createChildContext(e.Widgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.__myself}),this.__myself.get("is_adult")||this.$("#display-age-toggle").remove(),this.$(".age").text(this.__myself.get("age")),this.__populateUserFields(),this.__handleCountryChange(),this.__toggleHasChanges(!1)}.bind(this)),this.__prefsManager.populated().then(function(){this.__populatePrefs(),this.__toggleHasChanges(!1)}.bind(this))},__populatePrefs:function(){this.$("input[data-pref]").each(function(e,t){var i=$(t),n=this.__prefsManager.getBool(i.attr("data-pref"),!!i.attr("data-pref-default"));i.attr("data-pref-invert")&&(n=!n),i.prop("checked",n)}.bind(this))},__populateUserFields:function(){_.each(this.userFieldsToPopulate,function(e){var t=this.__myself.get(e);""!==t&&this.$("select#"+e).val(t).trigger("change")}.bind(this)),this.$("#username").text(this.__myself.get("username").replace("Guest_","")).trigger("input"),this.$("#location").text(this.__myself.get("country")+(this.__myself.get("state")?" - "+this.__myself.get("state"):"")),_.each(["display_name","interests","tagline"],function(e){""!==this.__myself.get(e)&&this.$("#"+e).val(this.__myself.get(e)).trigger("input")}.bind(this))},__setupDropDowns:function(){_.each(this.userFieldsToPopulate,function(t){var i=this.$("select#"+t);i.length&&(_.each(e.profileJSON[t],function(e,t){var n=this.$(".dropdown-item").clone().removeClass("hidden dropdown-item");i.append(n.attr("value",t).text(e))}.bind(this)),this.createChildContext(e.Dropdown,{$replaceElement:i,dismissOnScroll:this.$(".profile")}))}.bind(this))},__getPostData:function(){var e={gender:this.$("#gender").val(),country:this.$("#country").val(),relationship_status:this.$("#relationship_status").val(),looking_for:this.$("#looking_for").val(),interests:this.$("#interests").val(),tagline:this.$("#tagline").val(),display_name:this.$("#display_name").val()};return this.__countryIsUSA()&&(e.state=this.$("#state").val()),e},__changeProfileImage:function(t){this.__dialogManager.showDialog(e.EditProfileImageDialog,{file:t.target.files[0]}),this.$(".customProfileImage")[0].reset()},__submitChanges:function(){this.__removeMultipleConsecutiveSpaces(this.$("#display_name")),this.__uploadCurtain.show();var e=[this.__myself.save(this.__getPostData(),{error:this.__myself.invalidate.bind(this.__myself)})];this.$("input[data-pref]").each(function(t,i){var n=(s=$(i)).attr("data-pref"),a=s.prop("checked"),s=!!s.attr("data-pref-invert");e.push(this.__prefsManager.setBool(n,s?!a:a))}.bind(this)),this.__Promise.every(e).then(function(){this.__toggleHasChanges(!1),this.__uploadCurtain.complete()}.bind(this)).catch(function(e){var t=this.__stringManager.get("dialog_generic_save_error_text"),i="msg_blank msg_display_name_not_string msg_display_name_length msg_display_name_inappropriate msg_display_name_registered msg_display_name_wrapping_spaces msg_display_name_at_sign msg_display_name_persona msg_display_name_multiple_spaces".split(" ");e.message&&-1<i.indexOf(e.message)&&(t=this.__stringManager.get("edit_profile_error_"+e.message,{minimum:"1",maximum:"30"})),this.__uploadCurtain.hide(),this.__dialogManager.alert({title:this.__stringManager.get("dialog_generic_save_error_title"),text:t,ok:this.__stringManager.get("dialog_generic_save_error_ok")})}.bind(this)),this.__canSeeNewEditProfileDesign&&this.hide()},__toggleHasChanges:function(e){this.$("button.submit").prop("disabled",!e).text(e?this.__stringManager.get("dialog_edit_profile_save_changes"):this.__stringManager.get("dialog_edit_profile_saved"))},__handleFieldChange:function(){""!==this.$("#display_name").val()?this.__toggleHasChanges(!0):this.$("button.submit").prop("disabled",!0).text(this.__stringManager.get("dialog_edit_profile_save_changes"))},__removeMultipleConsecutiveSpaces:function(e){e.val(e.val().replace(/\s\s+/g," "))},__cancel:function(){this.hide(),this.promiseResolver.reject()},__countryIsUSA:function(){return"US"===this.$("#country").val()},__handleCountryChange:function(){this.$(".edit-profile-attribute.state").toggleClass("not-applicable",!this.__countryIsUSA()),this.__handleFieldChange()},__showLocationDropdown:function(){this.$("#location").toggleClass("hidden",!0),this.$(".location-container").toggleClass("hidden",!1)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],Widgets:e["@Widgets"],NextUtil:e["@NextUtil"],template:tn,profileJSON:e["json!/common/pure/util/profile.json"],Dropdown:_i,UploadCurtain:_e,EditProfileImageDialog:sn,SaveButtonTemplate:en}),rn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="profile-info">\n</div>'},useData:!0})}(),ln=function(e){return e.UiCore.UiContext.extend("ProfileFriendsListItem",{uiContextName:"profile_friends_list_item",tagName:"article",className:"profile-friends-list-item",dependencies:["cardManager","imageManager","model"],trackedEvents:function(){return[{type:"click",selector:".profile-info",name:"profile_item_show_profile",handler:this.__onClickTile.bind(this)}]},initialize:function(t){e.UiCore.UiContext.prototype.initialize.call(this,t),this.userNode=this.__model.node,this.addToDOM(),this.$el.removeClass("loading")},__loadImage:function(e){this.__imageManager.load(this.$(".cover-image"),this.userNode.get("thumbnail_url"),{container:this.$el})},render:function(){this.model.populated().then(function(){this.$el.html(e.template({})),this._dualName=this.createChildContext(e.Widgets.DualName,{$parentElement:this.$(".profile-info"),user:this.userNode,configuration:"large-dual-lightbg"}),this.__loadImage()}.bind(this))},__onClickTile:function(){this.__cardManager.showUserProfileCard({user:this.userNode,context:"friends"})}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:rn}),dn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="search-container">\n</div>\n<div class="profile-user-list-container">\n</div>'},useData:!0})}(),cn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="profile-info">\r\n    <div class="disabled-txt hidden">Disabled Account</div>\r\n</div>\r\n<div class="button-container"></div>'},useData:!0})}(),hn=function(e){return e.UiCore.UiContext.extend("ProfileListItem",{uiContextName:"profile_list_item",tagName:"article",className:"profile-list-item",dependencies:["model","imageManager","cardManager"],trackedEvents:function(){return[{type:"click",selector:".profile-info",name:"profile_item_show_profile",handler:this.__onClickTile.bind(this)}]},initialize:function(t){e.UiCore.UiContext.prototype.initialize.call(this,t),this.model=t.model,this.userNode=t.model.node.getSingleEdge("restgraph_entity"),this.__imageManager=t.imageManager,this.__cardManager=t.cardManager,this.__context=t.context||null,this.profileJSON=e.ProfileJSON,t.template&&(this.template=t.template),this.template||(this.template=e.template),this.addToDOM(),this.$el.removeClass("loading")},__loadImage:function(e){e=this.model.get("image")||this.model.node.get("image"),this.__imageManager.load(this.$(".cover-image"),e,{container:this.$el})},render:function(){this.model.populated().then(function(){this.$el.html(this.template({}));var t=0<this.$(".profile-info").length?".profile-info":".username",i=0<this.$(".button-container").length;switch(t){case".profile-info":this.userNode.populated().then(function(){this._dualName=this.createChildContext(e.Widgets.DualName,{$parentElement:this.$(".profile-info"),user:this.userNode,configuration:"large-dual-lightbg"})}.bind(this)).catch(function(e){404==e.contents.code&&this.$(".disabled-txt").removeClass("hidden")}.bind(this)),i&&(this.__followButton=this.createChildContext(e.Widgets.FollowButton,{$replaceElement:this.$(".button-container"),profileNode:this.model.node}))}this.__loadImage()}.bind(this))},__onClickTile:function(){this.__cardManager.showUserProfileCard({user:this.userNode,context:"friends"})}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],ProfileJSON:e["json!/common/withme/js/mode/friends/profile.json"],template:cn}),_n=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("ProfileList",{uiContextName:"profile_list",className:"profile-list",tagName:"section",triggerNextPage:3,dependencies:["stringManager"],initialize:function(i){this.filterModel=i.filterModel,this.stringManager=i.stringManager,this.itemFactory=i.itemFactory||e.ProfileListItem,t.prototype.initialize.call(this,i),this.__emptyPlaceholder=IMVU.optionalProperty(i,"emptyPlaceholder",null)},__updateEmpty:function(){},__emptyText:function(){return this.__emptyCopy?{standard:this.stringManager.get(this.__emptyPlaceholder),concise:this.stringManager.get(this.__emptyPlaceholder)}:{standard:this.stringManager.get("no_search_results"),concise:this.stringManager.get("no_search_results_concise")}}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],ProfileListItem:hn}),gn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return'<form class="search">\n    <input type="text" placeholder="'+(0,this.escapeExpression)("function"==typeof(a=t.placeholder||e&&e.placeholder)?a.call(e,{name:"placeholder",hash:{},data:n}):a)+'">\n    <button class="btn btn-small" type="reset"></button>\n    <button class="btn btn-small" type="submit"></button>\n</form>'},useData:!0})}(),pn=function(e){var t=e.UiCore.UiContext;return t.extend("SearchWidget",{uiContextName:"search_widget",className:"search-widget",dependencies:["stringManager"],initialize:function(i){this.__filterList=i.filterList,this.__stringManager=i.stringManager,this.__placeholder=this.__stringManager.get(i.placeholder),this.model=i.model||i.serviceProvider.create(e.Model.FilterModel,i.filterList,{}),t.prototype.initialize.call(this,i),this.addToDOM(),this.setInputToReflectModel(),i.showCategoryPlaceholder&&(this.__updateCategoryPlaceholder(),this.listenTo(this.model,"change:category",this.__updateCategoryPlaceholder))},setInputToReflectModel:function(){this.$('input[type="text"]').val(this.model.get("filter_text"))},render:function(){this.$el.html(e.template({placeholder:this.__placeholder}))},__updateCategoryPlaceholder:function(){var e=this.__placeholder;"all"!==this.model.get("category")&&-1===this.model.get("category").indexOf("user-")&&(e=this.__stringManager.get("search_box_category",{category:this.__stringManager.get("cat_"+this.model.get("category"))})),this.$('input[type="text"]').attr("placeholder",e)}})}({UiCore:e["@UiCore"],Model:e["@Model"],NextUtil:e["@NextUtil"],template:gn}),un=function(e){var t=e.SearchWidget;return t.extend("SearchBoxWidget",{uiContextName:"search_box_widget",className:"search-widget search-box-widget",dependencies:["stringManager"],trackedEvents:function(){return[{type:"click",selector:'button[type="submit"]',name:"submit_search",handler:"__onSubmitSearch"},{type:"click",selector:'button[type="reset"]',name:"reset",handler:"resetSearch"},{type:"keyup",selector:'input[type="text"]',name:"submit_search",handler:"__onKeyup",allowBubble:!0}]},setInputToReflectModel:function(){t.prototype.setInputToReflectModel.call(this),this.__updateResettable()},__val:function(){return $.trim(this.$('input[type="text"]').val())},__onSubmitSearch:function(e){e.preventDefault(),this.__submit(),this.__updateResettable()},__onKeyup:function(t){t.preventDefault(),t.keyCode===e.NextUtil.Keys.VK_ENTER&&(this.__recordEvent("click",{name:"submit_search",pressed_enter:1}),this.__submit()),this.__updateResettable()},__submit:function(){var e=this.__val();e!==this.model.get("filter_text")&&this.model.set("filter_text",e)},__updateResettable:function(){var e=this.__val();this.$el.toggleClass("resettable",0<e.length&&e===this.model.get("filter_text"))},resetSearch:function(){this.$('input[type="text"]').val(""),this.model.set("filter_text",""),this.$('input[type="text"]').removeClass("is-filled"),this.__updateResettable()}})}({NextUtil:e["@NextUtil"],SearchWidget:pn}),mn=function(e){var t=e.UiCore.UiContext;return t.extend("ProfileUserListPresenter",{className:"profile-user-list-presenter",uiContextName:"profile_user_list_presenter",dependencies:["globalStringManager","context","node"],initialize:function(i){switch(t.prototype.initialize.call(this,i),this.__filterModel=this.__serviceProvider.create(e.Model.FilterModel,["filter_text"],{}),this.__filterModel.set({limit:50}),this.__historySearch=[],this.collection=this.__node.searchEdgeCollection(this.__context,{limit:50},e.UiCore.EdgeCollection),this.__context){case"subscribers":this.__itemFactory=e.ItemFactory,this.__emptyPlaceholder="no_followers",this.__searchPlaceholder="search_followers";break;case"subscriptions":this.__itemFactory=e.ItemFactory,this.__emptyPlaceholder="no_followings",this.__searchPlaceholder="search_followings";break;case"friends":this.__itemFactory=e.FriendsListItem,this.__emptyPlaceholder="no_friends",this.__searchPlaceholder="search_friends"}this.addToDOM()},render:function(t){this.$el.html(e.template()),this.__search=this.createChildContext(e.SearchBox,{$parentElement:this.$(".search-container"),placeholder:this.__searchPlaceholder,model:this.__filterModel,stringManager:this.__globalStringManager}),this.collection.populated().then(function(){this.$(".search-container").toggleClass("hidden",0===this.collection.total_count)}.bind(this)),this.search(),this.listenTo(this.__filterModel,"change",function(){this.search()}.bind(this))},show:function(){this.searchBox&&this.searchBox.setInputToReflectModel(),t.prototype.show.call(this)},search:function(){this.collection=this.__node.searchEdgeCollection(this.__context,this.__augmentedQueryParams(),e.UiCore.EdgeCollection),_.contains(this.__historySearch,this.collection.url)||this.__historySearch.push(this.collection.url),this.__refreshUserList()},__refreshUserList:function(){this.__list&&this.__list.delete(),this.__list=this.createChildContext(e.ProfileList,{$parentElement:this.$(".profile-user-list-container"),collection:this.collection,stringManager:this.__globalStringManager,itemFactory:this.__itemFactory,emptyPlaceholder:this.__emptyPlaceholder})},__isFiltered:function(){var e=this.__filterModel.toQueryParamsMap();return delete e.limit,!_.isEmpty(e)},__augmentedQueryParams:function(){var e=this.__filterModel.toQueryParamsMap();return e.sortby="name",e.type="user",e.name_filter&&(e.q=e.name_filter),e}})}({UiCore:e["@UiCore"],Model:e["@Model"],ProfileList:_n,ItemFactory:hn,SearchBox:un,FriendsListItem:ln,template:dn}),fn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return"<div class=\"main-info\">\n    <div class='picture tile-body'>\n    </div>\n    <div class='text'>\n        <div class='primary-text'></div>\n        <div class='secondary-text is-truncated'>@ "+(0,this.escapeExpression)("function"==typeof(a=t.avatarName||e&&e.avatarName)?a.call(e,{name:"avatarName",hash:{},data:n}):a)+"</div>\n    </div>\n</div>\n"},useData:!0})}(),vn=function(e){var t=e.UiCore.UiContext;return t.extend("ProfileHeadpiece",{className:"profile-headpiece standard-headpiece",uiContextName:"profile_headpiece",dependencies:["user"],initialize:function(i){t.prototype.initialize.call(this,i),this.__ignoreClicks=IMVU.optionalProperty(i,"ignoreClicks",!1),this.__user.populated().then(function(){this.addToDOM(),this.createChildContext(e.Widgets.ProfileIcon,{ignoreClicks:this.__ignoreClicks,user:this.__user,$parentElement:this.$(".picture")}),this.createChildContext(e.Widgets.DisplayName,{$replaceElement:this.$(".primary-text"),user:this.__user,showVipBadge:!0,size:"large"})}.bind(this))},render:function(){this.$el.html(e.template({avatarName:this.__user.get("username")}))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:fn}),bn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="actions-container bar">\n    <li class="action-more-container">\n        <button class="btn action-more">\n            <svg class="icon icon-action_more_new" width="32" height="32" viewBox="0 0 32 32"><title>';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"More info",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</title><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-action_more_new"></svg>\n        </button>\n    </li>\n    <li class="action-gift-container">\n        <button class="btn action-gift">\n            <svg class="icon icon-gift_new" width="32" height="32" viewBox="0 0 32 32"><title>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Gift",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</title><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-gift_new"></svg>\n        </button>\n    </li>\n    <li class="action-message-container">\n        <button class="btn action-message">\n            <svg class="icon icon-action_message" width="32" height="32" viewBox="0 0 32 32"><title>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Message",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'</title><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-action_message"></svg>\n        </button>\n    </li>\n    <li class="action-share-container">\n    </li>\n</div>\n<div class="follow-container"></div>'},useData:!0})}(),Cn=function(e){var t=e.Dialogs.AlloyConfirmDialog;return t.extend("ReportUserDialog",{uiContextName:"report_user_dialog",className:"report-user-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager","loginManager"],initialize:function(i){this.__model=i.model,this.__dialogManager=i.dialogManager,this.__restModelFactory=i.restModelFactory,this.__startupModel=i.globalStartupModel,this.__stringManager=i.globalStringManager,i=_.extend({title:this.__stringManager.get("block_person_title"),html:this.__stringManager.get("block_person_html",{username:this.__model.get("display_name").replace("Guest_","")}),yes:this.__stringManager.get("block_person_block"),no:this.__stringManager.get("block_person_cancel")},i),t.prototype.initialize.call(this,i),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__blockedUsers=this.track(this.__myself.getEdgeCollection("blocked",e.UiCore.EdgeCollectionModel))},__onConfirm:function(){this.__blockedUsers.populated().then(function(){return this.__blockedUsers.create({id:this.__model.id})}.bind(this)).then(this.__confirmDialog.bind(this)).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this)).catch(function(e){this.__errorDialog(e).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this))}.bind(this))},__confirmDialog:function(){return this.__dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("block_person_confirm_title"),text:this.__stringManager.get("block_person_confirm_text",{username:this.__model.get("display_name").replace("Guest_","")}),ok:this.__stringManager.get("block_person_confirm_done")}).finished},__errorDialog:function(t){return this.__dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("block_person_error_title"),text:this.__stringManager.get("block_person_error_text"),ok:this.__stringManager.get("block_person_error_done")}).finished}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"]}),yn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){return i=t.helperMissing,'<div class="subheader">\n    '+(0,this.escapeExpression)((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"WISHLIST",{name:"i18n-g",hash:{},data:n}))+'\n    <hr>\n</div>\n<div class="id-searchbox"></div>\n<div class="wish-list-container-container">\n    <div class="wish-list-container is-list">\n</div>'},useData:!0})}(),Mn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<button class="btn ap ap-badge"></button>'},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r='<div class="product-img">\n    <img class="cover-image">\n    ';return((a=t.if.call(e,e&&e.isAp,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+'\n</div>\n<div class="product-info">\n    <div class="product-name">'+i("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:n}):s)+'</div>\n    <div class="created-by">'+i((s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"created_by_user",{name:"i18n-g",hash:{user:e&&e.creatorName},data:n}))+'</div>\n    <div class="price-info">\n        <div class="price-credits">'+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+"</div>\n    </div>\n</div>\n"},useData:!0})}(),kn=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("WishListItem",{className:"wishlist-item",uiContextName:"wishlist_item",tagName:"div",dependencies:["imageManager","loginManager","globalStringManager"],trackedEvents:function(){return[]},initialize:function(e){t.prototype.initialize.call(this,e),this.__myself=e.loginManager.getCurrentUser(),this.addToDOM()},setImage:function(e,t,i){t&&i&&(e=IMVU.URI.build(e,{width:i,height:t})),this.__imageManager.load(this.$("img"),e,{container:this.$el})},render:function(){this.model.populated().then(function(t){this.$el.html(e.template({name:t.get("product_name"),creatorName:t.get("creator_name"),isAp:"AP"===t.get("rating"),price:t.get(this.__myself.get("isVip")?"discount_price":"product_price")})),this.setImage(t.get("preview_image"),100,100),this.$el.data("node",t)}.bind(this))}})}({UiCore:e["@UiCore"],template:Mn}),xn=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("WishlistCollectionPresenter",{className:"wish-list",uiContextName:"wish_list",itemFactory:e.WishlistItem,dependencies:["globalStringManager"],initialize:function(e){this.__globalStringManager=e.globalStringManager,t.prototype.initialize.call(this,e)},__emptyText:function(){return{standard:this.__globalStringManager.get("no_wishlist_results"),concise:this.__globalStringManager.get("no_wishlist_results_concise")}}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],WishlistItem:kn}),wn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){return i=t.helperMissing,'<div class="id-go-to-shop btn-primary">'+(0,this.escapeExpression)((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"GO TO SHOP",{name:"i18n-g",hash:{},data:n}))+"</div>"},useData:!0})}(),Pn=function(e){var t=function(t){return t.extend("ItemPickerDialogWishlistCollectionPresenter",{initialize:function(i){this.__isBaseWishlistEmpty=i.isBaseWishlistEmpty,this.__giftee=i.giftee,this.__updateEmpty=function(){t.prototype.__updateEmpty.call(this),i.updateEmptyCallback.call(this,this.__isBaseWishlistEmpty())},e.WishlistCollectionPresenter.prototype.initialize.call(this,i)},__emptyText:function(){return this.__isBaseWishlistEmpty()?{standard:this.__globalStringManager.get("no wishlist_items_upsell",{user:this.__giftee.get("display_name")}),concise:this.__globalStringManager.get("No wishlist items")}:t.prototype.__emptyText.call(this)}})}(e.WishlistCollectionPresenter),i=e.Dialogs.AlloyModalDialog;return i.extend("ItemPickerDialog",{uiContextName:"itempicker_dialog",className:"itempicker-dialog dialog-type-B",dependencies:["loginManager","globalStringManager","dialogManager","modeManager","model"],trackedEvents:function(){return[{type:"click",selector:".wishlist-item",name:"wishlist_picker_checkout",handler:this.__checkout.bind(this)},{type:"click",selector:".id-go-to-shop",name:"wishlist_picker_shopupsell",handler:this.__modeManager.openMode.bind(this.__modeManager,{mode:{id:"shop"}})}]},initialize:function(t){this.__filterModel=t.serviceProvider.create(e.Model.FilterModel,["filter_text"],{}),this.title=t.globalStringManager.get("Send Gift"),i.prototype.initialize.call(this,t),this.__myself=this.track(t.loginManager.getCurrentUser()),t.model.populated().then(function(){this.baseWishlistSummary=t.model.searchEdgeCollection("wishlist",{filter:IMVU.URI.buildQuery({cat:[106,108,3088,425]}),limit:0},e.Model.ProductEdgeCollection),this.baseWishlistSummary.populated().then(this.addToDOM.bind(this))}.bind(this))},render:function(){i.prototype.render.call(this),this.setContent("body",e.template),this.__createList(!0),this.$(".wish-list-container").scrollbar(),this.listenTo(this.__filterModel,"change:filter_text",this.__createList.bind(this,!1))},__displayUpSellButton:function(t){this.__$upSellButton||(this.__$upSellButton=$(e.upsellButtonTemplate())),this.__$upSellButton.toggle(t),this.$el.append(this.__$upSellButton)},__isBaseWishlistEmpty:function(){return 0===this.baseWishlistSummary.total_count},__createList:function(i){this.__wishlistPresenter&&this.__wishlistPresenter.delete();var n=["wishlist",{filter:IMVU.URI.buildQuery({cat:[106,108,3088,425],keywords:this.__filterModel.get("filter_text")},{prune:!0})},e.Model.ProductEdgeCollection];i&&this.model.searchEdgeCollection.apply(this.model,n).enumerated().then(function(t){t.length&&this.createChildContext(e.SearchBox,{$replaceElement:this.$(".id-searchbox"),placeholder:"Search Wishlist",model:this.__filterModel,stringManager:this.__globalStringManager})}.bind(this)),this.__wishlistPresenter=this.createChildContext(t,{collection:this.model.searchEdgeCollection.apply(this.model,n),$parentElement:this.$(".wish-list-container"),scroller:this.$(".wish-list-container"),updateEmptyCallback:this.__displayUpSellButton.bind(this),isBaseWishlistEmpty:this.__isBaseWishlistEmpty.bind(this),giftee:this.model})},__checkout:function(t){this.__dialogManager.showDialog(e.Checkout.GiftingDialog,{product:$(t.currentTarget).data("node"),recipient:this.model}).finished.then(function(e){e||this.promiseResolver.resolve()}.bind(this)).catch(function(){this.promiseResolver.reject()}.bind(this))},postRender:function(){}})}({UiCore:e["@UiCore"],Checkout:e["@Checkout"],Dialogs:e["@Dialogs"],WishlistCollectionPresenter:xn,template:yn,Model:e["@Model"],SearchBox:un,upsellButtonTemplate:wn}),$n=function(e){var t=e.Dialogs.AlloyConfirmDialog;return t.extend("ReportUserDialog",{uiContextName:"report_user_dialog",className:"report-user-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager","loginManager"],initialize:function(i){this.__model=i.model,this.__dialogManager=i.dialogManager,this.__restModelFactory=i.restModelFactory,this.__startupModel=i.globalStartupModel,this.__stringManager=i.globalStringManager,i=_.extend({title:this.__stringManager.get("unblock_person_title"),html:this.__stringManager.get("unblock_person_html",{username:this.__model.get("display_name")}),yes:this.__stringManager.get("unblock_person_unblock"),no:this.__stringManager.get("unblock_person_cancel")},i),t.prototype.initialize.call(this,i),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__blockedUsers=this.track(this.__myself.getEdgeCollection("blocked",e.UiCore.EdgeCollectionModel))},__onConfirm:function(){this.__blockedUsers.populated().then(function(){return this.__blockedUserModel=this.__blockedUsers.find(function(e){return this.__model.id===e.node.id}.bind(this)),this.__blockedUserModel.edge.destroy()}.bind(this)).then(this.__confirmDialog.bind(this)).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this)).catch(function(e){this.__errorDialog(e).then(function(){this.promiseResolver.accept(),this.hide()}.bind(this))}.bind(this))},__confirmDialog:function(){return this.__dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("unblock_person_confirm_title"),text:this.__stringManager.get("unblock_person_confirm_text",{username:this.__model.get("display_name")}),ok:this.__stringManager.get("unblock_person_confirm_done")}).finished},__errorDialog:function(t){return this.__dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("unblock_person_error_title"),text:this.__stringManager.get("unblock_person_error_text"),ok:this.__stringManager.get("unblock_person_error_done")}).finished}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"]}),Sn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="content">\n    <div class="private-rooms">\n        <div class="room-list-header">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"My Private Rooms",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n        <div class="my-private-room-list-placeholder"></div>\n    </div>\n    <div class="public-rooms">\n        <div class="room-list-header">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"My Public Rooms",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n        <div class="my-public-room-list-placeholder"></div>\n    </div>\n</div>\n\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary continue" disabled>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Continue",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+' <span class="icon icon-page-right"></span></button>\n<\/script>'},useData:!0})}(),Un=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;i=t.helperMissing;var s="(";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"FULL",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+")"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return i='<div class="tile-thumbnail">\n    <div class="cover-image"></div>\n</div>\n<div class="tile-footer">\n    <div class="tile-name is-truncated">'+(i=this.escapeExpression)("function"==typeof(a=null==(a=null==(a=e&&e.data)||!1===a?a:a.node)||!1===a?a:a.name)?a.apply(e):a)+'</div>\n    <div class="room-tile-occupancy">\n        <span class="icon-person"><svg viewBox="0 0 32 32"><path d="M19 23.3V22c3-1 4.8-3.8 4.8-9.2 0-5.2-3.5-8.5-8-8.5S8 7.6 8 12.8c0 5.4 2 8.3 4.8 9.3v1.4H9.4c-3.2 0-6 3-6.2 6.6v2h25.4v-2c0-3.7-3-6.6-6.2-6.7H19z"/></svg></span>\n        '+i("function"==typeof(s=t.occupancy||e&&e.occupancy)?s.call(e,{name:"occupancy",hash:{},data:n}):s)+"/"+i("function"==typeof(a=null==(a=null==(a=e&&e.data)||!1===a?a:a.node)||!1===a?a:a.capacity)?a.apply(e):a)+" ",((a=t.if.call(e,e&&e.isFull,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n    </div>\n</div>\n"},useData:!0})}(),Tn=function(e){var t=e.ResponsiveTileListItem;return t.extend("ResponsiveRoomTileListItem",{uiContextName:"responsive_room_tile_list_item",className:"responsive-room-tile-list-item responsive-tile-list-item",dependencies:["imageManager","loginManager","model"],initialize:function(e){t.prototype.initialize.call(this,e),this.defaultRoomImageUrl=e.defaultRoomImageUrl||"/common/withme/img/default_room_image.png",this.addToDOM()},render:function(){this.model.populated().then(function(){this.$el.html(e.template({data:this.model.toJSON(),occupancy:this.model.node.get("occupancy")?this.model.node.get("occupancy"):0,isFull:10===parseInt(this.model.node.get("occupancy"))})),this.__loadImage()}.bind(this)),this.listenTo(this.__parentUiContext,"disable",this.__disableFilter)},__loadImage:function(e){e=""===this.model.node.get("image_url")||"//ssluserimages-a.akamaihd.net/imvufiles/rooms/image/default_332.jpg"===this.model.node.get("image_url")?this.model.node.get("themed_image_url")||this.model.node.get("rendered_image"):this.model.node.get("themed_image_url")||this.model.node.get("image_url")||this.model.node.get("rendered_image"),this.__imageManager.loadAsBackgroundImage(this.$(".cover-image"),e,{container:this.$el,defaultImage:this.defaultRoomImageUrl})}})}({UiCore:e["@UiCore"],ResponsiveTileListItem:Et,template:Un}),Dn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="no-results notation no-public-room">\n    ';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"no_my_public_rooms",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+=' \n    <span class="icon icon-tooltip-icon"></span>\n</div> \n\n<div class="tooltip-content">\n    <div class="tooltip-body">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"my_public_rooms_tooltip",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n</div>"},useData:!0})}(),Ln=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="no-results notation no-private-room">\n    ';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"no_my_private_rooms",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+=' \n    <span class="icon icon-tooltip-icon"></span>\n</div> \n\n<div class="tooltip-content">\n    <div class="tooltip-body">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"my_private_rooms_tooltip",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n</div>"},useData:!0})}(),En=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("ChooseRoomDialog",{uiContextName:"choose_room_dialog",className:"choose-room-dialog dialog-type-B is-padded",dependencies:"chatManager dialogManager globalStringManager globalStartupModel loginManager modeManager Promise rest restModelFactory user".split(" "),trackedEvents:function(){return[{type:"click",selector:"button.continue",name:"choose_room",handler:"__continue"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("choose_room_dialog_title"),this.__myself=this.__loginManager.getCurrentUser(),this.addToDOM()},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text()),this.__myself.populated().then(function(){return this.__publicCollection=this.__restModelFactory.searchCollection(this.__myself.relations.managed_rooms,{privacy:"public"},e.UiCore.EdgeCollection),this.__privateCollection=this.__restModelFactory.searchCollection(this.__myself.relations.managed_rooms,{privacy:"private"},e.UiCore.EdgeCollection),this.__Promise.every([this.__publicCollection.populated(),this.__privateCollection.populated()])}.bind(this)).then(function(){this.__myPrivateRooms=this.createChildContext(e.ResponsiveTileList,{$replaceElement:this.$(".my-private-room-list-placeholder"),collection:this.__privateCollection,itemFactory:e.ResponsiveRoomTileListItem,emptyTemplate:e.ResponsivePrivateRoomEmptyTemplate}),this.listenTo(this.__myPrivateRooms,"item_selected",this.__selectRoom),this.__myPublicRooms=this.createChildContext(e.ResponsiveTileList,{$replaceElement:this.$(".my-public-room-list-placeholder"),collection:this.__publicCollection,itemFactory:e.ResponsiveRoomTileListItem,emptyTemplate:e.ResponsivePublicRoomEmptyTemplate}),this.listenTo(this.__myPublicRooms,"item_selected",this.__selectRoom),this.__user.get("is_ap")||(this.__myPrivateRooms.trigger("disable",{key:"content_rating",value:"AP"}),this.__myPublicRooms.trigger("disable",{key:"content_rating",value:"AP"})),this.$(".dialog-body .content").scrollbar()}.bind(this)).catch(function(){}.bind(this))},__selectRoom:function(e){("AP"!==e.node.get("content_rating")||this.__user.get("is_ap"))&&(this.__roomModel=e.node,this.$("button.continue").prop("disabled",!1))},__continue:function(){this.__roomModel&&(this.__modeManager.openMode({mode:{id:"chat"},submode:{id:this.__roomModel.id,forceJoin:!0,showAlways:!0}}),this.__serviceProvider.get("windowManager").removeWindow(this.__roomModel.id),this.__chatManager.inviteUserToRoom(this.__roomModel,this.__user))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:Sn,ResponsiveTileList:At,ResponsiveRoomTileListItem:Tn,ResponsivePublicRoomEmptyTemplate:Dn,ResponsivePrivateRoomEmptyTemplate:Ln}),An=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='<form name="login_form" method="GET" action="#" class="login">\n    <div class="label login_avatarname label-first" data-holder="';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='">\n        <input type="text" tabindex="1" name="avatarname" placeholder=\'',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='\'  autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" value="'+o("function"==typeof(s=t.username||e&&e.username)?s.call(e,{name:"username",hash:{},data:n}):s)+'" />\n    </div>\n    <div class="label login_password label-second" data-holder="',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='">\n        <div style="position:relative">\n            <input tabindex="1" type="password" name="password" placeholder=\'',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='\'/>\n            <div class="toggle-password-visibility icon icon-password-show"></div>\n        </div>\n    </div>\n\n    <div class="label label-forgot">\n        <a class="forgot-password-link" href="/next/forgotpassword">'+o("function"==typeof(s=t.passwordHolderContent||e&&e.passwordHolderContent)?s.call(e,{name:"passwordHolderContent",hash:{},data:n}):s)+'</a>\n    </div>\n    <div class="label label-log-in">\n        <button class="btn btn-primary" >',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_signin_button",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</button>\n    </div>\n    <div class="label label-or">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_or",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</div>\n    <div class="label label-fb">\n        <a class="btn btn-fb id-fb">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_frontpage_fb_cta",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</a>\n    </div>\n\n    <div class="label signup">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_no_account",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='&nbsp;<a class="id-signup">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_signup",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</a></div>\n    <div class="label need-help">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_need_help",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='<a data-external href="https://help.imvu.com/">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_help_center",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</a></div>\n\n    <p class="app-store-buttons text-spacing">\n        <a data-external href="https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8" class="ios-button" target="_blank">\n            <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon-app-store" viewBox="0 0 135 40">\n                <title>Available on the App Store</title>\n                <path fill="#A6A6A6" d="M130.197 40H4.73C2.12 40 0 37.872 0 35.267V4.727C0 2.12 2.122 0 4.73 0h125.467C132.803 0 135 2.12 135 4.726v30.54c0 2.606-2.197 4.734-4.803 4.734z"/><path d="M134.032 35.268c0 2.116-1.714 3.83-3.834 3.83H4.728c-2.118 0-3.838-1.714-3.838-3.83V4.725C.89 2.61 2.61.89 4.73.89h125.467c2.12 0 3.834 1.72 3.834 3.835l.01 30.543z"/><path d="M30.128 19.784c-.03-3.223 2.64-4.79 2.76-4.864-1.51-2.203-3.852-2.504-4.675-2.528-1.967-.207-3.875 1.177-4.877 1.177-1.022 0-2.565-1.16-4.228-1.13-2.14.03-4.142 1.27-5.24 3.19-2.266 3.92-.576 9.69 1.595 12.86 1.086 1.55 2.355 3.28 4.016 3.22 1.62-.07 2.23-1.04 4.19-1.04 1.94 0 2.51 1.03 4.2.99 1.74-.03 2.84-1.56 3.89-3.13 1.25-1.78 1.76-3.53 1.78-3.62-.04-.01-3.39-1.29-3.42-5.15zm-3.2-9.478c.874-1.093 1.472-2.58 1.306-4.09-1.265.057-2.847.876-3.758 1.945-.806.95-1.526 2.49-1.34 3.94 1.42.11 2.88-.71 3.792-1.79zm26.717 21.198h-2.27l-1.245-3.91h-4.324l-1.185 3.91h-2.21l4.29-13.308h2.65l4.31 13.308zm-3.89-5.55L48.63 22.48c-.12-.355-.342-1.19-.67-2.507h-.04c-.132.566-.343 1.402-.633 2.507l-1.105 3.475h3.573zm14.907.634c0 1.632-.44 2.922-1.323 3.87-.79.842-1.78 1.263-2.95 1.263-1.27 0-2.17-.45-2.73-1.36h-.04v5.06H55.5V25.07c0-1.026-.027-2.08-.08-3.16h1.876l.12 1.522h.04c.71-1.15 1.79-1.72 3.237-1.72 1.132 0 2.077.447 2.833 1.34.758.898 1.136 2.076 1.136 3.537zm-2.172.078c0-.934-.21-1.704-.632-2.31-.46-.632-1.08-.948-1.856-.948-.526 0-1.004.176-1.43.523-.43.35-.71.81-.84 1.38-.066.27-.1.48-.1.65v1.6c0 .7.215 1.29.643 1.77s.984.72 1.668.72c.803 0 1.428-.31 1.875-.92.448-.62.672-1.43.672-2.45zm13.21-.078c0 1.632-.442 2.922-1.325 3.87-.79.842-1.77 1.263-2.94 1.263-1.265 0-2.173-.45-2.725-1.36h-.04v5.06h-2.132V25.07c0-1.026-.027-2.08-.08-3.16h1.876l.12 1.522h.04c.71-1.15 1.788-1.72 3.237-1.72 1.14 0 2.08.447 2.84 1.34.76.898 1.14 2.076 1.14 3.537zm-2.173.078c0-.934-.21-1.704-.633-2.31-.46-.632-1.078-.948-1.855-.948-.53 0-1.01.176-1.44.523-.43.35-.71.81-.84 1.38-.07.27-.1.48-.1.65v1.6c0 .7.21 1.29.64 1.77.43.48.98.72 1.67.72.8 0 1.43-.31 1.87-.92.45-.62.67-1.43.67-2.45zm14.513 1.106c0 1.132-.394 2.053-1.183 2.764-.867.777-2.074 1.165-3.625 1.165-1.432 0-2.58-.27-3.45-.82l.495-1.77c.936.57 1.963.85 3.082.85.8 0 1.42-.18 1.87-.54.44-.36.67-.84.67-1.45 0-.54-.19-.99-.56-1.36-.37-.37-.98-.71-1.84-1.03-2.33-.87-3.5-2.14-3.5-3.81 0-1.09.41-1.99 1.22-2.69.81-.69 1.9-1.04 3.26-1.04 1.21 0 2.21.21 3.02.63l-.54 1.74c-.75-.41-1.6-.61-2.55-.61-.75 0-1.34.18-1.76.55-.36.33-.54.73-.54 1.21 0 .53.2.96.61 1.31.35.32 1 .66 1.94 1.03 1.14.46 1.98 1 2.53 1.62.54.62.81 1.39.81 2.31zm7.048-4.264h-2.35v4.66c0 1.184.414 1.776 1.244 1.776.38 0 .697-.033.947-.1l.05 1.62c-.42.157-.98.236-1.66.236-.85 0-1.5-.257-1.98-.77-.48-.514-.71-1.376-.71-2.587v-4.837h-1.4v-1.6h1.4V20.15l2.09-.633v2.39h2.35v1.6zm10.602 3.12c0 1.474-.42 2.685-1.263 3.632-.883.975-2.055 1.46-3.516 1.46-1.4 0-2.52-.466-3.36-1.4s-1.25-2.113-1.25-3.534c0-1.487.43-2.705 1.3-3.652.86-.948 2.03-1.422 3.49-1.422 1.41 0 2.54.467 3.4 1.402.82.907 1.23 2.078 1.23 3.513zm-2.21.07c0-.887-.19-1.646-.573-2.28-.447-.766-1.086-1.15-1.914-1.15-.857 0-1.508.385-1.955 1.15-.383.634-.572 1.405-.572 2.317 0 .885.19 1.644.572 2.276.46.77 1.105 1.15 1.936 1.15.814 0 1.453-.39 1.914-1.17.393-.64.59-1.41.59-2.29zm9.14-2.915c-.21-.04-.435-.06-.67-.06-.75 0-1.33.284-1.74.85-.354.5-.532 1.133-.532 1.896v5.03h-2.13l.02-6.58c0-1.11-.028-2.12-.08-3.02h1.856l.078 1.83h.06c.224-.63.58-1.14 1.065-1.52.475-.35.988-.52 1.54-.52.198 0 .376.01.534.04v2.03zm9.536 2.47c0 .38-.025.703-.078.966h-6.396c.025.94.334 1.67.928 2.17.54.44 1.236.67 2.092.67.947 0 1.81-.15 2.588-.46l.334 1.48c-.908.39-1.98.59-3.217.59-1.488 0-2.656-.44-3.506-1.32-.84-.88-1.27-2.05-1.27-3.53 0-1.45.4-2.65 1.19-3.62.83-1.03 1.95-1.54 3.36-1.54 1.39 0 2.43.51 3.14 1.54.57.81.85 1.82.85 3.02zm-2.033-.554c.014-.64-.125-1.18-.414-1.64-.37-.6-.94-.89-1.7-.89-.7 0-1.27.29-1.7.87-.36.46-.57 1.01-.63 1.65h4.44zM49.05 10.01c0 1.176-.353 2.062-1.058 2.657-.653.55-1.58.824-2.783.824-.6 0-1.11-.02-1.54-.07V6.99c.55-.09 1.15-.138 1.8-.138 1.14 0 2.01.25 2.59.747.65.56.98 1.36.98 2.41zm-1.105.028c0-.763-.202-1.348-.606-1.756-.41-.407-1-.61-1.78-.61-.33 0-.61.02-.85.067v4.88c.13.02.36.03.71.03.8 0 1.42-.23 1.85-.67s.65-1.1.65-1.95zm6.965 1c0 .724-.208 1.32-.622 1.784-.434.48-1.01.718-1.727.718-.69 0-1.24-.23-1.65-.69-.41-.458-.61-1.037-.61-1.735 0-.73.21-1.33.64-1.794s1-.69 1.71-.69c.69 0 1.25.23 1.67.69.4.45.6 1.03.6 1.73zm-1.088.033c0-.43-.094-.8-.28-1.11-.22-.37-.534-.56-.94-.56-.422 0-.742.19-.962.57-.188.31-.28.69-.28 1.14 0 .44.093.81.28 1.12.227.38.543.57.95.57.4 0 .715-.19.94-.57.195-.31.292-.69.292-1.13zm8.943-2.35l-1.475 4.72h-.96l-.61-2.04c-.156-.51-.282-1.02-.38-1.52h-.02c-.09.52-.216 1.03-.378 1.53l-.65 2.05h-.97l-1.387-4.72h1.077l.533 2.24c.13.53.235 1.04.32 1.52h.02c.077-.39.206-.89.388-1.5l.67-2.25h.853l.64 2.21c.156.54.282 1.05.38 1.55h.028c.07-.48.178-1 .32-1.55l.572-2.2h1.03zm5.433 4.72H67.15v-2.7c0-.83-.316-1.25-.95-1.25-.31 0-.562.12-.757.35-.193.23-.29.5-.29.81v2.8h-1.05v-3.37c0-.41-.012-.86-.037-1.35h.92l.05.74h.03c.12-.23.303-.42.542-.57.284-.17.602-.26.95-.26.44 0 .806.15 1.097.43.362.35.543.87.543 1.56v2.83zm2.89 0H70.04V6.56h1.048v6.877zm6.17-2.39c0 .73-.207 1.32-.62 1.79-.435.48-1.01.72-1.728.72-.693 0-1.244-.23-1.654-.69-.41-.45-.615-1.03-.615-1.73 0-.73.22-1.33.64-1.79s1-.7 1.71-.7c.7 0 1.25.23 1.67.69.4.45.6 1.02.6 1.73zm-1.088.04c0-.43-.094-.8-.28-1.11-.22-.37-.534-.56-.94-.56-.422 0-.742.19-.96.57-.19.31-.282.69-.282 1.14 0 .44.094.81.28 1.12.228.38.544.57.952.57.4 0 .713-.19.94-.57.194-.32.29-.694.29-1.13zm6.16 2.37h-.94l-.08-.54h-.028c-.322.43-.78.65-1.377.65-.445 0-.805-.14-1.076-.43-.25-.26-.37-.58-.37-.96 0-.57.24-1.01.72-1.32.48-.3 1.16-.45 2.03-.44v-.09c0-.62-.33-.93-.98-.93-.47 0-.88.12-1.23.35l-.22-.69c.44-.27.98-.4 1.61-.4 1.23 0 1.85.65 1.85 1.95v1.74c0 .47.02.85.07 1.12zm-1.088-1.62v-.73c-1.156-.02-1.734.3-1.734.95 0 .25.066.43.2.55.136.12.308.19.513.19.23 0 .45-.07.65-.22.2-.14.32-.33.37-.56.01-.05.02-.11.02-.18zm7.043 1.62h-.93l-.05-.75h-.028c-.297.58-.803.86-1.514.86-.568 0-1.04-.22-1.416-.67s-.562-1.02-.562-1.73c0-.76.203-1.38.61-1.85.396-.44.88-.66 1.456-.66.64 0 1.08.22 1.33.64h.02V6.56h1.05v5.608c0 .46.01.882.04 1.27zm-1.085-2v-.78c0-.14-.01-.25-.03-.33-.06-.25-.186-.46-.38-.63-.194-.17-.43-.25-.7-.25-.39 0-.697.15-.922.46-.223.31-.336.71-.336 1.19 0 .47.107.85.322 1.14.227.31.533.47.916.47.344 0 .62-.13.828-.39.202-.24.3-.52.3-.86zm10.048-.41c0 .73-.207 1.32-.62 1.79-.435.48-1.01.72-1.728.72-.69 0-1.242-.23-1.654-.69-.41-.45-.615-1.03-.615-1.73 0-.73.22-1.33.64-1.79s1-.69 1.72-.69c.69 0 1.25.23 1.67.69.4.45.6 1.02.6 1.73zm-1.086.04c0-.43-.094-.8-.28-1.11-.222-.37-.534-.56-.942-.56-.42 0-.74.19-.96.56-.19.31-.282.69-.282 1.14 0 .44.094.81.28 1.12.228.38.544.57.952.57.4 0 .715-.19.94-.57.194-.316.292-.692.292-1.13zm6.72 2.37h-1.046v-2.7c0-.83-.316-1.25-.95-1.25-.312 0-.563.12-.757.35s-.3.5-.3.81v2.8h-1.05V10.1c0-.417-.01-.866-.04-1.35h.92l.05.735h.03c.12-.23.3-.416.54-.57.28-.173.6-.262.95-.262.44 0 .8.145 1.1.43.36.35.54.87.54 1.57v2.82zm7.054-3.93h-1.154v2.29c0 .59.205.88.61.88.19 0 .345-.01.468-.05l.027.8c-.207.07-.48.11-.814.11-.414 0-.736-.13-.97-.38-.233-.25-.35-.68-.35-1.27v-2.4h-.688v-.79h.69v-.86l1.026-.31v1.17h1.16v.79zm5.548 3.93h-1.05v-2.68c0-.84-.315-1.27-.948-1.27-.486 0-.818.25-1 .74-.03.1-.05.23-.05.38v2.84h-1.046v-6.9h1.047V9.4h.02c.33-.517.803-.775 1.416-.775.434 0 .793.142 1.078.427.36.35.54.88.54 1.58v2.8zm5.723-2.58c0 .19-.014.35-.04.48h-3.142c.014.47.164.82.455 1.07.266.22.61.33 1.03.33.464 0 .888-.07 1.27-.22l.164.73c-.447.2-.973.29-1.582.29-.73 0-1.305-.21-1.72-.64-.42-.43-.626-1.01-.626-1.73 0-.71.193-1.3.582-1.77.406-.5.955-.75 1.648-.75.678 0 1.193.256 1.54.76.282.4.42.9.42 1.488zm-1-.27c.008-.31-.06-.58-.203-.8-.182-.29-.46-.43-.834-.43-.342 0-.62.15-.834.43-.174.23-.277.5-.31.82h2.18z" fill="#FFF"/>\n            </svg>\n        </a>\n        <a data-external href="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova" class="last android-button" target="_blank">\n            <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon-google-play" viewBox="0 0 135 40">\n                <title>Get it on Google Play</title>\n                <defs><linearGradient id="a" x1="21.8" y1="418.71" x2="5.02" y2="435.49" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#00a0ff"/><stop offset=".01" stop-color="#00a1ff"/><stop offset=".26" stop-color="#00beff"/><stop offset=".51" stop-color="#00d2ff"/><stop offset=".76" stop-color="#00dfff"/><stop offset="1" stop-color="#00e3ff"/></linearGradient><linearGradient id="b" x1="33.83" y1="430" x2="9.64" y2="430" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ffe000"/><stop offset=".41" stop-color="#ffbd00"/><stop offset=".78" stop-color="orange"/><stop offset="1" stop-color="#ff9c00"/></linearGradient><linearGradient id="c" x1="24.83" y1="432.3" x2="2.07" y2="455.05" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ff3a44"/><stop offset="1" stop-color="#c31162"/></linearGradient><linearGradient id="d" x1="7.3" y1="410.18" x2="17.46" y2="420.34" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#32a071"/><stop offset=".07" stop-color="#2da771"/><stop offset=".48" stop-color="#15cf74"/><stop offset=".8" stop-color="#06e775"/><stop offset="1" stop-color="#00f076"/></linearGradient></defs>\n                <rect width="135" height="40" rx="5" ry="5"/><path d="M130 .8a4.2 4.2 0 0 1 4.2 4.2v30a4.2 4.2 0 0 1-4.2 4.2H5A4.2 4.2 0 0 1 .8 35V5A4.2 4.2 0 0 1 5 .8h125m0-.8H5a5 5 0 0 0-5 5v30a5 5 0 0 0 5 5h125a5 5 0 0 0 5-5V5a5 5 0 0 0-5-5z" fill="#a6a6a6"/><path d="M47.42 10.24a2.71 2.71 0 0 1-.75 2 2.91 2.91 0 0 1-2.2.89 3.15 3.15 0 0 1-2.21-5.37 3 3 0 0 1 2.21-.9 3.1 3.1 0 0 1 1.23.25 2.47 2.47 0 0 1 .94.67l-.53.53a2 2 0 0 0-1.64-.71 2.32 2.32 0 0 0-2.33 2.31V10a2.36 2.36 0 0 0 4 1.73 1.89 1.89 0 0 0 .5-1.22h-2.17v-.72h2.91a2.54 2.54 0 0 1 .04.45zM52 7.74h-2.7v1.9h2.46v.72H49.3v1.9H52V13h-3.5V7H52v.74zM55.28 13h-.77V7.74h-1.68V7H57v.74h-1.72V13zm4.66 0V7h.77v6h-.77zm4.19 0h-.77V7.74h-1.68V7h4.12v.74h-1.67V13zm9.48-.78a3.12 3.12 0 0 1-4.4 0 3.24 3.24 0 0 1 0-4.45 3.1 3.1 0 0 1 4.38 0 3.23 3.23 0 0 1 .02 4.45zm-3.83-.5a2.31 2.31 0 0 0 3.26 0 2.56 2.56 0 0 0 0-3.44 2.31 2.31 0 0 0-3.26 0 2.56 2.56 0 0 0 0 3.44zm5.8 1.28V7h.94l2.92 4.67V7h.76v6h-.8l-3.05-4.89V13h-.77z" fill="#fff" stroke="#fff" stroke-miterlimit="10" stroke-width=".2"/><path d="M68.14 21.75A4.25 4.25 0 1 0 72.41 26a4.19 4.19 0 0 0-4.13-4.25h-.14zm0 6.83a2.58 2.58 0 1 1 2.39-2.75V26a2.46 2.46 0 0 1-2.34 2.58h-.05zm-9.31-6.83A4.25 4.25 0 1 0 63.09 26 4.19 4.19 0 0 0 59 21.75h-.17zm0 6.83a2.58 2.58 0 1 1 2.38-2.76V26a2.46 2.46 0 0 1-2.34 2.58h-.04zm-11.09-5.52v1.8h4.32a3.77 3.77 0 0 1-1 2.27 4.42 4.42 0 0 1-3.33 1.32 4.8 4.8 0 0 1 0-9.6A4.6 4.6 0 0 1 51 20.14l1.27-1.27A6.29 6.29 0 0 0 47.74 17a6.61 6.61 0 1 0-.51 13.21h.51a5.84 5.84 0 0 0 6.17-6.07 5.87 5.87 0 0 0-.1-1.13h-6.07v.05zm45.31 1.4a3.92 3.92 0 0 0-7.65 1.28V26a4.16 4.16 0 0 0 4.07 4.25h.15a4.23 4.23 0 0 0 3.54-1.88l-1.45-1a2.43 2.43 0 0 1-2.09 1.18 2.16 2.16 0 0 1-2.06-1.29l5.69-2.35zm-5.8 1.42a2.33 2.33 0 0 1 2.17-2.48 1.65 1.65 0 0 1 1.58.9zM82.63 30h1.87V17.5h-1.87V30zm-3.06-7.3h-.07a3 3 0 0 0-2.24-1 4.26 4.26 0 0 0 0 8.51 2.9 2.9 0 0 0 2.24-1h.06v.69c0 1.63-.87 2.5-2.27 2.5a2.35 2.35 0 0 1-2.14-1.51l-1.63.68a4.05 4.05 0 0 0 3.77 2.51c2.19 0 4-1.29 4-4.43V22h-1.72v.7zm-2.14 5.88a2.59 2.59 0 0 1 0-5.16 2.4 2.4 0 0 1 2.27 2.52V26a2.38 2.38 0 0 1-2.17 2.57h-.1zm24.38-11.08h-4.47V30h1.87v-4.74h2.61a3.89 3.89 0 1 0-.01-7.76zm0 6H99.2v-4.26h2.65a2.14 2.14 0 0 1 0 4.28zm11.53-1.8a3.5 3.5 0 0 0-3.34 1.91l1.66.69a1.77 1.77 0 0 1 1.7-.92 1.8 1.8 0 0 1 2 1.58v.16a4.13 4.13 0 0 0-1.95-.48c-1.79 0-3.6 1-3.6 2.81a2.89 2.89 0 0 0 3 2.75h.08a2.63 2.63 0 0 0 2.4-1.2h.06v1h1.8v-4.81c0-2.19-1.66-3.46-3.79-3.46zm-.23 6.85a1.3 1.3 0 0 1-1.46-1.06c0-1 1.06-1.33 2-1.33a3.32 3.32 0 0 1 1.7.42 2.26 2.26 0 0 1-2.19 2zM123.74 22l-2.14 5.42h-.06L119.32 22h-2l3.33 7.58-1.9 4.21h1.95L125.82 22h-2.08zm-16.81 8h1.87V17.5h-1.87V30z" fill="#fff"/><path d="M10.44 7.54a2 2 0 0 0-.44 1.4v22.12a2 2 0 0 0 .46 1.4l.07.07L22.9 20.15v-.3L10.51 7.47z" fill="url(#a)"/><path d="M27 24.28l-4.1-4.13v-.3l4.1-4.13h.09L32 18.56c1.4.79 1.4 2.09 0 2.89l-4.89 2.78z" fill="url(#b)"/><path d="M27.12 24.22L22.9 20 10.44 32.46a1.63 1.63 0 0 0 2.08.06l14.61-8.3" fill="url(#c)"/><path d="M27.12 15.78l-14.61-8.3a1.63 1.63 0 0 0-2.08.06L22.9 20z" fill="url(#d)"/><path d="M27 24.13l-14.49 8.25a1.67 1.67 0 0 1-2 0l-.07.07.07.07a1.66 1.66 0 0 0 2 0l14.61-8.3z" style="isolation:isolate" opacity=".2"/><path d="M10.44 32.32a2 2 0 0 1-.46-1.4v.15a2 2 0 0 0 .46 1.4l.07-.07zM32 21.3l-5 2.83.09.09L32 21.44A1.75 1.75 0 0 0 33 20a1.86 1.86 0 0 1-1 1.3z" style="isolation:isolate" opacity=".12"/><path d="M12.51 7.62L32 18.7a1.86 1.86 0 0 1 1 1.3 1.75 1.75 0 0 0-1-1.44L12.51 7.48C11.11 6.69 10 7.35 10 8.95v.15c0-1.61 1.12-2.27 2.51-1.48z" style="isolation:isolate" fill="#fff" opacity=".25"/>\n            </svg>\n        </a>\n    </p>\n    <label class="submit">\n        <div class="error-message-container">\n            <div class="error-message try-again-later">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_try_again_later_error",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</div>\n            <div class="error-message credentials">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_credentials_error",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</div>\n            <div class="error-message disabled">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_disabled_error",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</div>\n            <div class="error-message unknown">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_unknown_login_error",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+"</div>\n        </div>\n    </label>\n</form>\n"},useData:!0})}(),In=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="content">\n    <div class="privacy-policy-minors-body">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_dialog_body",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n    <div class="privacy-policy-minors-form">\n        <div class="privacy-policy-minors-form-title">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_dialog_form_title",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n        <div class="fieldset">\n            <label>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Name",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</label>\n            <input type="text" class="privacy-policy-minors-avatarname full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"your name",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</label>\n            <input type="text" class="privacy-policy-minors-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"email address",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="<span> (",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_email_note",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+=')</span></label>\n            <input type="text" class="privacy-policy-minors-email full-width"></input>\n            <div class="input-error"></div>\n        </div>\n        <div class="fieldset">\n            <label>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_name",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_email",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-email full-width"></input>\n            <div class="input-note">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_email_note",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n            <div class="input-error"></div>\n        </div>\n    </div>\n    <div class="privacy-policy-link"><a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_privacy_policy",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</a></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary minors-guardian-form-submit full-width disabled">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"submit",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>\n<\/script>"},useData:!0})}(),Nn={validateEmail:function(e){return/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(e)}},Fn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div>\n    <p>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_dialog_body_1",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</p>\n    <p>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_dialog_body_2",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</p>\n</div>\n<div class="privacy-policy-link"><a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_privacy_policy",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</a></div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary ok full-width">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"OK",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>\n<\/script>"},useData:!0})}(),Hn=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyMinorsGuardianDialog",{uiContextName:"privacy_policy_minors_guardian_dialog",className:"privacy-policy-minors-guardian-dialog dialog-type-B",dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_minors_okay",handler:"__onClose"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("privacy_policy_minors_guardian_dialog_title"),this.addToDOM()},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text())}})}({Dialogs:e["@Dialogs"],template:Fn}),Rn=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyMinorsDialog",{uiContextName:"privacy_policy_minors_dialog",className:"privacy-policy-minors-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","rest"],trackedEvents:function(){return[{type:"keyup",selector:"input.privacy-policy-minors-avatarname",name:"change_avatarname",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-name",name:"change_username",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-email",name:"change_email",handler:"__validateMinorsEmail"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-name",name:"change_guardian_name",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-email",name:"change_guardian_email",handler:"__validateGuardiansEmail"},{type:"click",selector:"button",name:"submit_privacy_policy_minors_form",handler:"__submit"}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__GUARDIAN_VERIFICATION_URL=this.__serviceProvider.get("root")+"/guardian_verification",this.title=this.__globalStringManager.get("privacy_policy_minors_dialog_title"),this.__formValidator=e.FormValidator,this.addToDOM(),this.$(".dialog-x").remove(),this.__hasError=!1},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text()),this.$(".content").scrollbar()},__toggleButton:function(){var e=!1;this.$("input").each(function(t){$(this).val()||(e=!0)});var t=this.__minorsEmailError||this.__guardiansEmailError;this.$(".minors-guardian-form-submit").toggleClass("disabled",e||t)},__validateMinorsEmail:function(e){this.__minorsEmailError=!1;var t=$(e.currentTarget);(e=t.siblings(".input-error")).text(""),null!==(t=this.__validateEmail(t.val()))&&(this.__minorsEmailError=!0,e.text(t)),this.__toggleButton()},__validateGuardiansEmail:function(e){this.__guardiansEmailError=!1,(e=$(e.currentTarget)).siblings(".input-note").toggleClass("hidden",!1);var t=e.siblings(".input-error");t.text("");var i=this.__validateEmail(e.val());null===i&&this.$("input.privacy-policy-minors-email").val()===this.$("input.privacy-policy-minors-guardian-email").val()&&(i=this.__globalStringManager.get("privacy_policy_minors_guardian_email_note")),null!==i&&(this.__guardiansEmailError=!0,t.text(i),e.siblings(".input-note").toggleClass("hidden",!0)),this.__toggleButton()},__validateEmail:function(e){return e?this.__formValidator.validateEmail(e)?null:this.__globalStringManager.get("error_message_email_invalide_format"):this.__globalStringManager.get("error_message_email_empty")},__submit:function(t){this.__rest.post(this.__GUARDIAN_VERIFICATION_URL,{avatarname:this.$("input.privacy-policy-minors-avatarname").val(),user_name:this.$("input.privacy-policy-minors-name").val(),user_email:this.$("input.privacy-policy-minors-email").val(),guardian_name:this.$("input.privacy-policy-minors-guardian-name").val(),guardian_email:this.$("input.privacy-policy-minors-guardian-email").val()}).then(function(e){}),this.__onClose(t),this.__dialogManager.showDialog(e.PrivacyPolicyMinorsGuardianDialog)}})}({Dialogs:e["@Dialogs"],PrivacyPolicyMinorsGuardianDialog:Hn,FormValidator:Nn,template:In}),Bn={mixin:function(e){_.isArray(e)||(e=[].slice.call(arguments));var t=e[0],i=[],n=[];return _.each(e,function(e){if(e.initialize&&i.push(e.initialize),e.trackedEvents&&n.push(e.trackedEvents),e!==t){var a=t.dependencies||[];_.each(e.dependencies,function(e){-1===_.indexOf(a,e)&&a.push(e)}),_.extend(t,e,{dependencies:a})}}),i.length&&(t.initialize=1<i.length?function(){for(var e=Array.prototype.slice.call(arguments),t=i.length;0<t--;)i[t].apply(this,e)}:i[0]),n.length&&(t.trackedEvents=1<n.length?function(){for(var e=Array.prototype.slice.call(arguments),t=[],i=n.length;0<i--;)t=t.concat(n[i].apply(this,e));return t}:n[0]),t}},On=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return"show-label"},3:function(e,t,i,n){var a,s;return(a="function"==typeof(s=t.defaultLabel||e&&e.defaultLabel)?s.call(e,{name:"defaultLabel",hash:{},data:n}):s)||0===a?a:""},5:function(){return"&nbsp"},7:function(e,t,i,n){var a,s;return(a="function"==typeof(s=t.content||e&&e.content)?s.call(e,{name:"content",hash:{},data:n}):s)||0===a?a:""},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i='<div class="holder-label">\n    <div class="info ',((a=t.if.call(e,e&&e.defaultLabel,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+='">',((a=t.if.call(e,e&&e.defaultLabel,{name:"if",hash:{},fn:this.program(3,n),inverse:this.program(5,n),data:n}))||0===a)&&(i+=a),i+='</div>\n    <div class="content">',((a=t.if.call(e,e&&e.content,{name:"if",hash:{},fn:this.program(7,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"</div>\n</div>\n"},useData:!0})}(),zn=function(e){return Handlebars.registerPartial("InputMixinHolderLabel",e.HolderLabelTemplate),{dependencies:[],trackedEvents:function(){return[{type:"focus",selector:".label[data-holder] input",name:"focus_input",handler:"__onHolderInputFocus"},{type:"blur",selector:".label[data-holder] input",name:"blur_input",handler:"__onHolderInputBlur"}]},initialize:function(){var e;this.render=(e=this.render,function(){e.apply(this,arguments),this.__insertLabelTemplate(this.$(".label[data-holder]"))})},__insertLabelTemplate:function(t){(t=(t instanceof $?t:this.$(t)).not(":has(>.holder-label)")).prepend(e.HolderLabelTemplate()),t.filter("[data-dropdown]").each(function(e,t){this.__setInputLabelMsg(t,$(t).attr("data-holder"))}.bind(this))},__onHolderInputFocus:function(e){(e=$(e.currentTarget)).attr("placeholder",""),e=e.closest(".label[data-holder]").removeClass("error"),this.__insertLabelTemplate(e),e.find(">.holder-label >.info").html(e.attr("data-holder")).addClass("show-label")},__onHolderInputBlur:function(e){if(!(e=$(e.currentTarget)).val()){var t=e.closest(".label[data-holder]");e.attr("placeholder",t.attr("data-holder")),t.hasClass("error")||t.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label")}},__clearError:function(e){var t=(e=$(e).closest(".label[data-holder]").removeClass("error")).find("input");!t[0]||t.val()?this.__setInputLabelMsg(e,e.attr("data-holder")):(t.attr("placeholder",e.attr("data-holder")),e.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label"))},__setInputLabelMsg:function(e,t){var i=e instanceof $?e:this.$(e);i.find(">.holder-label >.info").html(t).toggleClass("show-label",!!i.attr("data-holder")||i.hasClass("error"))},__setInputErrorLabelMsg:function(e,t){this.__setInputLabelMsg(this.$(e).addClass("error"),t)}}}({UiCore:e["@UiCore"],HolderLabelTemplate:On}),Wn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="copy-body">\n    ';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_pending_guardian_approval_1",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="\n    ",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_pending_guardian_approval_2",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="\n    ",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_pending_guardian_approval_3",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n    <a href="https://help.imvu.com" target="_blank">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Help Center",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='.</a></div>\n</div>\n<div class="privacy-policy-link"><a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_privacy_policy",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</a></div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary full-width">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"close pending policy",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>\n<\/script>\n\n"},useData:!0})}(),Vn=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyMinorsPendingDialog",{uiContextName:"privacy_policy_minors_pending_dialog",className:"privacy-policy-minors-pending-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("privacy_pending_guardian_approval_title"),this.addToDOM(),this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text())},__onClose:function(e){t.prototype.__onClose.call(this,e)}})}({Dialogs:e["@Dialogs"],Tooltip:Dt,template:Wn}),qn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="copy-body">\n    ';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_1",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n    <a href="#" class="tooltip-target">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_2",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</a>\n    ",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_3",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n    <a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_4",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</a>\n    ",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_5",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="\n    <br>\n    ",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_6",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n\n    <div class="accept-button">\n        <button class="btn btn-primary accept-cookies">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"accept all cookies",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'</button>\n    </div> \n</div>\n\n\n<div class="tooltip-content cookie-tooltip">\n    <div class="tooltip-body">\n        To give you the best possible experience,personalize content and ads, this site usesCookies. Continuing to use the site you agree we may place thesecookieson your device. You can view our Privacy Policy for more details.\n\n        <div class="tooltip-header">Strictly Necessary Cookies:</div>\n            <div>These cookies are necessary for the website to function and cannot be switched off in our systems. </div>\n            <ul>\n                <li>prefer_alloy - Used to determine if you see IMVU Next or Core.</li>\n                <li>alloy_landing_cookie - Used to determine if you see IMVU Next or Core.</li>\n                <li>in_ux - Assigned to a "unique user" experiment.</li>\n                <li>osCsid - Session cookie; required for login to function.</li>\n            </ul>\n        <div class="tooltip-header">Performance Cookies:</div>\n            <div>These cookies allow us to count visits and traffic sources, so we can measure and improve the performance of our site. They help us know which pages are the most and least popular and see how visitors move around the site.</div>\n            <ul>\n                <li>browser_session - Tracks statistics about your IMVU session.</li>\n                <li>window_session - Tracks statistics about a specific IMVU window.</li>\n                <li>Targeting Cookies</li>\n                <li>These cookies are set through our site by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant ads on other sites. They work by uniquely identifying your browser and device.</li>\n                <li>login_interstitial_seen - tracks the last time you saw an interstitial, for aggregate analytics purposes.</li>\n                <li>sncd - Tracks CIDs you have logged into, for detecting if a new account is an alt.</li>\n                <li>nunu - Tracks if we believe you are a new new user.</li>\n                <li>preLogID - Used to connect incoming users with their subsequent login or registration.</li>\n                <li>imvua - Tracks which acquisition partner you came from.</li>\n                <li>datetime_entered - Tracks when you first landed on our site.</li>\n                <li>linkshare_site_id - If acquired through a specific partner, tracks which ad you followed.</li>\n                <li>lpip - Stores the IP you hit a landing page with.</li>\n            </ul>\n        <div class="tooltip-header">Presentation Cookies:</div>\n            <div>These cookies are set to help enhance your experience and for example, allow us to show you IMVU in the language of your choice.</div>\n            <ul>\n                <li>imvu_avnm - stores your avatarname for display purposes.</li>\n                <li>saved_locale - stores which language you prefer to see IMVU in.</li>\n            </ul>\n        <div class="tooltip-header">Third Party Partners:</div>\n            <div>We also have third party partners who may set cookies including this list below:</div>\n            <ul>\n                <li>Amazon</li>\n                <li>Doubleverify</li>\n                <li>Facebook</li>\n                <li>Google</li>\n                <li>Peanutlabs</li>\n                <li>Revenue Universe</li>\n                <li>AppNexus</li>\n                <li>Google Analytics</li>\n                <li>Threat Metrix</li>\n            </ul>\n    </div>\n</div>'},useData:!0})}(),Gn=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyAdultDialog",{uiContextName:"privacy_policy_adult_dialog",className:"privacy-policy-adult-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("privacy_policy_adult_dialog_title"),this.addToDOM(),this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",e.template,{}),this.tooltip=this.createChildContext(e.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".tooltip-target")}),this.tooltip.$el.addClass("tooltip-wide")},__onClose:function(e){this.__cookieManager.set("accepted_all_cookies",!0),t.prototype.__onClose.call(this,e)}})}({Dialogs:e["@Dialogs"],Tooltip:Dt,template:qn}),jn=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("LoginDialog",e.Mixin.mixin({uiContextName:"login_dialog",className:"login-dialog dialog-type-B-flexible",dependencies:"cookieManager dialogManager globalStringManager googleAnalytics leanplum loginManager modeManager restModelFactory window".split(" "),trackedEvents:function(){return[{type:"submit",selector:"form.login",name:"login",handler:"__onLogin"},{type:"click",selector:".id-signup",name:"signup",handler:"__onClickSignup"},{type:"click",selector:".id-fb",name:"fb_login",handler:this.__onClickFB},{type:"click",selector:".toggle-password-visibility",name:"toggle_password_visibility",handler:"__togglePasswordVisibility"},{type:"click",selector:".forgot-password-link",name:"forgot_password",handler:"__forgotPassword"},{type:"click",selector:".ios-button",name:"download_ios",handler:"__downloadIos"},{type:"click",selector:".android-button",name:"download_android",handler:"__downloadAndroid"}]},initialize:function(e){this.title=e.globalStringManager.get("welcome_login_dialog_signin"),void 0!==e.globalStringManager&&(this.__globalStringManager=e.globalStringManager),this.hasCloseButton=!!_.isUndefined(e.hasCloseButton)||e.hasCloseButton,this.__loginMode=e.loginMode,t.prototype.initialize.call(this,e),this.__loginCookieName=this.__serviceProvider.get("loginCookieName"),this.__cookieManager=this.__serviceProvider.get("cookieManager"),this.__hasSignupButton=!!_.isUndefined(e.hasSignupButton)||e.hasSignupButton,this.__loginUsername=this.__cookieManager.get("login_username")?this.__cookieManager.get("login_username"):"",this.__refreshOnLogin=e.refreshOnLogin||"mobile"===this.__serviceProvider.get("platform"),this.__loginDestination=e.loginDestination,this.shouldFocusOnPrimaryButton=!1,this.__socialLogin=this.__loginManager.getSocialLogin(),this.__socialLogin.checkLoginState(),this.__hadSocialLogin=this.__socialLogin.isLoggedIn(),this.__socialLogin.logout(),this.addToDOM()},postRender:function(){if(this.__loginUsername=void 0===this.__loginUsername?"":this.__loginUsername,this.__loginUsername="undefined"===this.__loginUsername?"":this.__loginUsername,this.__loginUsername=null===this.__loginUsername?"":this.__loginUsername,this.setContent("body",e.template,{username:this.__loginUsername,passwordHolderContent:this.__globalStringManager.get("login_dialog_forgot_credentials")}),this.$(".login_avatarname input").focus(),this.__loginUsername&&this.$(".login_password input").focus(),this.$(".login").toggleClass("can-signup",this.__hasSignupButton),this.__loginUsername){var t=this.$('input[name="avatarname"]').closest(".label[data-holder]");this.__insertLabelTemplate(t),t.hasClass("ignore-placeholder-behavior")||t.find(">.holder-label >.info").html(t.attr("data-holder"))}},__onLogin:function(t){null!==t&&t.preventDefault(),this.__leanplum.recordEvent("login_click",{mode:this.__loginMode}),t="true"===this.__cookieManager.get("accepted_all_cookies");var i=this.__socialLogin.isLoggedIn()?{email:this.__socialLogin.getProfileItem("email"),platform:"facebook_web",platform_token:this.__socialLogin.__fbAuthResponse.accessToken,platform_uid:this.__socialLogin.__fbAuthResponse.userID,gdpr_cookie_acceptance:t}:{username:this.$('[name="avatarname"]').val(),password:this.$('[name="password"]').val(),gdpr_cookie_acceptance:t};this.$("label.submit").addClass("loading"),this.__loginManager.performLoginFromCredentials(this.__serviceProvider,i).then(function(t){if(this.__restModelFactory.readModel(t.relations.user,e.UiCore.NodeModel).populated().then(function(e){this.__leanplum.recordEvent("welcome_login_success",{cid:e.get("legacy_cid").toString()})}.bind(this)),this.__googleAnalytics.recordSuccessfulAuthentication("true"),this.$("label.submit").removeClass("loading"),this.$(".error-message").removeClass("active").css("height",""),this.__cookieManager.set(this.__loginCookieName,"true"),this.__cookieManager.set("prefer_alloy","1"),this.__cookieManager.set("login_username",i.username),this.__cookieManager.set("password_changed","0"),this.__loginDestination)this.__window.location.href=this.__loginDestination;else if(this.__loginManager.getLoginDestination())this.__window.location.href=this.__loginManager.getLoginDestination();else if(this.__serviceProvider.services.overrideMode&&"ftux"!==this.__serviceProvider.services.overrideMode)t=this.__serviceProvider.get("siteRoot"),t+=this.__serviceProvider.get("startMode")+"/",this.__serviceProvider.services.startSubmode&&(t+=this.__urlId(this.serviceProvider.get("startSubmode"))+"/"),this.__window.location.href=t;else if(this.__refreshOnLogin)this.__window.location.reload();else{var n=this.__restModelFactory.readModel(t.relations.user,e.UiCore.NodeModel);n.populated().then(function(){return n.getEdgeCollection("preferences",e.UiCore.RestCollection)}.bind(this)).then(function(e){return this.__prefs=e,this.__prefs.populated()}.bind(this)).then(function(){for(var e=!1,t=0;t<this.__prefs.length;t++){var i=this.__prefs.at(t);"registered_through_alloy"!==i.get("name")&&"registered_through_mobile"!==i.get("name")&&"pure_mobile_access"!==i.get("name")||!i.get("value")||(e=!0,this.__window.location.reload())}e||(this.__window.location.href="/switch_to/classic/")}.bind(this))}}.bind(this),function(t){var i="credentials";t===this.__loginManager.ERROR_TRY_AGAIN_LATER?i="try-again-later":t===this.__loginManager.ERROR_DISABLED?i="disabled":t!==this.__loginManager.ERROR_UNDERAGE&&t!==this.__loginManager.ERROR_COOKIE_UNACCEPT&&t!==this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT||(i="disabled",this.__showPrivacyPolicyDialog(t)),this.__leanplum.recordEvent("welcome_login_error",{error:i}),e.NextUtil.DomHelper.radioClass(this.$(".error-message."+i),"active"),t=this.$(".error-message.active").height(),this.$(".error-message.active").css("height",0),this.$("label.submit").removeClass("loading"),this.$(".error-message.active").height(),this.$(".error-message.active").css("height",t)}.bind(this))},__onClickSignup:function(e){e.preventDefault(),this.__googleAnalytics.recordSignUpClick("login"),this.promiseResolver.resolve("signup"),this.__window.location.href="/welcome/ftux/gender/"},__onClickFB:function(){var e=function(){this.__onLogin(null)}.bind(this);this.hide(),this.__socialLogin.login(e)},__togglePasswordVisibility:function(){var e=this.$(".login_password input"),t="password"==e.attr("type");e[0].setAttribute("type",t?"text":"password"),this.$(".toggle-password-visibility").toggleClass("icon-password-show",!t).toggleClass("icon-password-hide",t),e.focus()},__forgotPassword:function(){this.__leanplum.recordEvent("welcome_login_forgot_password_click"),this.__window.location="/next/forgotpassword/"},__downloadIos:function(){this.__leanplum.recordEvent("welcome_login_download_ios_click")},__downloadAndroid:function(){this.__leanplum.recordEvent("welcome_login_download_android_click")},__onClose:function(e){t.prototype.__onClose.call(this,e),(!(e=-1!==this.__window.location.pathname.search("/welcome/ftux"))||e&&this.__hadSocialLogin)&&this.__modeManager.openMode({mode:{id:"ftux"},submode:{id:"__default__"}})},__showPrivacyPolicyDialog:function(t){var i=e.PrivacyPolicyAdultDialog;return t===this.__loginManager.ERROR_UNDERAGE?i=e.PrivacyPolicyMinorsDialog:t===this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT&&(i=e.PrivacyPolicyMinorsPendingDialog),this.__dialogManager.showDialog(i)}},e.InputMixin))}({Dialogs:e["@Dialogs"],NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],InputMixin:zn,Mixin:Bn,PrivacyPolicyMinorsDialog:Rn,PrivacyPolicyAdultDialog:Gn,PrivacyPolicyMinorsPendingDialog:Vn,template:An}),Kn=Te.extend("ReportUserDialog",{uiContextName:"report_user_dialog",className:"report-user-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager"],title:"report_user_title",text:"report_user_text",reportButton:"report_user_report",dropdownOptions:[{label:"report_user_reason_inappropriate_name",value:"name"},{label:"report_user_reason_inappropriate_image",value:"photo"},{label:"report_user_reason_inappropriate_tagline",value:"tagline"},{label:"report_user_reason_inappropriate_interest",value:"interest"}]}),Yn=function(e){var t=e.UiCore.UiContext;return t.extend("ProfileActionBar",{className:"action-bar profile-action-bar",uiContextName:"profile_action_bar",dependencies:"contextMenuManager dialogManager featureAccessManager globalStringManager googleAnalytics loginManager modeManager webGL window windowManager user".split(" "),trackedEvents:function(){return[{type:"click",selector:".action-more",name:"profile_action_more",handler:this.__moreAction},{type:"click",selector:".action-gift",name:"profile_action_gift",handler:this.__gift},{type:"click",selector:".action-message",name:"profile_action_message",handler:this.__messageAction},{type:"click",selector:".action-follow",name:"profile_action_follow",handler:this.__followUser}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__openContext=IMVU.optionalProperty(i,"openContext",null),this.__isLoggedIn=!!this.__loginManager.isLoggedIn(),this.__blockedUserModel=null,this.__isLoggedIn&&(this.__myself=this.__loginManager.getCurrentUser(),this.__friendManager=this.__serviceProvider.get("friendManager"),this.__blockedUsers=this.track(this.__myself.getEdgeCollection("blocked",e.UiCore.EdgeCollectionModel)),this.__blockedUsers.populated().then(function(){this.__blockedUserModel=this.__blockedUsers.find(function(e){return this.__user.id===e.node.id}.bind(this))}.bind(this)),this.listenTo(this,"message",this.__messageAction.bind(this)),this.listenTo(this,"gift",this.__gift.bind(this))),this.addToDOM()},render:function(){this.$el.html(e.template),this.createChildContext(e.Widgets.SocialShare,{$parentElement:this.$(".action-share-container"),linkToCopy:this.__getLinkToCopy()}),this.$(".action-more").prop("disabled",!this.__isLoggedIn),this.__followButton=this.createChildContext(e.Widgets.FollowButton,{$parentElement:this.$(".follow-container"),profileNode:this.__user.getSingleEdge("profile")})},__getLinkToCopy:function(){return location.protocol+"//imvu.com/"+this.__user.get("username")},__gift:function(t){this.__isLoggedIn?t&&$(t.currentTarget).hasClass("disabled")||this.__dialogManager.showDialog(e.ItemPickerDialog,{model:this.__user}).finished.then(function(){this.__close()}.bind(this)):this.__showLoginDialog("gift")},__messageAction:function(e){this.__isLoggedIn?e&&$(e.currentTarget).hasClass("disabled")||(this.__featureAccessManager.canSeeWindows()?this.__windowManager.addMessagesWindow("create_message",{model:"userPicker"}).composeMessageTo(this.__user):this.__modeManager.openMode({showAlways:!0,mode:{id:"messages",modelUrl:this.__user.get("username").replace("Guest_","")},submode:{id:"compose"}}).then(function(e){e.composeMessageTo(this.__user)}.bind(this)),this.__dialogManager.closeAll(),this.__close()):this.__showLoginDialog("message")},__followUser:function(){this.__isLoggedIn||this.__showLoginDialog()},__moreAction:function(t){this.__isLoggedIn?$(t.currentTarget).hasClass("disabled")||this.__user.populated().then(function(){var i=[];0===this.__user.get("persona_type")&&i.push({name:"chat",classNames:this.__user.get("online")?"":"disabled",text:this.__globalStringManager.get("Invite to Chat"),handler:this.__chatAction.bind(this,!this.__user.get("online"))}),this.__canSeeActions()&&i.push({name:"message",text:this.__globalStringManager.get("Message"),handler:this.__messageAction.bind(this),classNames:0!==this.__user.get("persona_type")?"disabled":""}),this.__user.relations.viewer_outbound_friend_request||(this.__user.relations.viewer_inbound_friend_request?(i.push({name:"friend_accept",text:this.__globalStringManager.get("Accept Friend Request"),handler:this.__friendAction.bind(this)}),i.push({name:"decline",text:this.__globalStringManager.get("Decline Friend Request"),handler:this.__declineFriendAction.bind(this)})):this.__user.relations.viewer_friend?i.push({name:"unfriend",text:this.__globalStringManager.get("Unfriend"),handler:this.__unfriendAction.bind(this)}):i.push({name:"friend_send",text:this.__globalStringManager.get("Add Friend"),handler:this.__friendAction.bind(this)})),this.__blockedUserModel?i.push({name:"unblock",text:this.__globalStringManager.get("Unblock"),handler:this.__unBlockAction.bind(this)}):i.push({name:"block_person",text:this.__globalStringManager.get("Block"),handler:this.__blockAction.bind(this)}),i.push({name:"report_person",text:this.__globalStringManager.get("Report"),handler:this.__reportAction.bind(this)}),this.__contextMenuManager.showMenu(t,e.ContextMenu,{items:i,displayOptions:{above:!0,right:!1}})}.bind(this)):this.__showLoginDialog()},__canSeeActions:function(){if(this.__openContext){for(var e=this.__openContext,t=["chat_now_submode","room_instance_submode"];e&&-1===t.indexOf(e.uiContextName);)e=e.getParentUiContext();return e&&this.__webGL.use3d()&&this.__activeChat}return!1},__chatAction:function(t){t||this.__user.populated().then(function(){if(this.__featureAccessManager.canSeeChooseRoomDialog())return this.__dialogManager.showDialog(e.ChooseRoomDialog,{user:this.__user});this.__chatManager.inviteUserToMyRoom(this.__user)}.bind(this))},__blockAction:function(t){this.__dialogManager.showDialog(e.BlockPersonDialog,{model:this.__user}).finished.then(function(){this.__close()}.bind(this))},__unBlockAction:function(t){this.__dialogManager.showDialog(e.UnBlockPersonDialog,{model:this.__user})},__reportAction:function(t){this.__dialogManager.showDialog(e.ReportUserDialog,{model:this.__user}).finished.then(function(){this.__close()}.bind(this))},__friendAction:function(e){if($(e.target).toggleClass("disabled",!0),this.__user.relations.viewer_friend||this.__user.relations.viewer_outbound_friend_request)throw Error("Tried to friend either myself or someone I've already friended!");this.__user.relations.viewer_inbound_friend_request?(this.__googleAnalytics.recordFriendRequest("accepted"),e=this.__friendManager.acceptFriendRequest(this.__user),this.$('li[data-menu-item="friend_accept"]').hide()):(this.__googleAnalytics.recordFriendRequest("sent"),e=this.__friendManager.addFriend(this.__user),this.$('li[data-menu-item="friend_send"]').hide()),e.then(function(){this.__user.invalidate()}.bind(this))},__unfriendAction:function(){this.__friendManager.unfriend(this.__user).then(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_generic_save_success_title"),text:this.__globalStringManager.get("dialog_generic_save_success_text")+this.__user.get("username").replace("Guest_","")+".",ok:this.__globalStringManager.get("dialog_generic_save_success_ok")})}.bind(this),function(e){this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_generic_save_cancelled_title"),text:this.__globalStringManager.get("dialog_generic_save_cancelled_text"),ok:this.__globalStringManager.get("dialog_generic_save_cancelled_ok")})}.bind(this))},__declineFriendAction:function(){this.__friendManager.rejectFriendRequest(this.__user).then(function(){this.__user.invalidate()}.bind(this))},__muteUser:function(){this.__activeChat.muteUser(this.__user),this.__close()},__unmuteUser:function(){this.__activeChat.unmuteUser(this.__user),this.__close()},__close:function(){this.trigger("close_dialog")},__showLoginDialog:function(t){t=t?IMVU.URI.build(this.__window.location.href,{action:t}):this.__window.location.href,this.__dialogManager.showDialog(e.LoginDialog,{stringManager:this.__globalStringManager,loginDestination:t})}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],BlockPersonDialog:Cn,ChooseRoomDialog:En,ContextMenu:A,ItemPickerDialog:Pn,ReportUserDialog:Kn,UnBlockPersonDialog:$n,LoginDialog:jn,template:bn}),Xn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='\n<div class="basic-info info-row">\n    <section class="age info-col">\n        <legend class="info-col-header title">\n            ';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"age",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='\n        </legend>\n        <div class="info-col-body">\n            ',((a=t.if.call(e,e&&e.age,{name:"if",hash:{},fn:this.program(2,n),inverse:this.program(4,n),data:n}))||0===a)&&(r+=a),r+='\n        </div>\n        <div class="info-col-footer">\n            '+o("function"==typeof(s=t.age_text||e&&e.age_text)?s.call(e,{name:"age_text",hash:{},data:n}):s)+'\n        </div>\n    </section>\n    <div class="vertical-divider"></div>\n    <section class="gender info-col">\n        <legend class="info-col-header title">\n            ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"gender",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='\n        </legend>\n        <div class="info-col-body">\n            <svg class="'+o("function"==typeof(s=t.gender_class||e&&e.gender_class)?s.call(e,{name:"gender_class",hash:{},data:n}):s)+'"><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-profile_'+o("function"==typeof(s=t.gender_class||e&&e.gender_class)?s.call(e,{name:"gender_class",hash:{},data:n}):s)+'"></svg>\n        </div>\n        <div class="info-col-footer">\n            '+o("function"==typeof(s=t.gender||e&&e.gender)?s.call(e,{name:"gender",hash:{},data:n}):s)+'\n        </div>\n    </section>\n    <div class="vertical-divider"></div>\n    <section class="location info-col">\n        <legend class="info-col-header title">\n            ',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"location",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='\n        </legend>\n        <div class="info-col-body">\n            ',((a=t.if.call(e,e&&e.location_flag_shown,{name:"if",hash:{},fn:this.program(6,n),inverse:this.program(8,n),data:n}))||0===a)&&(r+=a),r+='\n        </div>\n        <div class="info-col-footer ',((a=t.unless.call(e,e&&e.location_flag_shown,{name:"unless",hash:{},fn:this.program(10,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+'">\n            '+o("function"==typeof(s=t.location||e&&e.location)?s.call(e,{name:"location",hash:{},data:n}):s)+"\n        </div>\n    </section>\n</div>\n"},2:function(e,t,i,n){var a;return"\n                "+(0,this.escapeExpression)("function"==typeof(a=t.age||e&&e.age)?a.call(e,{name:"age",hash:{},data:n}):a)+"\n            "},4:function(){return'\n                <svg><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-profile_birthday"></svg>\n            '},6:function(e,t,i,n){var a;return"\n                "+(0,this.escapeExpression)("function"==typeof(a=t.location_flag||e&&e.location_flag)?a.call(e,{name:"location_flag",hash:{},data:n}):a)+"\n            "},8:function(e,t,i,n){var a;return'\n            <svg class="'+(i=this.escapeExpression)("function"==typeof(a=t.location_class||e&&e.location_class)?a.call(e,{name:"location_class",hash:{},data:n}):a)+'"><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-profile_'+i("function"==typeof(a=t.location_class||e&&e.location_class)?a.call(e,{name:"location_class",hash:{},data:n}):a)+'"></svg>\n            '},10:function(){return" location-hidden "},12:function(e,t,i,n){var a,s,o=this.escapeExpression;return i=t.helperMissing,o='\n<div class="current-room info-row '+o("function"==typeof(s=t.current_room_class||e&&e.current_room_class)?s.call(e,{name:"current_room_class",hash:{},data:n}):s)+'">\n    <div class="horizontal-divider"></div>\n    <legend class="title">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"current room",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+='</legend>\n    <section class="content">\n        ',((a=t.if.call(e,e&&e.current_room_shown,{name:"if",hash:{},fn:this.program(13,n),inverse:this.program(15,n),data:n}))||0===a)&&(o+=a),o+"\n    </section>\n</div>\n"},13:function(){return'\n            <div class="room-image"></div>\n            <div class="room-name"></div>\n        '},15:function(e,t,i,n){var a;return"\n            "+(0,this.escapeExpression)("function"==typeof(a=t.current_room_placeholder||e&&e.current_room_placeholder)?a.call(e,{name:"current_room_placeholder",hash:{},data:n}):a)+"\n        "},17:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r='\n<div class="bio info-row '+i("function"==typeof(s=t.bio_class||e&&e.bio_class)?s.call(e,{name:"bio_class",hash:{},data:n}):s)+'">\n    <div class="horizontal-divider"></div>\n    <legend class="title">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"bio",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+'</legend>\n    <section class="content">\n        '+i("function"==typeof(s=t.bio||e&&e.bio)?s.call(e,{name:"bio",hash:{},data:n}):s)+"\n    </section>\n</div>\n"},19:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r='\n<div class="interests info-row '+i("function"==typeof(s=t.interests_class||e&&e.interests_class)?s.call(e,{name:"interests_class",hash:{},data:n}):s)+'">\n    <div class="horizontal-divider"></div>\n    <legend class="title">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"interests",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+'</legend>\n    <section class="content">\n        '+i("function"==typeof(s=t.interests||e&&e.interests)?s.call(e,{name:"interests",hash:{},data:n}):s)+"\n    </section>\n</div>\n"},21:function(e,t,i,n){var a,s,o=this.escapeExpression;return i=t.helperMissing,o='\n<div class="affinity info-row '+o("function"==typeof(s=t.affinity_class||e&&e.affinity_class)?s.call(e,{name:"affinity_class",hash:{},data:n}):s)+'">\n    <div class="horizontal-divider"></div>\n    <legend class="title">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"affinity",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+='</legend>\n    <section class="content">\n        ',((a=t.if.call(e,e&&e.relationship_status_shown,{name:"if",hash:{},fn:this.program(22,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+="\n        ",((a=t.if.call(e,e&&e.looking_for_shown,{name:"if",hash:{},fn:this.program(24,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+"\n    </section>\n</div>\n"},22:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r='\n            <div class="affinity-row relationship '+i("function"==typeof(s=t.relationship_status_class||e&&e.relationship_status_class)?s.call(e,{name:"relationship_status_class",hash:{},data:n}):s)+'">\n                <span class="affinity-title">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"relationship",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+':</span>\n                <span class="affinity-text relationship">'+i("function"==typeof(s=t.relationship_status||e&&e.relationship_status)?s.call(e,{name:"relationship_status",hash:{},data:n}):s)+"</span>\n            </div>\n        "},24:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r='\n            <div class="affinity-row looking-for '+i("function"==typeof(s=t.looking_for_class||e&&e.looking_for_class)?s.call(e,{name:"looking_for_class",hash:{},data:n}):s)+'">\n                <span class="affinity-title">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"here for",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+':</span>\n                <span class="affinity-text herefor">'+i("function"==typeof(s=t.looking_for||e&&e.looking_for)?s.call(e,{name:"looking_for",hash:{},data:n}):s)+"</span>\n            </div>\n        "},26:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='\n<div class="member-since info-row">\n    <div class="horizontal-divider"></div>\n    <legend class="title">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"profile_about_member_since",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+'</legend>\n    <section class="content">\n        '+o("function"==typeof(s=t.member_since||e&&e.member_since)?s.call(e,{name:"member_since",hash:{},data:n}):s)+"\n    </section>\n</div>\n"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i="",((a=t.if.call(e,e&&e.isLoggedIn,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n",((a=t.if.call(e,e&&e.current_room_section_shown,{name:"if",hash:{},fn:this.program(12,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n",((a=t.if.call(e,e&&e.bio_shown,{name:"if",hash:{},fn:this.program(17,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n",((a=t.if.call(e,e&&e.interests_shown,{name:"if",hash:{},fn:this.program(19,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n",((a=t.if.call(e,e&&e.affinity_shown,{name:"if",hash:{},fn:this.program(21,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n",((a=t.if.call(e,e&&e.member_since,{name:"if",hash:{},fn:this.program(26,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i},useData:!0})}(),Jn=function(e){var t=e.UiCore.UiContext;return t.extend("ProfileAbout",{className:"profile-about",uiContextName:"profile_about",dependencies:["globalStringManager","imageManager","loginManager","prefsManager","user"],trackedEvents:function(){return[{type:"click",selector:".current-room .room-name, .current-room .room-image",name:"current_room",handler:"__joinRoom"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__isMyself=!1,(this.__isLoggedIn=this.__loginManager.isLoggedIn())&&(this.__myself=this.track(this.__loginManager.getCurrentUser()),this.__user===this.__myself&&(this.__isMyself=!0)),this.shown={age:!0,gender:!0,current_room:!0,location:!0},this.__isMyself?this.__prefsManager.populated().then(function(){this.shown.age=this.__prefsManager.getBool("avwidget_show_age",!0),this.shown.gender=this.__prefsManager.getBool("avwidget_show_gender",!0),this.shown.location=this.__prefsManager.getBool("avwidget_show_geo_location",!0),this.shown.current_room=!this.__prefsManager.getBool("client.is_current_location_hidden",!1),this.addToDOM()}.bind(this)):this.addToDOM()},render:function(){t.prototype.render.call(this),this.__showProfile(),this.__user.on("change reset change:relations",this.__showProfile,this)},__showProfile:function(){var t={relationship_status:null!==this.__user.get("relationship_status")?this.__globalStringManager.get("relationship_status_"+this.__user.get("relationship_status")):null,looking_for:null!==this.__user.get("looking_for")?this.__globalStringManager.get("looking_for_"+this.__user.get("looking_for")):null,member_since:null!==this.__user.get("created")?new Date(this.__user.get("created")).toLocaleDateString():null};if(t.bio=this.__user.get("tagline")?this.__user.get("tagline"):this.__globalStringManager.get("profile_bio"),t.bio_class=this.__user.get("tagline")?"":"empty",t.bio_shown=!!this.__user.get("tagline")||!!this.__isMyself,t.interests=this.__user.get("interests")?this.__user.get("interests"):this.__globalStringManager.get("profile_interests"),t.interests_class=this.__user.get("interests")?"":"empty",t.interests_shown=!!this.__user.get("interests")||!!this.__isMyself,0===this.__user.get("looking_for")&&0===this.__user.get("relationship_status")?(t.affinity_class="empty",t.affinity_shown=!!this.__isMyself):(t.affinity_class="",t.affinity_shown=!0),t.looking_for_shown=0!==this.__user.get("looking_for")||!!this.__isMyself,t.relationship_status_shown=0!==this.__user.get("relationship_status")||!!this.__isMyself,t.looking_for_class=0===this.__user.get("looking_for")?"empty":"",t.relationship_status_class=0===this.__user.get("relationship_status")?"empty":"",t.isLoggedIn=this.__isLoggedIn){t.age=this.__isMyself&&!this.shown.age||null===this.__user.get("age")?null:this.__user.get("age"),t.age_text=null===t.age?this.__globalStringManager.get("hidden"):this.__globalStringManager.get("profile_about_age_description");var i=this.__isMyself&&!this.shown.gender||null===this.__user.get("gender")?null:this.__user.get("gender");null===i?(t.gender=this.__globalStringManager.get("hidden"),t.gender_class="gender_hidden"):(t.gender=this.__globalStringManager.get("gender_"+this.__user.get("gender")),t.gender_class="f"===i?"female_new":"male_new"),null===(this.__isMyself&&!this.shown.location||null===this.__user.get("country")?null:this.__user.get("country"))?(t.location=this.__globalStringManager.get("hidden"),t.location_class="location_hidden",t.location_flag_shown=!1):(t.location=this.__user.get("country"),t.location_flag=this.__countryCodeToEmoji(this.__user.get("country")),t.location_flag_shown=!0,"US"===this.__user.get("country")&&this.__user.get("state")&&(t.location=this.__user.get("state")+", "+t.location),t.location_class="")}t.is_in_chat_room=!!this.__user.relations.current_room,t.current_room_section_shown=t.is_in_chat_room||this.__isMyself,t.current_room_placeholder=this.shown.current_room?this.__globalStringManager.get("profile_current_room_shown_placeholder"):this.__globalStringManager.get("profile_current_room_hidden_placeholder"),t.current_room_shown=this.__isMyself?t.is_in_chat_room&&this.shown.current_room:t.is_in_chat_room,this.$el.html(e.template(t)),t.current_room_shown&&(this.$(".current-room").hide(),this.__roomModel=this.__user.getSingleEdge("current_room"),this.__roomModel.populated().then(function(){this.$(".current-room .room-name").text(this.__roomModel.get("name")),"AP"===this.__roomModel.get("rating")&&this.$(".current-room").addClass("is-ap"),this.__imageManager.loadAsBackgroundImage(this.$(".current-room .room-image"),this.__roomModel.get("themed_image_url")||this.__roomModel.get("image_url")),this.$(".current-room").show()}.bind(this)))},__joinRoom:function(){this.__chatManager=this.__serviceProvider.get("chatManager"),this.__chatManager.goToRoom(this.__roomModel,!0)},__countryCodeToEmoji:function(e){return e.toUpperCase().replace(/[A-Z]/g,function(e){return String.fromCodePoint(e.charCodeAt(0)+127397)})},delete:function(){t.prototype.delete.call(this),this.__user&&this.__user.off(void 0,void 0,this)}})}({UiCore:e["@UiCore"],template:Xn}),Zn=function(e){var t=e.LightboxDialog;return t.extend("ProfileLightbox",{uiContextName:"profile_lightbox",className:"profile-lightbox lightbox-dialog",dependencies:"dialogManager globalStringManager loginManager modeManager platform user".split(" "),trackedEvents:function(){return t.prototype.trackedEvents.call(this).concat([{type:"click",selector:".edit-profile",name:"edit_profile",handler:"__openEditProfileDialog"}])},initialize:function(i){t.prototype.initialize.call(this,i),this.linkToDetailsSubmode("profile",this.__user),this.__isMobile="mobile"===this.__platform,this.__isLoggedIn=!!this.__loginManager.isLoggedIn(),this.__isMyself=!1,this.__isLoggedIn&&(this.__myself=this.__loginManager.getCurrentUser(),this.__user.id===this.__myself.id&&(this.__isMyself=!0)),this.__showEditButton(),this.addWidgetToMainContainer(e.ProfileLook,{user:this.__user,isColumnView:!1}),this.addWidgetToHeadpiece(e.ProfileHeadpiece,{user:this.__user}),this.__isMyself||(this.__actionBar=this.addWidgetToHeadpiece(e.ProfileActionBar,{user:this.__user}),this.listenTo(this.__actionBar,"close_dialog",this.__close.bind(this))),this.modeNavSimpleScroller=this.createChildContext(e.SimpleScroller,_.extend({$replaceElement:this.$(".simple-scroller-placeholder"),$target:this.$(".sticky-content .nav-container")})),this.addWidgetToSidebarPanel(e.ProfileAbout,{addCounter:!1,user:this.__user},"about"),this.addWidgetToSidebarPanel(e.ProfilePosts,{addCounter:!1,user:this.__user},"posts"),this.__profile=this.__user.getSingleEdge("profile"),this.__profile.populated().then(function(){this.__followersCollection=this.__profile.searchEdgeCollection("subscribers",{limit:50},e.UiCore.EdgeCollection),this.__followingsCollection=this.__profile.searchEdgeCollection("subscriptions",{limit:50},e.UiCore.EdgeCollection),this.addWidgetToSidebarPanel(e.ProfileUserList,{addCounter:!0,manuallyPage:!0,node:this.__profile,context:"subscribers"},"followers"),this.$(".counter-followers").text(this.__followersCollection.total_count),this.addWidgetToSidebarPanel(e.ProfileUserList,{addCounter:!0,manuallyPage:!0,node:this.__profile,context:"subscriptions"},"followings"),this.$(".counter-followings").text(this.__followingsCollection.total_count),this.__isMyself&&(this.__friendsCollection=this.track(this.__user.searchEdgeCollection("friends",{limit:50,sortby:"name"},e.UiCore.EdgeCollection)),this.addWidgetToSidebarPanel(e.ProfileUserList,{addCounter:!0,manuallyPage:!0,node:this.__user,context:"friends"},"friends"),this.$(".counter-friends").text(this.__friendsCollection.total_count)),this.__isMobile&&this.__showHeader()}.bind(this))},refreshSize:function(){if(t.prototype.refreshSize.call(this),this.__isMobile){var e=$(this.__window).height(),i=this.$(".main-container").height();i=Math.max(414,i);this.$(".main-container").css({width:"100%",height:i}),this.$(".lightbox-sidebar").css({height:e+240,"margin-top":-240-i,"padding-top":i})}},__showEditButton:function(){this.$(".dialog-header").before(e.EditButtonTemplate({})),this.$(".edit-profile").toggleClass("invisible",!this.__isMyself)},__openEditProfileDialog:function(){this.__dialogManager.showDialog(e.EditProfileDialog,{})},__close:function(){this.delete()},__onMobileScroll:function(){var e=this.$(".headpiece .sticky-container-wrap"),t=this.$(".sticky-container"),i=e.offset().top<=this.$(".lightbox").offset().top+this.$(".dialog-header").height();this.$(".dialog-header").toggleClass("non-transparent",i),this.$(".dialog-title").toggleClass("hidden",!i),this.__stickyHeadpieceEnabled?i||(t.detach().appendTo(e),e.css({height:"auto"}),this.__stickyHeadpieceEnabled=!1):i&&(e.css({height:e.height()}),t.detach().appendTo(this.$(".mobile-overlay")),this.__stickyHeadpieceEnabled=!0)},__showHeader:function(){this.$(".dialog-title").toggleClass("hidden",!0),this.$(".dialog-title").text(this.__user.get("display_name")),this.$(".dialog-header").prepend(this.$("a.dialog-x")),this.$(".dialog-header").append(this.$("a.edit-profile")),this.showHeader()}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],ProfileAbout:Jn,ProfileActionBar:Yn,ProfileHeadpiece:vn,ProfileLook:Oi,ProfilePosts:Qi,ProfileUserList:mn,SimpleScroller:Pe,LightboxDialog:x,EditProfileDialog:on,FriendsListItem:ln,EditButtonTemplate:zi}),Qn=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){return i=t.helperMissing,'<div class="panels">\n    <div class="feed-detail-left-panel">\n        <img class="feed-detail-image"/>\n        <img class="image-load-placeholder"/>\n        <div class="feed-detail-text">\n            <div class=\'message\'></div>\n\t    <div class=\'toggle\'></div>\n        </div>\n    </div>\n    <div class="feed-detail-right-panel">\n        <div class="feed-detail-body">\n            <div class="summary">\n                <div class="feed-detail-with"></div>\n                <ul class="feed-action-bar-placeholder"></ul>\n            </div>\n            <div class="segmented-control-container">\n                <div class="segmented-control-placeholder"></div>\n                <div class="magic-line"></div>\n            </div>\n            <div class="tab-containers">\n                <div class="tab-container" data-tab="comments">\n                    <div class="scroller">\n                        <div class="comment-list-placeholder"></div>\n                    </div>\n                </div>\n                <div class="tab-container" data-tab="likes">\n                    <div class="scroller">\n                        <div class="likes-list-placeholder"></div>\n                    </div>\n                </div>\n                <div class="tab-container" data-tab="tags">\n                    <div class="scroller">\n                        <div class="notation no-results">'+(0,this.escapeExpression)((t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"no_feed_tags",{name:"i18n-g",hash:{},data:n}))+'</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="mobile-chat-bar"></div>\n</div>\n'},useData:!0})}(),ea=function(e){function t(e){var t={};return 0<e.length&&(e=(e=e.substring(1)).split("&"),_.each(e,function(e){var n=e.split("=");if(e=void 0!==n[0]?decodeURIComponent(n[0].replace(/\+/g,"%20")):"",n=void 0!==n[1]?decodeURIComponent(n[1].replace(/\+/g,"%20")):"",i.test(e))if(i.exec(e)[1]){var a=e.replace(i,"");a in t||(t[a]={}),t[a][i.exec(e)[1]]=n}else(e=e.replace(i,""))in t||(t[e]=[]),t[e].push(n);else t[e]=n})),t}var i=/\[(.*?)\]/;return{fetch:function(e,i){var n=t(e.location.search),a=_.pick(n,i),s=(n=_.omit(n,i),e.location.pathname);return _.size(n)&&(s+="?"+$.param(n)),e.history.replaceState(e.history.state,document.title,s),a},get:function(e,i){return t(e.location.search)[i]},getAllParams:t}}(),ta=function(e){return IMVU.BaseClass.extend("LoginManager",{dependencies:"root rest restModelFactory random Promise uiEventReporter timer window".split(" "),enablePing:!0,pingImmediately:!0,initialize:function(e){this.__serviceProvider=e.serviceProvider,this.root=e.root,this.rest=e.rest,this.restModelFactory=e.restModelFactory,this.random=e.random,this.Promise=e.Promise,this.timer=e.timer,this.uiEventReporter=e.uiEventReporter,this.enablePing=IMVU.optionalProperty(e,"enablePing",this.enablePing),this.__pingTimeout=null,this.userURL=void 0,this.__setClientSession(),this.__logoutWorkItems=[],this.addLogoutWork(this.uiEventReporter.flush,this.uiEventReporter),this.__window=e.window},delete:function(){this.timer.clearTimeout(this.__pingTimeout)},__ping:function(){this.enablePing&&(this.__loginModel.getSingleEdge("user").save({online:!0}),this.__pingTimeout=this.timer.setTimeout(this.__ping.bind(this),11e4))},createFromCookie:function(){return new this.Promise(function(t){this.__loginModel=this.restModelFactory.readModel(this.root+"/login/me",e.UiCore.NodeModel),this.__loginModel.populated().then(function(){null===this.__pingTimeout&&(this.pingImmediately?this.__ping():this.__pingTimeout=this.timer.setTimeout(this.__ping.bind(this),11e4)),this.__serviceProvider.register("sauce",this.__loginModel.get("sauce")),t.resolve(this.__loginModel)}.bind(this)).catch(function(e){this.__serviceProvider.get("modelCache").release(this.__loginModel),t.reject(e)}.bind(this))}.bind(this))},createFromCredentials:function(t,i){return(i=_.clone(i||{})).wait=!0,new this.Promise(function(i){var n=function(t,n,a){void 0===t?(this.__loginModel=this.restModelFactory.readModel(n.data.id,e.UiCore.NodeModel),this.__loginModel.populated().then(function(){this.__serviceProvider.register("sauce",n.data.sauce),i.resolve(this.__loginModel)}.bind(this)).catch(function(e){i.reject(e)},this.__loginModel)):i.reject(t)}.bind(this);this.rest.post(this.root+"/login",t,n)}.bind(this))},getCurrent:function(){return this.__loginModel},addLogoutWork:function(e,t){this.__logoutWorkItems.push([e,t])},logout:function(){return this.timer.clearTimeout(this.__pingTimeout),new this.Promise(function(e){this.Promise.every(_.map(this.__logoutWorkItems,function(e){return e[0].bind(e[1])()})).then(function(){return this.rest.delete(this.__loginModel.id)}.bind(this)).then(function(t){this.__loginModel=void 0,e.resolve()}.bind(this)).catch(function(t){e.reject(t)}.bind(this))}.bind(this))},__setClientSession:function(){var e=new Date;e="client_"+this.random.getInteger(100,1e4).toString(36).substr(2,16)+e.getTime();document.cookie="client_session="+escape(e)+";domain="+(-1!==this.root.indexOf("localhost"))?"localhost.":"imvu.com;path=/"}})}({UiCore:e["@UiCore"],QueryParams:ea}),ia=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return" with-filler-inner-pad-left"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return i='<div class="with-filler-outer"><div class="with-filler-inner',((a=t.if.call(e,e&&e.padLeft,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+='">',((a="function"==typeof(s=t.theFiller||e&&e.theFiller)?s.call(e,{name:"theFiller",hash:{},data:n}):s)||0===a)&&(i+=a),i+"</div></div>"},useData:!0})}(),na=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="tags-list-item-header">\n    <div class="dual-name-goes-here"></div>\n    <button class="buy-look-btn btn-ghost btn-strokeless">buy look</button>\n</div>\n<div class="tags-list-item-products"></div>\n<div class="notation no-products">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"no_products",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>"},useData:!0})}(),aa=function(t){var i={UiCore:e["@UiCore"],ShoppingTile:l}.ShoppingTile;return i.extend("SmallShoppingTile",{className:"tile product-tile small-shopping-tile",__getDetails:function(){var e=i.prototype.__getDetails.call(this);return e.showName=!1,e.removeButton=!0,e.infoButton=!0,e}})}(),sa=function(e){var t=e.UiCore.ListPresenter;return t.extend("ProductList",{uiContextName:"product_list",className:"product-list",initialize:function(i){this.itemFactory=e.SmallShoppingTile,t.prototype.initialize.call(this,i)}})}({UiCore:e["@UiCore"],SmallShoppingTile:aa}),oa=function(e){var t=e.UiCore.UiContext;return t.extend("TagsListItem",{uiContextName:"tags_list_item",className:"tags-list-item",tagName:"li",dependencies:["restModelFactory","Promise","serviceProvider","dialogManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".buy-look-btn",name:"buy_look",handler:this.__buyLook}]},initialize:function(e){t.prototype.initialize.call(this,e),this.model=IMVU.requireProperty(e,"model"),this.__restModelFactory=e.restModelFactory,this.__Promise=e.Promise,this.__dialogManager=e.dialogManager,this.__globalStringManager=e.globalStringManager,this.addToDOM()},delete:function(){this.__products&&this.__products.each(function(e){e.off("change:is_owned",this.__updateBuyButton,this)}.bind(this)),t.prototype.delete.call(this)},render:function(){this.$el.html(e.template),this.__userModel=this.__restModelFactory.readModel(this.model.get("id"),e.UiCore.NodeModel),this._dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".dual-name-goes-here"),user:this.__userModel,size:"small",ignoreClicks:!0,hideDisplay:!1,displayArgs:{color:"light",size:"small"},hideAtAvatar:!0});var t=this.model.get("products");t&&t.length&&(this.$el.addClass("loading"),this.__products=new IMVU.NamedCollection,this.__Promise.every(_.map(t,function(t){var i=this.__restModelFactory.readModel(t,e.Model.ProductNode);return i.populated().then(function(){return i.getSingleEdge("creator").populated()}.bind(this)).then(function(){this.__products.add(i)}.bind(this)).catch(function(){return this.__Promise.accept()}.bind(this))}.bind(this))).then(function(){this.$el.removeClass("loading"),this.__products.length&&(this.productList=this.createChildContext(e.ProductList,{$parentElement:this.$(".tags-list-item-products"),collection:this.__products}),this.simpleScroller=this.createChildContext(e.SimpleScroller,{$parentElement:this.$(".tags-list-item-products"),$target:this.productList.$el}),this.on("shown",function(){this.simpleScroller.refreshScrollability()}.bind(this)),this.__updateBuyButton(),this.__products.each(function(e){e.on("change:is_owned",this.__updateBuyButton,this)}.bind(this)))}.bind(this)))},__updateBuyButton:function(){this.$(".buy-look-btn").toggleClass("visible",0<this.__unownedProducts().length)},__unownedProducts:function(){return this.__products.filter(function(e){return!e.get("is_owned")})},__buyLook:function(){this.__dialogManager.showDialog(e.Checkout.CheckoutDialog,{cart:new e.Checkout.CartCollection(this.__unownedProducts()),successOk:this.__globalStringManager.get("OK")})}})}({UiCore:e["@UiCore"],Checkout:e["@Checkout"],Model:e["@Model"],Widgets:e["@Widgets"],ProductList:sa,SimpleScroller:Pe,template:na}),ra=function(e){var t=e.UiCore.ListPresenter;return t.extend("TagsList",{uiContextName:"tags_list",className:"tags-list",initialize:function(i){this.itemFactory=e.TagsListItem,t.prototype.initialize.call(this,i),this.on("selected",function(){_.each(this.__childContexts,function(e){e.simpleScroller&&e.simpleScroller.refreshScrollability()})}.bind(this))}})}({UiCore:e["@UiCore"],TagsListItem:oa}),la=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="user-info">\n    <h1 class="username"></h1>\n</div>\n'},useData:!0})}(),da=function(e){var t=e.UiCore.UiContext;return t.extend("LikedByListItem",{uiContextName:"liked_by_list_item",tagName:"article",className:"liked-by-list-item",dependencies:["model","cardManager"],trackedEvents:function(){return[{type:"click",name:"liked_by_list_item_show_profile",handler:this.__onClickTile.bind(this)}]},initialize:function(e){this.__model=e.model,this.__cardManager=e.cardManager,t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.hide(),this.__model.populated().then(function(){this.show(),this.$el.html(e.template),t.prototype.render.call(this),this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".username"),user:this.__model.node,configuration:"small-dual-darkbg"})}.bind(this)).catch(function(e){this.hide()}.bind(this))},__onClickTile:function(){this.__cardManager.showUserProfileCard({user:this.model.node,context:"likedbylist"})}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:la}),ca=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("FeedLikeList",{uiContextName:"liked_by_list",className:"liked-by-list",tagName:"section",itemFactory:e.LikedByListItem,dependencies:["globalStringManager"],initialize:function(e){e.collection.models=this._selectValidItems(e.collection.models),this.__globalStringManager=e.globalStringManager,t.prototype.initialize.call(this,e)},_selectValidItems:function(e){return _.filter(e,function(e){return!e.node.isError()})},__emptyText:function(){return{standard:this.__globalStringManager.get("no_feed_likes"),concise:this.__globalStringManager.get("no_feed_likes")}}})}({Widgets:e["@Widgets"],LikedByListItem:da}),ha=function(e){var t=e.UiCore.UiContext;return t.extend("FeedDetailWidget",{className:"feed-detail-widget",uiContextName:"feed_detail_widget",dependencies:"defer dialogManager featureAccessManager globalStringManager imageManager loginManager platform Promise restModelFactory timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:".segmented-control-item[data-value=comments]",name:"comments_tab",handler:this.__selectTab.bind(this,"comments")},{type:"click",selector:".segmented-control-item[data-value=likes]",name:"likes_tab",handler:this.__selectTab.bind(this,"likes")},{type:"click",selector:".segmented-control-item[data-value=tags]",name:"tags_tab",handler:this.__selectTab.bind(this,"tags")},{type:"click",selector:".tab-container[data-tab=comments] .more",name:"more_comments",handler:this.__viewMoreComments},{type:"click",selector:".tab-container[data-tab=likes] .more",name:"more_likes",handler:this.__viewMoreLikes},e.NextUtil.DomHelper.trackDoubleclick({selector:".feed-detail-left-panel:not(.error)",name:"doubleclick_like",handler:this.__like}),{type:"click",selector:".tab-container[data-tab=likes] .more",name:"more_likes",handler:this.__viewMoreLikes}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__imageManager=e.imageManager,this.__restModelFactory=e.restModelFactory,this.__Promise=e.Promise,this.__globalStringManager=e.globalStringManager,this.__feedType=e.feedType,this.__timer=e.timer,this.__defer=e.defer,this.__platform=e.platform,this.__dialogManager=e.dialogManager,e.loginManager.isLoggedIn()?(this.__isLoggedIn=!0,this.__myself=e.loginManager.getCurrentUser()):this.__isLoggedIn=!1,this.__photoFadeDelay=e.photoFadeDelay||150,this.__startingTab=e.tab||"comments",this.__focusComments=e.focusComments,(e.tab||this.__focusComments)&&(this.__shouldScrollToTabs=!0),this.__tabContexts={},this.model=this.track(IMVU.requireProperty(e,"model")),"mobile"!==this.__serviceProvider.get("platform")&&!1!==e.darkTheme&&this.$el.addClass("dark-theme"),this.addToDOM()},delete:function(){this.__fadeTimer&&this.__timer.clearTimeout(this.__fadeTimer),this.__likes&&this.__likes.off(void 0,void 0,this),this.__commentsCollection&&this.__displayLikesAndComments&&this.__commentsCollection.off(void 0,void 0,this),this.__timer.clearTimeout(this.__scrollToTabsTimeout),t.prototype.delete.call(this)},__updateComments:function(){this.__setTabCount("comments",this.__commentsCollection.total_count),this.__featureAccessManager.canSeeFeedLightboxRedesign()||this.$(".tab-container[data-tab=comments] .more").toggle(!!this.__commentsCollection.hasNextPage())},__updateLikes:function(){this.__setTabCount("likes",this.__likes.total_count),this.__featureAccessManager.canSeeFeedLightboxRedesign()||this.$(".tab-container[data-tab=likes] .more").toggle(!!this.__likes.hasNextPage())},__setTabCount:function(e,t){this.counters[e].update(t)},__setupTabs:function(){this.segmentedControl=this.createChildContext(e.SegmentedControl,{$replaceElement:this.$(".segmented-control-placeholder"),name:"tabs",options:{comments:"",likes:"",tags:""}});var t=this.segmentedControl.$(".segmented-control-item");this.counters={comments:this.createChildContext(e.Counter,{$parentElement:t.eq(0),count:0,name:"comment"}),likes:this.createChildContext(e.Counter,{$parentElement:t.eq(1),count:0,name:"like"}),tags:this.createChildContext(e.Counter,{$parentElement:t.eq(2),count:0,name:this.__featureAccessManager.canSeeFeedLightboxRedesign()?"redesign_tag":"tag"})}},render:function(){this.$el.html(e.template({isMobile:"mobile"===this.__serviceProvider.get("platform")})),this.__setLoading(!0),this.createChildContext(e.FeedHeadpiece,{model:this.model,$prependElement:this.$(".summary")}),this.__actionBar=this.createChildContext(this.__featureAccessManager.canSeeFeedLightboxRedesign()?e.ActionBar:e.FeedActionBar,{model:this.model,$replaceElement:this.$(".feed-action-bar-placeholder"),feedType:this.__feedType}),this.__actionBar.on("action-comments",this.showAndFocusComments.bind(this)),this.__actionBar.on("item-reported",this.trigger.bind(this,"item-reported")),this.model.populated().then(function(){this.__actor=this.track(this.model.getSingleEdge("actor"));var t="photo"===this.model.get("type");this.$el.toggleClass("is-photo",t),this.__setupTabs(),t?this.__renderPhoto():this.__renderText(),this.$(".tab-container > .scroller").scrollbar(),t&&this.__showTags(),(this.__displayLikesAndComments=this.__loginManager.isLoggedIn())&&(this.__showLikes(),this.__showComments()),this.chatBar=this.createChildContext(e.ChatBar,{$parentElement:"mobile"===this.__platform?this.$(".mobile-chat-bar"):this.$(".tab-container[data-tab=comments]"),placeholder:this.__globalStringManager.get("add_a_comment")}),this.__displayLikesAndComments&&this.chatBar.on("sendInput",this.__sendComment.bind(this)),this.__focusComments?this.showAndFocusComments():this.__shouldScrollToTabs&&this.__displayLikesAndComments&&this.__scrollToTabs(),this.__selectTab(this.__startingTab),"comments"===this.__startingTab&&this.__displayLikesAndComments&&this.__commentsCollection.populated().then(this.__scrollToLastComment.bind(this)),this.__isLoggedIn||(this.$(".segmented-control-item[data-value=comments]").on("click",function(e){this.__forceLoginStopProp(e)}.bind(this)),this.$(".segmented-control-item[data-value=likes]").on("click",function(e){this.__forceLoginStopProp(e)}.bind(this)),this.$(".segmented-control-item[data-value=tags]").on("click",function(e){this.__forceLoginStopProp(e)}.bind(this)),this.$(".tab-container").on("click",function(e){this.__forceLoginStopProp(e)}.bind(this)),this.$(".tab-container[data-tab=comments] .more").on("click",function(e){this.__forceLoginStopProp(e)}.bind(this)),this.$(".tab-container[data-tab=likes] .more").on("click",function(e){this.__forceLoginStopProp(e)}.bind(this)),this.$(".action-like-container").on("click",function(e){this.__forceLoginStopProp(e)}.bind(this)),this.$(".action-share-container").on("click",function(e){this.__forceLoginStopProp(e)}.bind(this)),this.$(".action-more-container").on("click",function(e){this.__forceLoginStopProp(e)}.bind(this)),this.$(".feed-detail-image").on("click",function(e){this.__forceLoginStopProp(e)}.bind(this)))}.bind(this))},__forceLoginStopProp:function(t){this.__isLoggedIn||(this.__dialogManager.showDialog(e.LoginDialog,{stringManager:this.__globalStringManager,loginDestination:this.__window.location||this.__window.location.href}),t.stopPropagation())},showAndFocusComments:function(){this.__selectTab("comments"),this.chatBar.$(".input-text").focus()},__setLoading:function(e){this.$(".feed-detail-left-panel").toggleClass("loading",e)},__sizePhotoPlaceholder:function(){var e=$('<canvas width="'+this.model.get("payload.width")+'" height="'+this.model.get("payload.height")+'"></canvas>');this.$(".image-load-placeholder").attr("src",e.get(0).toDataURL("image/jpeg"))},__selectTab:function(t){this.segmentedControl.val(t),e.NextUtil.DomHelper.radioClass(this.$("[data-tab="+t+"]"),"selected"),this.chatBar&&this.chatBar.$el.toggleClass("hidden","comments"!==t),this.__tabContexts[t]&&this.__tabContexts[t].trigger("selected"),this.__setMagicLine(t)},__setupPhotoFade:function(){this.__fadeTimer=this.__timer.setTimeout(function(){this.$(".feed-detail-image").addClass("fade")}.bind(this),this.__photoFadeDelay)},__onPhotoError:function(){this.__setLoading(!1),this.$(".feed-detail-left-panel").addClass("error")},__renderPhoto:function(){this.__sizePhotoPlaceholder(),this.__setupPhotoFade(),this.__imageManager.load(this.$(".feed-detail-image"),this.model.get("payload.url"),{}).then(this.__setLoading.bind(this,!1)).catch(this.__onPhotoError.bind(this))},__showComments:function(){this.__commentsCollection=this.track(this.model.searchEdgeCollection("comments",{limit:10},e.Model.FeedCommentCollection,{appendToSearchCollection:!0})),this.__commentsCollection.on("add remove reset",this.__updateComments,this),this.__tabContexts.comments=this.createChildContext(this.__featureAccessManager.canSeeFeedLightboxRedesign()?e.CommentList:e.FeedComments,{$replaceElement:this.$(".tab-container[data-tab=comments] .comment-list-placeholder"),collection:this.__commentsCollection,feedModel:this.model}),this.__commentsCollection.populated().then(function(){this.__updateComments()}.bind(this))},__showLikes:function(){this.__likes=this.track(this.model.searchEdgeCollection("liked_by",{limit:10},e.UiCore.EdgeCollection,{appendToSearchCollection:!0})),this.__likes.on("add remove reset",this.__updateLikes,this),this.__tabContexts.likes=this.createChildContext(this.__featureAccessManager.canSeeFeedLightboxRedesign()?e.LikeList:e.LikedByList,{$replaceElement:this.$(".tab-container[data-tab=likes] .scroller .likes-list-placeholder"),collection:this.__likes,manuallyPage:!0}),this.__likes.populated().then(this.__updateLikes.bind(this))},__showTags:function(){this.model.getSingleEdge("photo").populated().then(function(e){return e.getSingleEdge("photo_details").populated()}.bind(this)).then(function(t){this.__userTags=new IMVU.NamedCollection,_.each(t.get("users"),function(e){this.__userTags.add(this.__serviceProvider.create(IMVU.NamedModel,e))}.bind(this)),this.__setTabCount("tags",this.__userTags.length),this.$el.toggleClass("no-tags",0===this.__userTags.length),this.__featureAccessManager.canSeeFeedLightboxRedesign()||this.__showTaggedUserSummary(),this.__tabContexts.tags=this.createChildContext(this.__featureAccessManager.canSeeFeedLightboxRedesign()?e.TagPanel:e.TagsList,{$parentElement:this.$(".tab-container[data-tab=tags] .scroller"),collection:this.__userTags,model:this.model})}.bind(this)).catch(function(){this.$el.addClass("no-tags")}.bind(this))},__showTaggedUserSummary:function(){this.__Promise.every(this.__userTags.map(function(t){return this.__restModelFactory.readModel(t.get("id"),e.UiCore.NodeModel).populated()}.bind(this))).then(function(t){var i=this.$(".feed-detail-with");t=_.filter(t,function(e){return e.id!==this.__actor.id}.bind(this)),_.each(t,function(n,a){0===a?i.append(e.templateWithFiller({theFiller:this.__globalStringManager.get("photo_tag_with")})):a===t.length-1?i.append(e.templateWithFiller({theFiller:this.__globalStringManager.get("photo_tag_and"),padLeft:!0})):i.append(e.templateWithFiller({theFiller:","})),this.__displayName=this.createChildContext(e.Widgets.DisplayName,{$parentElement:i,user:n,showVipBadgeTooltip:!0,width:"auto",marginTop:"small",size:"small",color:"light"})}.bind(this))}.bind(this))},__renderText:function(){var t=this.model.get("payload.background_color");t&&this.$(".feed-detail-text").css("background-color","#"+t),t=this.$(".feed-detail-text .message"),this.__userText=this.createChildContext(e.UserText,{$parentElement:t,text:this.model.get("payload.message")}),this.__setLoading(!1),t.scrollbar()},__sendComment:function(t){var i=function(e){e.populated().then(function(){e.node.getSingleEdge("author").id===this.__myself.id&&(this.__commentsCollection.off("add",i,this),this.__defer(this.__scrollToLastComment.bind(this)))}.bind(this))};this.__commentsCollection.on("add",i,this),this.__restModelFactory.createModel(this.__commentsCollection.url,e.UiCore.EdgeModel,{comment_text:t.message}).catch(function(){this.__commentsCollection.off("add",i,this)}.bind(this))},__scrollToTabs:function(){this.__commentsCollection.populated().then(function(){var e=this.segmentedControl.$el.position().top;this.__timer.clearTimeout(this.__scrollToTabsTimeout),this.__scrollToTabsTimeout=this.__timer.setTimeout(function(){this.$(".panels").scrollTop(e)},100)}.bind(this))},__scrollToLastComment:function(){if("mobile"!==this.__platform){var e=this.$(".tab-container[data-tab=comments] .feed-comments").outerHeight(!0);this.$(".tab-container[data-tab=comments] .scroller").scrollTop(e)}},__viewMoreComments:function(){this.__tabContexts.comments.viewMore()},__viewMoreLikes:function(){this.__tabContexts.likes.viewMore()},__like:function(){this.model.like(),e.NextUtil.DomHelper.applyTemporaryClass(this.__timer,this.$(".feed-detail-left-panel"),"liking",1e3)},__setMagicLine:function(e){e=this.$('.segmented-control-item[data-value="'+e+'"]'),this.$(".magic-line").css({"margin-left":e.position().left+"px",width:e.outerWidth()})}})}({UiCore:e["@UiCore"],Model:e["@Model"],NextUtil:e["@NextUtil"],ActionBar:Ae,ChatBar:Gt,CommentList:le,Counter:K,FeedComments:re,FeedHeadpiece:ii,FeedItemHeader:Yi,FeedActionBar:Ee,FormatNumber:r,LikedByList:ca,LikeList:Xt,LoginDialog:jn,LoginManager:ta,SegmentedControl:mt,TagsList:ra,TagPanel:ne,UserText:q,template:Qn,templateWithFiller:ia}),_a=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("FeedLightboxDialog",{uiContextName:"feed_lightbox_dialog",className:"feed-lightbox-dialog dialog-type-B-flexible text-close",initialize:function(e){t.prototype.initialize.call(this,e),this.args=e,this.model=e.model,this.linkToDetailsSubmode("feed",this.model),this.addToDOM()},hide:function(){t.prototype.hide.call(this)},postRender:function(){this.setContent("body",e.FeedDetailWidget,this.args).on("item-reported",function(){this.hide(),this.promiseResolver.reject()}.bind(this)),this.model.populated().then(function(){return this.createChildContext(e.FeedItemTimestamp,{timestamp:this.model.get("time"),$parentElement:this.$(".dialog-header")}),this.model.getSingleEdge("actor").populated()}.bind(this)).then(function(e){this.$(".dialog-header .dialog-title").text(e.get("display_name"))}.bind(this))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],FeedDetailWidget:ha,FeedItemTimestamp:ti}),ga=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<li><button class="btn ap"></button></li>'},3:function(e,t,i,n){var a;return i='\n\t\t\t<div class="favorite',((a=t.if.call(e,e&&e.isFavorited,{name:"if",hash:{},fn:this.program(4,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+'"></div>\n\t\t'},4:function(){return" favorited"},6:function(){return'\n\t\t\t<div class="settings"></div>\n\t\t'},8:function(){return'\n\t\t\t<div class="more"></div>\n\t\t'},10:function(e,t,i,n){var a,s;i=this.escapeExpression;var o=t.helperMissing,r='\n\t<div class="room-editing hidden">\n\t\t<div class="img-wrapper">\n\t\t\t<ul class="tile-status-icons">\n\t\t\t    ';return((a=t.if.call(e,e&&e.isAp,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+='\n\t\t\t</ul>\n\t\t\t<img src="" class="room-image" />\n\t\t</div>\n\t\t<textarea class="name" name="name">'+i("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:n}):s)+'</textarea>\n\t\t\n<div class="clear-fix"></div>\n\t\t<div class="privacy-row">\n            <input id=\'public-privacy-toggle\' class="toggle-switch public-privacy-toggle" type="checkbox"',((a=t.if.call(e,e&&e.public_room,{name:"if",hash:{},fn:this.program(11,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+=">\n            <label for='public-privacy-toggle'>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"Make Room Public",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+=' <span class="privacy-toggle-icon">?</span></label>\n        </div>\n\t</div>\n\t<div class="privacy-toggle-tip">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"room_privacy_toggle_tip",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+"</div>\n"},11:function(){return' checked="checked"'},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=this.escapeExpression;var o='<div class="public-room">\n\t<div class="img-wrapper">\n\t\t<ul class="tile-status-icons">\n\t\t    ';return((a=t.if.call(e,e&&e.isAp,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+='\n\t\t</ul>\n\t\t<img src="" class="room-image" />\n\t</div>\n\t<h1>'+i("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:n}):s)+'</h1>\n\t<div class="owner-name-goes-here"></div>\n\t<div class="clear-fix"></div>\n\t<div class="icons">\n\t\t',((a=t.if.call(e,e&&e.public_room,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+="\n\t\t",((a=t.if.call(e,e&&e.isMyRoom,{name:"if",hash:{},fn:this.program(6,n),inverse:this.program(8,n),data:n}))||0===a)&&(o+=a),o+="\n\t</div>\n</div>\n",((a=t.if.call(e,e&&e.isMyRoom,{name:"if",hash:{},fn:this.program(10,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+'\n<div class="clear-fix"></div>'},useData:!0})}(),pa=Te.extend("ReportRoomDialog",{uiContextName:"report_room_dialog",className:"report-room-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager"],title:"report_room_title",text:"report_room_text",dropdownOptions:[{label:"report_room_reason_name",value:"name"},{label:"report_room_reason_description",value:"description"},{label:"report_room_reason_photo",value:"photo"}]}),ua=function(e){return e.UiCore.UiContext.extend("RoomLightboxHeader",{uiContextName:"room_lightbox_dialog_header",className:"room-header",dependencies:["imageManager","contextMenuManager","loginManager","dialogManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".favorite",name:"favorite",handler:this.__onToggleFavorite.bind(this)},{type:"click",selector:".settings",name:"settings",handler:this.__showSettingsView.bind(this)},{type:"change",selector:".public-privacy-toggle",name:"privacy_toggle",handler:this.__triggerPrivacyChange.bind(this)},{type:"click",selector:".more",name:"more",handler:this.__onToggleContextMenu.bind(this)}]},initialize:function(t){e.UiCore.UiContext.prototype.initialize.call(this,t),this.__imageManager=t.imageManager,this.__myself=this.track(t.loginManager.getCurrentUser()),this.__owner=this.model.getSingleEdge("owner"),this.listenTo(this,"hide-settings",this.__hideSettingsView.bind(this)),this.addToDOM()},render:function(){this.$el.html(e.template({name:this.model.get("name"),isAp:this.model.get("is_ap"),isMyRoom:this.__myself.id===this.model.relations.owner?1:0,isFavorited:this.model.relations.viewer_favorite_room?1:0,public_room:"listed"===this.model.get("type")?1:0})),this.__owner.populated().then(function(){this.__displayName=this.createChildContext(e.Widgets.DisplayName,{$replaceElement:this.$(".owner-name-goes-here"),user:this.__owner,size:"small",color:"medium",showVipBadge:!1,ignoreClicks:!0,prefix:this.__globalStringManager.get("By")})}.bind(this)),this.__imageManager.load(this.$(".room-image"),this.model.get("rendered_image")),this.$(".privacy-toggle-tip").length&&(this.__tooltip=this.createChildContext(e.Tooltip,{$replaceElement:this.$(".privacy-toggle-tip"),$tooltipTarget:this.$(".privacy-toggle-icon")}))},getDetails:function(){return{name:this.$(".name").val(),type:this.__getCurrentPrivacyToggleValue()}},__getCurrentPrivacyToggleValue:function(){return this.$(".public-privacy-toggle").is(":checked")?"listed":"inventory"},__triggerPrivacyChange:function(){this.trigger("privacy-update",this.__getCurrentPrivacyToggleValue())},__onToggleFavorite:function(){this.model.relations.viewer_favorite_room?(this.$(".favorite").removeClass("favorited"),this.model.getSingleEdge("viewer_favorite_room",e.UiCore.EdgeModel).destroy()):(this.model.get("typed"),this.__dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__globalStringManager.get("Room is Private"),text:this.__globalStringManager.get("You cannot favorite a private room")}))},__showSettingsView:function(){this.trigger("show-settings"),this.$(".public-room").addClass("hidden"),this.$(".room-editing").removeClass("hidden")},__hideSettingsView:function(){this.$(".public-room").removeClass("hidden"),this.$(".room-editing").addClass("hidden")},__onToggleContextMenu:function(t){var i=[{name:"report_room",text:this.__globalStringManager.get("Report"),handler:this.__reportAction.bind(this)}];this.__contextMenuManager.showMenu(t,e.ContextMenu,{items:i,displayOptions:{above:!0,right:!1}})},__reportAction:function(){this.__dialogManager.showDialog(e.ReportRoomDialog,{model:this.model})}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],Widgets:e["@Widgets"],ContextMenu:A,ReportRoomDialog:pa,Tooltip:Dt,template:ga}),ma=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;return"\r\n            "+(0,this.escapeExpression)("function"==typeof(a=t.language||e&&e.language)?a.call(e,{name:"language",hash:{},data:n}):a)+"\r\n        "},3:function(e,t,i,n){var a;i=t.helperMissing;var s="\r\n            ";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Any",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"\r\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='<fieldset class="hostbar">\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+o((s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"LANGUAGE",{name:"i18n-g",hash:{},data:n}))+'</legend>\r\n    <section class="language flex-vc">\r\n        <div class="icon"></div>\r\n        <span>\r\n        ';return((a=t.if.call(e,e&&e.language,{name:"if",hash:{},fn:this.program(1,n),inverse:this.program(3,n),data:n}))||0===a)&&(r+=a),r+'\r\n        </span>\r\n    </section>\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+o((s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"OCCUPANCY",{name:"i18n-g",hash:{},data:n}))+'</legend>\r\n    <section class="occupancy flex-vc">\r\n        <div class="icon"></div>\r\n        <span class="occupants-row">\r\n            <span class="occupants">'+o("function"==typeof(s=t.occupancy||e&&e.occupancy)?s.call(e,{name:"occupancy",hash:{},data:n}):s)+'</span><span class="capacity">/'+o("function"==typeof(s=t.capacity||e&&e.capacity)?s.call(e,{name:"capacity",hash:{},data:n}):s)+'</span>&nbsp;<span class="users-word"></span>\r\n        </span>\r\n    </section>\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+o((s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"DESCRIPTION",{name:"i18n-g",hash:{},data:n}))+'</legend>\r\n    <section class="description">'+o("function"==typeof(s=t.description||e&&e.description)?s.call(e,{name:"description",hash:{},data:n}):s)+'</section>\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+o((s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"PARTICIPANTS",{name:"i18n-g",hash:{},data:n}))+"</legend>\r\n    <section class='chat-participants'></section>\r\n</fieldset>\r\n"},useData:!0})}(),fa=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="profile-icon-placeholder"></div>\r\n'},useData:!0})}(),va=function(e){function t(e,t){var i=e.get("bootstrapParams").is_app;e.get("window").open(t,i?"_system":"_blank")}function i(e){return-1!==e.indexOf("iPad")||-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPod")}return{openExternal:t,externalizeA:function(e,i){var n=$(i),a=n.attr("href");n.attr("href",""),n.click(function(){return t(e,a),!1})},isAndroid:function(e){return-1!==e.get("window").navigator.userAgent.indexOf("Android")},isAndroidChrome:function(e){return-1!==(e=e.get("window").navigator.userAgent).indexOf("Android")&&-1!==e.indexOf("Chrome/")&&-1===e.indexOf("Version/")},isAndroidWebApp:function(e){return!(-1===(e=e.get("window")).navigator.userAgent.indexOf("Android")||!e.navigator.standalone)},isIOS:function(e){return i(e=e.get("window").navigator.userAgent)},isIOSSafari:function(e){return!(!i(e=e.get("window").navigator.userAgent)||-1!==e.indexOf("CriOS/"))&&(-1!==e.indexOf("Safari/")||-1!==e.indexOf("AppleWebKit/")&&-1===e.indexOf("Chrome/"))},getVersionIOS:function(e){return i(e=e.get("window").navigator.userAgent)?null===(e=/(iphone|ipad)(; CPU)? OS ((\d+)_(\d+)(_(\d+))?)/i.exec(e))?null:{raw:e[3],major:parseInt(e[4],10),minor:parseInt(e[5],10),revision:e[7]?parseInt(e[7],10):null}:null}}}(),ba=function(e){var t=e.UiCore.UiContext;return t.extend("DetailParticipantListItem",{uiContextName:"detail_participant_list_item",className:"detail-participant-list-item",tagName:"li",dependencies:["loginManager"],initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},delete:function(){this.__profileIcon.delete(),t.prototype.delete.call(this)},render:function(){this.model.populated().then(function(){this.$el.html(e.template()),this.__profileIcon=this.createChildContext(e.Widgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.model.node}),e.MobileBrowser.isIOS(this.__serviceProvider)}.bind(this))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:fa,MobileBrowser:va}),Ca=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("DetailParticipantList",{uiContextName:"detail_participants_list",className:"detail-participant-list",tagName:"ul",itemFactory:e.DetailParticipantListItem,initialize:function(e){this.itemFactory=e.itemFactory||this.itemFactory,t.prototype.initialize.call(this,e)}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],DetailParticipantListItem:ba}),ya=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<span class="by-line-text">\n    <span class="username"></span>\n</span>\n'},useData:!0})}(),Ma=function(e){var t=e.UiCore.UiContext;return t.extend("ByLineWidget",{className:"by-line-widget",uiContextName:"bylinewidget",tagName:"div",dependencies:["verbBy","model"],initialize:function(e){t.prototype.initialize.call(this,e),this.__hideOnlineStatus=!!e.hideOnlineStatus,this.__ignoreClicks=!!e.ignoreClicks,this.__hideUsername=!e.hasOwnProperty("hideUsername")||e.hideUsername,this.__useLargeProfile=!!e.useLargeProfile,this.__verbBy=IMVU.optionalProperty(e,"verbBy",null),this.addToDOM()},render:function(){this.$el.html(e.template()),this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".username"),user:this.model,hideIcon:!1,size:"medium",hideDisplay:!1,displayArgs:{size:"small",color:"dark",prefix:this.__verbBy},hideAtAvatar:this.__hideUsername,atAvatarArgs:{size:"small",color:"medium"}})}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:ya}),ka=function(e){return{dependencies:"contextMenuManager dialogManager featureAccessManager globalStringManager googleAnalytics modeManager Promise".split(" "),__getPrimaryAction:function(){var e=!!this.__roomModel.relations.chat,t=e?this.__serviceProvider.get("activeChats").has(this.__roomModel.getSingleEdge("chat"))?"SHOW ROOM":"JOIN ROOM":"CLOSED";return this.options.hideJoinButton?null:{key:"join",text:this.__globalStringManager.get(t),handler:this.__joinClicked.bind(this),disabled:!e}},__getSecondaryActions:function(){return[this.__featureAccessManager.canEditScenes()&&this.__roomModel.relations.owner===this.__myself.id?{key:"edit",text:this.__globalStringManager.get("EDIT ROOM"),handler:this.__onEditRoom.bind(this),disabled:!1}:{key:"more",text:this.__globalStringManager.get("MORE"),handler:this.__onShowActionMenu.bind(this),disabled:!1},this.__roomModel.relations.viewer_favorite_room?{key:"favorited",text:this.__globalStringManager.get("FAVORITED"),handler:this.__onToggleFavorite.bind(this,!1),disabled:!1}:{key:"favorite",text:this.__globalStringManager.get("FAVORITE"),handler:this.__onToggleFavorite.bind(this,!0),disabled:!1}]},__onEditRoom:function(){this.__modeManager.openMode({mode:{id:"decorate"},submode:{id:this.__roomModel.relations.scene}})},__onShowActionMenu:function(t){t.stopPropagation(),this.__contextMenuManager.toggleMenu(t,e.ContextMenu,{items:[{name:"report",text:"Report",handler:this.__reportAction.bind(this)}],displayOptions:{above:!1,right:!0}})},__reportAction:function(){this.__dialogManager.showDialog(e.ReportRoomDialog,{model:this.__roomModel})},__showOwner:function(){this.__hostedByBlock=this.createChildContext(e.ByLineWidget,{$parentElement:this.$(".hostbar"),model:this.track(this.__roomModel.getSingleEdge("owner")),verbBy:this.__globalStringManager.get("Hosted by")})},__showOccupants:function(){if(this.__roomModel.relations.chat){var t=this.track(this.__roomModel.getSingleEdge("chat"));t.populated().then(function(){return this.track(t.getEdgeCollection("participants")).populated()}.bind(this)).then(function(t){this.createChildContext(e.DetailParticipantList,{collection:t,$parentElement:this.$(".chat-participants"),showProfileIconOnly:!0});var i=function(){this.$("span.occupants").text(t.total_count),this.$("span.users-word").text(this.__globalStringManager.getPluralized("occupancy_user",{howMany:t.total_count}))}.bind(this);this.listenTo(t,"change:relations",i),i()}.bind(this))}},__commonRender:function(t){this.__roomModel.getSingleEdge("scene").populated().then(function(e){this.setForeground(IMVU.URI.build(t.get("rendered_image"),{width:this.__backgroundWidth,height:this.__backgroundHeight,cb:e.relations.shell_product}))}.bind(this)),this.setTitle(t.get("name")),this.__imageManager.loadAsBackgroundImage(this.$(".profile-icon, .user-cover-image"),t.get("themed_image_url")||t.get("image_url")),this.setInfo(e.template(t.toJSON())),"private"===t.get("privacy")&&this.$("span.capacity").hide(),this.setShields(_.filter([t.get("is_ap")?"ap":null,t.get("is_vip")?"vip":null])),this.__showOwner(),this.setActions(this.__getPrimaryAction(),this.__getSecondaryActions()),"private"===t.get("privacy")&&this.$(".btn-primary").attr("disabled","disabled"),this.listenTo(this.__roomModel,"change:relations",this.__onFavoriteRoomChange),this.__showOccupants()},__onFavoriteRoomChange:function(e,t){t.viewer_favorite_room!=e.viewer_favorite_room&&this.setActions(this.__getPrimaryAction(),this.__getSecondaryActions())},__onToggleFavorite:function(t){return t?this.__myself.getEdgeCollection("favorite_rooms").create({id:this.__roomModel.id}):this.__roomModel.getSingleEdge("viewer_favorite_room",e.UiCore.EdgeModel).destroy()},__joinClicked:function(){this.__roomModel.get("occupancy")>=this.__roomModel.get("capacity")?this.__dialogManager.alert({title:this.__globalStringManager.get("Room Full"),text:this.__globalStringManager.get("This room is currently full"),ok:this.__globalStringManager.get("OK")}):(this.__googleAnalytics.recordEnterChatRoom(this.__roomModel.id),this.__joinRoom())}}}({UiCore:e["@UiCore"],ContextMenu:A,ByLineWidget:Ma,ReportRoomDialog:pa,DetailParticipantList:Ca,template:ma}),xa=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;i=t.helperMissing;var s='\n\t<p class="ap-required">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Room_Requires_AP",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</p>\n"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return(a=t.if.call(e,e&&e.showApRequired,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a?a:""},useData:!0})}(),wa=function(e){return e.UiCore.UiContext.extend("RoomLightboxDialogContent",{uiContextName:"room_lightbox_dialog_content",className:"room-lightbox-dialog-content",dependencies:"restModelFactory imageManager loginManager cookieManager featureAccessManager sceneManager".split(" "),initialize:function(t){e.UiCore.UiContext.prototype.initialize.call(this,t),this.__cookieManager=t.cookieManager,this.__model=t.model,this.__imageManager=t.imageManager,this.__sceneManager=t.sceneManager,this.__loginManager=t.loginManager,this.__restModelFactory=t.restModelFactory,this.__featureAccessManager=t.featureAccessManager,this.__myself=this.__loginManager.getCurrentUser(),this.__show3DPreview=this.__featureAccessManager.canSee3D()&&this.__cookieManager.get("prefer_3d"),this.addToDOM(),this.__model.populated().then(this.__onModelPopulated.bind(this)),this.listenTo(this.__model,"change",this.__onModelChange.bind(this))},render:function(){this.__maybeShowApRequiredOverlay()?this.$el.html(e.template({showApRequired:!0})):this.__show3DPreview?(this.$el.html(e.template()),this.__sceneModel=this.__restModelFactory.readModel(this.__model.relations.scene,e.UiCore.NodeModel),this.__model.populated().then(function(){return this.__sceneModel.populated()}.bind(this)).then(function(){this.__sceneManager.showScenePresenter({context:this,$parentElement:this.$el,size:"match-parent",userNode:this.__myself,sceneNode:this.__sceneModel,createDefaultLight:!1,showUserWidgets:!1,canClickAvatar:!1,preloadMyAvatar:!1,enableLOD:!1,type:"lightbox-preview"})}.bind(this))):this.__imageManager.loadAsBackgroundImage(this.$el,this.__model.get("rendered_image"))},__onModelPopulated:function(){this.__isAp=this.__model.get("is_ap")},__onModelChange:function(){this.__isAp===this.__model.get("is_ap")||this.__myself.get("is_ap")||this.render()},__maybeShowApRequiredOverlay:function(){return!(this.__model.get("is_ap")&&this.__myself.get("is_ap")||!this.__model.get("is_ap"))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:xa}),Pa=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r="\n\t\t\t\t<h3>";return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Language",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+'</h3>\n\t\t\t\t<p class="language">'+o("function"==typeof(s=t.language||e&&e.language)?s.call(e,{name:"language",hash:{},data:n}):s)+"</p>\n\t\t\t"},3:function(e,t,i,n){var a;i=t.helperMissing;var s='\n\t\t<div class="panel-wrapper">\n\t\t\t<h2 class="panel-header">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Room Admins",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='<span class="question-mark-icon">?</span></h2>\n\t\t\t<div class="panel-content">\n\t\t\t\t<div class="room-admin-presenter"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="room-admins-tip">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"room_admins_tip",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\n\t"},5:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='\n\t<div class="room-editing hidden">\n\n\t\t<div class="panel-wrapper">\n\t\t\t<h2 class="panel-header">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Details",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</h1>\n\t\t\t<div class="panel-content">\n\t\t\t\t<div class="public-only',((a=t.if.call(e,e&&e.private,{name:"if",hash:{},fn:this.program(6,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+='">\n\t\t\t\t\t<h3>',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Occupancy",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</h3>\n\t\t\t\t\t<select class="occupancy" name="occupancy">\n\t\t\t\t\t\t<option value="1">1</option>\n\t\t\t\t\t\t<option value="2">2</option>\n\t\t\t\t\t\t<option value="3">3</option>\n\t\t\t\t\t\t<option value="4">4</option>\n\t\t\t\t\t\t<option value="5">5</option>\n\t\t\t\t\t\t<option value="6">6</option>\n\t\t\t\t\t\t<option value="7">7</option>\n\t\t\t\t\t\t<option value="8">8</option>\n\t\t\t\t\t\t<option value="9">9</option>\n\t\t\t\t\t\t<option value="10">10</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\n\t\t\t\t<h3>',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Language",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</h3>\n\t\t\t\t<select class="id-language">\n\t                ',((a=t.each.call(e,e&&e.locales,{name:"each",hash:{},fn:this.program(8,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+='\n\t            </select>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="panel-wrapper">\n\t\t\t<h2 class="panel-header">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Description",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</h2>\n\t\t\t<div class="panel-content">\n\t\t\t\t<textarea class="description">'+o("function"==typeof(s=t.description||e&&e.description)?s.call(e,{name:"description",hash:{},data:n}):s)+'</textarea>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="panel-wrapper public-only',((a=t.if.call(e,e&&e.private,{name:"if",hash:{},fn:this.program(6,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+='">\n\t\t\t<h2 class="panel-header">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Entry Requirements",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</h1>\n\t\t\t<div class="panel-content">\n\t\t\t\t<div class="setting-row">\n\t\t            <input id=\'must-have-access-pass\' class="toggle-switch public-privacy-toggle" type="checkbox">\n\t\t            <label for=\'must-have-access-pass\'>',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Must Have Access Pass",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</label>\n\t\t        </div>\n\t\t\t\t<div class="setting-row">\n\t\t            <input id=\'must-have-vip\' class="toggle-switch public-privacy-toggle" type="checkbox">\n\t\t            <label for=\'must-have-vip\'>',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Must Have VIP",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</label>\n\t\t        </div>\n\t\t\t\t<div class="setting-row">\n\t\t            <input id=\'friends-only\' class="toggle-switch public-privacy-toggle" type="checkbox">\n\t\t            <label for=\'friends-only\'>',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"friends_only",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+"</label>\n\t\t        </div>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n"},6:function(){return" hidden"},8:function(e,t,i,n){var a,s='\n\t                <option value="'+(i=this.escapeExpression)("function"==typeof(a=e&&e.code)?a.apply(e):a)+'"';return((a=t.if.call(e,e&&e.selected,{name:"if",hash:{},fn:this.program(9,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+">"+i("function"==typeof(a=e&&e.name)?a.apply(e):a)+"</option>\n\t                "},9:function(){return" selected"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='<div class="public-room">\n\t<div class="panel-wrapper">\n\t\t<h2 class="panel-header">';return((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Details",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</h1>\n\t\t<div class="panel-content">\n\t\t\t<h3>',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Occupancy",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</h3>\n\t\t\t<div class="chat-participants"></div>\n\n\t\t\t',((a=t.if.call(e,e&&e.language,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+='\n\t\t</div>\n\t</div>\n\n\t<div class="panel-wrapper">\n\t\t<h2 class="panel-header">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Description",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+='</h2>\n\t\t<div class="panel-content">\n\t\t\t<p class="description">'+o("function"==typeof(s=t.description||e&&e.description)?s.call(e,{name:"description",hash:{},data:n}):s)+"</p>\n\t\t</div>\n\t</div>\n\n\t",((a=t.if.call(e,e&&e.hasAdmins,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+="\n</div>\n\n",((a=t.if.call(e,e&&e.isMyRoom,{name:"if",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r},useData:!0})}(),$a=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="user-info">\n    <p class="username is-truncated"></p>\n</div>'},useData:!0})}(),Sa=function(e){var t=e.UiCore.UiContext;return t.extend("RoomAdminsListItem",{tagName:"li",className:"room-admins-list-item",uiContextName:"room_admins_list_item",initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.model.populated().then(function(){this.$el.html(e.template),this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".username"),user:this.model.node,configuration:"large-dual-lightbg"})}.bind(this))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:$a}),Ua=function(e){return e.UiCore.ListPresenter.extend("RoomAdminsListPresenter",{className:"room-admins-list-presenter",uiContextName:"room_admins_list_presenter",itemFactory:e.RoomAdminsListItem})}({UiCore:e["@UiCore"],RoomAdminsListItem:Sa}),Ta=function(e){var t=e.UiCore.UiContext.extend("RoomLightboxDialogPanelWidget",{uiContextName:"room_lightbox_dialog_panel_widget",className:"room-panel-widget",dependencies:["loginManager","locales"],trackedEvents:function(){return[{type:"click",selector:".panel-header",name:"toggle_panel",handler:this.__togglePanel.bind(this)}]},initialize:function(t){e.UiCore.UiContext.prototype.initialize.call(this,t),this.__myself=this.track(t.loginManager.getCurrentUser()),this.__roomModel=this.model,this.__locales=t.locales,this.addToDOM()},render:function(){this.__roomAdminCollection=this.__roomModel.relations.moderators?this.__roomModel.getEdgeCollection("moderators"):[];var t=this.__myself.id===this.model.relations.owner;this.$el.html(e.template({locales:this.__locales,hasAdmins:this.__roomAdminCollection.length?1:0,description:this.model.get("description"),language:this.model.get("language"),isMyRoom:t,private:"private"===this.model.get("privacy")?1:0})),this.$(".question-mark-icon").length&&(this.__roomAdminsListPresenter=this.createChildContext(e.RoomAdminsListPresenter,{$replaceElement:this.$(".room-admin-presenter"),collection:this.__roomAdminCollection}),this.__tooltip=this.createChildContext(e.Tooltip,{$replaceElement:this.$(".room-admins-tip"),$tooltipTarget:this.$(".question-mark-icon")})),this.__showOccupants(),t&&(this.occupancyDropdown=this.createChildContext(e.Dropdown,{$replaceElement:this.$(".room-editing select.occupancy").expect(1)}),this.occupancyDropdown.selectByValue(this.model.get("capacity")),this.languageDropdown=this.createChildContext(e.Dropdown,{$replaceElement:this.$(".room-editing select.id-language").expect(1)})),this.listenTo(this,"show-settings",this.__showSettings.bind(this)),this.listenTo(this,"hide-settings",this.__hideSettings.bind(this))},maybeShowPublicRoomControls:function(e){"public"===e?this.$(".public-only").show():this.$(".public-only").hide()},getDetails:function(){var e=this.$(".room-editing").expect(1);return{capacity:e.find("select.occupancy").expect(1).val(),description:e.find(".description").expect(1).val(),language:this.$("select.id-language").expect(1).val(),is_vip:e.find("#must-have-vip").expect(1).is(":checked"),is_ap:e.find("#must-have-access-pass").expect(1).is(":checked")}},__showSettings:function(){this.$(".public-room").addClass("hidden"),this.$(".room-editing").removeClass("hidden")},__hideSettings:function(){this.$(".public-room").removeClass("hidden"),this.$(".room-editing").addClass("hidden")},__togglePanel:function(e){$(e.currentTarget).toggleClass("open",!$(e.currentTarget).hasClass("open")),$(e.currentTarget).next(".panel-content").slideToggle(250)}});return e.Mixin.mixin(t.prototype,e.RoomDetailMixin),t}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],Dropdown:_i,Mixin:Bn,RoomAdminsListPresenter:Ua,RoomDetailMixin:ka,Tooltip:Dt,template:Pa}),Da=function(e){var t=e.LightboxDialog,i=t.extend("RoomLightboxDialog",{uiContextName:"room_lightbox_dialog",className:"room-lightbox-dialog lightbox-dialog",dependencies:["modeManager","globalStringManager","window"],initialize:function(i){t.prototype.initialize.call(this,i),this.__roomModel=this.model.node||this.model,this.__modeManager=i.modeManager,this.__globalStringManager=i.globalStringManager,this.__isSettingsShowing=!1,this.addWidgetToMainContainer(e.RoomLightboxDialogContent,{model:this.__roomModel}),this.__header=this.addWidgetToHeadpiece(e.RoomLightboxDialogHeader,{model:this.__roomModel}),this.setHeadpieceButtons({ctaSecondary:this.__globalStringManager.get("DECORATE ROOM"),ctaPrimary:this.__globalStringManager.get("JOIN ROOM")}),this.__sidebarPanelWidget=this.addWidgetToSidebarPanel(e.RoomLightboxDialogPanelWidget,{model:this.__roomModel}),this.listenTo(this.__header,"show-settings",this.__showSettings.bind(this)),this.listenTo(this.__header,"privacy-update",this.__maybeShowPublicRoomControls.bind(this)),this.__roomModel.populated().then(function(){this.__roomModel.get("occupancy")===this.__roomModel.get("capacity")&&this.$("button.btn-primary").prop("disabled",!0)}.bind(this))},__showSettings:function(){this.__sidebarPanelWidget.trigger("show-settings"),this.setHeadpieceButtons({ctaPrimary:this.__globalStringManager.get("Save Changes")}),this.__isSettingsShowing=!0},__hideSettings:function(){this.__header.trigger("hide-settings"),this.__sidebarPanelWidget.trigger("hide-settings"),this.setHeadpieceButtons({ctaSecondary:this.__globalStringManager.get("DECORATE ROOM"),ctaPrimary:this.__globalStringManager.get("JOIN ROOM")}),this.__isSettingsShowing=!1},__maybeShowPublicRoomControls:function(e){this.__sidebarPanelWidget.maybeShowPublicRoomControls(e)},__joinRoom:function(){this.__modeManager.openMode({mode:{id:"chat"},submode:{id:this.__roomModel.id,forceJoin:!0,showAlways:!0}}),this.__serviceProvider.get("windowManager").removeWindow(this.__roomModel.id)},__onclickPrimary:function(e){this.__isSettingsShowing?(e=_.extend(this.__header.getDetails(),this.__sidebarPanelWidget.getDetails()),this.__roomModel.save(e).then(function(){this.__hideSettings()}.bind(this)).catch(function(e){this.__window.console.error("error saving room metadata:",e.message)}.bind(this))):this.__joinClicked()},__onclickSecondary:function(e){this.__onEditRoom()}});return e.Mixin.mixin(i.prototype,e.RoomDetailMixin),i}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],RoomLightboxDialogPanelWidget:Ta,RoomLightboxDialogHeader:ua,RoomLightboxDialogContent:wa,LightboxDialog:x,Mixin:Bn,RoomDetailMixin:ka}),La=function(e){var t=e.StandardHeadpiece;return t.extend("FeedTagHeadpiece",{className:"feed-tag-headpiece standard-headpiece",uiContextName:"feed_tag_headpiece",dependencies:["globalStringManager"],initialize:function(i){this.__imageUrl=i.imageUrl,this.__isAp=i.isAp,this.__pidListArr=i.pidListArr,this.__user=i.user,i.info={imageUrl:this.__imageUrl,headerText:"Outfit",isAP:this.__isAp},t.prototype.initialize.call(this,i),this.createChildContext(e.BundleCount,{model:null,forceCount:this.__pidListArr.length,$parentElement:this.$(".tile-body")}),this.createChildContext(e.Widgets.DisplayName,{$replaceElement:this.$(".secondary-text"),user:this.__user,showVipBadge:!1,size:"small",color:"medium",prefix:this.__globalStringManager.get("by")})}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],BundleCount:p,StandardHeadpiece:h}),Ea=function(e){var t=e.LightboxDialog;return t.extend("FeedTagLightbox",{uiContextName:"feed_tag_lightbox",className:"feed-tag-lightbox lightbox-dialog",dependencies:["globalStringManager","loginManager","Promise"],initialize:function(i){t.prototype.initialize.call(this,i),this.__dressUpAvatarManagerFactory=i.dressUpAvatarManagerFactory||e.DressUpAvatarManager,this.__myself=this.track(i.loginManager.getCurrentUser()),this.__imageFactory=i.imageFactory,this.__triggerList=this.__serviceProvider.create(i.triggerListFactory||e.TriggerList),this.__user=i.user,this.__productCollection=i.productCollection,this.__pidListArr=i.pidListArr,this.__isAp=i.isAp,this.__dressUpAvatarManager=this.__serviceProvider.create(this.__dressUpAvatarManagerFactory,{persistLooks:!1,confirmGenderChange:!1}),this.__Promise.every(this.__productCollection.map(function(e){return e.populated().catch(function(){})}.bind(this))).then(function(){this.__showAvatar()}.bind(this))},__setupHeadpiece:function(){this.addWidgetToHeadpiece(e.FeedTagHeadpiece,{imageUrl:this.__serviceProvider.get("root")+"/image_dressup/"+this.__pidListArr.join(","),isAp:this.__isAp,pidListArr:this.__pidListArr,user:this.__user})},__setupSidebar:function(){this.setSidebarPanelLoading(!0),this.__dressUpAvatarManager.populated().then(function(){return this.__Promise.every([this.__triggerList.loadTriggers(this.__dressUpAvatarManager.getLookModel().get("asset_url"))])}.bind(this)).then(function(){var t=this.__productCollection.map(function(e){return this.__triggerList.triggersForProduct(e)}.bind(this));this.__addAccordionSection(this.__globalStringManager.get("items_in_look"),e.SubproductList,{collection:this.__productCollection},!0);var i=_.reduce(t,function(e,t){return e+t.length},0);if(0<i){var n="desktop"===this.__platform;t=this.__addAccordionSection(this.__globalStringManager.get("actions_with_count",{count:i}),e.ActionList,{productTriggers:t},n);this.listenTo(t,"playAction",this.__playAction.bind(this))}this.setSidebarPanelLoading(!1)}.bind(this))},__addAccordionSection:function(t,i,n,a){return this.addWidgetToSidebarPanel(e.AccordionSection,{title:t,startOpen:!!a}).addWidget(i,n)},__showAvatar:function(){this.__dressUpAvatarManager.populated().then(function(){return this.__dressUpAvatarManager.forceChangeToLookUrl(this.__serviceProvider.get("root")+"/look/"+this.__pidListArr.join(","))}.bind(this)).then(function(){this.__avatarWidget=this.addWidgetToMainContainer(e.Avatar,{model:this.__dressUpAvatarManager.getLookModel(),imageFactory:this.__imageFactory,showLoadingProgress:!0,sceneContext:"shop_clothing"}),this.__setupHeadpiece(),this.__setupSidebar()}.bind(this))},setSidebarPanelLoading:function(e,t){var i=this.__getPanel(t);i.$widgets.toggleClass("loading",e),i.$footers.toggleClass("loading",e)},hide:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!1),t.prototype.hide.call(this)},show:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!0),t.prototype.show.call(this)},delete:function(){this.__dressUpAvatarManager.delete(),t.prototype.delete.call(this)},__playAction:function(e){this.__avatarWidget&&this.__avatarWidget.playTriggeredAction(e)}})}({Model:e["@Model"],Widgets:e["@Widgets"],AccordionSection:f,ActionList:R,Avatar:L,DressUpAvatarManager:O,LightboxDialog:x,TriggerList:a,SubproductList:d,FeedTagHeadpiece:La}),Aa=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='credits-widget-container'>\r\n    <div class='details'>\r\n        <div>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Available Credits",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</div>\r\n        <div class='available-credits'></div>\r\n        <div class='promo-credits'><span class='promo-credit-value'></span> ",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Promo",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\r\n    </div>\r\n</div>"},useData:!0})}(),Ia=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='\n            <div class="needs-credit ';return((a=t.if.call(e,e&&e.largeAmount,{name:"if",hash:{},fn:this.program(2,n),inverse:this.noop,data:n}))||0===a)&&(r+=a),r+='">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"You need",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+="<span>"+o("function"==typeof(s=t.amount||e&&e.amount)?s.call(e,{name:"amount",hash:{},data:n}):s)+" ",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Credits",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+="</span>",((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"complete_purchase",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+"</div>\n        "},2:function(){return" large-amount "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i='<div class="products-container">\n    <div class="products">\n        ',((a=t.if.call(e,e&&e.showAmount,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+'\n    </div>\n    <div class="ppc-redeem-placeholder"></div>\n</div>\n<footer class="dialog-footer">\n</footer>\n'},useData:!0})}(),Na=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<a class="back-button">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Back to Cart",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</a>"},useData:!0})}(),Fa=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<legend class="redeem-title system-info-header">\n    ';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ppc_redeem_title",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n    <span class="ppc-redeem-tooltip-target icon icon-tooltip-icon"></span>\n</legend>\n<div class="redeem-wrapper">\n    <div class="redeem-field">\n        <input type="text" class="ppc-code full-width" maxlength="16" placeholder="',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ppc_redeem_input_placeholder",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='">\n        <div class="input-error"></div>\n    </div>\n    <div class="redeem-button">\n        <button class="ppc-redeem-btn btn disabled full-width">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ppc_redeem_button",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</button>\n    </div>\n</div>\n<div class="ppc-redeem-tooltip">\n    <div class="tooltip-header">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ppc_tooltip_header",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n    <div class="tooltip-body">\n        <div class="icon icon-ppc-tooltip"></div>\n        <div>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ppc_tooltip_body_line_1",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</div>\n        <div>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ppc_tooltip_body_line_2",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n    </div>\n</div>\n\n<div class="vip-tooltip-body hidden">\n    ',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_title",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="\n    <ul>\n        <li>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_item_1",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</li>\n        <li>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_item_2",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</li>\n        <li>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_item_3",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</li>\n        <li>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_item_4",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</li>\n    </ul>\n</div>"},useData:!0})}(),Ha=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;i=t.helperMissing;var s='\n<div class="redemption-gifts">\n    <legend class="system-info-header">\n        ';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ppc_redemption_choice_dialog_bonus",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n    </legend>\n    <div class="bonus-items-list">\n    ',((a=t.each.call(e,e&&e.bonusItems,{name:"each",hash:{},fn:this.program(2,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+"\n    </div>\n</div>\n"},2:function(e,t,i,n){var a,s,o=this.escapeExpression;return i=t.helperMissing,o='\n        <article class="bonus-item-tile product-tile tile">\n            <div class="tile-body">\n                <img src="'+o("function"==typeof(s=t.thumbnail||e&&e.thumbnail)?s.call(e,{name:"thumbnail",hash:{},data:n}):s)+'" class="is-square">\n            </div>\n            <div class="product-info">\n                <div class="product-name">'+o("function"==typeof(a=e&&e.name)?a.apply(e):a)+'</div>\n                <div class="free">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"FREE",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+"</div>\n            </div>\n        </article>\n    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="redemption-choices">\n    <legend class="system-info-header">\n        ';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ppc_redemption_choice_dialog_package",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='\n    </legend>\n    <div class="redemption-choices-container">\n    </div>\n</div>\n',((a=t.if.call(e,e&&e.hasBonusItems,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+='\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary redeem-ppc full-width disabled">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ppc_redeem_button",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>\n<\/script>\n"},useData:!0})}(),Ra=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="celled-list-placeholder"></div>'},useData:!0})}(),Ba=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return" disabled "},3:function(){return" ignore-click "},5:function(){return'\n        <div class="tooltip-target icon icon-tooltip-icon"></div>\n        <div class="tooltip-content">\n            <div class="tooltip-header"></div>\n            <div class="tooltip-body"></div>\n        </div>\n    '},7:function(){return'\n        <span class="icon icon-action-more"></span>\n    '},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=this.escapeExpression;var o='<div class="wrapper ';return((a=t.if.call(e,e&&e.isDisabled,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+=" ",((a=t.if.call(e,e&&e.ignoreClick,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+='">\n    <div class="thumbnail">\n        <img src="'+i("function"==typeof(s=t.thumbnail||e&&e.thumbnail)?s.call(e,{name:"thumbnail",hash:{},data:n}):s)+'">\n    </div>\n    <div class="description">\n        <div class="celled-item-title">'+i("function"==typeof(s=t.title||e&&e.title)?s.call(e,{name:"title",hash:{},data:n}):s)+'</div>\n        <div class="celled-item-description">'+i("function"==typeof(s=t.description||e&&e.description)?s.call(e,{name:"description",hash:{},data:n}):s)+'</div>\n        <div class="celled-item-info">'+i("function"==typeof(s=t.info||e&&e.info)?s.call(e,{name:"info",hash:{},data:n}):s)+'</div>\n    </div>\n    <div class="extra">\n    ',((a=t.if.call(e,e&&e.tooltip,{name:"if",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+="\n    ",((a=t.if.call(e,e&&e.actionMore,{name:"if",hash:{},fn:this.program(7,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+"\n    </div>\n</div>"},useData:!0})}(),Oa=function(e){var t=e.UiCore.UiContext;return t.extend("CelledListItem",{className:"celled-list-item",uiContextName:"celled_list_item",dependencies:["model"],trackedEvents:function(){return[{type:"click",selector:"",name:"celledlistitem_click",handler:this.__onClick.bind(this)},{type:"click",selector:"extra.action-more",name:"click_more_info",handler:this.__onClickMore.bind(this)}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){var t=!1,i="",n="",a=this.__model.get("extra"),s=a&&"action_more"===a.type;a&&"tooltip"===a.type&&(t=!0,i=a.tooltip_header,n=a.tooltip_body),this.__ignoreClick=this.__model.get("isDisabled")||this.__model.get("ignoreItemClick"),this.$el.html(e.template({thumbnail:this.__model.get("thumbnail"),title:this.__model.get("title"),description:this.__model.get("description"),info:this.__model.get("info"),tooltip:t,isDisabled:!!this.__model.get("isDisabled"),actionMore:s,ignoreClick:this.__ignoreClick})),t&&(this.$(".tooltip-header").html(i),this.$(".tooltip-body").html(n),this.createChildContext(e.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".tooltip-target")}))},__onClick:function(t){this.__ignoreClick||(e.NextUtil.DomHelper.radioClass(this.$el,"is-selected"),this.trigger("select",this.__model))},__onClickMore:function(){this.trigger("action_more",this.__model)}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:Ba,Tooltip:Dt}),za=function(e){return e.UiCore.ListPresenter.extend("CelledList",{className:"celled-list",uiContextName:"celled_list",itemFactory:e.CelledListItem})}({UiCore:e["@UiCore"],CelledListItem:Oa}),Wa=function(e){var t=e.UiCore.UiContext;return t.extend("CelledListPresenter",{className:"celled-list-presenter",uiContextName:"celled_list_presenter",dependencies:["collection"],initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(t){this.$el.html(e.template()),this.celledList=this.createChildContext(e.CelledList,{$replaceElement:this.$(".celled-list-placeholder"),collection:this.collection}),this.celledList.on("select",function(e){this.__selectedItem=e,this.trigger("select")}.bind(this))},getSelectedItem:function(){return this.__selectedItem}})}({UiCore:e["@UiCore"],template:Ra,CelledList:za}),Va=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PPCRedemptionChoiceDialog",{uiContextName:"redemption_choice_dialog",className:"redemption-choice-dialog dialog-type-B",dependencies:"dialogManager globalStringManager globalStartupModel rest ppcPin redemptionChoices bonusItems".split(" "),trackedEvents:function(){return[{type:"click",selector:"button.redeem-ppc",name:"redeem_ppc",handler:"__redeem"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("ppc_redemption_choice_dialog_title"),this.__redeemUrl=this.__globalStartupModel.get("ppcRedeemUrl"),this.addToDOM()},postRender:function(){this.setContent("body",e.template,{hasBonusItems:0<this.__bonusItems.length&&!1,bonusItems:this.__bonusItems}),this.setContent("footer",this.$(".dialog-footer-template").text()),this.__choiceList=this.createChildContext(e.CelledListPresenter,{$replaceElement:this.$(".redemption-choices-container"),collection:this.__redemptionChoices}),this.__choiceList.on("select",this.__enableRedeemButton.bind(this))},__enableRedeemButton:function(){this.$(".redeem-ppc").toggleClass("disabled",!1)},__redeem:function(){if(this.__selectedItem=this.__choiceList.getSelectedItem()){this.__setLoading(!0);var e=this.__selectedItem.get("type");this.__rest.post(this.__redeemUrl+"/prepaid_card-"+this.__ppcPin,{choice:e}).then(function(){var e={};_.each(this.__bonusItems,function(t,i){e["gift_"+i]=t.name});var t=this.__globalStringManager.get("ppc_redemption_success_message_gift_num_0",_.extend({base_item:this.__selectedItem.get("title")},e));this.__dialogManager.alert({title:this.__globalStringManager.get("ppc_redemption_success_title"),text:t,ok:this.__globalStringManager.get("ppc_redemption_success_button")}).finished.then(function(){return this.promiseResolver.accept()}.bind(this))}.bind(this)).catch(function(e){var t=this.__globalStringManager.get("ppc_redeem_error_invalid_code");switch(e.error.code){case"PPC-001":t=this.__globalStringManager.get("ppc_redeem_error_invalid_code");break;case"PPC-002":t=this.__globalStringManager.get("ppc_redeem_error_inactive_card");break;case"PPC-003":t=this.__globalStringManager.get("ppc_redeem_error_already_redeemed")}this.__dialogManager.alert({title:this.__globalStringManager.get("ppc_redemption_failed_title"),text:t,ok:this.__globalStringManager.get("ppc_redemption_failed_button")}).finished.then(function(){return this.promiseResolver.reject()}.bind(this))}.bind(this))}},__setLoading:function(e){this.$("button.redeem-ppc").prop("disabled",e)}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:Ha,CelledListPresenter:Wa}),qa={VK_BACKSPACE:8,VK_TAB:9,VK_ENTER:13,VK_CONTROL:17,VK_ESC:27,VK_SPACE:32,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_COMMA:188,wasPressed:function(e,t){return _.contains(t,e.keyCode)},is:function(e,t){if(!(t in this))throw Error("invalid key code: "+t);return e.keyCode===this[t]},getAlphaNumericChar:function(e){return(47<(e=e.keyCode)&&58>e||64<e||91>e)&&!(95<e&&106>e)&&(47<e&&58>e?e-48+"":64<e||91>e?String.fromCharCode(e).toLowerCase():95<e&&106>e?e-96+"":void 0)}},Ga=function(e){var t=e.UiCore.UiContext;return t.extend("PPCRedeem",{className:"ppc-redeem",uiContextName:"ppc_redeem",dependencies:"dialogManager globalStartupModel globalStringManager googleAnalytics leanplum loginManager modelCache platform Promise restModelFactory".split(" "),trackedEvents:function(){return[{type:"keyup",selector:"input.ppc-code",name:"ppcredeem_keyup",handler:this.__onKeyup.bind(this)},{type:"click",selector:"button.ppc-redeem-btn",name:"ppcredeem_click",handler:this.__inquiryPin.bind(this)}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__redeemUrl=this.__globalStartupModel.get("ppcRedeemUrl"),this.__formatNumber=e.FormatNumber,this.__myself=this.track(this.__loginManager.getCurrentUser()),this.__isMobile="mobile"===this.__platform,this.addToDOM(),this.listenTo(this,"clear_input",this.__clearInput),this.listenTo(this,"successfully_redeemed",this.__clearInput)},delete:function(){t.prototype.delete.call(this),this.__tooltip.delete()},render:function(){this.$el.html(e.template()),this.__tooltip=this.__serviceProvider.create(e.Tooltip,{$replaceElement:this.$(".ppc-redeem-tooltip"),$tooltipTarget:this.$(".ppc-redeem-tooltip-target")}),this.__$code=this.$(".ppc-code"),this.__$error=this.$(".input-error"),parseInt(this.__globalStartupModel.get("ppcDisabled"),10)&&(this.$(".ppc-code").prop("disabled",!0),this.$(".ppc-code").attr("placeholder","Temporarily Disabled"))},__validatePin:function(e){return!!this.__$code.val()||(this.__updateError(this.__globalStringManager.get("ppc_redeem_error_empty_code")),!1)},__inquiryPin:function(t){this.__validatePin()?(this.__leanplum.recordEvent("next_ppc_redeem_click_success"),this.__googleAnalytics.recordDollarStore("redeem","ppc"),this.__clearErrors(),t=this.__redeemUrl+"/prepaid_card-"+this.__$code.val(),this.ppc&&this.__modelCache.invalidate(t),this.ppc=this.__restModelFactory.readModel(t,e.UiCore.NodeModel),this.ppc.populated().then(function(e){if(e.get("redeemed")||!e.get("valid"))return new this.__Promise(function(e){e.reject({redeemed:!0})});var t=e.get("base_credits"),i=e.get("vip_months");if(this.__choices=new IMVU.NamedCollection,i){switch(i){case 12:i="1 "+this.__globalStringManager.get("Year")+" "+this.__globalStringManager.get("VIP Subscription");break;case 1:i="1 "+this.__globalStringManager.get("Month")+" "+this.__globalStringManager.get("VIP Subscription");break;default:i=i+" "+this.__globalStringManager.get("Months")+" "+this.__globalStringManager.get("VIP Subscription")}i=new IMVU.NamedModel({type:"vip",thumbnail:this.__getImageUrl("vip.png"),title:i,description:"",info:"",extra:{type:"tooltip",tooltip_header:this.__globalStringManager.get("VIP Club Subscription"),tooltip_body:this.$(".vip-tooltip-body").html()},isDisabled:!!this.__myself.get("is_vip")}),this.__choices.add(i)}if(t){switch(t){case 1e3>=t:i="credits-level-one.png";break;case 1e4>=t:i="credits-level-two.png";break;default:i="credits-level-three.png"}t=new IMVU.NamedModel({type:"credits",thumbnail:this.__getImageUrl(i),title:this.__formatNumber.formatCredits(t)+" "+this.__globalStringManager.get("Credits"),description:"",info:""}),this.__choices.add(t)}return e.getEdgeCollection("bonus_products").populated()}.bind(this)).then(function(t){var i=[];_.each(t.models,function(e){i.push({name:e.node.get("product_name"),thumbnail:e.node.get("preview_image")+"?width=150&height=150"})}.bind(this)),this.__dialogManager.showDialog(e.RedemptionChoiceDialog,{ppcPin:this.__$code.val(),bonusItems:i,redemptionChoices:this.__choices}).finished.then(function(){this.trigger("successfully_redeemed")}.bind(this))}.bind(this)).catch(function(e){e=e.redeemed?this.__globalStringManager.get("ppc_redeem_error_already_redeemed"):this.__globalStringManager.get("ppc_redeem_error_invalid_code"),this.__updateError(e),this.trigger("redeem_failed")}.bind(this))):this.__leanplum.recordEvent("next_ppc_redeem_click_error")},__updateError:function(e){this.__$code.toggleClass("has-error",!0),this.__$error.text(e).toggleClass("error-visible",!0)},__onKeyup:function(t){t.keyCode===e.Keys.VK_ENTER?this.__inquiryPin():(this.$("button.ppc-redeem-btn").toggleClass("disabled",!this.__validatePin()),this.__clearErrors())},__clearErrors:function(){this.__$code.toggleClass("has-error",!1),this.__$error.text("").toggleClass("error-visible",!1)},__getImageUrl:function(e){return"/common/withme/img/store/"+e},__clearInput:function(){this.__$code.val(""),this.__clearErrors()}})}({UiCore:e["@UiCore"],template:Fa,Keys:qa,Tooltip:Dt,RedemptionChoiceDialog:Va,FormatNumber:r}),ja=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="available-credits credits-value"></div>\n'},useData:!0})}(),Ka=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return'<span class="credits-value">'+(0,this.escapeExpression)("function"==typeof(a=t.totalCredits||e&&e.totalCredits)?a.call(e,{name:"totalCredits",hash:{},data:n}):a)+"</span>"},useData:!0})}(),Ya=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<legend class="system-info-header">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Credits",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</legend>\n"},useData:!0})}(),Xa=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;return'\n        <div class="promo-banner sale">'+(0,this.escapeExpression)("function"==typeof(a=t.sale_copy||e&&e.sale_copy)?a.call(e,{name:"sale_copy",hash:{},data:n}):a)+'<div class="triangle"></div></div>\n    '},3:function(e,t,i,n){var a;i=t.helperMissing;var s='\n        <div class="promo-banner most-popular">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"MOST POPULAR",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'<div class="triangle"></div></div>\n    '},5:function(e,t,i,n){var a;i=t.helperMissing;var s='\n        <div class="promo-banner best-value">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BEST VALUE",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'<div class="triangle"></div></div>\n    '},7:function(e,t,i,n){var a,s;return i='\n    <div class="item-info">\n        <div class="image-container"><span class="helper"></span><img></div>\n    </div>\n    <div class="item-price">\n        <div class="title">'+(i=this.escapeExpression)("function"==typeof(s=t.title||e&&e.title)?s.call(e,{name:"title",hash:{},data:n}):s)+"</div>\n        ",((a=t.if.call(e,e&&e.has_discount,{name:"if",hash:{},fn:this.program(8,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n        ",((a=t.unless.call(e,e&&e.has_discount,{name:"unless",hash:{},fn:this.program(10,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n    </div>\n    "},8:function(e,t,i,n){var a;return'\n        <div class="prices has-discount">\n            <span class="original-price">$'+(i=this.escapeExpression)("function"==typeof(a=t.original_price||e&&e.original_price)?a.call(e,{name:"original_price",hash:{},data:n}):a)+'</span> \n            <span class="sale-price">$'+i("function"==typeof(a=t.price||e&&e.price)?a.call(e,{name:"price",hash:{},data:n}):a)+"</span> \n        </div>\n        "},10:function(e,t,i,n){var a;return'\n        <div class="prices">\n            $'+(0,this.escapeExpression)("function"==typeof(a=t.price||e&&e.price)?a.call(e,{name:"price",hash:{},data:n}):a)+"\n        </div>\n        "},12:function(e,t,i,n){var a,s,o='\n    <div class="item-info">\n        <div class="image-container"><span class="helper"></span><img></div>\n        '+(i=this.escapeExpression)("function"==typeof(s=t.title||e&&e.title)?s.call(e,{name:"title",hash:{},data:n}):s)+'\n    </div>\n    <div class="item-price">\n        ';return((a=t.if.call(e,e&&e.has_discount,{name:"if",hash:{},fn:this.program(13,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+'\n        <span class="sale-price">$'+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+"</span>\n    </div>\n    "},13:function(e,t,i,n){var a;return'\n            <span class="original-price">$'+(0,this.escapeExpression)("function"==typeof(a=t.original_price||e&&e.original_price)?a.call(e,{name:"original_price",hash:{},data:n}):a)+"</span> \n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i='<div class="wrapper">\n    ',((a=t.if.call(e,e&&e.is_sale,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n    ",((a=t.if.call(e,e&&e.is_popular,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n    ",((a=t.if.call(e,e&&e.is_best,{name:"if",hash:{},fn:this.program(5,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n\n    ",((a=t.if.call(e,e&&e.showInDialog,{name:"if",hash:{},fn:this.program(7,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n    ",((a=t.unless.call(e,e&&e.showInDialog,{name:"unless",hash:{},fn:this.program(12,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n</div>"},useData:!0})}(),Ja=function(e){var t=e.UiCore.UiContext;return t.extend("BuyCreditListItem",{uiContextName:"buy_credit_list_item",tagName:"article",className:"buy-credit-list-item",dependencies:"featureAccessManager globalStringManager googleAnalytics imageManager leanplum loginManager model".split(" "),trackedEvents:function(){return[{type:"click",name:"choose_credit_item",handler:"__selectItem"}]},initialize:function(e){this.__selectedCredit=e.selectedCredit,this.__model=e.model,this.__imageManager=e.imageManager,this.__loginManager=e.loginManager,this.__featureAccessManager=e.featureAccessManager,this.__style=IMVU.optionalProperty(e,"style",""),this.__bestOption=IMVU.optionalProperty(e,"bestOption",0),this.__isVip=this.__loginManager.getCurrentUser().get("is_vip"),this.__isInDialog="in-dialog"===this.__style,this.__isInStore=IMVU.optionalProperty(e,"isInStore",!1),this.__context=IMVU.optionalProperty(e,"context",null),this.__useImageAbsolutePath=IMVU.optionalProperty(e,"useImageAbsolutePath",!1),this.__checkedForSelectedItem=!1,this.__percentageOff=IMVU.optionalProperty(e,"percentageOff",void 0),t.prototype.initialize.call(this,e),this.__featureAccessManager.canSeeVIPSale()&&!this.__isVip&&this.__context&&this.listenTo(this.__context,"add_vip_item",this.__updateVIPSalePrice),this.__context&&this.listenTo(this.__context,"refresh_items",this.__refreshProduct),this.addToDOM()},render:function(){t.prototype.render.call(this),this.__model.populated().then(function(){this.__isVipSaleOn=this.__model.get("vip_price")<this.__model.get("independent_purchase_price"),this.__featureAccessManager.canSeeVIPSale()&&this.__isVipSaleOn?this.__price=this.__isVip?this.__model.get("vip_price"):this.__model.get("independent_purchase_price"):this.__price=this.__model.get("independent_purchase_price"),this.__renderTemplate(),!this.__checkedForSelectedItem&&this.__isInDialog&&this.__isBestOption()&&this.__selectItem(),this.__checkedForSelectedItem=!0}.bind(this))},__getImageSrc:function(e,t){return t?e:"/common/withme/img/store/"+e},__selectItem:function(){this.__isInStore?(this.__selectedCredit.set({name:this.__model.get("title"),sale_price:this.__model.get("independent_purchase_price"),price:this.__price,vip_price:this.__model.get("vip_price"),original_price:this.__model.get("original_price"),sku:this.__model.get("sku"),pid:this.__model.get("pid"),type:this.__model.get("type"),image:this.__model.get("image")}),this.__leanplum.recordEvent("select_credit_in_store",{sku:this.__model.get("sku"),pid:this.__model.get("pid"),price:this.__price}),this.__googleAnalytics.recordDollarStore("view",this.__model.get("sku")),this.__selectedCredit.trigger("click")):(this.$el.toggleClass("selected-item"),this.$el.hasClass("selected-item")?(e.NextUtil.DomHelper.radioClass(this.$el,"selected-item"),this.__selectedCredit.set({name:this.__model.get("title"),sale_price:this.__model.get("independent_purchase_price"),price:this.__price,vip_price:this.__model.get("vip_price"),original_price:this.__model.get("original_price"),sku:this.__model.get("sku"),pid:this.__model.get("pid"),type:this.__model.get("type"),image:this.__model.get("image")}),this.__leanplum.recordEvent("select_credit_in_list",{sku:this.__model.get("sku"),pid:this.__model.get("pid"),price:this.__price})):this.__selectedCredit.set({price:0}))},__isBestOption:function(){return parseInt(this.__model.get("sku").replace("imvu.next.credits.",""))===this.__bestOption},__updateVIPSalePrice:function(e){this.__isVipSaleOn&&((e=e?this.__model.get("vip_price"):this.__model.get("independent_purchase_price"))!=this.__price&&(this.__price=e,this.__renderTemplate()))},__refreshProduct:function(){this.__model.invalidate(),this.render()},__renderTemplate:function(){this.__hasDiscount=this.__model.get("original_price")>this.__price,this.$el.html(e.template({has_discount:this.__hasDiscount,original_price:this.__model.get("original_price").toFixed(2),price:this.__price.toFixed(2),title:this.__model.get("title"),is_sale:this.__hasDiscount||this.__percentageOff,sale_copy:this.__percentageOff?this.__percentageOff+"% "+this.__globalStringManager.get("OFF"):this.__globalStringManager.get("SALE"),is_best:!this.__hasDiscount&&this.__model.get("best"),is_popular:!this.__hasDiscount&&!this.__model.get("best")&&this.__model.get("popular"),showInDialog:this.__isInDialog})),(this.__hasDiscount||this.__model.get("best")||this.__model.get("popular"))&&this.$el.addClass("has-promo"),this.__imageManager.load(this.$(".image-container > img"),this.__getImageSrc(this.__model.get("image"),this.__useImageAbsolutePath))}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:Xa}),Za=function(e){var t=e.UiCore.ListPresenter;return t.extend("BuyCreditList",{uiContextName:"buy_credit_list",className:"buy-credit-list",tagName:"section",itemFactory:e.BuyCreditListItem,initialize:function(i){t.prototype.initialize.call(this,i),this.$el.prepend(e.template())}})}({UiCore:e["@UiCore"],BuyCreditListItem:Ja,template:Ya}),Qa=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("BuyCreditDialog",{uiContextName:"buycredit_dialog",className:"buycredit-dialog dialog-type-B",dependencies:"restModelFactory Promise loginManager dialogManager globalStringManager globalStartupModel".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_to_checkout",handler:this.__backToCheckout}]},initialize:function(i){i=_.extend({includeBuyCredits:!0,includeBuyUpgrades:!1,includePromoCredits:!0},i),t.prototype.initialize.call(this,i),this.purchaseComplete=!1,this.serviceProvider=i.serviceProvider,this.dialogManager=i.dialogManager,this.__stringManager=i.globalStringManager,this.restModelFactory=i.restModelFactory,this.__myself=i.loginManager.getCurrentUser(),this.__totalAmount=IMVU.requireProperty(i,"totalAmount",0),this.__showAmount=0<this.__totalAmount,this.__bestOption=IMVU.optionalProperty(i,"bestOption",0),this.__includePromoCredits=i.includePromoCredits,this.includeBuyCredits=i.includeBuyCredits,this.__includeBuyUpgrades=i.includeBuyUpgrades,this.__formatNumber=e.FormatNumber,this.__storeCatalogUrl=i.globalStartupModel.get("storeCatalogUrl"),this.__storeCatalog=this.restModelFactory.readModel(this.__storeCatalogUrl,e.UiCore.NodeModel),this.title=this.__stringManager.get("buycredit_title"),this.__selectedCredit=new IMVU.NamedModel({price:0}),this.__selectedVip=new IMVU.NamedModel({price:0}),this.addToDOM(),this.listenTo(this,"add_vip_item",this.__toggleVIPPriceOnSelectedCredit)},destroy:function(){this.promiseResolver&&this.promiseResolver.resolve(this.purchaseComplete),this.hide(),this.delete()},show:function(){this.ppcRedeem&&this.ppcRedeem.trigger("clear_input"),t.prototype.show.call(this)},postRender:function(){this.__myself.populated().then(function(){return this.__wallet=this.__myself.getSingleEdge("wallet"),this.__wallet.populated()}.bind(this)).then(function(){return this.setContent("body",e.template,{amount:this.__formatNumber.formatCredits(this.__totalAmount),largeAmount:999<this.__totalAmount,showAmount:this.__showAmount}),this.$(".products-container").scrollbar(),this.setContent("auxHeader",e.headerCreditsTemplate,{}),this.createChildContext(e.CheckoutButton,{$parentElement:this.$(".dialog-footer"),selectedCredit:this.__selectedCredit,selectedVip:this.__selectedVip,globalStringManager:this.__stringManager,context:this}),this.ppcRedeem=this.createChildContext(e.PPCRedeem,{$parentElement:this.$(".ppc-redeem-placeholder")}),this.listenTo(this.ppcRedeem,"successfully_redeemed",this.destroy),this.listenTo(this.ppcRedeem,"redeem_failed",this.__onPPCRedeemFail),this.__updateCreditsDisplay(),this.listenTo(this.__wallet,"change",this.__updateCreditsDisplay),this.__storeCatalog.populated()}.bind(this)).then(function(e){return e.getEdgeCollection("items").populated()}.bind(this)).then(function(t){this.__storeCatalogItems=t,this.$(".buy-credit-list").remove(),this.$(".buy-upgrade-list").remove();for(var i=new IMVU.NamedCollection,n=new IMVU.NamedCollection,a=1e5,s=0;s<t.models.length;s++){if("credits"===(o=t.models[s].edge).get("type")){i.add(o);var o,r=(o=parseInt(o.get("sku").replace("imvu.next.credits.","")))-this.__totalAmount;0<r&&r<a&&(a=r,this.__bestOption=o)}else"vip"===o.get("type")&&n.add(o)}this.includeBuyCredits&&this.createChildContext(e.BuyCreditList,{$parentElement:this.$(".products"),collection:i,selectedCredit:this.__selectedCredit,style:"in-dialog",bestOption:this.__bestOption,context:this}),this.__includeBuyUpgrades&&!this.__myself.get("is_vip")&&this.createChildContext(e.BuyUpgradeList,{$parentElement:this.$(".products"),collection:n,selectedVip:this.__selectedVip,style:"in-credit-dialog",globalStringManager:this.__stringManager,context:this})}.bind(this))},__currentWealth:function(){return this.__includePromoCredits?parseInt(this.__wallet.get("credits"))+parseInt(this.__wallet.get("promo_credits")):parseInt(this.__wallet.get("credits"))},__updateCreditsDisplay:function(){this.$(".available-credits").text(this.__formatNumber.formatCredits(this.__currentWealth()))},__backToCheckout:function(){this.destroy()},__toggleVIPPriceOnSelectedCredit:function(e){0<this.__selectedCredit.get("price")&&((e=e?this.__selectedCredit.get("vip_price"):this.__selectedCredit.get("sale_price"))!=this.__selectedCredit.get("price")&&this.__selectedCredit.set({price:e}))},__onPPCRedeemFail:function(){this.$(".products-container").scrollTop(this.$(".products-container").height())}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],Model:e["@Model"],template:Ia,backButtonTemplate:Na,headerCreditsTemplate:ja,FormatNumber:r,creditsValueTemplate:Ka,BuyCreditList:Za,CheckoutButton:Li,BuyUpgradeList:Fi,PPCRedeem:Ga}),es=function(e){var t=e.UiCore.UiContext;return t.extend("CreditsWidget",{uiContextName:"credits_widget",className:"credits-widget",dependencies:["dialogManager","leanplum","loginManager"],trackedEvents:function(){return[{type:"click",selector:".credits-widget-container",name:"credits_widget_click",handler:"__onClick"}]},initialize:function(i){t.prototype.initialize.call(this,i),this.addToDOM(),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__formatNumber=e.FormatNumber,this.__wallet=this.track(this.__myself.getSingleEdge("wallet")),this.__wallet.populated().then(function(){this.$(".details").show(),this.__updateWealth(),this.__wallet.on("change",this.__updateWealth,this)}.bind(this))},__updateWealth:function(){this.$(".available-credits").text(this.__formatNumber.formatCredits(Number(this.__wallet.get("credits")))),this.$(".promo-credit-value").text(this.__formatNumber.formatCredits(Number(this.__wallet.get("promo_credits")))),this.$(".promo-credits").toggleClass("has-promo-credits",0<this.__wallet.get("promo_credits"))},render:function(){this.$el.html(e.template())},delete:function(){this.__wallet.off(null,null,this),t.prototype.delete.call(this)},__onClick:function(t){this.__leanplum.recordEvent("credit_widget_click"),this.__dialogManager.showDialog(e.BuyCreditDialog,{totalAmount:0})}})}({UiCore:e["@UiCore"],FormatNumber:r,template:Aa,BuyCreditDialog:Qa}),ts=function(e){var t=IMVU.NamedModel;return t.extend("UndoRedoModel",{initialize:function(){t.prototype.initialize.apply(this,arguments),this.clearHistory()},add:function(e){this.undoArr.push(e),this.redoArr=[],this.trigger("add",e),this.__updateComputedAttributes()},undo:function(e){return this.redoArr.push(e),e=this.undoArr.pop(),this.trigger("undo",e),this.__updateComputedAttributes(),e},redo:function(e){return this.undoArr.push(e),e=this.redoArr.pop(),this.trigger("redo",e),this.__updateComputedAttributes(),e},clearHistory:function(){this.undoArr=[],this.redoArr=[],this.__updateComputedAttributes()},isInHistory:function(e){var t=e.get("product_id").toString();return e=function(e){return e=_.last(e.split("/")).split(","),_.contains(e,t)},_.find(this.undoArr,e)||_.find(this.redoArr,e)},__updateComputedAttributes:function(){this.set({canUndo:!!this.undoArr.length,canRedo:!!this.redoArr.length})},get:function(e){switch(e){case"lastUndo":return _.last(this.undoArr);default:return t.prototype.get.apply(this,arguments)}}})}(e["@UiCore"]),is=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<button class="btn ap ap-badge"></button>'},3:function(e,t,i,n){var a;return'\n        <div class="price-info">\n            <div class="price-credits">'+(0,this.escapeExpression)("function"==typeof(a=t.price||e&&e.price)?a.call(e,{name:"price",hash:{},data:n}):a)+"</div>\n        </div>\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s,o='<div class="row">\n    <div class="product-img">\n        <img src="'+(i=this.escapeExpression)("function"==typeof(s=t.preview_image||e&&e.preview_image)?s.call(e,{name:"preview_image",hash:{},data:n}):s)+'">\n        ';return((a=t.if.call(e,e&&e.is_ap,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+='\n        <div class="wearing-indicator"></div>\n    </div>\n    <div class="product-info">\n        <div class="product-name">'+i("function"==typeof(s=t.product_name||e&&e.product_name)?s.call(e,{name:"product_name",hash:{},data:n}):s)+'</div>\n        <div class="created-by"></div>\n        ',((a=t.unless.call(e,e&&e.is_owned,{name:"unless",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(o+=a),o+"\n    </div>\n</div>\n"},useData:!0})}(),ns=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("ProductRow",{className:"product-row",uiContextName:"product_row",dependencies:["loginManager","featureAccessManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".row.can-toggle",name:"toggle_product",handler:"__toggleProduct"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__user=this.track(e.loginManager.getCurrentUser()),this.__dressUpAvatarManager=IMVU.optionalProperty(e,"dressUpAvatarManager"),this.__undoRedo=IMVU.optionalProperty(e,"undoRedo"),this.addToDOM()},render:function(){this.model.populated().then(function(){return this.$el.html(e.template({preview_image:IMVU.URI.build(this.model.get("preview_image"),{width:75,height:75}),product_name:this.model.get("product_name"),is_ap:"AP"===this.model.get("rating"),price:e.FormatNumber.formatCredits(this.model.get(this.__user.get("is_vip")?"discount_price":"product_price")),is_owned:!!this.model.get("is_owned")})),this.__dressUpAvatarManager&&this.__dressUpAvatarManager.populated().then(function(){this.__updateWearingStatus(),this.$(".row").addClass("can-toggle"),this.listenTo(this.__dressUpAvatarManager.getLookModel(),"change",this.__updateWearingStatus.bind(this))}.bind(this)),this.model.getSingleEdge("creator").populated()}.bind(this)).then(function(t){this.$(".created-by").show(),this.__displayName=this.createChildContext(e.Widgets.DisplayName,{$parentElement:this.$(".created-by"),user:t,size:"small",color:"medium",showVipBadge:!1,ignoreClicks:!0,prefix:this.__globalStringManager.get("By")})}.bind(this))},__updateWearingStatus:function(){this.$el.toggleClass("is-wearing",this.__dressUpAvatarManager.isWearing(this.model.id))},__toggleProduct:function(){this.__dressUpAvatarManager&&(this.__undoRedo&&this.__undoRedo.add(this.__dressUpAvatarManager.getLookModel().get("look_url")),this.model.get("is_bundle")?this.__dressUpAvatarManager.addAllSubproducts(this.model):this.__dressUpAvatarManager.isWearing(this.model.id)?this.__dressUpAvatarManager.remove(this.model.id):this.__dressUpAvatarManager.add(this.model.id))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],FormatNumber:r,template:is}),as=function(e){var t=e.UiCore.ListPresenter;return t.extend("InventoryProductList",{uiContextName:"inventory_product_list",className:"inventory-product-list",initialize:function(i){this.itemFactory=e.ProductRow,t.prototype.initialize.call(this,i)}})}({UiCore:e["@UiCore"],ProductRow:ns}),ss=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='cart-empty-content cart-notification'>\r\n    ";return((a=(t.icon||e&&e.icon||i).call(e,"icon-empty_cart",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+='\r\n    <span class="description">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"shopping_cart_empty",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</span>\r\n    <button class='btn go-to-shop btn-ghost full-width'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"go_to_shop",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</button>\r\n</div>\r\n<div class='cart-unavailable-content cart-notification'>\r\n    ",((a=(t.icon||e&&e.icon||i).call(e,"icon-cart_items_unavailable",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+="\r\n    <span class=\"description\"></span>\r\n    <button class='btn dismiss btn-ghost full-width'>",((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"OK",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+="</button>\r\n</div>\r\n<div class='cart-error-content cart-notification'>\r\n    ",((a=(t.icon||e&&e.icon||i).call(e,"icon-cart_items_error",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+='\r\n    <span class="description">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"shopping_cart_errors",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</span>\r\n</div>\r\n<ul class='items'>\r\n</ul>"},useData:!0})}(),os=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="cart-item-info">\r\n    <div class="product-placeholder"></div>\r\n    <div class="buttons">\r\n        <div class="more"></div>\r\n        <div class="remove">';return((a=(t.icon||e&&e.icon||i).call(e,"icon-trash2",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\r\n    </div>\r\n</div>\r\n<div class="expanding-section subproducts">\r\n    <div class="list-container"></div>\r\n    <div class="show">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Show items",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='&nbsp;(<span class="count"></span>)</div>\r\n    <div class="hide">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Hide items",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\r\n</div>\r\n<div class="expanding-section actions">\r\n    <div class="list-container"></div>\r\n    <div class="show">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Show actions",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='&nbsp;(<span class="count"></span>)</div>\r\n    <div class="hide">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Hide actions",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>\r\n</div>"},useData:!0})}(),rs=Te.extend("ReportProductDialog",{uiContextName:"report_product_dialog",className:"report-product-dialog",dependencies:["dialogManager","restModelFactory","globalStartupModel","globalStringManager"],title:"report_product_title",text:"report_product_text",dropdownOptions:[{label:"report_product_reason_inappropriate_content",value:"inappropriate_content"},{label:"report_product_reason_product_not_working",value:"product_not_working"}]}),ls=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("CartProductItem",{className:"cart-product-item",uiContextName:"cart_product_item",tagName:"article",dependencies:"imageManager loginManager contextMenuManager globalStringManager dialogManager Promise featureAccessManager rest".split(" "),trackedEvents:function(){return[{type:"click",selector:".remove",name:"remove_from_cart",handler:"__removeFromCart"},{type:"click",selector:".more",name:"more",handler:"__more"},{type:"click",selector:".actions .show",name:"show_actions",handler:this.__expandSection.bind(this,"actions")},{type:"click",selector:".actions .hide",name:"hide_actions",handler:this.__collapseSection.bind(this,"actions")},{type:"click",selector:".subproducts .show",name:"show_subproducts",handler:this.__expandSection.bind(this,"subproducts")},{type:"click",selector:".subproducts .hide",name:"hide_subproducts",handler:this.__collapseSection.bind(this,"subproducts")}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__dressUpAvatarManager=IMVU.optionalProperty(i,"dressUpAvatarManager"),this.__undoRedo=IMVU.optionalProperty(i,"undoRedo"),this.__triggerListFactory=i.triggerListFactory||e.TriggerList,this.__showExpandingSections=!!i.showExpandingSections,this.__avatarNode=IMVU.optionalProperty(i,"avatarNode"),this.addToDOM()},render:function(){this.model.populated().then(function(){this.model.node.get("is_bundle")&&(this.__subproducts=this.model.node.getEdgeCollection("subproducts",e.Model.ProductEdgeCollection)),this.$el.attr("data-id",this.model.node.id).html(e.template),this.createChildContext(e.ProductRow,{model:this.model.node,dressUpAvatarManager:this.__dressUpAvatarManager,undoRedo:this.__undoRedo,$replaceElement:this.$(".product-placeholder")}),this.model.node.get("is_bundle")&&this.createChildContext(e.BundleCount,{model:this.model.node,$parentElement:this.$(".product-img")}),this.__showExpandingSections&&(this.model.node.get("is_bundle")&&this.__buildSubproductsSection(),this.__buildActionsSection())}.bind(this))},__buildSubproductsSection:function(){this.__subproducts.populated().catch(function(){}).then(function(){this.$(".expanding-section.subproducts").addClass("shown"),this.$(".expanding-section.subproducts .count").text(this.__subproducts.length),this.createChildContext(e.LightboxProductList,{collection:new Backbone.Collection(_.pluck(this.__subproducts.models,"node")),$parentElement:this.$(".expanding-section.subproducts .list-container"),dressUpAvatarManager:this.__dressUpAvatarManager})}.bind(this))},__getActionLookUrl:function(){if(this.model.node.get("look_url"))return this.model.node.get("look_url");var e=this.model.node.get("is_bundle")?this.__subproducts.map(function(e){return e.node.id}):[this.model.node.id];return IMVU.URI.build(this.__avatarNode.get("look_url"),{add:e.join(",")})},__buildActionsSection:function(){this.__avatarNode.populated().then(function(){return this.__subproducts?this.__subproducts.populated().catch(function(){}):this.__Promise.accept()}.bind(this)).then(function(){return this.__rest.get(this.__getActionLookUrl())}.bind(this)).then(function(e){return e=e.response.data||e.response,this.__triggerList=this.__serviceProvider.create(this.__triggerListFactory),this.__triggerList.loadTriggers(e.assetURL)}.bind(this)).then(function(){var t=this.__subproducts?_.compact(this.__subproducts.map(function(e){return e.node.isPopulated()?this.__triggerList.triggersForProduct(e.node):null}.bind(this))):[this.__triggerList.triggersForProduct(this.model.node)],i=_.reduce(t,function(e,t){return e+t.length},0);0<i&&(this.$(".expanding-section.actions").addClass("shown"),this.$(".expanding-section.actions .count").text(i),t=this.createChildContext(e.ActionList,{productTriggers:t,$parentElement:this.$(".expanding-section.actions .list-container")}),this.listenTo(t,"playAction",this.trigger.bind(this,"playAction")))}.bind(this))},__removeFromCart:function(){this.__undoRedo&&_.any(this.__subproducts?this.__subproducts.models:[this.model],function(e){return e.node&&(this.__dressUpAvatarManager.isWearing(e.node.id)||this.__undoRedo.isInHistory(e.node))}.bind(this))&&this.__undoRedo.clearHistory(),this.trigger("takeOff",this.model.node),this.model.edge.destroy(),this.delete()},__more:function(t){var i=this.model.node.get("is_wished");i=[{name:"buy",divider:!0,text:this.__globalStringManager.get("buy_now_cart"),handler:this.__buy.bind(this)},{name:"wishlist",classNames:i?"disabled":"",text:this.__globalStringManager.get("move_to_wishlist"),handler:this.__moveToWishlist.bind(this)},{name:"report",text:this.__globalStringManager.get("Report"),handler:this.__report.bind(this)}];this.__contextMenuManager.showMenu(t,e.ContextMenu,{items:i,displayOptions:{right:!0}})},__buy:function(){this.trigger("checkout",[this.model.node])},__report:function(){this.__dialogManager.showDialog(e.ReportProductDialog,{model:this.model.node}).finished.then(this.__removeFromCart.bind(this))},__moveToWishlist:function(){this.__myself.getSummaryCollection("wishlist",e.Model.ProductEdgeCollection).create({id:this.model.node.id}),this.__removeFromCart()},__expandSection:function(e){this.$(".expanding-section."+e).addClass("expanded"),this.__dressUpAvatarManager&&(this.model.node.get("is_bundle")?this.__dressUpAvatarManager.addAllSubproducts(this.model.node):this.__dressUpAvatarManager.add(this.model.node.id))},__collapseSection:function(e){this.$(".expanding-section."+e).removeClass("expanded")}})}({UiCore:e["@UiCore"],Model:e["@Model"],template:os,ContextMenu:A,ReportProductDialog:rs,ProductRow:ns,TriggerList:a,ActionList:R,BundleCount:p,LightboxProductList:Q}),ds=function(e){var t=e.Widgets.EdgeCollectionPresenter;return t.extend("CartProductList",{className:"cart-product-list",uiContextName:"cart_product_list",tagName:"section",itemFactory:e.CartProductItem,dependencies:["modeManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".btn.go-to-shop",name:"go_to_shop",handler:"__goToShop"},{type:"click",selector:".cart-unavailable-content .btn.dismiss",name:"dismiss_unavailable_notification",handler:"__dismissUnavailableNotification"}]},initialize:function(e){e.reverse=!0,t.prototype.initialize.call(this,e)},renderTemplate:function(){this.$el.html(e.template),this.$itemContainer=this.$(".items"),this.__handleAnyErrors(),t.prototype.renderTemplate.call(this)},__handleAnyErrors:function(){var e=[],t=[];if(this.collection.each(function(i){if(i.node&&i.node.isError()){var n=i.node.getError().code;400<=n&&500>n?t.push(i):e.push(i)}else i.isError()&&e.push(i)}),_.each(t,function(e){e.edge.destroy()}.bind(this)),e.length)this.$el.addClass("has-errors");else if(t.length){this.$el.addClass("has-unavailables");var i=1<t.length?"shopping_cart_unavailable_products":"shopping_cart_unavailable_product";this.$(".cart-unavailable-content .description").text(this.__globalStringManager.get(i,{count:t.length}))}},__updateEmpty:function(){this.$el.toggleClass("is-empty",!this.collection.any(function(e){return e.isPopulated()}))},__goToShop:function(){var e=this.__modeManager.getCurrentMode();e&&"shop"===e.id||this.__modeManager.openMode({mode:{id:"shop"}}),this.trigger("dismiss")},__dismissUnavailableNotification:function(){this.$el.removeClass("has-unavailables")}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],CartProductItem:ls,template:ss}),cs=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<span class="become">Become<br/>a VIP Member</span><br/>\n<span class="free">Get Free Credits<br/>&amp; Discounts</span>\n'},useData:!0})}(),hs=function(e){var t=e.UiCore.UiContext;return t.extend("VIPUpsellReveal",{className:"VIP-Upsell-Reveal",uiContextName:"vip_upsell_reveal",dependencies:[],trackedEvents:function(){},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template({}))}})}({UiCore:e["@UiCore"],template:cs}),_s=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="wipe-container">\n    <div class="above"></div>\n\n    <div class="wipe-trigger">\n        <div class="crown-icon-wrapper">\n            <svg class="crown-icon" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M15 5.5a.86.86 0 1 0-1.5.6l-2.4 2.36a.16.16 0 0 1-.27-.05L8.48 3.1a.86.86 0 0 0-.46-1.6.86.86 0 0 0-.47 1.6L5.2 8.4a.16.16 0 0 1-.26.06L2.5 6.06A.86.86 0 1 0 1 5.5c0 .44.34.8.78.85l.76 6.3c.22.5 2.58.9 5.48.9 2.9 0 5.26-.4 5.47-.9l.76-6.3A.86.86 0 0 0 15 5.5"/></svg>\n        </div>\n    </div>\n\n    <div class="below-base">\n        <div class="below-wrapper">\n            <div class="below"></div>\n        </div>\n    </div>\n\n    <div class="wipe"></div>\n</div>'},useData:!0})}(),gs=function(e){var t=e.UiCore.UiContext;return t.extend("WipeReveal",{className:"Wipe-Reveal",uiContextName:"wipe_reveal",dependencies:["dialogManager","loginManager"],trackedEvents:function(){return[{type:"click",selector:".below-base",name:"wipe_reveal_above_click",handler:"__onClickAbove"},{type:"click",selector:".wipe-trigger",name:"wipe_reveal_below_click",handler:"__onClickBelow"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.aboveWidget=e.aboveWidget,this.belowWidget=e.belowWidget,this.addToDOM(),this.__myself=this.__loginManager.getCurrentUser(),this.listenTo(this.__myself,"change:is_vip",this.__hideUpsell)},__hideUpsell:function(){this.$el.toggleClass("hide-upsell",!!this.__myself.get("is_vip"))},render:function(){this.$el.html(e.template),void 0!==this.aboveWidget&&(this.aboveWidgetChild=this.createChildContext(this.aboveWidget,{$parentElement:this.$(".above")})),void 0!==this.belowWidget&&(this.belowWidgetChild=this.createChildContext(this.belowWidget,{$parentElement:this.$(".below")}));var t=this.$(".wipe-trigger");t.on("mouseover",function(){t.addClass("hover")}),t.on("mouseout",function(){t.removeClass("hover")}),t.on("click",function(e){if("mobile"===this.__serviceProvider.get("platform"))t.hasClass("peeled-back")||e.stopPropagation();else if(t.hasClass("hover"))return;t.toggleClass("peeled-back")}.bind(this)),this.$(".Wipe-Reveal").on("click",function(){t.removeClass("peeled-back")})},__onClickAbove:function(t){this.__dialogManager.showDialog(e.BuyCreditDialog,{totalAmount:0})},__onClickBelow:function(t){this.__dialogManager.showDialog(e.BuyUpgradeDialog)}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:_s,BuyCreditDialog:Qa,BuyUpgradeDialog:Hi}),ps=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;i=t.helperMissing;var o=this.escapeExpression,r='<div class="error-icon">';return((a=(s=t.icon||e&&e.icon||i).call(e,"icon-cart-full",{name:"icon",hash:{},data:n}))||0===a)&&(r+=a),r+='</div>\n<div class="error-body">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"shopping_cart_full_error",{name:"i18n-g",hash:{},data:n}))||0===a)&&(r+=a),r+'</div>\n<button class="btn btn-primary dismiss">'+o("function"==typeof(s=t.ctaText||e&&e.ctaText)?s.call(e,{name:"ctaText",hash:{},data:n}):s)+"</button>\n"},useData:!0})}(),us=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("CartFullErrorDialog",{uiContextName:"cart_full_error_dialog",className:"cart-full-error-dialog",dependencies:["dialogManager"],trackedEvents:function(){return[{type:"click",selector:".dismiss",name:"dismiss",handler:"__dismiss"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__ctaText=e.ctaText,this.addToDOM()},postRender:function(){this.hideHeader(),this.$(".dialog-body").replaceWith(e.template({ctaText:this.__ctaText}))},__dismiss:function(){this.hide(),this.promiseResolver.accept()}})}({Dialogs:e["@Dialogs"],template:ps}),ms=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='cart-notification'>\r\n    ";return((a=(t.icon||e&&e.icon||i).call(e,"icon-cart_error",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+='\r\n    <span class="description">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"shopping_cart_error",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</span>\r\n</div>\r\n"},useData:!0})}(),fs=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("CartError",{className:"cart-error",uiContextName:"cart_error",initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template)}})}({UiCore:e["@UiCore"],template:ms}),vs=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='cart-details'>\n    <div class='item-count'>\n        ";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"cart_subtotal",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='&nbsp;(<span class="value"></span>)\n    </div>\n    <div class=\'total-price price-credits\'>\n        <span class="value"></span>\n    </div>\n</div>\n<button class="btn btn-primary full-width loading-placeholder disabled">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Loading",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</button>\n<button class="btn btn-primary full-width checkout disabled">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"CHECKOUT",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>"},useData:!0})}(),bs=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("CartCheckout",{className:"cart-checkout",uiContextName:"cart_checkout",dependencies:["loginManager","Promise","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".btn.checkout",name:"checkout",handler:"__checkout"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__myself=this.track(e.loginManager.getCurrentUser()),this.__cartModel=this.track(this.__myself.getSingleEdge("cart")),this.addToDOM()},render:function(){this.$el.html(e.template),this.__cartModel.populated().then(function(){return this.__cartProducts=this.__cartModel.getEdgeCollection("products",e.Model.CartProductCollection),this.__cartProducts.enumerated()}.bind(this)).then(function(){this.__updateItems(),this.listenTo(this.__cartProducts,"add remove reset",this.__updateItems.bind(this))}.bind(this)).catch(this.__onCartError.bind(this))},__updateItems:function(){this.__cartProducts.populated({ignoreBadProducts:!0}).then(function(){var t=0,i=0;this.__cartProducts.each(function(n){if(n.isPopulated()&&(t++,i+=n.node.get(this.__myself.get("is_vip")?"discount_price":"product_price"),n.node.get("is_bundle"))){var a=n.node.getEdgeCollection("subproducts",e.Model.ProductEdgeCollection);a.populated().then(function(){a.map(function(e){e.node.get("is_owned")&&80!=e.node.get("product_id")&&191!=e.node.get("product_id")&&(i-=e.node.get(this.__myself.get("is_vip")?"discount_price":"product_price"),this.__updatePrice(i))}.bind(this))}.bind(this))}}.bind(this)),this.__updatePrice(i),this.$(".item-count .value").text(this.__globalStringManager.get(1===t?"cart_items_single":"cart_items_plural",{count:t})),this.$(".btn.checkout").toggleClass("disabled",0===t)}.bind(this))},__updatePrice:function(t){this.$(".total-price .value").text(e.FormatNumber.formatCredits(t))},finishedLoading:function(){this.$el.addClass("loaded")},__checkout:function(){this.trigger("checkout")},__onCartError:function(){this.$(".cart-details").hide(),this.$(".btn.checkout").addClass("disabled")}})}({Model:e["@Model"],UiCore:e["@UiCore"],template:vs,FormatNumber:r}),Cs=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='undo'>";return((a=(t.icon||e&&e.icon||i).call(e,"icon-undo",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+="</div>\r\n<div class='redo'>",((a=(t.icon||e&&e.icon||i).call(e,"icon-redo",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+"</div>"},useData:!0})}(),ys=function(e){var t=e.UiCore.UiContext;return e.UiCore.UiContext.extend("UndoWidget",{className:"undo-widget",uiContextName:"undo_widget",trackedEvents:function(){return[{type:"click",selector:".undo",name:"undo",handler:"__undo"},{type:"click",selector:".redo",name:"redo",handler:"__redo"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__dressUpAvatarManager=IMVU.requireProperty(e,"dressUpAvatarManager"),this.__undoRedo=IMVU.requireProperty(e,"undoRedo"),e.vertical&&this.$el.addClass("vertical"),this.addToDOM()},render:function(){this.$el.html(e.template),this.__refreshButtons(),this.listenTo(this.__undoRedo,"all",this.__refreshButtons)},__undo:function(){var e=this.__dressUpAvatarManager.getLookModel().get("look_url");this.__dressUpAvatarManager.forceChangeToLookUrl(this.__undoRedo.undo(e),!0)},__redo:function(){var e=this.__dressUpAvatarManager.getLookModel().get("look_url");this.__dressUpAvatarManager.forceChangeToLookUrl(this.__undoRedo.redo(e),!0)},__refreshButtons:function(){this.$(".undo").toggleClass("disabled",!this.__undoRedo.get("canUndo")),this.$(".redo").toggleClass("disabled",!this.__undoRedo.get("canRedo"))}})}({UiCore:e["@UiCore"],template:Cs}),Ms=function(e){var t=e.LightboxDialog;return t.extend("ShoppingCartLightbox",{uiContextName:"shopping_cart_lightbox",className:"shopping-cart-lightbox lightbox-dialog",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager loginManager platform restModelFactory".split(" "),initialize:function(i){this.title=i.globalStringManager.get("Shopping Cart"),t.prototype.initialize.call(this,i),this.__dressUpAvatarManagerFactory=i.dressUpAvatarManagerFactory||e.DressUpAvatarManager,this.__triggerListFactory=i.triggerListFactory,this.__imageFactory=i.imageFactory,this.__productsToAdd=i.productsToAdd||[],this.__myself=this.track(i.loginManager.getCurrentUser()),this.__restModelFactory=i.restModelFactory,this.__userEndPoint=this.__globalStartupModel.get("userEndpoint"),this.__productEndPoint=this.__globalStartupModel.get("productEndPoint"),this.__undoRedo=i.serviceProvider.create(e.UndoRedo,{}),this.__dressUpAvatarManager=this.__serviceProvider.create(this.__dressUpAvatarManagerFactory,{persistLooks:!1,confirmGenderChange:!1}),!this.__myself.get("is_vip")&&this.__featureAccessManager.canSeeVipUpsell()?this.addWidgetToSidebarPanel(e.WipeReveal,{aboveWidget:e.CreditsWidget,belowWidget:e.VIPUpsellReveal},"cart"):this.addWidgetToSidebarPanel(e.CreditsWidget,{},"cart"),this.__loadingPlaceholder=this.addWidgetToSidebarPanel(e.Widgets.LoadingPlaceholderList,{useSquareThumbnail:!0},"cart"),this.__cartCheckout=this.addFooterToSidebarPanel(e.CartCheckout,{},"cart"),this.listenTo(this.__cartCheckout,"checkout",this.__checkout.bind(this)),this.__cartModel=this.track(this.__myself.getSingleEdge("cart")),this.__avatarNode=this.__myself.getSingleEdge("avatar"),this.__Promise.every([this.__cartModel.populated(),this.__avatarNode.populated()]).then(function(){return this.__cartProducts=this.__cartModel.getEdgeCollection("products",e.Model.CartProductCollection),this.__cartProducts.enumerated()}.bind(this)).then(this.__addProductsToCart.bind(this)).then(function(){return this.__cartProducts.populated({ignoreBadProducts:!0})}.bind(this)).then(function(){for(var t=this.__cartProducts.models,i=Object.keys(t),n=i.length,a=0;a<n;a++){var s=t[i[a]];void 0!==s.node&&void 0!==s.node.relations&&void 0!==s.node.relations.creator&&this.__restModelFactory.multiGetQueueElement(this.__userEndPoint,s.node.relations.creator),s&&s.node&&s.node.id&&this.__restModelFactory.multiGetQueueElement(this.__productEndPoint,s.node.id)}this.__restModelFactory.multiGetRequest(this.__userEndPoint,e.UiCore.NodeModel),this.__restModelFactory.multiGetReset(this.__userEndPoint),this.__restModelFactory.multiGetRequest(this.__productEndPoint,e.Model.ProductNode),this.__restModelFactory.multiGetReset(this.__productEndPoint),this.__loadingPlaceholder.delete(),this.__cartCheckout.finishedLoading(),this.__cartProductList=this.addWidgetToSidebarPanel(e.CartProductList,{dressUpAvatarManager:this.__dressUpAvatarManager,undoRedo:this.__undoRedo,collection:this.__cartProducts,showExpandingSections:!0,avatarNode:this.__avatarNode,triggerListFactory:this.__triggerListFactory},"cart"),this.listenTo(this.__cartProductList,"checkout",this.__checkout.bind(this)),this.listenTo(this.__cartProductList,"takeOff",this.__onCartProductRemove.bind(this)),this.listenTo(this.__cartProductList,"playAction",this.__playAction.bind(this)),this.listenTo(this.__cartProductList,"dismiss",this.delete.bind(this)),"mobile"!==this.__platform&&this.__addAvatar()}.bind(this)).catch(function(){this.__loadingPlaceholder.delete(),this.__cartCheckout.finishedLoading(),this.addWidgetToSidebarPanel(e.CartError,{},"cart")}.bind(this)),"desktop"===this.__platform&&this.__avatarNode.populated().then(function(){this.__avatarNode.attributes.products.forEach(function(e){this.__restModelFactory.multiGetQueueElement(this.__productEndPoint,e.id)}.bind(this)),this.__restModelFactory.multiGetRequest(this.__productEndPoint,e.Model.ProductNode),this.__restModelFactory.multiGetReset(this.__productEndPoint);var t=_.map(this.__avatarNode.get("products"),function(e){return e.id});this.__productURLsTotal=t.length,this.__productURLsCounter=0,this.products=new IMVU.NamedCollection,this.__Promise.every(_.map(t,function(t){this.__restModelFactory.readModel(t,e.Model.ProductNode).populated().then(function(t){this.products.add(t),this.__restModelFactory.multiGetQueueElement(this.__userEndPoint,t.relations.creator),this.__productURLsCounter++,this.__productURLsCounter==this.__productURLsTotal&&(this.__restModelFactory.multiGetRequest(this.__userEndPoint,e.UiCore.NodeModel),this.__restModelFactory.multiGetReset(this.__userEndPoint))}.bind(this)).catch(function(){return this.__Promise.accept()}.bind(this))}.bind(this))),this.addWidgetToSidebarPanel(e.Inventory,{collection:this.products,dressUpAvatarManager:this.__dressUpAvatarManager},"inventory")}.bind(this)),"mobile"===this.__platform&&(this.__toasterWidget=this.__serviceProvider.get("toasterWidget"),this.__toasterWidget.renderDownloadAppToaster())},__playAction:function(e,t){if(this.__avatarWidget)if(this.__dressUpAvatarManager.isWearing(t.id))this.__avatarWidget.playTriggeredAction(e);else{var i=function(){this.__avatarWidget.playTriggeredAction(e),this.__avatarWidget.off("assetChanged",i)}.bind(this);this.__avatarWidget.on("assetChanged",i),this.__dressUpAvatarManager.add(t.id)}},__addProductsToCart:function(){return this.__Promise.every(_.map(this.__productsToAdd,function(e){return this.__cartProducts.create({id:e.id})}.bind(this))).catch(this.__onCartAddFailure.bind(this))},__onCartAddFailure:function(t){"CART_PRODUCT-005"===t.error.error?this.__dialogManager.showDialog(e.CartFullErrorDialog,{ctaText:this.__globalStringManager.get("OK")}):this.__dialogManager.alert({title:this.__globalStringManager.get("add_to_cart_error_title"),text:this.__globalStringManager.get("add_to_cart_error_text"),ok:this.__globalStringManager.get("add_to_cart_error_ok")})},__addClothingToAvatar:function(e){var t=_.last(e);return this.__dressUpAvatarManager.checkGenderMatches(t.id).then(function(i){var n=_.pluck(e,"id");return i?this.__dressUpAvatarManager.addProducts(n):this.__dressUpAvatarManager.changeGenderAndAdd(t.get("gender"),n)}.bind(this))},__addAvatar:function(){this.__filterModel=this.__serviceProvider.create(e.Model.FilterModel,[],{}),this.__filterModel.set("category","all"),this.__dressUpAvatarManager.populated().then(function(){return this.__Promise.every(this.__cartProducts.map(function(t){if(t.node){if(t.node.get("is_bundle")){var i=t.node.getEdgeCollection("subproducts",e.Model.ProductEdgeCollection);return i.populated().catch(function(){}.bind(this)).then(function(){return this.__Promise.accept(_.pluck(i.filter(function(e){return e.node&&e.node.isPopulated()}),"node"))}.bind(this))}if(_.contains(t.node.get("is"),"clothing_product"))return this.__Promise.accept(t.node)}return this.__Promise.accept()}.bind(this)))}.bind(this)).then(function(e){return(e=_.compact(_.flatten(e))).length?this.__addClothingToAvatar(e):this.__Promise.accept()}.bind(this)).then(function(){this.__avatarWidget=this.addWidgetToMainContainer(e.Avatar,{model:this.__dressUpAvatarManager.getLookModel(),filterModel:this.__filterModel,imageFactory:this.__imageFactory,showLoadingProgress:!0,sceneContext:"shop_clothing"}),this.__featureAccessManager.canUndoInCart()&&(this.__undoWidget=this.addWidgetToMainContainer(e.UndoWidget,{dressUpAvatarManager:this.__dressUpAvatarManager,undoRedo:this.__undoRedo,vertical:!0}))}.bind(this))},__onCartProductRemove:function(e){e.get("is_bundle")?this.__dressUpAvatarManager.removeAllSubproducts(e):this.__dressUpAvatarManager.remove(e.id)},hide:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!1),t.prototype.hide.call(this)},show:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!0),t.prototype.show.call(this)},__checkout:function(t){t=new e.Checkout.CartCollection(t||_.pluck(this.__cartProducts.filter(function(e){return e.isPopulated()}),"node")),this.__markSelectedProducts(t),this.__dialogManager.showDialog(e.Checkout.CheckoutDialog,{cart:t,successOk:this.__globalStringManager.get("OK"),dressUpAvatarManager:this.__dressUpAvatarManager}).finished.then(function(){this.delete()}.bind(this))},__markSelectedProducts:function(e){_.each(e.models,function(e){this.__dressUpAvatarManager.isWearing(e.id)?e.set("is_worn_in_shop",!0):e.set("is_worn_in_shop",!1)}.bind(this))},delete:function(){this.__dressUpAvatarManager.delete(),t.prototype.delete.call(this)}})}({Checkout:e["@Checkout"],Model:e["@Model"],Widgets:e["@Widgets"],UiCore:e["@UiCore"],LightboxDialog:x,Avatar:L,DressUpAvatarManager:O,WipeReveal:gs,VIPUpsellReveal:hs,CartFullErrorDialog:us,CreditsWidget:es,CartProductList:ds,CartCheckout:bs,CartError:fs,Inventory:as,UndoWidget:ys,UndoRedo:ts}),ks=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;i=t.helperMissing;var s="\n    ";return((a=t.if.call(e,e&&e.showPriceInfo,{name:"if",hash:{},fn:this.program(2,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+='\n        <div class="icons">\n            ',((a=t.if.call(e,e&&e.showInfo,{name:"if",hash:{},fn:this.program(4,n),inverse:this.noop,data:n}))||0===a)&&(s+=a),s+='\n            <span class="icon gift hidden" title="',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Gift",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='"></span>\n            <span class="wishlist-container hidden">\n                <span class="icon wishlist add-to-wishlist hidden" title="',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"add_to_wishlist",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='"></span>\n                <span class="icon in-wishlist hidden" title="',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"remove_from_wishlist",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='">',((a=(t.icon||e&&e.icon||i).call(e,"icon-wishlist-added",{name:"icon",hash:{},data:n}))||0===a)&&(s+=a),s+"</span>\n            </span>\n            </div>\n        </div>\n"},2:function(e,t,i,n){var a,s,o=this.escapeExpression;return i=t.helperMissing,o='\n        <div class="price-info">\n            <div class="credits hidden">'+o("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:n}):s)+'</div>\n            <div class="owned-label hidden">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"IN INVENTORY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+='</div>\n            <div class="displayonly-label hidden">',((a=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"DISPLAY ONLY",{name:"i18n-g",hash:{},data:n}))||0===a)&&(o+=a),o+"</div>\n        </div>\n    "},4:function(e,t,i,n){var a;i=t.helperMissing;var s='<span class="icon more-info hidden" title="';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"more_options",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'""></span>'},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return i="",((a=t.if.call(e,e&&e.showProductInfo,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n"},useData:!0})}(),xs=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary send-gift" disabled>';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"gifting_recipient_list_dialog_cta",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'</button>\n<\/script>\n\n<script type="template">\n    <a></a>\x3c!-- get placed into modal heaer aux --\x3e\n<\/script>\n'},useData:!0})}(),ws=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return'<div class="user-picker-name-box-wrapper">\n    <span class="user-picker-to">To</span>\n    <div class="user-picker-name-box-scroll-wrapper">\n        <div class="user-picker-name-box">\n            <div class="user-name-list-presenter-placeholder"></div>\n            <input type="text" class="user-picker-search with-placeholder no-focus" placeholder="'+(0,this.escapeExpression)("function"==typeof(a=t.placeholderText||e&&e.placeholderText)?a.call(e,{name:"placeholderText",hash:{},data:n}):a)+'" tabindex="0" size="5">\n        </div>\n    </div>\n    <div class="clear-input"></div>\n</div>\n<div class="user-suggestion-list-presenter-container"></div>'},useData:!0})}(),Ps=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="user-info"><div class="username"></div></div><span class="icon remove-recipient"></span>\n'},useData:!0})}(),$s=function(e){var t=e.UiCore.UiContext;return t.extend("UserNameListItemPresenter",{tagName:"li",className:"user-name-list-item-presenter",uiContextName:"user_name_list_item_presenter",dependencies:["globalStringManager","featureAccessManager"],trackedEvents:function(){return[{type:"click",selector:".remove-recipient",name:"remove_recipient",handler:"__remove"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__globalStringManager=e.globalStringManager,this.__userPicker=e.userPicker,this.__namePresentation=e.namePresentation,this.addToDOM()},render:function(){this.model.populated().then(function(){switch(this.$el.html(e.template),this.__namePresentation){case"single":this.__displayName=this.createChildContext(e.Widgets.DisplayName,{$replaceElement:this.$(".username"),user:this.model,showVipBadge:!1,size:"small",color:"light"});break;case"dual":this.$el.addClass("user-name-list-item-presenter-dual-version"),this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".user-info"),user:this.model,configuration:"small-dual-darkbg",ignoreClicks:!0})}this.__parentUiContext.trigger("add",this),this.__parentUiContext.trigger("rendered")}.bind(this))},__remove:function(){this.__userPicker.toggleUserInCollection(this.model)}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:Ps}),Ss=function(e){return e.UiCore.ListPresenter.extend("UserNameListPresenter",{className:"user-name-list-presenter",uiContextName:"user_name_list_presenter",itemFactory:e.UserNameListItemPresenter})}({UiCore:e["@UiCore"],UserNameListItemPresenter:$s}),Us=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return'<li class="no-results">\n    <span class="no-results-text">'+(0,this.escapeExpression)("function"==typeof(a=t.noResultsText||e&&e.noResultsText)?a.call(e,{name:"noResultsText",hash:{},data:n}):a)+"</span>\n</li>\n"},useData:!0})}(),Ts=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'\n\t<div class="ap-badge">\n\t\tAP\n\t</div>\n'},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return i='<div class="checkBoxWrapper">\n    <input id="user-'+(i=this.escapeExpression)("function"==typeof(s=t.username||e&&e.username)?s.call(e,{name:"username",hash:{},data:n}):s)+'-checkbox" name="user-'+i("function"==typeof(s=t.username||e&&e.username)?s.call(e,{name:"username",hash:{},data:n}):s)+'-checkbox" class="checkbox" type="checkbox">\n    <label></label>\n</div>\n<div class="user-info">\n    <p class="username is-truncated"></p>\n</div>\n',((a=t.if.call(e,e&&e.show_ap,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n"},useData:!0})}(),Ds=function(e){var t=e.UiCore.UiContext;return t.extend("UserListItemPresenter",{tagName:"li",className:"user-list-item-presenter",uiContextName:"user_list_item_presenter",trackedEvents:function(){return[{type:"click",selector:"",name:"select_friend",handler:"__handleFriendSelection"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__disableFilter=e.disableFilter,this.__selectedUsers=e.selectedUsers||new Backbone.Collection,this.__allowPersonas=e.allowPersonas,this.__noneligibleUsers=e.noneligibleUsers||new Backbone.Collection,this.__disableFlag=IMVU.optionalProperty(e,"disableFlag",!1),this.__bgLight=(this.__useLargeProfileIcon=IMVU.optionalProperty(e,"useLargeProfileIcon",!0))?"large-dual-lightbg":"small-dual-lightbg",this.__bgDark=this.__useLargeProfileIcon?"large-dual-darkbg":"small-dual-darkbg",this.addToDOM()},render:function(){this.model&&this.model.populated?this.model.populated().then(function(){this.$el.html(e.template({show_ap:this.model.get("is_ap")&&!this.__disableFlag,username:this.model.get("username")})),this.__dualName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".username"),user:this.model,configuration:this.__bgLight}),0<this.__selectedUsers.length&&this.__selectedUsers.contains(this.model)&&this.__toggleUserItemSelected(),0<this.__noneligibleUsers.length&&this.__noneligibleUsers.contains(this.model)&&this.$el.addClass("disabled"),this.__disableFilter&&this.__disableFilter(this.model)&&this.$el.addClass("disabled"),this.__allowPersonas||0===this.model.get("persona_type")||this.$el.addClass("disabled")}.bind(this)).catch(function(){this.$el.hide()}.bind(this)):this.$el.hide()},__handleFriendSelection:function(){if(this.$el.hasClass("disabled")||(this.$el.parent().parent().parent().find(".user-picker-search").focus(),this.__toggleUserItemSelected(),this.trigger("selected",this.model)),void 0!==this.__dualName){var e=this.$("input").prop("checked")?this.__bgDark:this.__bgLight;this.__dualName.setConfiguration(e),this.__dualName.drawIt()}},__toggleUserItemSelected:function(){this.$el.toggleClass("is-selected"),this.$("input").prop("checked",!this.$("input").prop("checked"))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],template:Ts}),Ls=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;return'<li class="divider"><div class="system-info-header">'+(0,this.escapeExpression)("function"==typeof(a=t.title||e&&e.title)?a.call(e,{name:"title",hash:{},data:n}):a)+"</div></li>"},useData:!0})}(),Es=function(e){var t=e.UiCore.ListPresenter;return t.extend("UserSuggestionListPresenter",{className:"user-suggestion-list-presenter",uiContextName:"user_suggestion_list_presenter",itemFactory:e.UserListItemPresenter,dependencies:"globalStringManager searchModel timer restModelFactory $inputElement window featureAccessManager".split(" "),triggerNextPage:1,initialize:function(e){this.__user=e.user,this.__scroller=e.scroller?$(e.scroller):null,this.__window=e.window,this.__globalStringManager=e.globalStringManager,this.collection=new Backbone.Collection,this.__serviceProvider=e.serviceProvider,this.__additionalCollections=[],this.__featureAccessManager=e.featureAccessManager,this.searchModel=e.searchModel,this.timer=e.timer,this.__includeFriends=e.includeFriends,this.__additionalFilters=e.additionalFilters,this.restModelFactory=e.restModelFactory,t.prototype.initialize.call(this,e),this.searchModel.on("change:name",this.__onNameChange,this),this.searchModel.trigger("change:name")},delete:function(){this.__currentSearchCollection&&this.__currentSearchCollection.off(null,null,this),t.prototype.delete.call(this),this.$el.off(),this.collection.off(null,null,this),this.timer.clearTimeout(this.__onScrollTimeout),this.timer.clearTimeout(this.searchTimeout),$(this.__scroller).off("scroll.userSuggestionListPresenter")},__getSiteUserSuggestionsCollection:function(){var t=this.__serviceProvider.get("globalStartupModel").get("userEndpoint");return this.restModelFactory.rest.cancelAll(t),this.restModelFactory.searchCollection(t,_.extend({limit:5,username_like:this.searchModel.get("name")},this.__additionalFilters),e.UiCore.NodeCollection)},render:function(){this.__scroller=this.__scroller||this.$el,this.__scroller.scrollbar(),this.__scroller.addClass("loading"),$(this.__scroller).on("scroll.userSuggestionListPresenter",this.__onScroll.bind(this))},__onNameChange:function(){this.__scroller.addClass("loading");var e=this.searchModel.get("name");this.$(".user-list-item-presenter").removeClass("selected"),this.searchTimeout&&this.timer.clearTimeout(this.searchTimeout),""!==e&&null!==e?this.searchTimeout=this.timer.setTimeout(this.__searchForUser.bind(this),250):this.__includeFriends?this.__defaultFriendsList():(this.__resetList(),this.__currentSearchCollection&&this.__currentSearchCollection.off(null,null,this),this.__currentSearchCollection=null)},__addModelToCollection:function(t){_.isArray(t)?t[0]&&(t[0]instanceof e.UiCore.NodeModel?this.collection.add(t):this.collection.add(_.pluck(t,"node"))):this.collection.add(t instanceof e.UiCore.NodeModel?t:t.node)},__resetList:function(){this.collection.reset(),this.$el.empty(),this.__scroller.removeClass("loading paging")},__defaultFriendsList:function(){this.__currentSearchCollection=this.__searchUserFriendsCollection(""),this.__currentSearchCollection.on("paged",this.__onPaged,this),this.__currentSearchCollection.enumerated().then(function(){this.__resetList(),this.collection.reset(_.pluck(this.__currentSearchCollection.models,"node")),this.__currentSearchCollection.on("add",this.__addModelToCollection,this),this.collection.length&&this.$el.prepend(e.DividerTemplate({title:"FRIENDS"})),this.__onPaged()}.bind(this))},__searchUserFriendsCollection:function(t){t=t||this.searchModel.get("name");var i=this.__user.relations.friends;return this.restModelFactory.rest.cancelAll(i),this.restModelFactory.searchCollection(i,{limit:5,name_filter:t},e.UiCore.EdgeCollection)},__searchForUser:function(){this.__currentSearchCollection&&this.__currentSearchCollection.off(null,null,this);var t=this.searchModel.get("name");this.__includeFriends?(this.__currentSearchCollection=this.__searchUserFriendsCollection(),this.__additionalCollections=[this.__getSiteUserSuggestionsCollection.bind(this)]):this.__currentSearchCollection=this.__getSiteUserSuggestionsCollection(),this.__currentSearchCollection.on("paged",this.__onPaged,this),this.__currentSearchCollection.enumerated().then(function(){if(t!==this.searchModel.get("name"))return!1;this.__resetList(),this.__addModelToCollection(this.__currentSearchCollection.models),this.__includeFriends&&(this.collection.models.length?this.$el.prepend(e.DividerTemplate({title:"MATCHING FRIENDS"})):this.$el.prepend(e.DividerTemplate({title:"FRIENDS"}))),this.__currentSearchCollection.on("add",this.__addModelToCollection,this),this.__onPaged()}.bind(this)).catch(function(){this.__currentSearchCollection.off("paged",this.__onPaged,this),this.__resetList()}.bind(this))},__onPaged:function(){0===this.collection.models.length&&this.$el.html(e.NoResultsTemplate({noResultsText:this.__globalStringManager.get(this.searchModel.get("name")?"no_matches":"no_friends")})),this.__scroller.removeClass("loading paging"),this.__onScrollTimeout&&this.timer.clearTimeout(this.__onScrollTimeout),this.__onScrollTimeout=this.timer.setTimeout(this.__onScroll.bind(this),0)},__updateStickyDividers:function(){this.$(".divider").each(function(e,t){var i=$(t),n=i.position().top;i.find(".system-info-header").css({top:0>n?"0px":"",position:0>n?"absolute":"relative"})}.bind(this))},__onScroll:function(){this.__updateStickyDividers(),this.__currentSearchCollection&&this.__isScrolledIntoView()&&(this.__currentSearchCollection.hasNextPage()?(this.__scroller.addClass("paging"),this.__currentSearchCollection.getNextPage()):this.__additionalCollections[0]&&this.__getNextCollection())},__getNextCollection:function(){var t=this.__additionalCollections.shift();this.__currentSearchCollection.off(null,null,this);var i=this.__currentSearchCollection=t();this.__currentSearchCollection.on("paged",this.__onPaged,this),this.__currentSearchCollection.on("add",this.__addModelToCollection,this);var n=this.searchModel.get("name");this.__currentSearchCollection.enumerated().then(function(t){if(this.__currentSearchCollection==i){if(n!==this.searchModel.get("name"))return!1;this.__includeFriends&&""!==this.searchModel.get("name")&&this.$el.append(e.DividerTemplate({title:"MORE PEOPLE"})),this.__addModelToCollection(t.models),this.__onPaged()}}.bind(this)).catch(function(){this.__currentSearchCollection.off(null,null,this)}.bind(this))},__isScrolledIntoView:function(){var e;e=this.__scroller[0]===this.__window?this.__scroller.scrollTop()+this.__scroller.height():this.__scroller.offset().top+this.__scroller.height();var t=this.$el.children();return 0<t.length?0===(t=this.$el.children().eq(-this.triggerNextPage)).length||t.offset().top<=e:t.length===this.collection.length}})}({UiCore:e["@UiCore"],UserListItemPresenter:Ds,DividerTemplate:Ls,NoResultsTemplate:Us}),As=function(e){var t=e.UiCore.UiContext;return t.extend("UserPicker",{className:"user-picker",uiContextName:"user_picker",dependencies:"timer globalStringManager featureAccessManager platform dialogManager window".split(" "),trackedEvents:function(){return[{type:"keyup",selector:".user-picker-search",name:"keyup_user_search",handler:this.__onUserInput},{type:"click",selector:".user-picker-search",name:"click_user_search",handler:this.__onInputClick,allowBubble:!1},{type:"focus",selector:".user-picker-search",name:"focus_user_search",handler:this.__onFocus},{type:"blur",selector:".user-picker-search",name:"blur_user_search",handler:this.__onBlur},{type:"click",selector:".user-picker-name-box-wrapper",name:"click_user_picker_wrapper",handler:this.__onUserInputWrapperClick},{type:"click",selector:".clear-input",name:"clear_input",handler:this.__onClearInput,allowBubble:!0}]},initialize:function(i){this.__user=i.user,t.prototype.initialize.call(this,i),this.__args=i,this.__namePresentation=i.namePresentation,this.__window=i.window,this.__maxEntries=i.maxEntries||19,this.__disableFilter=i.disableFilter,this.__allowPersonas=i.allowPersonas,this.__canFlowUpwards=i.canFlowUpwards,this.__noneligibleUsers=i.noneligibleUsers||!1,this.__additionalClasses=i.additionalClasses,this.__timer=i.timer,this.__platform=i.platform,this.__dialogManager=i.dialogManager,this.__globalStringManager=i.globalStringManager,this.__keys=e.NextUtil.Keys,this.__useLargeProfileIcon=IMVU.optionalProperty(i,"useLargeProfileIcon",!0),this.__beginFocused=IMVU.optionalProperty(i,"beginFocused",!0),this.__includeFriends=IMVU.optionalProperty(i,"includeFriends",!0),this.__additionalFilters=IMVU.optionalProperty(i,"additionalFilters",{}),this.__placeholderText=IMVU.optionalProperty(i,"placeholder",this.__globalStringManager.get("Choose up to max Recipients",{maxEntries:this.__maxEntries})),this.userCollection=new Backbone.Collection,this.__mobileDialogType=IMVU.optionalProperty(i,"mobileDialogType",null),this.__mobileDialogTitle=i.mobileDialogTitle,this.searchModel=new Backbone.Model({name:null}),this.addToDOM(),this.listenTo(this.userCollection,"add remove reset",function(){this.trigger("recipientChanged",this.userCollection.length)}.bind(this)),this.__useLargeProfileIcon||this.$el.addClass("small-user-picker")},delete:function(){$(this.__window).off("resize.user-suggestions"),t.prototype.delete.call(this)},render:function(){this.$el.html(e.template({placeholderText:this.__placeholderText})),this.$el.attr("data-max-entries",this.__maxEntries),this.__additionalClasses&&this.$el.addClass(this.__additionalClasses),this.userNameListPresenter=this.createChildContext(e.UserNameListPresenter,{$replaceElement:this.$(".user-name-list-presenter-placeholder"),collection:this.userCollection,userPicker:this,namePresentation:this.__namePresentation}),this.userSuggestionPresenter=this.createChildContext(e.UserSuggestionListPresenter,{$parentElement:this.$(".user-suggestion-list-presenter-container"),collection:new Backbone.Collection,searchModel:this.searchModel,$inputElement:this.$(".user-picker-search"),user:this.__user,disableFilter:this.__disableFilter,selectedUsers:this.userCollection,noneligibleUsers:this.__noneligibleUsers,disableFlag:!0,includeFriends:this.__includeFriends,allowPersonas:this.__allowPersonas,useLargeProfileIcon:!!this.__useLargeProfileIcon,additionalFilters:this.__additionalFilters}),this.listenTo(this.userSuggestionPresenter,"selected",this.__toggleUserInCollection,this),this.__maxSuggestionHeight=parseInt(this.$(".user-suggestion-list-presenter-container > .user-suggestion-list-presenter").css("max-height"),10),0<this.__maxSuggestionHeight&&this.__canFlowUpwards&&(this.__maybeFlowUpwards(),$(this.__window).on("resize.user-suggestions",this.__maybeFlowUpwards.bind(this))),this.__beginFocused&&this.focusInput(),this.listenTo(this.userNameListPresenter,"rendered",function(){var e=this.$(".user-picker-name-box");this.$(".user-picker-name-box-scroll-wrapper").scrollbar(),e.scrollTop(e[0].scrollHeight)},this)},__maybeFlowUpwards:function(){var e=this.$(".user-picker-name-box-wrapper")[0].getBoundingClientRect(),t=$(this.__window).height();this.$el.toggleClass("flow-up",e.bottom+this.__maxSuggestionHeight>t)},focusInput:function(){this.$('input[type="text"]').focus()},clearList:function(){return this.userSuggestionPresenter.$(".user-list-item-presenter").removeClass("is-selected"),this.userSuggestionPresenter.$(".user-list-item-presenter input").prop("checked",!1),this.userCollection.reset(),this},toggleUserInCollection:function(e){this.userCollection.contains(e)?e.populated().then(function(e){var t=this.$(".user-list-item-presenter #user-"+e.get("username")+"-checkbox"),i=t.parent().parent();t.prop("checked",!1),i.removeClass("is-selected"),this.__toggleUserInCollection(e)}.bind(this)):this.__toggleUserInCollection(e)},__clearText:function(){this.$(".user-picker-search").val(""),this.searchModel.set("name",""),this.__refreshHasInput()},__onClearInput:function(){for(this.__clearText();0<this.userCollection.length;)this.toggleUserInCollection(this.userCollection.models[0])},__toggleUserInCollection:function(e){if(this.userCollection.contains(e))this.userCollection.remove(e),this.$el.removeClass("max-cap-disable"),1===this.__maxEntries&&this.__clearText(),this.$("input").show();else{if(this.userCollection.length>=this.__maxEntries)return;this.userCollection.add(e),this.userCollection.length>=this.__maxEntries?(this.$el.addClass("max-cap-disable"),this.$("input").hide()):this.$("input").show()}this.$("input").attr("placeholder",0<this.userCollection.length?"":this.__placeholderText),this.$("input").toggleClass("with-placeholder",0===this.userCollection.length),this.__refreshHasInput()},getUserList:function(){return _.map(this.userCollection.models,function(e){return e.id.replace("/user/","/users/").replace("/user-","/")})},getUserIdList:function(){return _.map(this.userCollection.models,function(e){return e.get("legacy_cid")})},__onUserInput:function(e){null!==this.__timer&&this.__timer.clearTimeout(this.__timer);var t=this.$(".user-picker-search").val(),i=$.trim(t);this.__refreshHasInput(),this.__keys.wasPressed(e,[8])&&""===i?this.__hasUsersToDelete():this.__highlightActive&&this.$(".user-name-list-presenter li:last-child").removeClass("highlight"),this.__timer.setTimeout(function(){i!==this.searchModel.get("name")&&this.searchModel.set("name",i)}.bind(this),0)},__refreshHasInput:function(){this.$el.toggleClass("has-input",0<this.userCollection.length||0<this.$(".user-picker-search").val().length)},__hasUsersToDelete:function(){if(0<this.userCollection.length){var e=this.$(".user-name-list-presenter li:last-child");e.hasClass("highlight")?(this.toggleUserInCollection(this.userCollection.models[this.userCollection.length-1]),this.__highlightActive=!1):""===this.searchModel.get("name")&&(e.addClass("highlight"),this.__highlightActive=!0)}},__showMobileDialog:function(){this.__dialogManager.showDialog(this.__mobileDialogType,{title:this.__mobileDialogTitle,userPickerArgs:this.__args}).finished.then(function(e){e&&(this.userCollection.each(this.__toggleUserInCollection.bind(this)),e.each(this.__toggleUserInCollection.bind(this)))}.bind(this))},__onUserInputWrapperClick:function(e){"mobile"===this.__platform&&this.__mobileDialogType?this.__showMobileDialog():this.$(".user-picker-search").focus()},__onInputClick:function(){"mobile"===this.__platform&&this.__mobileDialogType&&this.__showMobileDialog()},__onFocus:function(){this.$el.addClass("focused")},__onBlur:function(){this.$el.removeClass("focused")}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:ws,UserNameListPresenter:Ss,UserSuggestionListPresenter:Es}),Is=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("GiftingRecipientPicker",{uiContextName:"gifting_recipient_list",className:"gifting-recipient-picker dialog-type-B userpicker-dialog",dependencies:["loginManager","globalStringManager","Promise"],trackedEvents:function(){return[{type:"click",selector:"button.send-gift",name:"send_gift",handler:this.__handleSendGiftClicked}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__dialogManager=e.dialogManager,this.__loginManager=e.loginManager,this.__myself=this.track(this.__loginManager.getCurrentUser()),this.__Promise=e.Promise,this.__product=e.product,this.__stringManager=e.globalStringManager,this.__maxEntries=e.maxEntries||10,this.title=this.__stringManager.get("gifting_recipient_list_dialog_title",{count:0,max:this.__maxEntries}),this.addToDOM()},render:function(){t.prototype.render.call(this),this.__Promise.every([this.__myself.populated(),this.__product.populated()]).then(function(){this.userPicker=this.setContent("body",e.UserPicker,{maxEntries:this.__maxEntries,user:this.__myself,disableFilter:"GA"!==this.__product.get("rating")?this.__disableDueToNonGAProducts.bind(this):null,namePresentation:"single"}),this.listenTo(this.userPicker.userCollection,"add remove",this.__enableSendAndUpdateTitle),this.setContent("footer",this.$(".dialog-footer-template").text())}.bind(this))},postRender:function(){this.setContent("body",e.template)},__disableDueToNonGAProducts:function(e){return!e.get("is_ap")},__enableSendAndUpdateTitle:function(){this.$("button.send-gift").prop("disabled",0>=this.userPicker.userCollection.length),this.title=this.__stringManager.get("gifting_recipient_list_dialog_title",{count:this.userPicker.userCollection.length,max:this.__maxEntries}),this.$(".dialog-title").text(this.title)},__handleSendGiftClicked:function(){this.__dialogManager.showDialog(e.Checkout.GiftingDialog,{product:this.__product,userPicker:this.userPicker}).finished.then(function(e){e||this.promiseResolver.resolve()}.bind(this)).catch(function(){this.promiseResolver.reject()}.bind(this))}})}({UiCore:e["@UiCore"],Checkout:e["@Checkout"],Dialogs:e["@Dialogs"],UserPicker:As,template:xs}),Ns=function(e){var t=e.UiCore.UiContext;return t.extend("ShopActionBar",{uiContextName:"shop_action_bar",className:"shop-action-bar",dependencies:["contextMenuManager","dialogManager","globalStringManager","loginManager","restModelFactory"],trackedEvents:function(){return[{type:"click",selector:".more-info",name:"more_info",handler:"__showMoreInfo"},{type:"click",selector:".icon.gift",name:"gifting",handler:"__giftProduct"},{type:"click",selector:".icon.wishlist",name:"wishlisting",handler:"__addToWishlist"},{type:"click",selector:".icon.in-wishlist",name:"remove_from_wishlist",handler:"__removeFromWishlist"}]},initialize:function(e){this.__model=IMVU.requireProperty(e,"model"),this.__myself=e.loginManager.getCurrentUser(),this.__price=(this.__isVip=!!this.__myself.get("is_vip"))?this.__model.get("discount_price"):this.__model.get("product_price"),this.listenTo(this.__model,"change:is_wished",this.__setWishlist.bind(this)),this.listenTo(this.__model,"change:is_owned",this.__setInfoAndIconsDisplay.bind(this)),this.listenTo(this.__model,"change:is_purchasable",this.__setInfoAndIconsDisplay.bind(this)),t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template({showProductInfo:!0,showPriceInfo:!0,price:e.FormatNumber.formatCredits(this.__price),showInfo:!0})),this.__setWishlist(),this.__model.get("is_bundle")&&!this.__model.get("is_owned")?(this.__subproducts=this.__model.getEdgeCollection("subproducts",e.Model.ProductEdgeCollection),this.__subproducts.populated().then(function(){this.__setInfoAndIconsDisplay(),this.listenTo(this.__subproducts,"change:is_owned",this.__setInfoAndIconsDisplay.bind(this))}.bind(this)).catch(this.__setInfoAndIconsDisplay.bind(this))):this.__setInfoAndIconsDisplay()},__isOwned:function(){return this.__model.get("is_owned")||!(!this.__subproducts||!this.__subproducts.get("is_owned"))},__setInfoAndIconsDisplay:function(){var e=this.__isOwned(),t=!!this.__model.get("is_purchasable"),i=!e&&t,n=!e&&!t;this.$(".credits").toggleClass("hidden",!i),this.$(".owned-label").toggleClass("hidden",!e),this.$(".displayonly-label").toggleClass("hidden",!n),this.$(".gift").toggleClass("hidden",!t),this.$(".wishlist-container").toggleClass("hidden",e),this.$(".more-info").removeClass("hidden")},__showMoreInfo:function(t){var i=[{name:"report_product",text:this.__globalStringManager.get("product_context_menu_report_product"),handler:this.__reportProduct.bind(this)}];this.__contextMenuManager.showMenu(t,e.ContextMenu,{items:i,displayOptions:{right:!0,above:!0}})},__reportProduct:function(){this.$(".report").addClass("hidden"),this.__dialogManager.showDialog(e.ReportProductDialog,{model:this.__model}).finished.then(function(e){this.trigger("reported_item")}.bind(this))},__giftProduct:function(){this.__dialogManager.showDialog(e.GiftingRecipientPicker,{product:this.__model}).finished.then(function(e){}.bind(this))},__isWishlisted:function(){return!!this.__model.get("is_wished")},__setWishlist:function(){this.$(".icon.wishlist").toggleClass("hidden",this.__isWishlisted()),this.$(".icon.in-wishlist").toggleClass("hidden",!this.__isWishlisted())},__addToWishlist:function(){this.__myself.getSummaryCollection("wishlist",e.Model.ProductEdgeCollection).create({id:this.model.id})},__removeFromWishlist:function(){this.__restModelFactory.readModel(this.model.relations.viewer_wishlist,e.UiCore.EdgeModel).destroy()}})}({UiCore:e["@UiCore"],Model:e["@Model"],template:ks,ReportProductDialog:rs,ContextMenu:A,GiftingRecipientPicker:Is,FormatNumber:r}),Fs=function(e){var t=e.StandardHeadpiece;return t.extend("ProductHeadpiece",{className:"product-headpiece standard-headpiece",uiContextName:"product_headpiece",dependencies:["model","globalStringManager"],initialize:function(i){this.model=i.model,this.model.populated().then(function(){return i.info={imageUrl:IMVU.URI.build(this.model.get("preview_image"),{width:75,height:75}),headerText:this.model.get("product_name"),isAP:"AP"===this.model.get("rating")},i.info.imageUrl=i.info.imageUrl.replace(/\.localhost/,""),t.prototype.initialize.call(this,i),this.model.get("is_bundle")&&this.createChildContext(e.BundleCount,{model:this.model,$parentElement:this.$(".tile-body")}),this.model.getSingleEdge("creator").populated()}.bind(this)).then(function(t){this.createChildContext(e.Widgets.DisplayName,{$replaceElement:this.$(".secondary-text"),user:t,showVipBadge:!1,size:"small",color:"medium",prefix:this.__globalStringManager.get("by")})}.bind(this))}})}({UiCore:e["@UiCore"],Widgets:e["@Widgets"],BundleCount:p,StandardHeadpiece:h}),Hs=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return""},useData:!0})}(),Rs=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s="<div class='name-container'></div>\n<div class='products'></div>\n<button class='view-shop btn btn-small btn-ghost full-width'>";return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_shop",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+"</button>"},useData:!0})}(),Bs=function(e){var t=e.UiCore.UiContext;return t.extend("MoreByCreator",{className:"more-by-creator",uiContextName:"more_by_creator",dependencies:["globalStartupModel","modeManager","restModelFactory"],trackedEvents:function(){return[{type:"click",selector:"button.view-shop",name:"view_shop",handler:"__viewShop"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template),this.model.populated().then(function(){return this.__restModelFactory.searchCollection(this.__globalStartupModel.get("productEndpoint"),{creator:this.model.get("creator_name"),filter_inventory:1,cat:"106,108,3088,425",limit:10},e.Model.ProductCollection).enumerated()}.bind(this)).then(function(t){return(t=t.reject(function(e){return this.model.id===e.id}.bind(this))).length&&this.createChildContext(e.LightboxProductList,{collection:new Backbone.Collection(t.slice(0,4)),$parentElement:this.$(".products")}),this.model.getSingleEdge("creator").populated()}.bind(this)).then(function(t){this.__creator=t,this.__dualName=this.createChildContext(e.Widgets.DualName,{$parentElement:this.$(".name-container"),user:t,size:"small",hideAtAvatar:!0,displayArgs:{size:"small",showVipBadge:!1}}),this.$("button.view-shop").show()}.bind(this))},__viewShop:function(){var e={id:"products",creatorModel:this.__creator,showAlways:!0};this.__modeManager.openMode({mode:{id:"shop",submode:e},submode:e})}})}({Model:e["@Model"],UiCore:e["@UiCore"],Widgets:e["@Widgets"],LightboxProductList:Q,template:Rs}),Os=function(e){var t=e.UiCore.UiContext;return t.extend("SimilarItems",{className:"similar-items",uiContextName:"similar_items",dependencies:["restModelFactory"],initialize:function(e){t.prototype.initialize.call(this,e),this.__collection=e.collection,this.addToDOM()},render:function(){this.createChildContext(e.LightboxProductList,{$parentElement:this.$el,collection:new Backbone.Collection(_.pluck(this.__collection.models,"node").slice(0,4))})}})}({UiCore:e["@UiCore"],Model:e["@Model"],Widgets:e["@Widgets"],LightboxProductList:Q}),zs=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,n){var a;i=t.helperMissing;var s=this.escapeExpression;return"<li class='gender'>"+s((a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"product_gender",{name:"i18n-g",hash:{},data:n}))+": "+s("function"==typeof(a=t.gender||e&&e.gender)?a.call(e,{name:"gender",hash:{},data:n}):a)+"</li>"},3:function(e,t,i,n){var a;i=t.helperMissing;var s=this.escapeExpression;return"<li class='category'>"+s((a=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"product_category",{name:"i18n-g",hash:{},data:n}))+": "+s("function"==typeof(a=t.category||e&&e.category)?a.call(e,{name:"category",hash:{},data:n}):a)+"</li>"},compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a,s;return i="<div>\n    <img src='"+(i=this.escapeExpression)("function"==typeof(s=t.product_image||e&&e.product_image)?s.call(e,{name:"product_image",hash:{},data:n}):s)+"' />\n</div>\n<ul class='info'>\n    ",((a=t.if.call(e,e&&e.gender,{name:"if",hash:{},fn:this.program(1,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+="\n    ",((a=t.if.call(e,e&&e.category,{name:"if",hash:{},fn:this.program(3,n),inverse:this.noop,data:n}))||0===a)&&(i+=a),i+"\n</ul>"},useData:!0})}(),Ws=function(e){var t=e.UiCore.UiContext;return t.extend("ProductDetails",{className:"product-details",uiContextName:"product_details",initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.model.populated().then(function(){var t=this.__serviceProvider.create(e.Model.FilterModel,[],{});t.setCategoryByProduct(this.model),this.$el.html(e.template({product_image:this.model.get("legacy_outfit_image")||this.model.get("product_image"),gender:this.model.get("gender"),category:t.get("category")}))}.bind(this))}})}({UiCore:e["@UiCore"],Model:e["@Model"],template:zs}),Vs=function(e){var t=e.UiCore.UiContext;return t.extend("ProductDetailSidebar",{className:"product-detail-sidebar",uiContextName:"product_detail_sidebar",dependencies:["Promise","dressUpAvatarManager","globalStringManager","loginManager","platform"],initialize:function(i){t.prototype.initialize.call(this,i),this.model=IMVU.requireProperty(i,"model"),this.__loginManager.isLoggedIn()&&(this.__myself=this.__loginManager.getCurrentUser()),i=this.__serviceProvider.has("triggerListFactory")?this.__serviceProvider.get("triggerListFactory"):e.TriggerList,this.__triggerList=this.__serviceProvider.create(i),this.addToDOM()},render:function(){this.$el.addClass("loading"),this.$el.html(e.template),this.__creatorNode=this.model.getSingleEdge("creator");var t=[this.__triggerList.loadTriggers(this.__dressUpAvatarManager.getLookModel().get("asset_url")),this.__creatorNode.populated().catch(function(){})];this.model.get("is_bundle")&&(this.__subproductCollection=this.model.getEdgeCollection("subproducts",e.Model.ProductEdgeCollection),t.push(this.__subproductCollection.populated().catch(function(){}))),this.__loginManager.isLoggedIn()&&(this.__productEdgeCollection=this.model.searchEdgeCollection("uml_products",{limit:4,exclude_inventory_for:this.__myself.get("legacy_cid")},e.Model.ProductEdgeCollection),t.unshift(this.__productEdgeCollection.populated())),this.__loadingPromise=this.__Promise.every(t),this.__loadingPromise.then(function(){var t=this.__subproductCollection?this.__subproductCollection.map(function(e){return this.__triggerList.triggersForProduct(e.node)}.bind(this)):[this.__triggerList.triggersForProduct(this.model)];this.__subproductCollection&&this.__addAccordionSection(this.__globalStringManager.get("items_in_look"),e.SubproductList,{collection:this.__subproductCollection},!0);var i=_.reduce(t,function(e,t){return e+t.length},0);if(0<i){var n="desktop"===this.__platform;t=this.__addAccordionSection(this.__globalStringManager.get("actions_with_count",{count:i}),e.ActionList,{productTriggers:t},n);this.listenTo(t,"playAction",function(e){this.trigger("playAction",e)}.bind(this))}this.__addAccordionSection(this.__globalStringManager.get("details"),e.ProductDetails,{model:this.model}),this.__loginManager.isLoggedIn()&&(this.__creatorNode.isPopulated()&&this.__addAccordionSection(this.__globalStringManager.get("more_by_creator"),e.MoreByCreator,{model:this.model}),this.__productEdgeCollection.length&&this.__addAccordionSection(this.__globalStringManager.get("similar_items"),e.SimilarItems,{collection:this.__productEdgeCollection})),this.$el.removeClass("loading")}.bind(this))},loaded:function(){return this.__loadingPromise||this.__Promise.reject("Not Rendered")},__addStandardSections:function(){},__addAccordionSection:function(t,i,n,a){return this.createChildContext(e.AccordionSection,{$parentElement:this.$el,title:t,startOpen:!!a}).addWidget(i,n)}})}({UiCore:e["@UiCore"],Model:e["@Model"],AccordionSection:f,ActionList:R,MoreByCreator:Bs,ProductDetails:Ws,SimilarItems:Os,SubproductList:d,TriggerList:a,template:Hs}),qs=function(e){var t=e.LightboxDialog;return t.extend("ProductLightbox",{uiContextName:"product_lightbox",className:"product-lightbox lightbox-dialog",dependencies:["dialogManager","featureAccessManager","globalStringManager","loginManager","Promise"],initialize:function(i){t.prototype.initialize.call(this,i),this.__dressUpAvatarManagerFactory=i.dressUpAvatarManagerFactory||e.DressUpAvatarManager,this.__myself=this.track(i.loginManager.getCurrentUser()),this.__featureAccessManager.showProductDetailPage()&&this.linkToDetailsSubmode("shop",this.model),this.__imageFactory=i.imageFactory,this.__filterModel=this.__serviceProvider.create(e.Model.FilterModel,[],{}),this.__filterModel.setCategoryByProduct(this.model),this.__dressUpAvatarManager=this.__serviceProvider.create(this.__dressUpAvatarManagerFactory,{persistLooks:!1,confirmGenderChange:!1}),this.model.populated().then(function(){return this.__creatorNode=this.model.getSingleEdge("creator"),this.model.get("is_bundle")&&(this.__subproductCollection=this.model.getEdgeCollection("subproducts",e.Model.ProductEdgeCollection)),this.__applyProduct(),this.__addAvatar(),this.__setupHeadpiece(),this.__setupSidebar(),this.__cartModel=this.track(this.__myself.getSingleEdge("cart")),this.__cartModel.populated()}.bind(this)).then(function(){return this.__cartProducts=this.__cartModel.getEdgeCollection("products",e.Model.CartProductCollection),this.__cartProducts.enumerated()}.bind(this)).then(function(e){this.__updateAddToCartButton(),this.listenTo(this.__cartProducts,"add remove",this.__updateAddToCartButton.bind(this))}.bind(this))},__setupHeadpiece:function(){this.__creatorNode.populated().catch(function(){}).then(function(){return this.addWidgetToHeadpiece(e.ProductHeadpiece,{model:this.model}),this.actionBar=this.addWidgetToHeadpiece(e.ShopActionBar,{model:this.model}),this.listenTo(this.actionBar,"reported_item",this.hide),this.__subproductCollection?this.__subproductCollection.populated().catch(function(){}):this.__Promise.accept()}.bind(this)).then(function(){this.__updateHeadpieceButtons(),this.listenTo(this.model,"change:is_owned",this.__updateHeadpieceButtons.bind(this)),this.__subproductCollection&&this.listenTo(this.__subproductCollection,"change:is_owned",this.__updateHeadpieceButtons.bind(this))}.bind(this))},__updateHeadpieceButtons:function(){this.model.get("is_owned")||this.__subproductCollection&&this.__subproductCollection.get("is_owned")||!this.model.get("is_purchasable")?this.removeHeadpieceButtons():this.setHeadpieceButtons({ctaSecondary:this.__globalStringManager.get("add_to_cart"),ctaPrimary:this.__globalStringManager.get("buy_now"),shopLightbox:!0})},__setupSidebar:function(){this.setSidebarPanelLoading(!0),this.__productApplied.then(function(){this.__productDetailSidebar=this.addWidgetToSidebarPanel(e.ProductDetailSidebar,{model:this.model,productApplied:this.__productApplied,dressUpAvatarManager:this.__dressUpAvatarManager}),this.listenTo(this.__productDetailSidebar,"playAction",this.__playAction.bind(this)),this.__productDetailSidebar.loaded().then(function(){this.setSidebarPanelLoading(!1)}.bind(this))}.bind(this))},__applyProduct:function(){this.__productApplied=this.__dressUpAvatarManager.populated().then(function(){return this.model.get("look_url")?this.__dressUpAvatarManager.forceChangeToLookUrl(this.model.get("look_url")):this.model.get("is_bundle")?this.__dressUpAvatarManager.addAllSubproducts(this.model):this.__dressUpAvatarManager.add(this.model.id)}.bind(this))},__addAvatar:function(){this.__productApplied.then(function(){this.__avatarWidget=this.addWidgetToMainContainer(e.Avatar,{model:this.__dressUpAvatarManager.getLookModel(),filterModel:this.__filterModel,imageFactory:this.__imageFactory,showLoadingProgress:!0,sceneContext:"shop_clothing"})}.bind(this))},hide:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!1),t.prototype.hide.call(this)},show:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!0),t.prototype.show.call(this)},delete:function(){this.__dressUpAvatarManager.delete(),t.prototype.delete.call(this)},__onclickSecondary:function(){t.prototype.__onclickSecondary.call(this),this.__addToCart()},__onclickPrimary:function(){this.__openCheckoutDialog()},__addToCart:function(){this.__dialogManager.showDialog(e.ShoppingCartLightbox,{productsToAdd:[this.model]})},__updateAddToCartButton:function(){this.__cartProducts.checkCartContains(this.model.id).then(function(e){this.$(".btn.btn-ghost").toggleClass("hidden",e),this.$(".btn.btn-ghost.in-cart").toggleClass("hidden",!e)}.bind(this))},__openCheckoutDialog:function(){this.__dialogManager.showDialog(e.Checkout.CheckoutDialog,{cart:new e.Checkout.CartCollection([this.model]),successOk:this.__globalStringManager.get("OK")}).finished.then(this.delete.bind(this))},__playAction:function(e){this.__avatarWidget&&this.__avatarWidget.playTriggeredAction(e)}})}({Model:e["@Model"],Checkout:e["@Checkout"],Widgets:e["@Widgets"],LightboxDialog:x,Avatar:L,DressUpAvatarManager:O,ProductDetailSidebar:Vs,ProductHeadpiece:Fs,ShopActionBar:Ns,ShoppingCartLightbox:Ms}),Gs=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="panels">\n    <div class="left-panel">\n        <div class="left-panel-image-div"></div>\n        <div class="left-panel-text"><div class="adjustable"></div></div>\n        <button class="ap-badge btn ap hidden"></button>\n        <div class="headpiece"></div>\n    </div>\n    <div class="right-panel">\n        <div class="headpiece"></div>\n        <div class="main-column">\n            <div class="scroll-row hosted-by">\n                <div class="title-line">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Hosted by",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n                <div class="install-name-widget-here"></div>\n            </div>\n            <div class="scroll-row language">\n                <div class="title-line">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Language",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n                <div class="lang-payload"></div>\n            </div>\n            <div class="scroll-row occupancy">\n                <div class="title-line"><span>',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Occupancy",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+=' <span class="count-cap"></span></div>\n                <div class="line-up">\n                    <div class="logged-out-overlay-background"></div>\n                    <div class="logged-out-overlay">\n                        <div class="prompt-wrapper">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"join_to_view",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n                        <div class="login">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"join_login",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div>\n                    </div>\n                </div>\n            </div>\n            <div class="scroll-row description">\n                <div class="title-line">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Description",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'</div>\n                <div class="des-payload"></div>\n            </div>\n        </div>\n    </div>\n    <div class="mobile-chat-bar"></div>\n</div>\n'},useData:!0})}(),js=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,n){var a;i=t.helperMissing;var s='<div class="first-row">\n    <div class="image-div hidden"><img class="image-img"/></div>\n    <div class="text-div hidden"><div class="adjustable">';return((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"image_na",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+='</div></div>\n    <div class="name"></div>\n</div>\n<div class="second-row">\n    <div class="left-side">\n        <div class="more icon">\n            <g fill="#646464" fill-rule="evenodd"><svg viewBox="0 0 32 32">\n                <path d="M3.7 12.3C1.7 12.3 0 14 0 16s1.7 3.7 3.7 3.7S7.4 18 7.4 16s-1.6-3.7-3.7-3.7zm12 0c-2 0-3.8 1.6-3.8 3.7s1.6 3.7 3.6 3.7 3.7-1.7 3.7-3.7-1.6-3.7-3.7-3.7zm12.6 0c-2 0-3.7 1.6-3.7 3.7s1.6 3.7 3.7 3.7c2 0 3.7-1.7 3.7-3.7s-1.7-3.7-3.7-3.7z"/>\n            </svg></g>\n            <div class="more-overlay overlay"></div>\n        </div>\n        <div class="favorite icon hidden">\n            <g fill="#646464" fill-rule="evenodd"><svg viewBox="-2 -2 30 30">\n                 <path d="M18 2a6.17 6.17 0 0 0-4.346 1.77L12.5 4.93 11.346 3.77A6.174 6.174 0 0 0 7 2a6.18 6.18 0 0 0-4.42 1.841l-.12.121C.02 6.42-.667 11.063 3.487 15.684 7.332 19.958 12.5 23 12.5 23s5.167-3.042 9.011-7.316c4.155-4.62 3.468-9.264 1.03-11.722l-.12-.12A6.182 6.182 0 0 0 18.001 2m0 1c1.403 0 2.721.55 3.713 1.55l.117.116c2.151 2.17 2.657 6.211-1.063 10.35-3.002 3.337-6.893 5.938-8.268 6.808-1.375-.87-5.266-3.47-8.268-6.809-3.72-4.138-3.215-8.18-1.067-10.346l.124-.124A5.192 5.192 0 0 1 7 3c1.372 0 2.667.526 3.636 1.473l1.154 1.163.71.715.71-.715 1.143-1.153A5.19 5.19 0 0 1 18 3"></path>\n            </svg></g>\n            <div class="favorite-overlay overlay"></div>\n        </div>\n        <div class="favorited icon hidden">\n            <g fill="#FF374D" fill-rule="evenodd"><svg viewBox="0 0 25 25">\n                <path d="M12.5003077,4.931 L13.6533079,3.769 C14.8223082,2.627 16.3603085,2 18.0003088,2 C19.6753092,2 21.2433095,2.655 22.4203097,3.841 L22.5413097,3.962 C24.9793102,6.42 25.6653104,11.064 21.5113095,15.684 C17.6673088,19.958 12.5003077,23 12.5003077,23 C12.5003077,23 7.33230668,19.958 3.4883059,15.684 C-0.665694932,11.064 0.0213052062,6.42 2.4583057,3.962 L2.57930572,3.841 C3.75630596,2.655 5.32430627,2 6.99930661,2 C8.63930694,2 10.1773072,2.627 11.3463075,3.769 L12.5003077,4.931 Z" id="like-on-path-2"></path>\n            </svg></g>\n            <div class="favorited-overlay overlay"></div>\n        </div>\n        <div class="share icon"></div>\n    </div>\n    <div class="right-side">\n        <div class="join">',((a=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"join_room",{name:"i18n-g",hash:{},data:n}))||0===a)&&(s+=a),s+'</div>\n        <div class="join-overlay overlay"></div>\n    </div>\n</div>'},useData:!0})}(),Ks=function(e){var t=e.UiCore.UiContext,i=t.extend("RoomDetailWidgetHeadpiece",{className:"room-detail-widget-headpiece",uiContextName:"room_detail_widget_headpiece",dependencies:"dialogManager globalNav globalStringManager loginManager modeManager Promise window".split(" "),trackedEvents:function(){return[{type:"click",selector:".join",name:"join_room_click",handler:this.__joinRoom.bind(this)},{type:"click",selector:".more-overlay",name:"more_go_to_login",handler:this.__goToLogin.bind(this)},{type:"click",selector:".favorite-overlay",name:"favorite_go_to_login",handler:this.__goToLogin.bind(this)},{type:"click",selector:".favorited-overlay",name:"favorited_go_to_login",handler:this.__goToLogin.bind(this)},{type:"click",selector:".join-overlay",name:"join_go_to_login",handler:this.__goToLogin.bind(this)}]},__getDetailsFromRoom:function(){this.__roomID=this.__roomModel.id,this.__roomIsAP=this.__roomModel.get("is_ap"),this.__roomDescription=this.__roomModel.get("description"),this.__roomImageLandscrape=this.__roomModel.get("image_url")||this.__roomModel.get("themed_image_url"),this.__roomName=this.__roomModel.get("name"),this.__roomOwnerCID=this.__roomModel.get("customers_id"),this.__roomIsVIP=this.__roomModel.get("is_vip")},__addToDOMLeadIn:function(){this.__isLoggedIn?this.__myself.populated().then(function(){this.addToDOM()}.bind(this)):this.addToDOM()},initialize:function(e){t.prototype.initialize.call(this,e),this.__loginManager=e.loginManager,this.__isLoggedIn=this.__loginManager.isLoggedIn(),this.__roomModel=e.roomModel,this.__subMode=void 0===e.subMode?null:e.subMode,this.__parent=void 0===e.parent?null:e.parent,this.__modeManager=e.modeManager,this.__dialogManager=e.dialogManager,this.__globalNav=e.globalNav,this.__myself=this.__isLoggedIn?this.__loginManager.getCurrentUser():null,this.__roomModel.populated().then(function(e){this.__getDetailsFromRoom(),this.__roomModel.getSingleEdge("owner").populated().then(function(e){this.__roomOwnerModel=e,this.__addToDOMLeadIn()}.bind(this))}.bind(this))},__findElements:function(){this.__eleWidget=this.$el[0],this.__row1=this.__eleWidget.getElementsByClassName("first-row")[0],this.__row1Image=this.__row1.getElementsByClassName("image-div")[0],this.__row1ImageImg=this.__row1Image.getElementsByClassName("image-img")[0],this.__row1Text=this.__row1.getElementsByClassName("text-div")[0],this.__row1Name=this.__row1.getElementsByClassName("name")[0],this.__row2=this.__eleWidget.getElementsByClassName("second-row")[0],this.__row2Left=this.__row2.getElementsByClassName("left-side")[0],this.__row2LeftMore=this.__row2Left.getElementsByClassName("more")[0],this.__row2LeftFav=this.__row2Left.getElementsByClassName("favorite")[0],this.__row2LeftFaved=this.__row2Left.getElementsByClassName("favorited")[0],this.__row2LeftShare=this.__row2Left.getElementsByClassName("share")[0],this.__row2Right=this.__row2.getElementsByClassName("right-side")[0],this.__row2RightJoin=this.__row2Right.getElementsByClassName("join")[0],this.__row2Over=this.__row2.getElementsByClassName("overlay")[0]},__toggleFavoriteLocal:function(){this.__favorited=this.__row2LeftFav.classList.contains("hidden"),this.__onToggleFavorite(!this.__favorited).then(function(){(this.__favorited=!this.__favorited)?(this.__row2LeftFav.classList.add("hidden"),this.__row2LeftFaved.classList.remove("hidden")):(this.__row2LeftFav.classList.remove("hidden"),this.__row2LeftFaved.classList.add("hidden"))}.bind(this))},__isFavorited:function(){return!!this.__isLoggedIn&&(this.__favoritedCollection=this.__myself.getEdgeCollection("favorite_rooms"),this.__favoritedModels=[],this.__favoritedCollection.models.forEach(function(e){e=e.id.slice(6),this.__favoritedModels.push(e)}.bind(this)),this.__favorited=-1!==this.__favoritedModels.indexOf(this.__roomID))},__renderElements:function(){this.__isLoggedIn?(this.__viewImages=!this.__roomIsAP||!!this.__myself.get("is_ap"),this.__roomIsVIP&&(this.__viewImages=this.__myself.get("is_vip")),this.__eleWidget.classList.add("logged-in"),this.__eleWidget.classList.remove("not-logged-in")):(this.__viewImages=!this.__roomIsAP,this.__eleWidget.classList.remove("logged-in"),this.__eleWidget.classList.add("not-logged-in")),this.__row1ImageImg.setAttribute("src",this.__roomImageLandscrape),this.__viewImages?(this.__row1Image.classList.remove("hidden"),this.__row1Text.classList.add("hidden"),this.__row1Text.classList.remove("flexing")):(this.__row1Image.classList.add("hidden"),this.__row1Text.classList.remove("hidden"),this.__row1Text.classList.add("flexing")),this.__row1Name.innerHTML=this.__roomName,this.__socialShare=this.createChildContext(e.Widgets.SocialShare,{$parentElement:this.$(".second-row .left-side .share"),linkToCopy:location.href}),this.__isLoggedIn?(this.__row2LeftMore.setAttribute("title",this.__globalStringManager.get("more_options")),this.__row2LeftMore.addEventListener("click",this.__onShowActionMenu.bind(this)),this.__row2LeftMore.disabled=!1,this.__row2LeftFav.setAttribute("title",this.__globalStringManager.get("Favorite")),this.__row2LeftFaved.setAttribute("title",this.__globalStringManager.get("Favorite")),this.__row2LeftFav.addEventListener("click",this.__toggleFavoriteLocal.bind(this)),this.__row2LeftFaved.addEventListener("click",this.__toggleFavoriteLocal.bind(this)),this.__row2LeftFav.disabled=!1,this.__row2LeftFaved.disabled=!1,this.__row2RightJoin.setAttribute("title",this.__globalStringManager.get("join_room_prompt"))):(this.__row2LeftMore.setAttribute("title",this.__globalStringManager.get("login_more")),this.__row2LeftMore.removeEventListener("click",this.__onShowActionMenu.bind(this)),this.__row2LeftMore.disabled=!0,this.__row2LeftFav.setAttribute("title",this.__globalStringManager.get("login_more")),this.__row2LeftFaved.setAttribute("title",this.__globalStringManager.get("login_more")),this.__row2LeftFav.removeEventListener("click",this.__toggleFavoriteLocal.bind(this)),this.__row2LeftFaved.removeEventListener("click",this.__toggleFavoriteLocal.bind(this)),this.__row2LeftFav.disabled=!0,this.__row2LeftFaved.disabled=!0,this.__row2LeftFav.removeEventListener("click",this.__onToggleFavorite.bind(this)),this.__row2LeftFaved.removeEventListener("click",this.__onToggleFavorite.bind(this)),this.__row2RightJoin.setAttribute("title",this.__globalStringManager.get("login_more"))),this.__row2LeftShare.disabled=!1,this.__row2LeftShare.setAttribute("title",this.__globalStringManager.get("share_url")),this.__row2RightJoin.disabled=!1,this.__isFavorited(),(this.__showLikeButton=!this.__isLoggedIn||this.__roomOwnerCID!=this.__myself.get("legacy_cid"))?this.__favorited?(this.__row2LeftFav.classList.add("hidden"),this.__row2LeftFaved.classList.remove("hidden")):(this.__row2LeftFav.classList.remove("hidden"),this.__row2LeftFaved.classList.add("hidden")):(this.__row2LeftFav.classList.add("hidden"),this.__row2LeftFaved.classList.add("hidden")),this.__isLoggedIn&&this.__row2Over.classList.add("hidden")},render:function(){this.$el.html(e.template()),this.__findElements(),this.__renderElements()},__joinRoom:function(){this.__isLoggedIn?null===this.__subMode?(this.__modeManager.openMode({mode:{id:"chat"},submode:{id:this.__roomModel.id,forceJoin:!0,showAlways:!0}}),this.__serviceProvider.get("windowManager").removeWindow(this.__roomModel.id)):(this.__subMode.joinRoom(),this.__parent.removeIfInASubmode()):this.__goToLogin()},__goToLogin:function(){this.__dialogManager.showDialog(e.LoginDialog,{stringManager:this.__globalStringManager,loginDestination:this.__window.location||this.__window.location.href})}});return e.Mixin.mixin(i.prototype,e.RoomDetailMixin),i}({UiCore:e["@UiCore"],Model:e["@Model"],Widgets:e["@Widgets"],LoginDialog:jn,Mixin:Bn,RoomDetailMixin:ka,template:js}),Ys=function(e){var t=e.UiCore.UiContext;return t.extend("RoomDetailWidget",{className:"room-detail-widget",uiContextName:"room_detail_widget",dependencies:"dialogManager featureAccessManager globalNav globalStringManager loginManager modeManager Promise window".split(" "),trackedEvents:function(){return[{type:"click",selector:".logged-out-overlay .login",name:"occupancy_login",handler:this.__loginOverride.bind(this)}]},__getDetailsFromRoom:function(){this.__roomCapacity=this.__roomModel.get("capactiy"),this.__roomID=this.__roomModel.id,this.__roomIsAP=this.__roomModel.get("is_ap"),this.__roomDescription=this.__roomModel.get("description"),this.__roomImagePortrait=this.__roomModel.get("rendered_image")+"?width=500&height=500",this.__roomImageLandscrape=this.__roomModel.get("image_url")||this.__roomModel.get("themed_image_url"),this.__roomName=this.__roomModel.get("name"),this.__roomLanguage=this.__roomModel.get("language"),this.__roomPrivacy=this.__roomModel.get("privacy"),this.__roomType=this.__roomModel.get("type"),this.__roomIsVIP=this.__roomModel.get("is_vip")},__getDetailsFromChat:function(){this.__roomCapacity=this.__chatModel.get("capacity")||this.__roomCapacity},__getDetailsFromParticipants:function(){this.__participantModels=[],this.__lastParticipant=null,this.__participantsCollection.models.forEach(function(e){this.__participantModels.push(e.populated()),this.__lastParticipant=e}.bind(this)),this.__participantsCount=this.__participantModels.length},__addToDOMLeadIn:function(){this.__isLoggedIn?this.__myself.populated().then(function(){this.addToDOM()}.bind(this)):this.addToDOM()},initialize:function(e){t.prototype.initialize.call(this,e),this.__window=e.window,this.__args=e,this.__featureAccessManager=e.featureAccessManager,this.__lastParticipant=this.__chatModel=null,this.__loginManager=e.loginManager,this.__roomModel=e.roomModel,this.__stringManager=e.globalStringManager,this.__dialogManager=e.dialogManager,this.__modeManager=e.modeManager,this.__subMode=void 0===e.subMode?null:e.subMode,this.__globalNav=e.globalNav,(this.__isLoggedIn=this.__loginManager.isLoggedIn())&&(this.__myself=this.__loginManager.getCurrentUser()),this.__isMobile=this.__featureAccessManager.isMobile(),this.__roomModel.populated().then(function(e){this.__getDetailsFromRoom(),this.__roomModel.getSingleEdge("owner").populated().then(function(e){this.__roomOwnerModel=e,this.__isLoggedIn?this.__roomModel.getSingleEdge("chat").populated().then(function(e){this.__chatModel=e,this.__getDetailsFromChat(),this.__chatModel.getEdgeCollection("participants").populated().then(function(e){this.__participantsCollection=e,this.__getDetailsFromParticipants(),null===this.__lastParticipant?this.__addToDOMLeadIn():this.__lastParticipant.populated().then(function(){this.__addToDOMLeadIn()}.bind(this))}.bind(this))}.bind(this)):this.__addToDOMLeadIn()}.bind(this))}.bind(this)).catch(function(e){this.__window.console.log("failed to access the services to redirecting welome login"),this.__loginManager.setLoginDestination(this.__window.location||this.__window.location.href),this.__window.location="/welcome/login/"}.bind(this))},__findElements:function(){this.__eleWidget=this.$el[0],this.__eleLeft=this.__eleWidget.getElementsByClassName("left-panel")[0],this.__eleLeftHead=this.__eleLeft.getElementsByClassName("headpiece")[0],this.__eleLeftPanelImage=this.__eleLeft.getElementsByClassName("left-panel-image-div")[0],this.__eleLeftPanelText=this.__eleLeft.getElementsByClassName("left-panel-text")[0],this.__eleLeftPanelTextAdjustable=this.__eleLeftPanelText.getElementsByClassName("adjustable")[0],this.__eleLeftAPBadge=this.__eleLeft.getElementsByClassName("ap-badge")[0],this.__eleRight=this.__eleWidget.getElementsByClassName("right-panel")[0],this.__eleRightHead=this.__eleRight.getElementsByClassName("headpiece")[0],this.__eleRightCol=this.__eleRight.getElementsByClassName("main-column")[0],this.__eleRightColLang=this.__eleRightCol.getElementsByClassName("language")[0],this.__eleRightColLangPayload=this.__eleRightColLang.getElementsByClassName("lang-payload")[0],this.__eleRightColOcc=this.__eleRightCol.getElementsByClassName("occupancy")[0],this.__eleRightColOccCntCap=this.__eleRightColOcc.getElementsByClassName("count-cap")[0],this.__eleRightColOccLine=this.__eleRightColOcc.getElementsByClassName("line-up")[0],this.__eleRightColDes=this.__eleRightCol.getElementsByClassName("description")[0],this.__eleRightColDesPayload=this.__eleRightColDes.getElementsByClassName("des-payload")[0]},__renderElements:function(){null!==this.__subMode&&this.__subMode.toggleMagicLineMenu(!0),this.__isLoggedIn?(this.__viewImages=!this.__roomIsAP||!!this.__myself.get("is_ap"),this.__roomIsVIP&&(this.__viewImages=this.__myself.get("is_vip")),this.__roomIsAP?this.__eleLeftAPBadge.classList.remove("hidden"):this.__eleLeftAPBadge.classList.add("hidden")):this.__viewImages=!this.__roomIsAP,this.__viewImages?(this.__eleLeftPanelImage.classList.remove("hidden"),this.__eleLeftPanelImage.style.backgroundImage="url('"+this.__roomImagePortrait+"')",this.__eleLeftPanelText.classList.add("hidden"),this.__eleLeftPanelText.classList.remove("flexing")):(this.__eleLeftPanelImage.classList.add("hidden"),this.__eleLeftPanelText.classList.remove("hidden"),this.__eleLeftPanelText.classList.add("flexing"),this.__roomIsAP&&!this.__myself.get("is_ap")?this.__eleLeftPanelTextAdjustable.innerHTML=this.__stringManager.get("ap_image_not_available"):this.__roomIsVIP&&!this.__myself.get("is_vip")||(this.__eleLeftPanelTextAdjustable.innerHTML=this.__stringManager.get("vip_image_not_available")));var t=this.$(".left-panel .headpiece");this.__isMobile?(this.__eleLeftHead.classList.remove("hidden"),this.__eleRightHead.classList.add("hidden")):(t=this.$(".right-panel .headpiece"),this.__eleLeftHead.classList.add("hidden"),this.__eleRightHead.classList.remove("hidden")),this.__headpiece=this.createChildContext(e.RoomDetailWidgetHeadpiece,{$parentElement:t,roomModel:this.__roomModel,subMode:this.__subMode,parent:this}),this.__hostedByName=this.createChildContext(e.Widgets.DualName,{$replaceElement:this.$(".install-name-widget-here"),user:this.__roomOwnerModel,size:"small",hideAtAvatar:!0,ignoreClicks:!1,displayArgs:{color:"dark",size:"large"},modeManager:this.__modeManager}),this.__eleRightColLangPayload.innerHTML=this.__roomLanguage,this.__isLoggedIn?(this.__eleRightColOccCntCap.innerHTML="("+String(this.__participantsCount)+"/"+String(this.__roomCapacity)+")",0<this.__participantsCount&&this.__lastParticipant.populated().then(function(){this.__profileIcons=[],this.__participantsCollection.models.forEach(function(t){t.populated().then(function(){var i={$parentElement:this.$(".line-up"),user:t.node,ignoreClicks:!this.__isLoggedIn};this.__profileIcons.push(this.createChildContext(e.Widgets.ProfileIcon,i))}.bind(this))}.bind(this))}.bind(this))):(this.__roomCapacity=10,this.__participantsCount=0);t=0>(t=this.__roomCapacity-this.__participantsCount)?0:t;for(var i=0;i<t;i++){var n=document.createElement("div");n.classList.add("profile-icon-placeholder"),this.__eleRightColOccLine.appendChild(n)}this.__eleRightColDesPayload.innerHTML=this.__roomDescription,this.__isLoggedIn?(this.__eleRightColOcc.classList.add("logged-in"),this.__eleRightColOcc.classList.remove("logged-out")):(this.__eleRightColOcc.classList.remove("logged-in"),this.__eleRightColOcc.classList.add("logged-out")),this.__eleRightCol.classList.add("scroller")},render:function(){this.$el.html(e.template()).promise().then(function(){this.__findElements(),this.__renderElements()}.bind(this))},removeIfInASubmode:function(){null!==this.__subMode&&this.__eleWidget.parentNode.removeChild(this.__eleWidget)},__loginOverride:function(){this.__isLoggedIn||this.__dialogManager.showDialog(e.LoginDialog,{stringManager:this.__globalStringManager,loginDestination:this.__window.location||this.__window.location.href})}})}({UiCore:e["@UiCore"],Model:e["@Model"],Widgets:e["@Widgets"],LoginDialog:jn,RoomDetailWidgetHeadpiece:Ks,template:Gs});return{FeedLightbox:ni,OldFeedLightboxDialog:_a,FeedTagLightbox:Ea,InventoryOutfitLightbox:z,LightboxDialog:x,ProductLightbox:qs,RoomDetailLightbox:function(e){var t=e.LightboxDialog;return t.extend("RoomDetailLightbox",{uiContextName:"room_detail_lightbox",className:"room-detail-lightbox lightbox-dialog",dependencies:["dialogManager","featureAccessManager","globalStringManager","loginManager","Promise"],initialize:function(i){t.prototype.initialize.call(this,i),this.model.populated().then(function(){this.__detailPresenter=this.createChildContext(e.RoomDetailWidget,{$parentElement:this.$(".main-container"),roomModel:this.model}),this.linkToDetailsSubmode("chat",this.model)}.bind(this))}})}({Model:e["@Model"],Checkout:e["@Checkout"],Widgets:e["@Widgets"],LightboxDialog:x,RoomDetailWidget:Ys}),ProfileLightbox:Zn,RoomLightbox:Da,ShoppingCartLightbox:Ms}});
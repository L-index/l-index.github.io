module({"css!/build/camanjs/caman.full.css":"css!/asset/d41d8cd98f00b204/build/camanjs/caman.full.css"},function(t){return function(){(function(){var t,e,i,r,n,s,o,a,h,c,u,l,g,d,p,f,m,b,y,x,v,w,D,R,M,P,I,B,S,L={}.hasOwnProperty,C=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},k=[].slice;D=Array.prototype.slice,t=function(t,e){return null==e&&(e=document),"object"==typeof t||"undefined"!=typeof exports&&null!==exports?t:e.querySelector(t)},v=function(){function t(){}var e;return t.uniqid=(e=0,{get:function(){return e++}}),t.extend=function(t){var e,i,r,n,s,o;for(i=t,s=0,o=(n=D.call(arguments,1)).length;s<o;s++)for(r in e=n[s])L.call(e,r)&&(i[r]=e[r]);return i},t.clampRGB=function(t){return 0>t?0:255<t?255:t},t.copyAttributes=function(t,e,i){var r,n,s,o,a;for(null==i&&(i={}),a=[],r=0,n=(s=t.attributes).length;r<n;r++)t=s[r],null!=i.except&&(o=t.nodeName,0<=C.call(i.except,o))||a.push(e.setAttribute(t.nodeName,t.nodeValue));return a},t.dataArray=function(t){return null==t&&(t=0),n.NodeJS||null!=window.Uint8Array?new Uint8Array(t):Array(t)},t}(),"undefined"!=typeof exports&&null!==exports?(y=exports,o=require("canvas"),g=o.Image,c=require("fibers"),w=require("fs")):y=window,y.Caman=n=function(){function i(){var t,r,n,s=this;if(0===arguments.length)throw"Invalid arguments";return this instanceof i?(this.finishInit=this.finishInit.bind(this),this.imageLoaded=this.imageLoaded.bind(this),t=arguments[0],i.NodeJS||(n=parseInt(i.getAttrId(t[0]),10),r="function"==typeof t[1]?t[1]:"function"==typeof t[2]?t[2]:function(){},isNaN(n)||!x.has(n))?(this.id=v.uniqid.get(),this.initializedPixelData=this.originalPixelData=null,this.cropCoordinates={x:0,y:0},this.resized=this.cropped=!1,this.pixelStack=[],this.layerStack=[],this.canvasQueue=[],this.currentLayer=null,this.scaled=!1,this.analyze=new e(this),this.renderer=new b(this),this.domIsLoaded(function(){return s.parseArguments(t),s.setup()}),this):x.execute(n,r)):new i(arguments)}return i.version={release:"4.1.1",date:"4/8/2013"},i.DEBUG=!1,i.NodeJS="undefined"!=typeof exports&&null!==exports,i.autoload=!i.NodeJS,i.allowRevert=!0,i.crossOrigin="anonymous",i.toString=function(){return"Version "+i.version.release+", Released "+i.version.date},i.remoteProxy="",i.proxyParam="camanProxyUrl",i.getAttrId=function(e){return!!i.NodeJS||("string"==typeof e&&(e=t(e)),null==e||null==e.getAttribute?null:e.getAttribute("data-caman-id"))},i.prototype.domIsLoaded=function(t){var e=this;return i.NodeJS?setTimeout(function(){return t.call(e)},0):"complete"===document.readyState?(p.debug("DOM initialized"),setTimeout(function(){return t.call(e)},0)):document.addEventListener("readystatechange",function(){if("complete"===document.readyState)return p.debug("DOM initialized"),t.call(e)},!1)},i.prototype.parseArguments=function(t){var e,i,r;if(0===t.length)throw"Invalid arguments given";if(this.imageUrl=this.initType=this.initObj=null,this.callback=function(){},this.setInitObject(t[0]),1!==t.length){switch(typeof t[1]){case"string":this.imageUrl=t[1];break;case"function":this.callback=t[1]}if(2!==t.length&&(this.callback=t[2],4===t.length)){for(e in r=[],i=t[4])L.call(i,e)&&(t=i[e],r.push(this.options[e]=t));return r}}},i.prototype.setInitObject=function(e){if(!i.NodeJS){if(this.initObj="object"==typeof e?e:t(e),null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()}this.initObj=e,this.initType="node"},i.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}},i.prototype.initNode=function(){var t=this;return p.debug("Initializing for NodeJS"),this.image=new g,this.image.onload=function(){return p.debug("Image loaded. Width = "+t.imageWidth()+", Height = "+t.imageHeight()),t.canvas=new o(t.imageWidth(),t.imageHeight()),t.finishInit()},this.image.onerror=function(t){throw t},this.image.src=this.initObj},i.prototype.initImage=function(){return this.image=this.initObj,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),v.copyAttributes(this.image,this.canvas,{except:["src"]}),this.image.parentNode.replaceChild(this.canvas,this.image),this.imageAdjustments(),this.waitForImageLoaded()},i.prototype.initCanvas=function(){return this.canvas=this.initObj,this.context=this.canvas.getContext("2d"),null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()},i.prototype.imageAdjustments=function(){if(this.needsHiDPISwap()&&(p.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement()),l.isRemote(this.image))return this.image.src=l.proxyUrl(this.image.src),p.debug("Remote image detected, using URL = "+this.image.src)},i.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded},i.prototype.isImageLoaded=function(){return!(!this.image.complete||null!=this.image.naturalWidth&&0===this.image.naturalWidth)},i.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth},i.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight},i.prototype.imageLoaded=function(){return p.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight()),this.finishInit()},i.prototype.finishInit=function(){var t,e,r,n,s;if(null==this.context&&(this.context=this.canvas.getContext("2d")),this.originalWidth=this.preScaledWidth=this.width=this.canvas.width,this.originalHeight=this.preScaledHeight=this.height=this.canvas.height,this.hiDPIAdjustments(),this.hasId()||this.assignId(),null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight),this.reloadCanvasData(),i.allowRevert)for(this.initializedPixelData=v.dataArray(this.pixelData.length),this.originalPixelData=v.dataArray(this.pixelData.length),t=r=0,n=(s=this.pixelData).length;r<n;t=++r)e=s[t],this.initializedPixelData[t]=e,this.originalPixelData[t]=e;return this.dimensions={width:this.canvas.width,height:this.canvas.height},x.put(this.id,this),this.callback.call(this,this),this.callback=function(){}},i.prototype.reloadCanvasData=function(){return this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data},i.prototype.resetOriginalPixelData=function(){var t,e,r,n,s;if(!i.allowRevert)throw"Revert disabled";for(this.originalPixelData=v.dataArray(this.pixelData.length),s=[],e=0,r=(n=this.pixelData).length;e<r;e++)t=n[e],s.push(this.originalPixelData.push(t));return s},i.prototype.hasId=function(){return null!=i.getAttrId(this.canvas)},i.prototype.assignId=function(){if(!i.NodeJS&&!this.canvas.getAttribute("data-caman-id"))return this.canvas.setAttribute("data-caman-id",this.id)},i.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")},i.prototype.hiDPIAdjustments=function(){var t;if(!i.NodeJS&&!this.hiDPIDisabled()&&1!==(t=this.hiDPIRatio()))return p.debug("HiDPI ratio = "+t),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*t,this.canvas.height=this.preScaledHeight*t,this.canvas.style.width=this.preScaledWidth+"px",this.canvas.style.height=this.preScaledHeight+"px",this.context.scale(t,t),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=this.canvas.height},i.prototype.hiDPIRatio=function(){return(window.devicePixelRatio||1)/(this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1)},i.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio},i.prototype.needsHiDPISwap=function(){return!(this.hiDPIDisabled()||!this.hiDPICapable())&&null!==this.hiDPIReplacement()},i.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")},i.prototype.replaceCanvas=function(t){var e;return e=this.canvas,this.canvas=t,this.context=this.canvas.getContext("2d"),e.parentNode.replaceChild(this.canvas,e),this.width=this.canvas.width,this.height=this.canvas.height,this.reloadCanvasData(),this.dimensions={width:this.canvas.width,height:this.canvas.height}},i.prototype.render=function(t){var e=this;return null==t&&(t=function(){}),h.trigger(this,"renderStart"),this.renderer.execute(function(){return e.context.putImageData(e.imageData,0,0),t.call(e)})},i.prototype.revert=function(){var t,e,r,n,s;if(!i.allowRevert)throw"Revert disabled";for(t=r=0,n=(s=this.originalVisiblePixels()).length;r<n;t=++r)e=s[t],this.pixelData[t]=e;return this.context.putImageData(this.imageData,0,0)},i.prototype.reset=function(){var t,e,i,r,n,s,o,a,h;for(t=document.createElement("canvas"),v.copyAttributes(this.canvas,t),t.width=this.originalWidth,t.height=this.originalHeight,s=(r=(e=t.getContext("2d")).getImageData(0,0,t.width,t.height)).data,i=o=0,a=(h=this.initializedPixelData).length;o<a;i=++o)n=h[i],s[i]=n;return e.putImageData(r,0,0),this.cropCoordinates={x:0,y:0},this.resized=!1,this.replaceCanvas(t)},i.prototype.originalVisiblePixels=function(){var t,e,r,n,s,o,a,h,c,u,l,g,d,p,m,b;if(!i.allowRevert)throw"Revert disabled";if(c=[],r=(u=this.cropCoordinates.x)+this.width,n=(l=this.cropCoordinates.y)+this.height,this.resized){for((t=document.createElement("canvas")).width=this.originalWidth,t.height=this.originalHeight,h=(o=(e=t.getContext("2d")).getImageData(0,0,t.width,t.height)).data,s=g=0,d=(p=this.originalPixelData).length;g<d;s=++g)a=p[s],h[s]=a;e.putImageData(o,0,0),(s=document.createElement("canvas")).width=this.width,s.height=this.height,(e=s.getContext("2d")).drawImage(t,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height),h=e.getImageData(0,0,this.width,this.height).data,e=this.width}else h=this.originalPixelData,e=this.originalWidth;for(s=o=0,a=h.length;o<a;s=o+=4)u<=(m=(t=f.locationToCoordinates(s,e)).x)&&m<r&&l<=(b=t.y)&&b<n&&c.push(h[s],h[s+1],h[s+2],h[s+3]);return c},i.prototype.process=function(t,e){return this.renderer.add({type:u.Type.Single,name:t,processFn:e}),this},i.prototype.processKernel=function(t,e,i,r){var n,s,o;if(!i)for(n=s=i=0,o=e.length;0<=o?s<o:s>o;n=0<=o?++s:--s)i+=e[n];return this.renderer.add({type:u.Type.Kernel,name:t,adjust:e,divisor:i,bias:r||0}),this},i.prototype.processPlugin=function(t,e){return this.renderer.add({type:u.Type.Plugin,plugin:t,args:e}),this},i.prototype.newLayer=function(t){var e;return e=new d(this),this.canvasQueue.push(e),this.renderer.add({type:u.Type.LayerDequeue}),t.call(e),this.renderer.add({type:u.Type.LayerFinished}),this},i.prototype.executeLayer=function(t){return this.pushContext(t)},i.prototype.pushContext=function(t){return this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=t,this.pixelData=t.pixelData},i.prototype.popContext=function(){return this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()},i.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()},i}(),e=function(){function t(t){this.c=t}return t.prototype.calculateLevels=function(){var t,e,i,r;for(e={r:{},g:{},b:{}},t=i=0;255>=i;t=++i)e.r[t]=0,e.g[t]=0,e.b[t]=0;for(t=i=0,r=this.c.pixelData.length;i<r;t=i+=4)e.r[this.c.pixelData[t]]++,e.g[this.c.pixelData[t+1]]++,e.b[this.c.pixelData[t+2]]++;for(i=this.c.pixelData.length/4,t=r=0;255>=r;t=++r)e.r[t]/=i,e.g[t]/=i,e.b[t]/=i;return e},t}(),n.DOMUpdated=function(){var t,e,i,r,n;if(0<(e=document.querySelectorAll("img[data-caman]")).length){for(n=[],i=0,r=e.length;i<r;i++)t=e[i],n.push(new s(t,function(){return this.parse(),this.execute()}));return n}},n.autoload&&("complete"===document.readyState?n.DOMUpdated():document.addEventListener("DOMContentLoaded",n.DOMUpdated,!1)),s=function(){function t(t,e){this.dataStr=t.getAttribute("data-caman"),this.caman=n(t,e.bind(this))}return t.prototype.parse=function(){var t,e,i,r,n,s,o,a;if(this.ele=this.caman.canvas,r=/(\w+)\((.*?)\)/g,0<(n=this.dataStr.match(r)).length){for(r=/(\w+)\((.*?)\)/,a=[],s=0,o=n.length;s<o;s++){e=(t=(e=n[s]).match(r))[1],t=t[2],e=new Function("return function() {        this."+e+"("+t+");      };");try{i=e(),a.push(i.call(this.caman))}catch(t){a.push(p.debug(t))}}return a}},t.prototype.execute=function(){var t;return t=this.ele,this.caman.render(function(){return t.parentNode.replaceChild(this.toImage(),t)})},t}(),n.Blender=i=function(){function t(){}return t.blenders={},t.register=function(t,e){return this.blenders[t]=e},t.execute=function(t,e,i){return this.blenders[t](e,i)},t}(),n.Calculate=r=function(){function t(){}return t.distance=function(t,e,i,r){return Math.sqrt(Math.pow(i-t,2)+Math.pow(r-e,2))},t.randomRange=function(t,e,i){return null==i&&(i=!1),t+=Math.random()*(e-t),i?t.toFixed(i):Math.round(t)},t.luminance=function(t){return.299*t.r+.587*t.g+.114*t.b},t.bezier=function(t,e,i,r,n,s){var o,a,h,c,u,l,g,d,p,f;for(p=t[0],t=t[1],h=e[0],l=e[1],o=i[0],c=i[1],u=r[0],a=r[1],i={},o=u-p-(e=parseInt(3*(h-p),10))-(h=3*(o-h)-e),a=a-t-(u=3*(l-t))-(c=3*(c-l)-u),l=f=0;1e3>f;l=++f)g=l/1e3,l=Math.round(o*Math.pow(g,3)+h*Math.pow(g,2)+e*g+p),g=Math.round(a*Math.pow(g,3)+c*Math.pow(g,2)+u*g+t),n&&g<n?g=n:s&&g>s&&(g=s),i[l]=g;if(i.length<r[0]+1)for(l=p=0,e=r[0];0<=e?p<=e:p>=e;l=0<=e?++p:--p)if(null==i[l]){for(s=[l-1,i[l-1]],n=t=l,h=r[0];l<=h?t<=h:t>=h;n=l<=h?++t:--t)if(null!=i[n]){d=[n,i[n]];break}i[l]=s[1]+(d[1]-s[1])/(d[0]-s[0])*(l-s[0])}return null==i[r[0]]&&(i[r[0]]=i[r[0]-1]),i},t}(),a=function(){function t(){}return t.hexToRGB=function(t){return"#"===t.charAt(0)&&(t=t.substr(1)),{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:t=parseInt(t.substr(4,2),16)}},t.rgbToHSL=function(t,e,i){var r,n,s,o,a;return"object"==typeof t&&(e=t.g,i=t.b,t=t.r),t/=255,e/=255,i/=255,o=Math.max(t,e,i),n=Math.min(t,e,i),s=(o+n)/2,o===n?n=a=0:(r=o-n,a=.5<s?r/(2-o-n):r/(o+n),n=function(){switch(o){case t:return(e-i)/r+(e<i?6:0);case e:return(i-t)/r+2;case i:return(t-e)/r+4}}(),n/=6),{h:n,s:a,l:s}},t.hslToRGB=function(t,e,i){var r,n;return"object"==typeof t&&(e=t.s,i=t.l,t=t.h),0===e?n=i=t=i:(r=2*i-(e=.5>i?i*(1+e):i+e-i*e),n=this.hueToRGB(r,e,t+1/3),i=this.hueToRGB(r,e,t),t=this.hueToRGB(r,e,t-1/3)),{r:255*n,g:255*i,b:255*t}},t.hueToRGB=function(t,e,i){return 0>i&&(i+=1),1<i&&(i-=1),i<1/6?t+6*(e-t)*i:.5>i?e:i<2/3?t+6*(e-t)*(2/3-i):t},t.rgbToHSV=function(t,e,i){var r,n,s,o;return t/=255,e/=255,i/=255,s=Math.max(t,e,i),n=Math.min(t,e,i),r=s-n,o=0===s?0:r/s,s===n?n=0:(n=function(){switch(s){case t:return(e-i)/r+(e<i?6:0);case e:return(i-t)/r+2;case i:return(t-e)/r+4}}(),n/=6),{h:n,s:o,v:s}},t.hsvToRGB=function(t,e,i){var r,n,s,o,a,h;switch(n=6*t-(o=Math.floor(6*t)),t=i*(1-e),a=i*(1-n*e),e=i*(1-(1-n)*e),o%6){case 0:h=i,s=e,r=t;break;case 1:h=a,s=i,r=t;break;case 2:h=t,s=i,r=e;break;case 3:h=t,s=a,r=i;break;case 4:h=e,s=t,r=i;break;case 5:h=i,s=t,r=a}return{r:255*h,g:255*s,b:255*r}},t.rgbToXYZ=function(t,e,i){return e/=255,i/=255,{x:100*(.4124*(t=.04045<(t/=255)?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(e=.04045<e?Math.pow((e+.055)/1.055,2.4):e/12.92)+.1805*(i=.04045<i?Math.pow((i+.055)/1.055,2.4):i/12.92)),y:100*(.2126*t+.7152*e+.0722*i),z:100*(.0193*t+.1192*e+.9505*i)}},t.xyzToRGB=function(t,e,i){var r,n;return n=3.2406*(t/=100)+-1.5372*(e/=100)+-.4986*(i/=100),r=-.9689*t+1.8758*e+.0415*i,t=.0557*t+-.204*e+1.057*i,{r:255*(n=.0031308<n?1.055*Math.pow(n,.4166666667)-.055:12.92*n),g:255*(r=.0031308<r?1.055*Math.pow(r,.4166666667)-.055:12.92*r),b:255*(t=.0031308<t?1.055*Math.pow(t,.4166666667)-.055:12.92*t)}},t.xyzToLab=function(t,e,i){return"object"==typeof t&&(e=t.y,i=t.z,t=t.x),e/=100,i/=108.883,t=.008856451679<(t/=95.047)?Math.pow(t,.3333333333):7.787037037*t+.1379310345,{l:116*(e=.008856451679<e?Math.pow(e,.3333333333):7.787037037*e+.1379310345)-16,a:500*(t-e),b:200*(e-(i=.008856451679<i?Math.pow(i,.3333333333):7.787037037*i+.1379310345))}},t.labToXYZ=function(t,e,i){return"object"==typeof t&&(e=t.a,i=t.b,t=t.l),{x:95.047*(.2068965517<(e=(t=(t+16)/116)+e/500)?e*e*e:.1284185493*(e-.1379310345)),y:100*(.2068965517<t?t*t*t:.1284185493*(t-.1379310345)),z:108.883*(.2068965517<(i=t-i/200)?i*i*i:.1284185493*(i-.1379310345))}},t.rgbToLab=function(t,e,i){return"object"==typeof t&&(e=t.g,i=t.b,t=t.r),t=this.rgbToXYZ(t,e,i),this.xyzToLab(t)},t.labToRGB=function(t,e,i){},t}(),h=function(){function t(){}return t.events={},t.types="processStart processComplete renderStart renderFinished blockStarted blockFinished".split(" "),t.trigger=function(t,e,i){var r,n,s,o;if(this.events[e]&&this.events[e].length){for(o=[],r=0,n=(s=this.events[e]).length;r<n;r++)null===(e=s[r]).target||t.id===e.target.id?o.push(e.fn.call(t,i)):o.push(void 0);return o}},t.listen=function(t,e,i){var r;return"string"==typeof t&&(r=t,i=e,t=null,e=r),!(0>C.call(this.types,e))&&(this.events[e]||(this.events[e]=[]),this.events[e].push({target:t,fn:i}),!0)},t}(),n.Event=h,n.Filter=u=function(){function t(){}return t.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6},t.register=function(t,e){return n.prototype[t]=e},t}(),n.IO=l=function(){function t(){}return t.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/,t.isRemote=function(t){return null!=t&&!this.corsEnabled(t)&&this.isURLRemote(t.src)},t.corsEnabled=function(t){var e;return null!=t.crossOrigin&&("anonymous"===(e=t.crossOrigin.toLowerCase())||"use-credentials"===e)},t.isURLRemote=function(t){return!!(t=t.match(this.domainRegex))&&t[1]!==document.domain},t.remoteCheck=function(t){if(this.isURLRemote(t))if(n.remoteProxy.length){if(!n.isURLRemote(n.remoteProxy))return n.remoteProxy+"?camanProxyUrl="+encodeURIComponent(t);p.info("Cannot use a remote proxy for loading images.")}else p.info("Attempting to load a remote image without a configured proxy. URL: "+t)},t.proxyUrl=function(t){return n.remoteProxy+"?"+n.proxyParam+"="+encodeURIComponent(t)},t.useProxy=function(t){var e;return null!=(e={ruby:"rb",python:"py",perl:"pl",javascript:"js"})[t=t.toLowerCase()]&&(t=e[t]),"proxies/caman_proxy."+t},t}(),n.prototype.save=function(){return"undefined"!=typeof exports&&null!==exports?this.nodeSave.apply(this,arguments):this.browserSave.apply(this,arguments)},n.prototype.browserSave=function(t){return null==t&&(t="png"),t=t.toLowerCase(),t=this.toBase64(t).replace("image/"+t,"image/octet-stream"),document.location.href=t},n.prototype.nodeSave=function(t,e){null==e&&(e=!0);try{if(w.statSync(t).isFile()&&!e)return!1}catch(e){p.debug("Creating output file "+t)}return w.writeFile(t,this.canvas.toBuffer(),function(){return p.debug("Finished writing to "+t)})},n.prototype.toImage=function(t){var e;return(e=document.createElement("img")).src=this.toBase64(t),e.width=this.dimensions.width,e.height=this.dimensions.height,window.devicePixelRatio&&(e.width/=window.devicePixelRatio,e.height/=window.devicePixelRatio),e},n.prototype.toBase64=function(t){return null==t&&(t="png"),t=t.toLowerCase(),this.canvas.toDataURL("image/"+t)},d=function(){function e(t){this.filter=this.c=t,this.options={blendingMode:"normal",opacity:1},this.layerID=v.uniqid.get(),this.canvas="undefined"!=typeof exports&&null!==exports?new o:document.createElement("canvas"),this.canvas.width=this.c.dimensions.width,this.canvas.height=this.c.dimensions.height,this.context=this.canvas.getContext("2d"),this.context.createImageData(this.canvas.width,this.canvas.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data}return e.prototype.newLayer=function(t){return this.c.newLayer.call(this.c,t)},e.prototype.setBlendingMode=function(t){return this.options.blendingMode=t,this},e.prototype.opacity=function(t){return this.options.opacity=t/100,this},e.prototype.copyParent=function(){var t,e,i,r;for(e=this.c.pixelData,t=i=0,r=this.c.pixelData.length;i<r;t=i+=4)this.pixelData[t]=e[t],this.pixelData[t+1]=e[t+1],this.pixelData[t+2]=e[t+2],this.pixelData[t+3]=e[t+3];return this},e.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)},e.prototype.overlayImage=function(e){return"object"==typeof e?e=e.src:"string"==typeof e&&"#"===e[0]&&(e=t(e).src),e?(this.c.renderer.renderQueue.push({type:u.Type.LoadOverlay,src:e,layer:this}),this):this},e.prototype.applyToParent=function(){var t,e,r,n,s,o,a,h,c;for(r=this.c.pixelStack[this.c.pixelStack.length-1],c=[],t=a=0,h=(e=this.c.pixelData).length;a<h;t=a+=4)o={r:r[t],g:r[t+1],b:r[t+2],a:r[t+3]},s={r:e[t],g:e[t+1],b:e[t+2],a:e[t+3]},(n=i.execute(this.options.blendingMode,s,o)).r=v.clampRGB(n.r),n.g=v.clampRGB(n.g),n.b=v.clampRGB(n.b),null==n.a&&(n.a=s.a),r[t]=o.r-(o.r-n.r)*this.options.opacity*(n.a/255),r[t+1]=o.g-(o.g-n.g)*this.options.opacity*(n.a/255),c.push(r[t+2]=o.b-(o.b-n.b)*this.options.opacity*(n.a/255));return c},e}(),p=new function(){var t,e,i,r;for(e=0,i=(r=["log","info","warn","error"]).length;e<i;e++)this[t=r[e]]=function(t){return function(){var e;if(e=1<=arguments.length?k.call(arguments,0):[],n.DEBUG)try{return console[t].apply(console,e)}catch(i){return console[t](e)}}}(t);this.debug=this.log},f=function(){function t(t){this.c=t,this.loc=0}return t.coordinatesToLocation=function(t,e,i){return 4*(e*i+t)},t.locationToCoordinates=function(t,e){return{x:t%(4*e)/4,y:Math.floor(t/(4*e))}},t.prototype.locationXY=function(){return{x:this.loc%(4*this.c.dimensions.width)/4,y:this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width))}},t.prototype.getPixelRelative=function(t,e){var i;return(i=this.loc+4*this.c.dimensions.width*-1*e+4*t)>this.c.pixelData.length||0>i?{r:0,g:0,b:0,a:0}:{r:this.c.pixelData[i],g:this.c.pixelData[i+1],b:this.c.pixelData[i+2],a:this.c.pixelData[i+3]}},t.prototype.putPixelRelative=function(t,e,i){if(!(newLoc>this.c.pixelData.length||0>newLoc))return this.c.pixelData[newLoc]=i.r,this.c.pixelData[newLoc+1]=i.g,this.c.pixelData[newLoc+2]=i.b,this.c.pixelData[newLoc+3]=i.a,!0},t.prototype.getPixel=function(t,e){var i;return i=this.coordinatesToLocation(t,e,this.width),{r:this.c.pixelData[i],g:this.c.pixelData[i+1],b:this.c.pixelData[i+2],a:this.c.pixelData[i+3]}},t.prototype.putPixel=function(t,e,i){return t=this.coordinatesToLocation(t,e,this.width),this.c.pixelData[t]=i.r,this.c.pixelData[t+1]=i.g,this.c.pixelData[t+2]=i.b,this.c.pixelData[t+3]=i.a},t}(),m=function(){function t(){}return t.plugins={},t.register=function(t,e){return this.plugins[t]=e},t.execute=function(t,e,i){return this.plugins[e].apply(t,i)},t}(),n.Plugin=m,n.Renderer=b=function(){function t(e){var i=this;this.c=e,this.processNext=function(){return t.prototype.processNext.apply(i,arguments)},this.renderQueue=[],this.modPixelData=null}return t.Blocks=n.NodeJS?require("os").cpus().length:4,t.prototype.add=function(t){if(null!=t)return this.renderQueue.push(t)},t.prototype.processNext=function(){var t;if(0===this.renderQueue.length)return h.trigger(this,"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case u.Type.LayerDequeue:return t=this.c.canvasQueue.shift(),this.c.executeLayer(t),this.processNext();case u.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case u.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case u.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}},t.prototype.execute=function(t){return this.finishedFn=t,this.modPixelData=v.dataArray(this.c.pixelData.length),this.processNext()},t.prototype.eachBlock=function(e){var i,r,s,o,a,h,u,l,g,d=this;for(this.blocksDone=0,a=this.c.pixelData.length,a=(i=4*Math.floor(a/4/t.Blocks))+a/4%t.Blocks*4,g=[],o=u=0,l=t.Blocks;0<=l?u<l:u>l;o=0<=l?++u:--u)s=(h=o*i)+(o===t.Blocks-1?a:i),n.NodeJS?(r=(r=c(function(){return e.call(d,o,h,s)})).run(),g.push(this.blockFinished(r))):g.push(setTimeout(function(t,i,r){return function(){return e.call(d,t,i,r)}}(o,h,s),0));return g},t.prototype.executeFilter=function(){return h.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===u.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)},t.prototype.executePlugin=function(){return p.debug("Executing plugin "+this.currentJob.plugin),m.execute(this.c,this.currentJob.plugin,this.currentJob.args),p.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()},t.prototype.renderBlock=function(e,i,r){var s,o,a,u;for(p.debug("Block #"+e+" - Filter: "+this.currentJob.name+", Start: "+i+", End: "+r),h.trigger(this.c,"blockStarted",{blockNum:e,totalBlocks:t.Blocks,startPixel:i,endPixel:r}),s={r:0,g:0,b:0,a:0},o=new f(this.c),i=u=i;u<r;i=u+=4)o.loc=i,s.r=this.c.pixelData[i],s.g=this.c.pixelData[i+1],s.b=this.c.pixelData[i+2],s.a=this.c.pixelData[i+3],null==(a=this.currentJob.processFn.call(o,s)).a&&(a.a=s.a),this.c.pixelData[i]=v.clampRGB(a.r),this.c.pixelData[i+1]=v.clampRGB(a.g),this.c.pixelData[i+2]=v.clampRGB(a.b),this.c.pixelData[i+3]=v.clampRGB(a.a);return n.NodeJS?c.yield(e):this.blockFinished(e)},t.prototype.renderKernel=function(t,e,i){var r,s,o,a,h,u,l,g,d,m,b,y;for(o=this.currentJob.bias,h=this.currentJob.divisor,d=this.c.pixelData.length,r=this.currentJob.adjust,s=Math.sqrt(r.length),g=[],p.debug("Rendering kernel - Filter: "+this.currentJob.name),e=Math.max(e,4*this.c.dimensions.width*((s-1)/2)),i=Math.min(i,d-4*this.c.dimensions.width*((s-1)/2)),s=(s-1)/2,d=new f(this.c),e=m=e;m<i;e=m+=4){for(d.loc=e,a=0,u=b=-s;-s<=s?b<=s:b>=s;u=-s<=s?++b:--b)for(l=y=s;s<=-s?y<=-s:y>=-s;l=s<=-s?++y:--y)l=d.getPixelRelative(u,l),g[3*a]=l.r,g[3*a+1]=l.g,g[3*a+2]=l.b,a++;a=this.processKernel(r,g,h,o),this.modPixelData[e]=v.clampRGB(a.r),this.modPixelData[e+1]=v.clampRGB(a.g),this.modPixelData[e+2]=v.clampRGB(a.b),this.modPixelData[e+3]=this.c.pixelData[e+3]}return n.NodeJS?c.yield(t):this.blockFinished(t)},t.prototype.blockFinished=function(e){var i,r,n;if(0<=e&&p.debug("Block #"+e+" finished! Filter: "+this.currentJob.name),this.blocksDone++,h.trigger(this.c,"blockFinished",{blockNum:e,blocksFinished:this.blocksDone,totalBlocks:t.Blocks}),this.blocksDone===t.Blocks){if(this.currentJob.type===u.Type.Kernel)for(i=r=0,n=this.c.pixelData.length;0<=n?r<n:r>n;i=0<=n?++r:--r)this.c.pixelData[i]=this.modPixelData[i];return 0<=e&&p.debug("Filter "+this.currentJob.name+" finished!"),h.trigger(this.c,"processComplete",this.currentJob),this.processNext()}},t.prototype.processKernel=function(t,e,i,r){var n,s,o,a;for(s={r:0,g:0,b:0},n=o=0,a=t.length;0<=a?o<a:o>a;n=0<=a?++o:--o)s.r+=t[n]*e[3*n],s.g+=t[n]*e[3*n+1],s.b+=t[n]*e[3*n+2];return s.r=s.r/i+r,s.g=s.g/i+r,s.b=s.b/i+r,s},t.prototype.loadOverlay=function(t,e){var i,r,n=this;return(i=document.createElement("img")).onload=function(){return t.context.drawImage(i,0,0,n.c.dimensions.width,n.c.dimensions.height),t.imageData=t.context.getImageData(0,0,n.c.dimensions.width,n.c.dimensions.height),t.pixelData=t.imageData.data,n.c.pixelData=t.pixelData,n.processNext()},r=l.remoteCheck(e),i.src=null!=r?r:e},t}(),n.Store=x=function(){function t(){}return t.items={},t.has=function(t){return null!=this.items[t]},t.get=function(t){return this.items[t]},t.put=function(t,e){return this.items[t]=e},t.execute=function(t,e){var i=this;return setTimeout(function(){return e.call(i.get(t),i.get(t))},0),this.get(t)},t.flush=function(t){return null==t&&(t=!1),t?delete this.items[t]:this.items={}},t}(),i.register("normal",function(t,e){return{r:t.r,g:t.g,b:t.b}}),i.register("multiply",function(t,e){return{r:t.r*e.r/255,g:t.g*e.g/255,b:t.b*e.b/255}}),i.register("screen",function(t,e){return{r:255-(255-t.r)*(255-e.r)/255,g:255-(255-t.g)*(255-e.g)/255,b:255-(255-t.b)*(255-e.b)/255}}),i.register("overlay",function(t,e){var i;return(i={}).r=128<e.r?255-2*(255-t.r)*(255-e.r)/255:2*e.r*t.r/255,i.g=128<e.g?255-2*(255-t.g)*(255-e.g)/255:2*e.g*t.g/255,i.b=128<e.b?255-2*(255-t.b)*(255-e.b)/255:2*e.b*t.b/255,i}),i.register("difference",function(t,e){return{r:t.r-e.r,g:t.g-e.g,b:t.b-e.b}}),i.register("addition",function(t,e){return{r:e.r+t.r,g:e.g+t.g,b:e.b+t.b}}),i.register("exclusion",function(t,e){return{r:128-2*(e.r-128)*(t.r-128)/255,g:128-2*(e.g-128)*(t.g-128)/255,b:128-2*(e.b-128)*(t.b-128)/255}}),i.register("softLight",function(t,e){var i;return(i={}).r=128<e.r?255-(255-e.r)*(255-(t.r-128))/255:e.r*(t.r+128)/255,i.g=128<e.g?255-(255-e.g)*(255-(t.g-128))/255:e.g*(t.g+128)/255,i.b=128<e.b?255-(255-e.b)*(255-(t.b-128))/255:e.b*(t.b+128)/255,i}),i.register("lighten",function(t,e){return{r:e.r>t.r?e.r:t.r,g:e.g>t.g?e.g:t.g,b:e.b>t.b?e.b:t.b}}),i.register("darken",function(t,e){return{r:e.r>t.r?t.r:e.r,g:e.g>t.g?t.g:e.g,b:e.b>t.b?t.b:e.b}}),u.register("fillColor",function(){var t;return t=1===arguments.length?a.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]},this.process("fillColor",function(e){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=255,e})}),u.register("brightness",function(t){return t=Math.floor(t/100*255),this.process("brightness",function(e){return e.r+=t,e.g+=t,e.b+=t,e})}),u.register("saturation",function(t){return t*=-.01,this.process("saturation",function(e){var i;return i=Math.max(e.r,e.g,e.b),e.r!==i&&(e.r+=(i-e.r)*t),e.g!==i&&(e.g+=(i-e.g)*t),e.b!==i&&(e.b+=(i-e.b)*t),e})}),u.register("vibrance",function(t){return t*=-1,this.process("vibrance",function(e){var i,r;return r=Math.max(e.r,e.g,e.b),i=2*Math.abs(r-(e.r+e.g+e.b)/3)/255*t/100,e.r!==r&&(e.r+=(r-e.r)*i),e.g!==r&&(e.g+=(r-e.g)*i),e.b!==r&&(e.b+=(r-e.b)*i),e})}),u.register("greyscale",function(t){return this.process("greyscale",function(t){var e;return e=r.luminance(t),t.r=e,t.g=e,t.b=e,t})}),u.register("contrast",function(t){return t=Math.pow((t+100)/100,2),this.process("contrast",function(e){return e.r/=255,e.r-=.5,e.r*=t,e.r+=.5,e.r*=255,e.g/=255,e.g-=.5,e.g*=t,e.g+=.5,e.g*=255,e.b/=255,e.b-=.5,e.b*=t,e.b+=.5,e.b*=255,e})}),u.register("hue",function(t){return this.process("hue",function(e){var i,r;return i=100*(r=a.rgbToHSV(e.r,e.g,e.b)).h,i=(i+=Math.abs(t))%100/100,r.h=i,(i=a.hsvToRGB(r.h,r.s,r.v)).a=e.a,i})}),u.register("colorize",function(){var t,e;return 2===arguments.length?(e=a.hexToRGB(arguments[0]),t=arguments[1]):4===arguments.length&&(e={r:arguments[0],g:arguments[1],b:arguments[2]},t=arguments[3]),this.process("colorize",function(i){return i.r-=(i.r-e.r)*(t/100),i.g-=(i.g-e.g)*(t/100),i.b-=(i.b-e.b)*(t/100),i})}),u.register("invert",function(){return this.process("invert",function(t){return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,t})}),u.register("sepia",function(t){return null==t&&(t=100),t/=100,this.process("sepia",function(e){return e.r=Math.min(255,e.r*(1-.607*t)+.769*e.g*t+.189*e.b*t),e.g=Math.min(255,.349*e.r*t+e.g*(1-.314*t)+.168*e.b*t),e.b=Math.min(255,.272*e.r*t+.534*e.g*t+e.b*(1-.869*t)),e})}),u.register("gamma",function(t){return this.process("gamma",function(e){return e.r=255*Math.pow(e.r/255,t),e.g=255*Math.pow(e.g/255,t),e.b=255*Math.pow(e.b/255,t),e})}),u.register("noise",function(t){return t=2.55*Math.abs(t),this.process("noise",function(e){var i;return i=r.randomRange(-1*t,t),e.r+=i,e.g+=i,e.b+=i,e})}),u.register("clip",function(t){return t=2.55*Math.abs(t),this.process("clip",function(e){return e.r>255-t?e.r=255:e.r<t&&(e.r=0),e.g>255-t?e.g=255:e.g<t&&(e.g=0),e.b>255-t?e.b=255:e.b<t&&(e.b=0),e})}),u.register("channels",function(t){var e;if("object"!=typeof t)return this;for(e in t)L.call(t,e)&&(0===t[e]?delete t[e]:t[e]/=100);return 0===t.length?this:this.process("channels",function(e){return null!=t.red&&(e.r=0<t.red?e.r+(255-e.r)*t.red:e.r-e.r*Math.abs(t.red)),null!=t.green&&(e.g=0<t.green?e.g+(255-e.g)*t.green:e.g-e.g*Math.abs(t.green)),null!=t.blue&&(e.b=0<t.blue?e.b+(255-e.b)*t.blue:e.b-e.b*Math.abs(t.blue)),e})}),u.register("curves",function(){var t,e,i,n,s,o,a;if(e=arguments[0],i=2<=arguments.length?k.call(arguments,1):[],"string"==typeof e&&(e=e.split("")),"v"===e[0]&&(e=["r","g","b"]),3>i.length||4<i.length)throw"Invalid number of arguments to curves filter";if(a=i[0],n=i[1],s=4===i.length?i[2]:i[1],i=i[i.length-1],t=r.bezier(a,n,s,i,0,255),0<a[0])for(o=n=0,s=a[0];0<=s?n<s:n>s;o=0<=s?++n:--n)t[o]=a[1];if(255>i[0])for(o=a=n=i[0];255>=n?255>=a:255<=a;o=255>=n?++a:--a)t[o]=i[1];return this.process("curves",function(i){var r,n;for(o=r=0,n=e.length;0<=n?r<n:r>n;o=0<=n?++r:--r)i[e[o]]=t[i[e[o]]];return i})}),u.register("exposure",function(t){var e,i;return e=[0,255*(i=Math.abs(t)/100)],i=[255-255*i,255],0>t&&(e=e.reverse(),i=i.reverse()),this.curves("rgb",[0,0],e,i,[255,255])}),n.Plugin.register("crop",function(t,e,i,r){var n;return null==i&&(i=0),null==r&&(r=0),"undefined"!=typeof exports&&null!==exports?n=new o(t,e):(n=document.createElement("canvas"),v.copyAttributes(this.canvas,n),n.width=t,n.height=e),n.getContext("2d").drawImage(this.canvas,i,r,t,e,0,0,t,e),this.cropCoordinates={x:i,y:r},this.cropped=!0,this.replaceCanvas(n)}),n.Plugin.register("resize",function(t){var e;if(null==t&&(t=null),null!==t&&(null!=t.width||null!=t.height))return null==t.width?t.width=this.canvas.width*t.height/this.canvas.height:null==t.height&&(t.height=this.canvas.height*t.width/this.canvas.width),"undefined"!=typeof exports&&null!==exports?e=new o(t.width,t.height):(e=document.createElement("canvas"),v.copyAttributes(this.canvas,e),e.width=t.width,e.height=t.height),e.getContext("2d").drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,t.width,t.height),this.resized=!0,this.replaceCanvas(e);p.error("Invalid or missing dimensions given for resize")}),n.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0))}),n.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0))}),n.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])}),n.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])}),n.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])}),n.Filter.register("motionBlur",function(t){return this.processKernel("Motion Blur",0===t||180===t?[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]:0<t&&90>t||180<t&&270>t?[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]:90===t||270===t?[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1])}),n.Filter.register("sharpen",function(t){return null==t&&(t=100),t/=100,this.processKernel("Sharpen",[0,-t,0,-t,4*t+1,-t,0,-t,0])}),R={brightness:function(t,e,i){return t.r-=t.r*e*i.strength,t.g-=t.g*e*i.strength,t.b-=t.b*e*i.strength,t},gamma:function(t,e,i){return t.r=255*Math.pow(t.r/255,Math.max(10*e*i.strength,1)),t.g=255*Math.pow(t.g/255,Math.max(10*e*i.strength,1)),t.b=255*Math.pow(t.b/255,Math.max(10*e*i.strength,1)),t},colorize:function(t,e,i){return t.r-=(t.r-i.color.r)*e,t.g-=(t.g-i.color.g)*e,t.b-=(t.b-i.color.b)*e,t}},u.register("vignette",function(t,e){var i,n,s;return null==e&&(e=60),"string"==typeof t&&"%"===t.substr(-1)&&(t=this.dimensions.height>this.dimensions.width?this.dimensions.width*(parseInt(t.substr(0,t.length-1),10)/100):this.dimensions.height*(parseInt(t.substr(0,t.length-1),10)/100)),e/=100,n=[this.dimensions.width/2,this.dimensions.height/2],s=Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2))-t,i=r.bezier([0,1],[30,30],[70,60],[100,80]),this.process("vignette",function(o){var a;return a=this.locationXY(),(a=r.distance(a.x,a.y,n[0],n[1]))>s&&(a=Math.max(1,i[Math.round((a-s)/t*100)]/10*e),o.r=255*Math.pow(o.r/255,a),o.g=255*Math.pow(o.g/255,a),o.b=255*Math.pow(o.b/255,a)),o})}),u.register("rectangularVignette",function(t){var e,i,s,o;if(!(t=v.extend({strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}},t)).size)return this;if("string"==typeof t.size)e=parseInt(t.size,10)/100,t.size={width:this.dimensions.width*e,height:this.dimensions.height*e};else if("object"==typeof t.size)for(i=0,s=(o=["width","height"]).length;i<s;i++)e=o[i],"string"==typeof t.size[e]&&(t.size[e]=this.dimensions[e]*(parseInt(t.size[e],10)/100));else"number"===t.size&&(e=t.size,t.size={width:e,height:e});return"string"==typeof t.cornerRadius&&(t.cornerRadius=t.size.width/2*(parseInt(t.cornerRadius,10)/100)),t.strength/=100,t.size.width=Math.floor(t.size.width),t.size.height=Math.floor(t.size.height),t.image={width:this.dimensions.width,height:this.dimensions.height},"colorize"===t.method&&"string"==typeof t.color&&(t.color=a.hexToRGB(t.color)),t.coords={left:(this.dimensions.width-t.size.width)/2,right:this.dimensions.width-t.coords.left,bottom:(this.dimensions.height-t.size.height)/2,top:this.dimensions.height-t.coords.bottom},t.corners=[{x:t.coords.left+t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.bottom+t.cornerRadius},{x:t.coords.left+t.cornerRadius,y:t.coords.bottom+t.cornerRadius}],t.maxDist=r.distance(0,0,t.corners[3].x,t.corners[3].y)-t.cornerRadius,this.process("rectangularVignette",function(e){var i,r;return(r=this.locationXY()).x>t.corners[0].x&&r.x<t.corners[1].x&&r.y>t.coords.bottom&&r.y<t.coords.top||r.x>t.coords.left&&r.x<t.coords.right&&r.y>t.corners[3].y&&r.y<t.corners[2].y?e:(r.x>t.corners[0].x&&r.x<t.corners[1].x&&r.y>t.coords.top?i=(r.y-t.coords.top)/t.maxDist:r.y>t.corners[2].y&&r.y<t.corners[1].y&&r.x>t.coords.right?i=(r.x-t.coords.right)/t.maxDist:r.x>t.corners[0].x&&r.x<t.corners[1].x&&r.y<t.coords.bottom?i=(t.coords.bottom-r.y)/t.maxDist:r.y>t.corners[2].y&&r.y<t.corners[1].y&&r.x<t.coords.left?i=(t.coords.left-r.x)/t.maxDist:r.x<=t.corners[0].x&&r.y>=t.corners[0].y?i=((i=n.distance(r.x,r.y,t.corners[0].x,t.corners[0].y))-t.cornerRadius)/t.maxDist:r.x>=t.corners[1].x&&r.y>=t.corners[1].y?i=((i=n.distance(r.x,r.y,t.corners[1].x,t.corners[1].y))-t.cornerRadius)/t.maxDist:r.x>=t.corners[2].x&&r.y<=t.corners[2].y?i=((i=n.distance(r.x,r.y,t.corners[2].x,t.corners[2].y))-t.cornerRadius)/t.maxDist:r.x<=t.corners[3].x&&r.y<=t.corners[3].y&&(i=((i=n.distance(r.x,r.y,t.corners[3].x,t.corners[3].y))-t.cornerRadius)/t.maxDist),0>i?e:R[t.method](e,i,t))})}),B=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],S=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],P=function(t,e,i,r,n,s,a){var h,c,u;return(h="undefined"!=typeof exports&&null!==exports?new o:document.createElement("canvas")).width=t,h.height=e,c=i+.5*Math.cos(n)*s,u=r+.5*Math.sin(n)*s,i-=.5*Math.cos(n)*s,r-=.5*Math.sin(n)*s,c=(h=h.getContext("2d")).createLinearGradient(c,u,i,r),a?(c.addColorStop(0,"white"),c.addColorStop(.5,"black"),c.addColorStop(1,"white")):(c.addColorStop(0,"white"),c.addColorStop(1,"black")),h.fillStyle=c,h.fillRect(0,0,t,e),h.getImageData(0,0,t,e)},I=function(t,e,i,r,n,s){var a;return(a="undefined"!=typeof exports&&null!==exports?new o:document.createElement("canvas")).width=t,a.height=e,(i=(a=a.getContext("2d")).createRadialGradient(i,r,n,i,r,s)).addColorStop(1,"white"),i.addColorStop(0,"black"),a.fillStyle=i,a.fillRect(0,0,t,e),a.getImageData(0,0,t,e)},M=function(){return this.a=this.b=this.g=this.r=0,this.next=null},n.Plugin.register("compoundBlur",function(t,e,i,r){var n,s,o,a,h,c,u,l,g,d,p,f,m,b,y,x,v,w,D,R,P,I,L,C,k,F,z,T,A,N,J,j,G,O,H;for(N=this.dimensions.width,d=this.dimensions.height,b=this.pixelData,I=t.data,h=(A=N*d)<<2,t=[],f=z=0;0<=h?z<h:z>h;f=0<=h?++z:--z)t[f]=b[f];for(h=0,z=r,r-=1;0<=z--;)if(0!=(n=e+.5|0)){for(256<n&&(n=256),c=n+n+1,J=N-1,p=d-1,T=(a=n+1)*(a+1)/2,m=void 0,k=F=new M,f=s=1;1<=c?s<c:s>c;f=1<=c?++s:--s)k=k.next=new M,f===a&&(m=k);for(k.next=F,O=G=0,c=B[n],C=S[n],H=0;0<=d?H<d:H>d;0<=d?++H:--H){for(D=u=n=P=g=o=0,R=a*(w=t[G]),l=a*(v=t[G+1]),s=a*(x=t[G+2]),P+=T*w,g+=T*v,o+=T*x,k=F,f=0;0<=a?f<a:f>a;0<=a?++f:--f)k.r=w,k.g=v,k.b=x,k=k.next;for(f=j=1;1<=a?j<a:j>a;f=1<=a?++j:--j)y=G+((J<f?J:f)<<2),P+=(k.r=w=t[y])*(L=a-f),g+=(k.g=v=t[y+1])*L,o+=(k.b=x=t[y+2])*L,D+=w,u+=v,n+=x,k=k.next;for(f=F,k=m,j=L=0;0<=N?L<N:L>N;j=0<=N?++L:--L)t[G]=P*c>>C,t[G+1]=g*c>>C,t[G+2]=o*c>>C,P-=R,g-=l,o-=s,R-=f.r,l-=f.g,s-=f.b,y=O+((y=j+a)<J?y:J)<<2,P+=D+=f.r=t[y],g+=u+=f.g=t[y+1],o+=n+=f.b=t[y+2],f=f.next,R+=w=k.r,l+=v=k.g,s+=x=k.b,D-=w,u-=v,n-=x,k=k.next,G+=4;O+=N}for(j=J=0;0<=N?J<N:J>N;j=0<=N?++J:--J){for(u=n=D=g=o=P=0,R=a*(w=t[G=j<<2]),l=a*(v=t[G+1]),s=a*(x=t[G+2]),P+=T*w,g+=T*v,o+=T*x,k=F,f=0;0<=a?f<a:f>a;0<=a?++f:--f)k.r=w,k.g=v,k.b=x,k=k.next;for(O=N,f=H=1;1<=a?H<a:H>a;f=1<=a?++H:--H)G=O+j<<2,P+=(k.r=w=t[G])*(L=a-f),g+=(k.g=v=t[G+1])*L,o+=(k.b=x=t[G+2])*L,D+=w,u+=v,n+=x,k=k.next,f<p&&(O+=N);for(G=j,f=F,k=m,x=O=0;0<=d?O<d:O>d;x=0<=d?++O:--O)t[y=G<<2]=P*c>>C,t[y+1]=g*c>>C,t[y+2]=o*c>>C,P-=R,g-=l,o-=s,R-=f.r,l-=f.g,s-=f.b,y=j+((y=x+a)<p?y:p)*N<<2,P+=D+=f.r=t[y],g+=u+=f.g=t[y+1],o+=n+=f.b=t[y+2],f=f.next,R+=w=k.r,l+=v=k.g,s+=x=k.b,D-=w,u-=v,n-=x,k=k.next,G+=N}for(e*=i,f=A;-1<--f;)(a=0|(m=(255&I[2+(p=f<<2)])/255*r))===h?(m=256-(a=256*(m-(0|m))),b[p]=b[p]*m+t[p]*a>>8,b[p+1]=b[p+1]*m+t[p+1]*a>>8,b[p+2]=b[p+2]*m+t[p+2]*a>>8):a===h+1&&(b[p]=t[p],b[p+1]=t[p+1],b[p+2]=t[p+2]);h++}return this}),n.Filter.register("tiltShift",function(t){var e;return(t=v.extend({center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3},t)).angle*=Math.PI/180,e=P(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,t.angle,t.focusWidth,!0),this.processPlugin("compoundBlur",[e,t.startRadius,t.radiusFactor,t.steps])}),n.Filter.register("radialBlur",function(t){var e;return(t=v.extend({size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null},t)).radius||(t.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width),e=I(this.dimensions.width,this.dimensions.height,t.center.x,t.center.y,t.radius/2-t.size,t.radius/2),this.processPlugin("compoundBlur",[e,t.startRadius,t.radiusFactor,t.steps])}),n.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0])}),n.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1])}),n.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2])}),n.Filter.register("posterize",function(t){var e,i;return e=256/t,i=255/(t-1),this.process("posterize",function(t){return t.r=Math.floor(Math.floor(t.r/e)*i),t.g=Math.floor(Math.floor(t.g/e)*i),t.b=Math.floor(Math.floor(t.b/e)*i),t})}),n.Filter.register("vintage",function(t){if(null==t&&(t=!0),this.greyscale(),this.contrast(5),this.noise(3),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.87),t)return this.vignette("40%",30)}),n.Filter.register("lomo",function(t){return null==t&&(t=!0),this.brightness(15),this.exposure(15),this.curves("rgb",[0,0],[200,0],[155,255],[255,255]),this.saturation(-20),this.gamma(1.8),t&&this.vignette("50%",60),this.brightness(5)}),n.Filter.register("clarity",function(t){return null==t&&(t=!1),this.vibrance(20),this.curves("rgb",[5,0],[130,150],[190,220],[250,255]),this.sharpen(15),this.vignette("45%",20),t&&(this.greyscale(),this.contrast(4)),this}),n.Filter.register("sinCity",function(){return this.contrast(100),this.brightness(15),this.exposure(10),this.posterize(80),this.clip(30),this.greyscale()}),n.Filter.register("sunrise",function(){return this.exposure(3.5),this.saturation(-5),this.vibrance(50),this.sepia(60),this.colorize("#e87b22",10),this.channels({red:8,blue:8}),this.contrast(5),this.gamma(1.2),this.vignette("55%",25)}),n.Filter.register("crossProcess",function(){return this.exposure(5),this.colorize("#e87b22",4),this.sepia(20),this.channels({blue:8,red:3}),this.curves("b",[0,0],[100,150],[180,180],[255,255]),this.contrast(15),this.vibrance(75),this.gamma(1.6)}),n.Filter.register("orangePeel",function(){return this.curves("rgb",[0,0],[100,50],[140,200],[255,255]),this.vibrance(-30),this.saturation(-30),this.colorize("#ff9000",30),this.contrast(-5),this.gamma(1.4)}),n.Filter.register("love",function(){return this.brightness(5),this.exposure(8),this.contrast(4),this.colorize("#c42007",30),this.vibrance(50),this.gamma(1.3)}),n.Filter.register("grungy",function(){return this.gamma(1.5),this.clip(25),this.saturation(-60),this.contrast(5),this.noise(5),this.vignette("50%",30)}),n.Filter.register("jarques",function(){return this.saturation(-35),this.curves("b",[20,0],[90,120],[186,144],[255,230]),this.curves("r",[0,0],[144,90],[138,120],[255,255]),this.curves("g",[10,0],[115,105],[148,100],[255,248]),this.curves("rgb",[0,0],[120,100],[128,140],[255,255]),this.sharpen(20)}),n.Filter.register("pinhole",function(){return this.greyscale(),this.sepia(10),this.exposure(10),this.contrast(15),this.vignette("60%",35)}),n.Filter.register("oldBoot",function(){return this.saturation(-20),this.vibrance(-50),this.gamma(1.1),this.sepia(30),this.channels({red:-10,blue:5}),this.curves("rgb",[0,0],[80,50],[128,230],[255,255]),this.vignette("60%",30)}),n.Filter.register("glowingSun",function(t){if(null==t&&(t=!0),this.brightness(10),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.gamma(.8),this.filter.contrast(50),this.filter.exposure(10)}),this.newLayer(function(){return this.setBlendingMode("softLight"),this.opacity(80),this.fillColor("#f49600")}),this.exposure(20),this.gamma(.8),t)return this.vignette("45%",20)}),n.Filter.register("hazyDays",function(){return this.gamma(1.2),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(60),this.copyParent(),this.filter.channels({red:5}),this.filter.stackBlur(15)}),this.newLayer(function(){return this.setBlendingMode("addition"),this.opacity(40),this.fillColor("#6899ba")}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(35),this.copyParent(),this.filter.brightness(40),this.filter.vibrance(40),this.filter.exposure(30),this.filter.contrast(15),this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]),this.filter.stackBlur(5)}),this.curves("r",[20,0],[128,158],[128,128],[235,255]),this.curves("g",[20,0],[128,128],[128,128],[235,255]),this.curves("b",[20,0],[128,108],[128,128],[235,255]),this.vignette("45%",20)}),n.Filter.register("herMajesty",function(){return this.brightness(40),this.colorize("#ea1c5d",10),this.curves("b",[0,10],[128,180],[190,190],[255,255]),this.newLayer(function(){return this.setBlendingMode("overlay"),this.opacity(50),this.copyParent(),this.filter.gamma(.7),this.newLayer(function(){return this.setBlendingMode("normal"),this.opacity(60),this.fillColor("#ea1c5d")})}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(60),this.copyParent(),this.filter.saturation(50),this.filter.hue(90),this.filter.contrast(10)}),this.gamma(1.4),this.vibrance(-30),this.newLayer(function(){return this.opacity(10),this.fillColor("#e5f0ff")}),this}),n.Filter.register("nostalgia",function(){return this.saturation(20),this.gamma(1.4),this.greyscale(),this.contrast(5),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.8),this.contrast(5),this.exposure(10),this.newLayer(function(){return this.setBlendingMode("overlay"),this.copyParent(),this.opacity(55),this.filter.stackBlur(10)}),this.vignette("50%",30)}),n.Filter.register("hemingway",function(){return this.greyscale(),this.contrast(10),this.gamma(.9),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(40),this.copyParent(),this.filter.exposure(15),this.filter.contrast(15),this.filter.channels({green:10,red:5})}),this.sepia(30),this.curves("rgb",[0,10],[120,90],[180,200],[235,255]),this.channels({red:5,green:-2}),this.exposure(15)}),n.Filter.register("concentrate",function(){return this.sharpen(40),this.saturation(-50),this.channels({red:3}),this.newLayer(function(){return this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.sharpen(5),this.filter.contrast(50),this.filter.exposure(10),this.filter.channels({blue:5})}),this.brightness(10)}),function(){var t,e,i;e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],i=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],t=function(){return this.a=this.b=this.g=this.r=0,this.next=null},n.Plugin.register("stackBlur",function(r){var n,s,o,a,h,c,u,l,g,d,p,f,m,b,y,x,v,w,D,R,M,P,I,B,S,L,C,k,F,z,T;if(!(isNaN(r)||1>r)){for(r|=0,b=this.pixelData,n=r+r+1,C=(L=this.dimensions.width)-1,l=(u=this.dimensions.height)-1,S=(D=r+1)*(D+1)/2,P=B=new t,g=s=1;1<=n?s<n:s>n;g=1<=n?++s:--s)P=P.next=new t,g===D&&(I=P);for(P.next=B,z=F=0,d=e[r],M=i[r],T=0;0<=u?T<u:T>u;0<=u?++T:--T){for(x=a=n=w=c=o=0,v=D*(y=b[F]),h=D*(m=b[F+1]),s=D*(f=b[F+2]),w+=S*y,c+=S*m,o+=S*f,P=B,k=0;0<=D?k<D:k>D;0<=D?++k:--k)P.r=y,P.g=m,P.b=f,P=P.next;for(g=k=1;1<=D?k<D:k>D;g=1<=D?++k:--k)p=F+((C<g?C:g)<<2),w+=(P.r=y=b[p])*(R=D-g),c+=(P.g=m=b[p+1])*R,o+=(P.b=f=b[p+2])*R,x+=y,a+=m,n+=f,P=P.next;for(P=B,g=I,k=R=0;0<=L?R<L:R>L;k=0<=L?++R:--R)b[F]=w*d>>M,b[F+1]=c*d>>M,b[F+2]=o*d>>M,w-=v,c-=h,o-=s,v-=P.r,h-=P.g,s-=P.b,p=z+((p=k+r+1)<C?p:C)<<2,w+=x+=P.r=b[p],c+=a+=P.g=b[p+1],o+=n+=P.b=b[p+2],P=P.next,v+=y=g.r,h+=m=g.g,s+=f=g.b,x-=y,a-=m,n-=f,g=g.next,F+=4;z+=L}for(k=C=0;0<=L?C<L:C>L;k=0<=L?++C:--C){for(a=n=x=c=o=w=0,v=D*(y=b[F=k<<2]),h=D*(m=b[F+1]),s=D*(f=b[F+2]),w+=S*y,c+=S*m,o+=S*f,P=B,p=0;0<=D?p<D:p>D;0<=D?++p:--p)P.r=y,P.g=m,P.b=f,P=P.next;for(p=L,g=z=1;1<=r?z<=r:z>=r;g=1<=r?++z:--z)F=p+k<<2,w+=(P.r=y=b[F])*(R=D-g),c+=(P.g=m=b[F+1])*R,o+=(P.b=f=b[F+2])*R,x+=y,a+=m,n+=f,P=P.next,g<l&&(p+=L);for(F=k,P=B,g=I,f=z=0;0<=u?z<u:z>u;f=0<=u?++z:--z)b[p=F<<2]=w*d>>M,b[p+1]=c*d>>M,b[p+2]=o*d>>M,w-=v,c-=h,o-=s,v-=P.r,h-=P.g,s-=P.b,p=k+((p=f+D)<l?p:l)*L<<2,w+=x+=P.r=b[p],c+=a+=P.g=b[p+1],o+=n+=P.b=b[p+2],P=P.next,v+=y=g.r,h+=m=g.g,s+=f=g.b,x-=y,a-=m,n-=f,g=g.next,F+=L}return this}}),n.Filter.register("stackBlur",function(t){return this.processPlugin("stackBlur",[t])})}(),n.Filter.register("threshold",function(t){return this.process("threshold",function(e){return.2126*e.r+.7152*e.g+.0722*e.b<t?(e.r=0,e.g=0,e.b=0):(e.r=255,e.g=255,e.b=255),e})})}).call(this)}()});
module({"@NextUtil":"@NextUtil","@Dialogs":"@Dialogs","json!/common/js/JSON/RoomsOccupancy.json":"json!/asset/18a4ecdf13f29bb8/common/js/JSON/RoomsOccupancy.json","json!/common/js/JSON/Countries.json":"json!/asset/82bbf3f0be07c92d/common/js/JSON/Countries.json","json!/common/js/JSON/PPCCountries.json":"json!/asset/cb7303d250cfc7c9/common/js/JSON/PPCCountries.json","json!/common/js/JSON/PPCValue.json":"json!/asset/997927575664224c/common/js/JSON/PPCValue.json","@Model":"@Model","json!/common/js/JSON/Provinces.json":"json!/asset/1e80a06c565197b7/common/js/JSON/Provinces.json","@UiCore":"@UiCore","json!/common/js/JSON/LanguageMap.json":"json!/asset/cdbdd9c055835f4e/common/js/JSON/LanguageMap.json","json!/common/js/JSON/States.json":"json!/asset/581385bf78983508/common/js/JSON/States.json","json!/common/js/JSON/ProductPricing.json":"json!/asset/f47409f4768bae3d/common/js/JSON/ProductPricing.json","css!/build/withme/widgets.css":"css!/asset/9f99a97d757df638/build/withme/widgets.css"},function(e){var t,i,a=(i={UiCore:e["@UiCore"]}.UiCore.UiContext).extend("Timestamp",{className:"timestamp-widget",uiContextName:"timestamp",tagName:"timestamp",dependencies:["timestampHelper","moment","timestamp"],initialize:function(e){i.prototype.initialize.call(this,e),this.__timestampHelper=e.timestampHelper,this.__moment=e.moment,this.__timestampHelper.setDifference(e.timestamp),this.addToDOM(),this.$el.attr("data-actual-date",this.__timestampHelper.now().toString())},render:function(){this.$el.text(this.__timestampHelper.formatTime())}}),n=(e["@UiCore"],a).extend("activityHeaderTimestamp",{className:"activity-header-timestamp system-info-header",uiContextName:"activity_header_timestamp",tagName:"datedivider",render:function(){this.$el.text(this.__timestampHelper.activityCenterHeader())}}),s=function(e){var t={DESKTOP:{FEED_GRID:"Feed_Grid_Fluid",FEED_COLUMN:"Feed_Single_Fluid",SHOP_GRID:"Shop_Grid_Fluid"},MOBILE:{FEED_COLUMN:"MWeb_Feed_Single_Fluid",SHOP_GRID:"MWeb_Shop_Grid_Fluid"}},i=["fluid"],a=e.UiCore.UiContext;return a.extend("AdSlot",{uiContextName:"ad_slot",className:"ad-slot",tagName:"div",dependencies:"adsCategory adSlotCount globalVariablesManager loginManager parentElement platform prefsManager timestampHelper type uiContext window".split(" "),initialize:function(e){switch(a.prototype.initialize.call(this,e),this.__initDFP(),this.__uiContext){case"feed_list":this.__uiContextName="feed";break;case"shop_list":this.__uiContextName="shop";break;default:this.__uicontextName=""}this.$el.addClass(this.__type+" "+this.__uiContextName),this.__slotId=this.__adSlotId(),this.__isMobile="mobile"===e.platform,this._isUnitTest=this.__isUnitTest,this.$el.attr("id",this.__slotId),this.__parentElement.append(this.$el),this.__myself=this.__loginManager.getCurrentUser(),this.__prefsManager.populated().then(function(){this.__testNativeAds=e.prefsManager.getBool("testNativeAds"),this.__requestAdFromDFP(this.__slotId)}.bind(this))},__initDFP:function(e){this.__googletag=this.__window.googletag||{},this.__googletag.cmd=this.__googletag.cmd||[],this.__globalVariablesManager.has("DFPinited")&&this.__globalVariablesManager.get("DFPinited")||(this.__googletag.cmd.push(function(){this.__googletag.pubads().enableSingleRequest(),this.__googletag.pubads().collapseEmptyDivs(),this.__googletag.pubads().disableInitialLoad(),this.__googletag.pubads().setPublisherProvidedId(this.__generatePPID()),this.__googletag.companionAds().setRefreshUnfilledSlots(!0),this.__googletag.enableServices()}.bind(this)),this.__globalVariablesManager.has("DFPinited")?this.__globalVariablesManager.set("DFPinited",!0):this.__globalVariablesManager.add("DFPinited",!0))},__generatePPID:function(){for(var e=["x","y"],t=0,i=this.__cid+"";32>i.length;)i=e[t]+i,t=0===t?1:0;return btoa(i).replace(/=/g,"z")},__adSlotId:function(){return"div-gpt-ad-"+this.__timestampHelper.now().valueOf()+"-"+this.__adSlotCount},__requestAdFromDFP:function(){this._isUnitTest||this.__googletag.cmd.push(function(){var e=this.__googletag.defineSlot(this.__getAdUnitCode(),i,this.__slotId);e.addService(this.__googletag.pubads()),e.setTargeting("gender",this.__myself.get("gender")),e.setTargeting("userCategory",this.__adsCategory),this.__testNativeAds&&e.setTargeting("testOnly",1),this.__googletag.pubads().refresh([e]),this.__googletag.display(this.__slotId)}.bind(this))},__getAdUnitCode:function(){var e,i=this.__isMobile?"MOBILE":"DESKTOP";return"shop_list"===this.__uiContext?e=t[i].SHOP_GRID:"feed_list"===this.__uiContext&&("MOBILE"===i?e=t[i].FEED_COLUMN:("grid"===this.__type&&(e=t[i].FEED_GRID),"column"===this.__type&&(e=t[i].FEED_COLUMN))),"/6017/IMVU-Web_Native/"+e}})}({UiCore:e["@UiCore"]}),o=(t=Handlebars.template,Handlebars.templates=Handlebars.templates||{},t({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="edge-collection-init-error">\n    ';return((n=(t.icon||e&&e.icon||i).call(e,"icon-feed_error",{name:"icon",hash:{},data:a}))||0===n)&&(s+=n),s+="\n    <div class='error-title'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"feed-error-title",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</div>\n    <div class='error-text'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"feed-error-text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n</div>"},useData:!0})),l=function(t){var i={Dialogs:e["@Dialogs"]}.Dialogs.AlloyModalDialog;return i.extend("TooltipDialog",{uiContextName:"tooltip_dialog",className:"tooltip-dialog dialog-type-B text-close",trackedEvents:function(){return this.__customTrackedEvents},initialize:function(e){this.__customTrackedEvents=e.trackedEvents||[],i.prototype.initialize.call(this,e),this.title=e.title,this.__tooltipContent=e.tooltipContent,this.addToDOM()},postRender:function(){this.setContent("body",this.__tooltipContent)}})}(),r=function(e){var t=e.UiCore.UiContext;return t.extend("Tooltip",{className:"tooltip",uiContextName:"tooltip",dependencies:["dialogManager","timer","tooltipLayer","window"],trackedEvents:function(){return[{type:"click",selector:"a",name:"link_click",handler:"__clickedLink",allowBubble:!0}].concat(this.__customTrackedEvents)},__installTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.on("mouseenter.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.$target.off("mouseleave.tooltip")}.bind(this)),this.__tooltipLayer.$el.on("mouseleave.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=this.__timer.setTimeout(function(){this.setVisible(!1),this.__timer.clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=this.__timer.setTimeout(function(){this.__hide(),this.__installTargetMouseleave()}.bind(this),125)}.bind(this),250)}.bind(this))},__removeTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.off(".tooltip")},initialize:function(e){this.$tooltip=IMVU.requireProperty(e,"$replaceElement"),this.$target=IMVU.requireProperty(e,"$tooltipTarget"),this.tooltipTitle=IMVU.optionalProperty(e,"title",!1),this.__tooltipStyle=IMVU.optionalProperty(e,"tooltipStyle","default"),this.__customTrackedEvents=e.trackedEvents||[],t.prototype.initialize.call(this,e),this.$body=$("body"),this.$globalNav=$("nav.global-nav:visible"),"mobile"===this.__serviceProvider.get("platform")?this.$target.on("click.tooltip",function(e){e.stopPropagation(),this.__openTooltipDialog()}.bind(this)):this.$target.on("mouseenter.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.__timer.clearTimeout(this.__targetFadeinTimeout),this.__installTargetMouseleave(),this.__targetFadeinTimeout=this.__timer.setTimeout(function(){this.setVisible(!0),this.__show()}.bind(this),250)}.bind(this)),"snug"===this.__tooltipStyle&&this.$el.addClass("tooltip-snug"),this.$el.append(this.$tooltip),this.setParentUiContext(this.__tooltipLayer),this.__tooltipLayer.$el.append(this.$el)},setVisible:function(e){this.$el.toggleClass("tooltip-open",!!e)},__installTargetMouseleave:function(){this.$target.on("mouseleave.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout),this.__targetTimeout=this.__timer.setTimeout(function(){this.setVisible(!1),this.__timer.clearTimeout(this.__targetTimeout),this.__targetTimeout=this.__timer.setTimeout(function(){this.__hide()}.bind(this),125)}.bind(this),250)}.bind(this))},__show:function(){this.__installTooltipLayerEventHandlers(),this.__trackTooltip(),$(this.__window).on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this)),this.$body.find(".transparent-overlay").on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this))},__trackTooltip:function(){var e=this.$globalNav.height(),t=this.$target[0].getBoundingClientRect().top,i=this.$target[0].getBoundingClientRect().left,a=$(window).width()-(i+this.$target.outerWidth()/2),n=this.$el[0].offsetWidth;0<this.$target.parents(".dialog-manager").length&&(e=0),i=a>n?i+this.$target.width()/2:i+this.$target.width()/2-n,this.$el.css({"margin-top":Math.max(t,e),"margin-left":i})},__hide:function(){this.__removeTooltipLayerEventHandlers(),this.setVisible(!1)},__openTooltipDialog:function(){return this.__dialogManager.showDialog(e.TooltipDialog,{title:this.tooltipTitle||this.$target.text(),tooltipContent:this.$tooltip.html(),trackedEvents:this.__customTrackedEvents})},delete:function(){this.$el.removeAttr("style"),this.__timer.clearTimeout(this.__targetFadeinTimeout),this.__timer.clearTimeout(this.__targetTimeout),this.__timer.clearTimeout(this.__tooltipTimeout),this.$target.off(".tooltip"),this.__removeTooltipLayerEventHandlers(),$(this.__window).off("scroll.tooltip"),this.$body.find(".transparent-overlay").off("scroll.tooltip"),t.prototype.delete.call(this)},__clickedLink:function(){this.__hide()}})}({UiCore:e["@UiCore"],TooltipDialog:l}),d=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return'<span class="tool-tip">?</span>'},3:function(e,t,i,a){var n;return'<div class="tool-tip-content">'+(0,this.escapeExpression)("function"==typeof(n=t.toolTipContent||e&&e.toolTipContent)?n.call(e,{name:"toolTipContent",hash:{},data:a}):n)+"</div>"},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s,o='<div class="no-results notation">\n    <span class="standard-text">'+(i=this.escapeExpression)("function"==typeof(s=t.standard||e&&e.standard)?s.call(e,{name:"standard",hash:{},data:a}):s);return((n=t.if.call(e,e&&e.hasToolTip,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+='</span>\n    <span class="concise-text">'+i("function"==typeof(s=t.concise||e&&e.concise)?s.call(e,{name:"concise",hash:{},data:a}):s),((n=t.if.call(e,e&&e.hasToolTip,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+="</span>\n    ",((n=t.if.call(e,e&&e.hasToolTip,{name:"if",hash:{},fn:this.program(3,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+"\n</div>"},useData:!0})}(),h=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="notation page-error">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"edge_collection_page_error",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>"},useData:!0})}(),c=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return'<div class="notation reached-end">'+(0,this.escapeExpression)("function"==typeof(n=t.text||e&&e.text)?n.call(e,{name:"text",hash:{},data:a}):n)+"</div>"},useData:!0})}(),p=function(e){var t=e.UiCore.EdgeCollectionPresenter;return t.extend("EdgeCollectionPresenter",{dependencies:["timer"],initialize:function(e){this.__manuallyPage=!!e.manuallyPage,t.prototype.initialize.call(this,e),this.$el.addClass("is-list")},renderTemplate:function(){this.__updateEmpty(),this.__updateReachedEnd(),this.collection.on("add remove reset",this.__updateEmpty.bind(this))},__updateEmpty:function(){if(0!==this.collection.models.length||this.__$empty)this.collection.models.length&&this.__$empty&&(this.__$empty.remove(),this.__$empty=null);else{var t=this.__emptyText();t&&(this.__$empty=$(e.emptyTemplate({standard:t.standard,concise:t.concise,hasToolTip:"hasToolTip"in t&&void 0!==t.hasToolTip?1:0,toolTipText:"toolTipText"in t&&void 0!==t.toolTipText?t.toolTipText:"",toolTipContent:"toolTipContent"in t&&void 0!==t.toolTipContent?t.toolTipContent:""})),this.$el.append(this.__$empty),this.__tooltip=this.createChildContext(e.Tooltip,{$replaceElement:this.$(".tool-tip-content"),$tooltipTarget:this.$(".tool-tip")}))}},__updateReachedEnd:function(){if(!this.__$reachedEnd&&this.collection.length&&!this.collection.hasNextPage()){var t=this.__reachedEndText();t&&(this.__$reachedEnd=$(e.reachedEndTemplate({text:t})),this.$el.append(this.__$reachedEnd))}},__onPaged:function(){this.__manuallyPage||t.prototype.__onPaged.call(this),this.$el.removeClass("loading"),this.__updateReachedEnd()},__onScroll:function(){this.__manuallyPage||t.prototype.__onScroll.call(this)},__ensureContainerFilled:function(){this.__manuallyPage||t.prototype.__ensureContainerFilled.call(this)},viewMore:function(){this.__maybePage()},__shouldPage:function(){return this.__manuallyPage?this.__readyToPage():t.prototype.__shouldPage.call(this)},__arrangeAndReattach:function(e){t.prototype.__arrangeAndReattach.call(this,e),this.__$reachedEnd&&this.__$reachedEnd.detach().appendTo(this.$el)},onInitError:function(){this.__setInitError(),this.__loadFailureTimeout=this.__timer.setTimeout(this.__recoverFromLoadFail.bind(this,0),5e3)},onPageError:function(){this.__setPageError(),this.__pageFailureTimeout=this.__timer.setTimeout(this.__recoverFromPageFail.bind(this,0),6e4)},__recoverFromLoadFail:function(e){this.__removeInitError(),this.collection.invalidate(),this.collection.enumerated().then(function(){this.render()}.bind(this)).catch(function(){var t=e&&0<e?15===e?45:180<=e?180:2*e:15;window.console.log("Waiting "+t+" seconds to reload"),this.__setInitError(),this.__loadFailureTimeout=this.__timer.setTimeout(this.__recoverFromLoadFail.bind(this,t),1e3*t)}.bind(this))},__recoverFromPageFail:function(){this.__removePageError(),this.__noVisibilityChecks=!1,this.__maybePage()},__setInitError:function(){this.__$initError=$(e.initErrorTemplate({})),this.$el.append(this.__$initError)},__removeInitError:function(){this.__$initError&&(this.__$initError.remove(),this.__$initError=null)},__setPageError:function(){this.__$pageError=$(e.pageErrorTemplate({})),this.$el.append(this.__$pageError)},__removePageError:function(){this.__$pageError&&(this.__$pageError.remove(),this.__$pageError=null)},delete:function(){t.prototype.delete.call(this),this.__loadFailureTimeout&&this.__timer.clearTimeout(this.__loadFailureTimeout),this.__pageFailureTimeout&&this.__timer.clearTimeout(this.__pageFailureTimeout)},__emptyText:function(){},__reachedEndText:function(){}})}({UiCore:e["@UiCore"],emptyTemplate:d,reachedEndTemplate:c,Tooltip:r,initErrorTemplate:o,pageErrorTemplate:h}),g=function(e){var t=e.EdgeCollectionPresenter;return t.extend("AdsListPresenter",{dependencies:["featureAccessManager","loginManager","platform"],initialize:function(e){if(this.itemFactory=this.itemFactory||e.itemFactory,this.__showAds=IMVU.optionalProperty(e,"showAds",!0),this._showedUnloadWarning=!1,e.featureAccessManager.canSeeNativeAds()&&!e.featureAccessManager.isIE()||(this.__showAds=!1),this.__showHouseAds=e.featureAccessManager.canSeeHouseAds(),"You May Also Like"!==e.category&&"Complete Your Look"!==e.category&&"featured"!==e.category&&"wishlist"!==e.category||(this.__showAds=!1),this.__adsCategory="NonVIP",e.loginManager.getCurrentUser().populated().then(function(e){this.__adsCategory=e.get("ads_category")?e.get("ads_category"):"none","none"===this.__adsCategory&&(this.__showAds=!1),"VIP"!==this.__adsCategory||this.__showHouseAds||(this.__showAds=!1),this.__cid=e.get("legacy_cid")}.bind(this)),this.__showAds)switch(this.__isMobile="mobile"===e.platform,this.__firstAdPositionInColumnView=IMVU.optionalProperty(e,"firstAdPositionInColumnView",4),this.__showAdEveryNItemsInColumnView=IMVU.optionalProperty(e,"showAdEveryNItemsInColumnView",3),this.__showAdAfterEveryNRowsInGridView=IMVU.optionalProperty(e,"showAdAfterEveryNRowsInGridView",2),this.__firstAdAfterNRow=IMVU.optionalProperty(e,"firstAdAfterNRow",2),this.__viewType=IMVU.optionalProperty(e,"viewType","grid"),this.__isMobile&&"feed_list"===this.uiContextName&&(this.__viewType="column"),this._isUnitTest=IMVU.optionalProperty(e,"isUnitTest",!1),this._itemCountPerRow=IMVU.optionalProperty(e,"itemCountPerRow",4),this.__lastViewType=this.__viewType,this._isUnitTest&&(this.uiContextName=e.uiContextName),this.uiContextName){case"feed_list":this.__itemSelector="article.feed-item";break;case"shop_list":this.__itemSelector="article.tile";break;default:this.__itemSelector=null}t.prototype.initialize.call(this,e),this.__showAds&&(e.featureAccessManager.canSeePopup()&&$(this.__window).on("beforeunload",function(e){return e.returnValue="leaving IMVU",this._setUnloadWarning(),"leaving IMVU"}.bind(this)),$(this.__window).on("resize."+this.className,this.__onResize.bind(this)),this.collection.enumerated().then(function(){this.__insertAds()}.bind(this)))},__canDecideAdsPosition:function(){return!(!this.$(this.__itemSelector).width()||!this.$el.width())},__decidePositionsByView:function(){"column"===this.__viewType?(this.__firstAdPosition=this.__firstAdPositionInColumnView,this.__showAdEveryNItems=this.__showAdEveryNItemsInColumnView):(this.__itemCountPerRow=this.__itemCountPerRow||this.__getItemCountPerRow(),this.__firstAdPosition=this.__itemCountPerRow*this.__firstAdAfterNRow+1,this.__showAdEveryNItems=this.__itemCountPerRow*this.__showAdAfterEveryNRowsInGridView)},__getItemCountPerRow:function(){if(this._isUnitTest)return this._itemCountPerRow;var e=this.$el.width(),t=this.$(this.__itemSelector).width();return Math.floor(e/t)},__createAdSlot:function(t,i){this.__serviceProvider.create(e.adSlot,{adSlotCount:t,type:this.__viewType,uiContext:this.uiContextName,parentElement:i,adsCategory:this.__adsCategory,isUnitTest:this._isUnitTest})},__insertAds:function(){if((this.__itemSelector||0!==this.$(this.__itemSelector).length)&&this.__canDecideAdsPosition()){this.__decidePositionsByView();var e=this.$(this.__itemSelector).parent(),t=this.$("div.ad-slot"),i=t.length;t.toggleClass("hidden",!0);for(var a=this.$(this.__itemSelector).detach(),n=a.length,s=0,o=this.__firstAdPosition-1;o<n;o+=this.__showAdEveryNItems){var l=a.splice(0,0===s?this.__firstAdPosition-1:this.__showAdEveryNItems);if(s<i?(_.each(l,function(i){e[0].insertBefore(i,t[s])}),t[s].classList.remove("hidden")):(_.each(l,function(t){e.append(t)}),this.__createAdSlot(s,e)),s++,0===this.__showAdEveryNItems)return}0<a.length&&_.each(a,function(t){e.append(t)}),this.__lastItemCountPerRow=this.__itemCountPerRow,this.__lastViewType=this.__viewType}},__onResize:function(){"column"!==this.__viewType&&(this.__itemCountPerRow=this.__getItemCountPerRow(),this.__lastItemCountPerRow!==this.__itemCountPerRow&&this.__rearrangeAdSlots(this.__viewType))},__rearrangeAdSlots:function(e){this.__showAds&&(this.__lastViewType=this.__viewType,this.__viewType=e,this.__viewChanged()&&this.$("div.ad-slot").remove(),this.__insertAds())},__viewChanged:function(){return this.__lastViewType!==this.__viewType},delete:function(){this.__showAds&&($(this.__window).off("resize."+this.className),$(this.__window).off("beforeunload")),t.prototype.delete.call(this)},__detach:function(){if(!this.__showAds)return t.prototype.__detach.call(this)},__arrangeAndReattach:function(e){t.prototype.__arrangeAndReattach.call(this,e),this.__showAds&&this.__insertAds()},__onPaged:function(){t.prototype.__onPaged.call(this),this.__showAds&&this.__insertAds()},rearrangeAdSlots:function(){this.__showAds&&this.__insertAds()},removeAds:function(){this.$("div.ad-slot").remove()},_setItemCountPerRow:function(e){this._itemCountPerRow=e},_setIsUnitTest:function(e){this._isUnitTest=e},_setUnloadWarning:function(){this._showedUnloadWarning=!0}})}({EdgeCollectionPresenter:p,adSlot:s}),u=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return'<div class="at-avatar-name-at">@</div><div class="at-avatar-name-text is-truncated">'+(0,this.escapeExpression)("function"==typeof(n=t.atAvatarName||e&&e.atAvatarName)?n.call(e,{name:"atAvatarName",hash:{},data:a}):n)+"</div>"},useData:!0})}(),m=function(e){var t=e.UiCore.UiContext;return t.extend("AtAvatarName",{className:"at-avatar-name enable-text-selection",uiContextName:"at_avatar_name",dependencies:"cardManager dialogManager featureAccessManager globalStringManager loginManager modeManager user window".split(" "),trackedEvents:function(){return[{type:"click",selector:".at-avatar-name-text",name:"avatar_name_lhs_click",handler:this.__onClickInner.bind(this),allowBubble:!0}]},__stripGuest:function(t){return e.NextUtil.string.startsWith(t,"Guest_")&&(t=t.substring(6)),t},initialize:function(i){t.prototype.initialize.call(this,i),this.__window=i.window,this.__modeManager=i.modeManager,this.__serviceProvider=i.serviceProvider,this.__stringManager=i.globalStringManager,this.__featureAccessManager=i.featureAccessManager,this.__user=this.track(i.user),this.__cardManager=i.cardManager,this.__loginManager=i.loginManager,this.__showErrorView=!!i.showErrorView,this.__ignoreClicks=void 0!==i.ignoreClicks?!!i.ignoreClicks:!this.__loginManager.isLoggedIn(),this.__isLoggedIn=this.__loginManager.isLoggedIn(),this.__ignoreClicks&&this.$el.addClass("ignore-clicks"),this.__shouldRemoveTruncate=IMVU.optionalProperty(i,"shouldRemoveTruncate",!1),this.__shouldWrap=IMVU.optionalProperty(i,"shouldWrap",!1),this.__hoverOn=IMVU.optionalProperty(i,"hoverOn",!1),this.__size=IMVU.optionalProperty(i,"size","small"),this.__color=IMVU.optionalProperty(i,"color","dark"),this.__display=IMVU.optionalProperty(i,"display",null),this.__width=IMVU.optionalProperty(i,"width",null),this.__shouldRemoveTruncate&&(this.__shouldWrap=!0),this.__shouldWrap&&(this.__shouldRemoveTruncate=!0),this.addToDOM(),this.$(".at-avatar-name-text").change(function(){var t=this.__stripGuest(this.$(".at-avatar-name-text").text());e.NextUtil.string.startsWith(t,"@")||this.$(".at-avatar-name-text").text("@".text)}.bind(this)),this.listenTo(this.__user,"change:username",e.NextUtil.mirrorModelChange(".at-avatar-name-text"))},assignSize:function(e){switch(void 0!==e&&(this.__size=e),this.$el.removeClass("an-s-tiny"),this.$el.removeClass("an-s-small"),this.$el.removeClass("an-s-medium"),this.$el.removeClass("an-s-large"),this.$el.removeClass("an-s-big"),this.__size){case"tiny":case"small":case"medium":case"large":case"big":this.$el.addClass("an-s-"+this.__size)}},assignColor:function(e){switch(void 0!==e&&(this.__color=e),this.$el.removeClass("an-fc-white"),this.$el.removeClass("an-fc-light-gray"),this.$el.removeClass("an-fc-dark-gray"),this.__color){case"light":this.$el.addClass("an-fc-white");break;case"medium":this.$el.addClass("an-fc-light-gray");break;case"dark":this.$el.addClass("an-fc-dark-gray")}},assignDisplay:function(e){switch(void 0!==e&&(this.__display=e),this.$el.removeClass("an-d-inline"),this.$el.removeClass("an-d-inline-block"),this.$el.removeClass("an-d-block"),this.$el.removeClass("an-d-flex"),this.$el.removeClass("an-d-hidden"),this.__display){case"inline":this.$el.addClass("an-d-inline");break;case"inline-block":this.$el.addClass("an-d-inline-block");break;case"block":this.$el.addClass("an-d-block");break;case"flex":this.$el.addClass("an-d-flex");break;case"hidden":this.$el.addClass("an-d-hidden")}},render:function(){this.$el.html(e.template),this.__user.populated().then(function(){var t=this.__stripGuest(this.__user.get("username"));this.$el.html(e.template({atAvatarName:t}))}.bind(this)).catch(function(){this.__showErrorView&&(this.__ignoreClicks=!0,this.$el.html("...").addClass("ignore-clicks"))}.bind(this)),this.__shouldRemoveTruncate&&this.$(".at-avatar-name-text").removeClass("is-truncated"),this.assignSize(),this.assignColor(),this.assignDisplay()},__onClickInner:function(e){this.__ignoreClicks||(this.__isLoggedIn?this.__featureAccessManager.canSeeProfileLightbox()?this.__dialogManager.showProfileLightbox(this.__user):this.__cardManager.showUserProfileCard({user:this.__user,context:"username",activeChat:this.__activeChat,openContext:this}):this.__modeManager.openMode({mode:{id:"profile"},submode:{id:this.__user.get("id")}}),e.stopPropagation())},__addHovering:function(){this.$el.addClass("hovering")},__removeHovering:function(){this.$el.removeClass("hovering")}})}({NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],template:u}),v=(e["@UiCore"],a).extend("MessageDrawerTimestamp",{className:"timestamp-widget message-drawer-timestamp system-info-drawer",uiContextName:"message_drawer_timestamp",render:function(){this.$el.text(this.__timestampHelper.messageDrawerDateTime())}}),f=(e["@UiCore"],a).extend("activityDetailTimestamp",{className:"timestamp-widget activity-detail-timestamp system-info-detail",uiContextName:"activity_detail_timestamp",render:function(){this.$el.text(this.__timestampHelper.activityCenterDetail())}}),y=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return'<div class="display-name-text is-truncated">'+(0,this.escapeExpression)("function"==typeof(n=t.displayName||e&&e.displayName)?n.call(e,{name:"displayName",hash:{},data:a}):n)+'</div><div class="display-name-badges"></div>'},useData:!0})}(),b=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="upgrade-products">\n    <div class="products"></div>\n</div>\n<footer class="dialog-footer"></footer>'},useData:!0})}(),C=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<button class="btn btn-primary buy-now" disabled>';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"CHECKOUT",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</button>"},useData:!0})}(),w=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="alert-message">\n';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"already_have_vip_subscription_text_before_link",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n<a href="https://help.imvu.com" target="_blank">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"already_have_vip_subscription_text_link",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</a>\n",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"already_have_vip_subscription_text_after_link",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"\n</div>"},useData:!0})}(),x=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='\n            <div class="order-row order-total-row">\n                <div class="order-row-name">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Total",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+" ("+o("function"==typeof(s=t.itemCount||e&&e.itemCount)?s.call(e,{name:"itemCount",hash:{},data:a}):s)+')</div>\n                <div class="order-row-amount">$<span class="order-total"></span></div>\n            </div>\n            '},3:function(e,t,i,a){var n;i=t.helperMissing;var s="\n        <div class=\"vip-block\">\n            <input id='vip-checkbox' class=\"vip checkbox\" tabindex='13' type=\"checkbox\"><label for='vip-checkbox'>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"I agree to the VIP",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</label> <a class="vip-terms-link vip-toc-link tooltip-target">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Terms and Conditions",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</a>\n            <div class="vip-toc-tooltip">\n                <div class="tooltip-header">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_dialog_title",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n                <div class="tooltip-body">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_dialog_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n            </div>\n        </div>\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='<div class="content-container">\n    <div class="error-block">\n        <ul>\n            <li class="error-message invalid-product">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_invalid_product",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</li>\n            <li class="error-message vip-checkbox-missing">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</li>\n        </ul>\n    </div>\n    <div class="padded-content-container">\n        <div class="order-block">\n            <legend class="system-info-header">\n                ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Cart",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='\n            </legend>\n            <div class="order-list-placeholder"></div>\n            ',((n=t.if.call(e,e&&e.showTotal,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(l+=n),l+="\n        </div>\n        ",((n=t.if.call(e,e&&e.hasVip,{name:"if",hash:{},fn:this.program(3,a),inverse:this.noop,data:a}))||0===n)&&(l+=n),l+='\n        <div class="payment-block">\n            <legend class="system-info-header">\n                ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Payment Method",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='\n            </legend>\n            <div class="savedcard-container"></div>\n            <div class="action-row add-credit-card"><div class="icon-payment-cc icon"></div> ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Check Out With New Credit Card",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+=' <div class="right-arrow"></div></div>\n            <div class="action-row paypal-checkout"><svg class="paypal-icon" width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><g fill="none"><path d="M3.15 18.146H1.227a.267.267 0 0 0-.264.227L.187 23.33a.16.16 0 0 0 .16.186h.916a.267.267 0 0 0 .264-.227l.21-1.338A.267.267 0 0 1 2 21.726h.608c1.265 0 1.996-.617 2.186-1.837.086-.536.004-.955-.245-1.25-.274-.322-.758-.493-1.4-.493zm.22 1.81c-.104.694-.63.694-1.14.694h-.29l.203-1.295a.16.16 0 0 1 .158-.136h.134c.347 0 .674 0 .844.198.1.12.13.295.093.54zm5.522-.022h-.92a.16.16 0 0 0-.16.136l-.04.26-.064-.095c-.2-.29-.643-.388-1.086-.388-1.017 0-1.885.775-2.054 1.86-.088.544.037 1.06.343 1.423.28.333.682.47 1.16.47.82 0 1.273-.53 1.273-.53l-.04.258a.16.16 0 0 0 .157.187h.828a.267.267 0 0 0 .264-.227l.497-3.168a.16.16 0 0 0-.158-.186zM7.61 21.736a1.027 1.027 0 0 1-1.04.883c-.266 0-.48-.087-.616-.25-.136-.162-.188-.393-.145-.65.082-.525.506-.89 1.03-.89.26 0 .474.086.614.25.14.167.195.4.155.656zm6.18-1.802h-.923a.267.267 0 0 0-.22.118l-1.276 1.89-.54-1.816a.268.268 0 0 0-.256-.192h-.91a.16.16 0 0 0-.15.213l1.018 3.007-.958 1.36a.16.16 0 0 0 .13.254h.924c.088 0 .17-.043.22-.116l3.074-4.465a.16.16 0 0 0-.13-.253z" fill="#253B80"/><path d="M16.852 18.146H14.93a.267.267 0 0 0-.263.227l-.777 4.956a.16.16 0 0 0 .158.185h.986c.09 0 .17-.067.184-.16l.22-1.404a.267.267 0 0 1 .264-.225h.608c1.266 0 1.996-.617 2.187-1.837.086-.535.003-.954-.246-1.248-.27-.323-.755-.494-1.4-.494zm.22 1.81c-.103.694-.63.694-1.14.694h-.29l.204-1.295a.16.16 0 0 1 .158-.136h.133c.347 0 .674 0 .843.198.1.12.132.295.093.54zm5.522-.022h-.92a.16.16 0 0 0-.157.136l-.04.26-.066-.095c-.198-.29-.642-.388-1.085-.388-1.017 0-1.885.775-2.054 1.86-.086.544.038 1.06.344 1.423.28.333.68.47 1.158.47.82 0 1.274-.53 1.274-.53l-.04.258a.16.16 0 0 0 .157.187h.83a.267.267 0 0 0 .262-.227l.498-3.168a.16.16 0 0 0-.16-.186zm-1.282 1.802a1.027 1.027 0 0 1-1.038.883c-.267 0-.48-.087-.618-.25-.136-.162-.187-.393-.144-.65.083-.525.507-.89 1.03-.89.262 0 .474.086.614.25.14.167.196.4.156.656zm2.366-3.454l-.788 5.047a.16.16 0 0 0 .158.185h.792a.267.267 0 0 0 .264-.227l.778-4.956a.16.16 0 0 0-.158-.186h-.888a.16.16 0 0 0-.158.136z" fill="#179BD7"/><path d="M10.47 15.845l.285-1.806-.633-.016H7.098L9.2.702a.172.172 0 0 1 .17-.146h5.1c1.69 0 2.86.353 3.47 1.048.285.326.467.667.555 1.042.092.393.094.863.004 1.437l-.008.04v.37l.286.16c.24.13.432.275.58.442.244.28.402.633.47 1.053.068.432.045.947-.068 1.53-.13.67-.342 1.25-.626 1.73-.262.44-.596.803-.992 1.085a4.024 4.024 0 0 1-1.336.603 6.662 6.662 0 0 1-1.67.193h-.396c-.284 0-.56.1-.776.284-.217.187-.36.443-.404.722l-.03.163-.502 3.18-.023.118c-.006.037-.016.055-.032.068a.084.084 0 0 1-.052.02h-2.45z" fill="#253B80"/><path d="M19.048 4.167a8.915 8.915 0 0 1-.052.3c-.673 3.45-2.973 4.643-5.91 4.643H11.59c-.36 0-.662.26-.718.615l-.765 4.857-.217 1.376a.383.383 0 0 0 .377.443h2.653a.638.638 0 0 0 .63-.537l.027-.135.5-3.17.03-.174a.638.638 0 0 1 .63-.54h.398c2.57 0 4.582-1.042 5.17-4.062.246-1.26.12-2.315-.53-3.055a2.536 2.536 0 0 0-.727-.56z" fill="#179BD7"/><path d="M18.345 3.886a5.303 5.303 0 0 0-.654-.145 8.307 8.307 0 0 0-1.318-.095h-3.995a.634.634 0 0 0-.63.54l-.85 5.383-.025.157a.726.726 0 0 1 .718-.615h1.496c2.937 0 5.237-1.193 5.91-4.644.02-.102.037-.202.052-.3a3.584 3.584 0 0 0-.703-.28z" fill="#222D65"/><path d="M11.747 4.184a.635.635 0 0 1 .63-.538h3.995c.474 0 .916.03 1.32.096a5.303 5.303 0 0 1 .804.192c.198.065.382.143.552.233.2-1.276 0-2.144-.69-2.93C17.596.37 16.223 0 14.468 0H9.37a.73.73 0 0 0-.72.616l-2.123 13.46a.438.438 0 0 0 .432.506h3.147l.79-5.014.85-5.384z" fill="#253B80"/></g></svg> ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Check Out With PayPal",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+=' <div class="right-arrow"></div></div>\n            <div class="info-row">\n                ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"original_store_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+=' <br><a class="core-store-link" href="/store/index/?platform='+o("function"==typeof(s=t.platformId||e&&e.platformId)?s.call(e,{name:"platformId",hash:{},data:a}):s)+'" target="_blank">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"original_store_link_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</a>\n            </div>\n        </div>\n    </div>\n</div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BUY",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+=' <span class="item-count"></span> ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ITEM FOR",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+' $<span class="order-total"></span></button>\n<\/script>\n'},useData:!0})}(),M=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n,s;i=this.escapeExpression;var o='\n    <div class="order-row">\n        <div class="order-item">\n            ';return((n=t.if.call(e,e&&e.image,{name:"if",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+'\n            <div class="item-info">\n                <div class="item-name">'+i("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:a}):s)+'</div>\n                <div class="product-price">$'+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:a}):s)+"</div>\n            </div>\n        </div>\n    </div>\n"},2:function(e,t,i,a){var n;return'\n            <div class="image-container"><img src="'+(0,this.escapeExpression)("function"==typeof(n=t.image||e&&e.image)?n.call(e,{name:"image",hash:{},data:a}):n)+'"></div>\n            '},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return(n=t.each.call(e,e&&e.cart,{name:"each",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n?n:""},useData:!0})}(),k=function(e){var t=e.UiCore.UiContext;return t.extend("OrderList",{className:"order-list",uiContextName:"orderlist",initialize:function(e){t.prototype.initialize.call(this,e),this.__cart=IMVU.requireProperty(e,"cart"),this.addToDOM()},render:function(){_.each(this.__cart,function(e){e.price=parseFloat(e.price).toFixed(2),e.image&&-1===e.image.indexOf("/")&&(e.image="/common/withme/img/store/"+e.image)}),this.$el.html(e.template({cart:this.__cart}))}})}({UiCore:e["@UiCore"],template:M}),I=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="dropdown-label is-truncated"><span>&nbsp;</span></div>\n<div class="dropdown-option-list-container">\n    <div class="dropdown-scroll-up"></div>\n    <div class="dropdown-scroll-down"></div>\n    <ul class="dropdown-option-list">\n        <li class="dropdown-option is-truncated" data-value="" tabindex="-1"></li>\n    </ul>\n</div>\n'},useData:!0})}(),T=function(e){function t(e){e=$(e.target).closest(".dropdown"),$(".dropdown").not(e).each(function(e,t){$(t).data("dropdown-instance").__hide()})}var i=e.UiCore.UiContext,a=e.NextUtil.Keys;return i.extend("Dropdown",{globalSetup:function(){document.addEventListener("click",t,!0),document.addEventListener("touchend",t,!0)},globalTearDown:function(){document.removeEventListener("click",t,!0),document.removeEventListener("touchend",t,!0)},uiContextName:"dropdown",className:"dropdown disable-text-selection",ITEM_HEIGHT:40,AUTO_SCROLL_BY:2,dependencies:["window","timer"],trackedEvents:function(){return[{type:"click",selector:".dropdown-label",name:"dropdown_label_click",handler:"toggleOpen"},{type:"click",selector:".dropdown-option",name:"dropdown_option_click",handler:"clickOption"},{type:"keydown",selector:"",name:"dropdown_keydown",handler:this.__onKeydown.bind(this,[])},{type:"mousemove",selector:".dropdown-option",name:"dropdown_option_mouseenter",handler:this.__onMousemove.bind(this,{x:0,y:0})},{type:"mouseenter",selector:".dropdown-label",name:"dropdown_label_mouseenter",handler:"__onMouseenterLabel"},{type:"mouseenter",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseenter",handler:"__onScrollUpMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseleave",handler:"__onScrollUpMouseleave"},{type:"mouseenter",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseenter",handler:"__onScrollDownMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseleave",handler:"__onScrollDownMouseleave"}]},__onMousemove:function(e,t){e.x==t.screenX&&e.y==t.screenY||(e.x=t.screenX,e.y=t.screenY,this.$el.focus(),this.setActiveElement($(t.target)))},__onBlur:function(e){this.$el.removeClass("is-open")},__onMouseenterLabel:function(e){this.$(".is-selected").removeClass("is-selected")},initialize:function(e){if(this.$select=IMVU.requireProperty(e,"$replaceElement"),!this.$select.is("select"))throw Error("$replaceElement must be a <select> element. got: "+this.$select[0].tagName);if(this.$select.closest("label").length)throw Error("do not wrap custom dropdowns with <label> tags; it disrupts event handling");i.prototype.initialize.call(this,e),this.window=e.window,this.timer=e.timer,this.boundingBox=e.boundingBox||this.getDefaultBoundingBox(),this.document=e.document||document,this.__keyArray=[],(this.dismissOnScroll=e.dismissOnScroll)&&$(e.dismissOnScroll).on("scroll.dropdown",function(){this.__hide()}.bind(this)),$(".dropdown-layer").length||$("body").append('<div class="dropdown-layer"/>'),this.$dropdownLayer=$(".dropdown-layer"),e.dimNoValue&&this.$el.addClass("dim-no-value"),this.$el.data("dropdown-instance",this),this.addToDOM()},delete:function(){this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray),this.dismissOnScroll&&$(this.dismissOnScroll).off("scroll.dropdown"),$(this.window).off("resize.dropdown"),i.prototype.delete.call(this)},__onHidden:function(){this.$el.is(":visible")&&this.remove(),i.prototype.__onHidden.apply(this,arguments)},getDefaultBoundingBox:function(){var e=this.$el.position().top-5*this.ITEM_HEIGHT,t=e+11*this.ITEM_HEIGHT;return 0>e&&(e=0),t>$(this.window).height()&&(t=$(this.window).height()),{x:0,y:e,w:$(this.window).width(),h:t-e}},render:function(){this.$placeholder=$("<div/>"),this.$el.html(e.template),this.$label=this.$(".dropdown-label"),this.$optionList=this.$(".dropdown-option-list"),this.$optionListContainer=this.$(".dropdown-option-list-container");var t=this.$optionList.find(".dropdown-option");this.$select.addClass("is-enhanced"),this.refreshLabel(this.$select.find(":selected")),t.remove(),this.$select.children().each(function(e,i){var a=t.clone(!0);a.text($(i).text()),a.attr("data-text",$(i).text().toLowerCase()),a.attr("data-value",$(i).val()),this.$optionList.append(a)}.bind(this)),this.$el.addClass(this.$select[0].className).removeClass("dropdown-template").addClass("dropdown"),this.$label.append(this.$select),this.$el.attr("tabindex",this.$select.attr("tabindex")||"0"),this.$select.attr("tabindex",-1),this.$optionList.on("scroll",this.__onScroll.bind(this)),this.$select.on("change",this.__changedOption.bind(this)),this.$el.addClass("is-ready")},__fullHeight:function(){return this.$select.children().length*this.ITEM_HEIGHT},__getSelectedIndex:function(){return this.$select[0].selectedIndex},__getTopEdgeInViewport:function(e){return e.offset().top-$(this.document).scrollTop()},__getComputedInfo:function(){var e=this.__getTopEdgeInViewport(this.$el),t=this.__fullHeight(),i=this.__getSelectedIndex()*this.ITEM_HEIGHT,a=this.getDefaultBoundingBox().y,n=this.getDefaultBoundingBox().y+this.getDefaultBoundingBox().h,s=e-i,o=s+t,l=0;return s<a&&(s=a),o>n&&(l=o-n,o=n,s>a&&(s-=Math.min(s-a,l))),{projectedTopDiff:s-e,computedHeight:o-s,selectedTop:i,maxTop:a,maxBottom:n,fullHeight:t}},__refreshScrollers:function(){var e=this.$optionList[0].scrollHeight-this.$optionList.innerHeight(),t=0<this.$optionList.scrollTop();e=Math.round(this.$optionList.scrollTop())<e;this.$el.toggleClass("can-scroll-up",t).toggleClass("can-scroll-down",e)},isOpen:function(){return this.$el.hasClass("is-open")},__hide:function(){this.isOpen()&&($(this.window).off("resize.dropdown"),this.$el.removeClass("is-open"),this.$placeholder.before(this.$el).detach(),this.$el.removeAttr("style"))},__show:function(){if(!this.isOpen()){$(this.window).on("resize.dropdown",t);var e=this.$el.offset(),i=this.$el.width(),a=this.$el.height(),n=this.$el.css("margin-left"),s=this.$el.css("margin-right"),o=this.$el.css("margin-top"),l=this.$el.css("margin-bottom"),r=this.$el.css("float");this.$placeholder.css({width:i,height:a,"margin-left":n,"margin-right":s,"margin-top":o,"margin-bottom":l,float:r}),this.$el.addClass("is-open").css({top:this.__getTopEdgeInViewport(this.$el),left:e.left,width:i,height:a,"margin-left":0,"margin-right":0,"margin-top":0,"margin-bottom":0}),this.$el=this.$el.before(this.$placeholder).detach(),this.$dropdownLayer.append(this.$el)}},toggleOpen:function(e){return this.isOpen()?this.__hide():(this.__show(),e=this.__getComputedInfo(),this.$optionListContainer.css({top:e.projectedTopDiff,height:e.computedHeight}),this.$el.focus(),e=e.selectedTop+e.projectedTopDiff,this.$optionList.scrollTop(e),this.__lastScrollTop=e,this.setActiveElement(this.$(".dropdown-option").eq(this.__getSelectedIndex())),this.__refreshScrollers()),!1},refreshLabel:function(e){this.$label.find("> span").text(e.text()).toggleClass("no-value",""===e.val())},clickOption:function(e){this.__hide(),this.$select.val($(e.target).attr("data-value")),this.$select.trigger("change"),t(e)},selectByValue:function(e){this.$(".is-selected").removeClass("is-selected"),this.$('.dropdown-option[data-value="'+e+'"]').addClass("is-selected"),this.$("select").val(e),e=this.$("select").find(":selected"),this.refreshLabel(e)},val:function(){return this.$("select").val()},__changedOption:function(e){e=$(e.target).find(":selected"),this.refreshLabel(e)},__maybeScrollOptionIntoView:function(e,t){if(e[0]){var i=this.$el.hasClass("can-scroll-up"),a=this.$el.hasClass("can-scroll-down"),n=this.$optionList,s=n.height(),o=n.offset().top,l=o+s,r=e.outerHeight(),d=e.offset().top,h=d+r,c=d-o+n.scrollTop(),_=s/2-r/2*3;d<o+(i?r:0)?(t&&(c-=_),n.scrollTop(c-(i?this.ITEM_HEIGHT:0))):h>l-(a?r:0)&&(t&&(c+=_),n.scrollTop(c-(s-r)+(a?r:0)))}},__open:function(t){return this.isOpen()&&this.$select.val(this.$optionList.find(".is-selected").attr("data-value")).change(),this.toggleOpen(t),t=this.$optionList.children().eq(this.$select[0].selectedIndex),e.NextUtil.DomHelper.radioClass(t,"is-selected"),t},__moveSelection:function(t){return 0>(t=this.$optionList.children().index(this.$optionList.find(".is-selected"))+t)?t=0:t>this.$select.children().length-1&&(t=this.$select.children().length-1),t=this.$optionList.children().eq(t),e.NextUtil.DomHelper.radioClass(t,"is-selected"),t},setActiveElement:function(t){this.__activeElement=t,e.NextUtil.DomHelper.radioClass(t,"is-selected")},__onKeydown:function(i,n){if(!this.isOpen()&&a.is(n,"VK_ENTER")||!this.isOpen()&&a.is(n,"VK_DOWN"))t(this.$el),this.__open(n);else{var s=this.__activeElement&&this.__activeElement.parent()[0]===this.$optionList[0]?this.__activeElement:this.$(".dropdown-option").first();if(a.is(n,"VK_DOWN"))this.__maybeScrollOptionIntoView(s.next()),s.next()[0]&&this.setActiveElement(s.next());else if(a.is(n,"VK_UP"))this.__maybeScrollOptionIntoView(s.prev()),s.prev()[0]&&this.setActiveElement(s.prev());else if(a.is(n,"VK_ENTER"))this.__hide(),this.$select.val(this.__activeElement.attr("data-value")),this.$select.trigger("change"),t(n);else if(a.is(n,"VK_ESC"))t(this.$el);else{var o=a.getAlphaNumericChar(n);if(!1!==o){var l=s[0];this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray),i.push(o);var r=i.join("").toLowerCase();for(this.__keyValueArray=this.timer.setTimeout(function(){i.length=0}.bind(this),1e3);l.nextSibling;)if(l=l.nextSibling,(o=$(l)).attr("data-text")[0]&&e.NextUtil.string.startsWith(o.attr("data-text"),r))return this.isOpen()||this.toggleOpen(n),this.setActiveElement(o),void this.__maybeScrollOptionIntoView(o,o[0]!=s[0].nextSibling&&o[0]!=s[0].prevSibling);for(l=this.$(".dropdown-option")[0];l&&l!=s[0];){if((o=$(l)).attr("data-text")[0]&&e.NextUtil.string.startsWith(o.attr("data-text"),r)){this.isOpen()||this.toggleOpen(n),this.setActiveElement(o),this.__maybeScrollOptionIntoView(o,o[0]!=s[0].nextSibling&&o[0]!=s[0].prevSibling);break}l=l.nextSibling}}}}},__onScroll:function(e){e=this.$optionList.scrollTop(),this.__refreshScrollers(),this.__lastScrollTop=e},__doScrollUp:function(e,t){var i=this.__getComputedInfo(),a=void 0===t?this.AUTO_SCROLL_BY:t;if(this.$optionListContainer.offset().top+this.$optionListContainer.height()+a<i.maxBottom){var n=this.$optionListContainer.height()+a;n>i.fullHeight&&(n=i.fullHeight),this.$optionListContainer.css({height:n}),this.$optionList[0].scrollTop-=a,this.__refreshScrollers(this.$dropdown)}else void 0===t&&(this.$optionList[0].scrollTop-=this.AUTO_SCROLL_BY)},__onScrollUpMouseenter:function(e){this.timer.clearInterval(this.__autoScrollInterval),this.__autoScrollIntervalCounter=0,this.__autoScrollInterval=this.timer.setInterval(function(){this.__doScrollUp(e)}.bind(this),1)},__onScrollUpMouseleave:function(e){this.timer.clearInterval(this.__autoScrollInterval)},__doScrollDown:function(e,t){var i=this.__getComputedInfo(),a=void 0===t?this.AUTO_SCROLL_BY:t;if((s=this.$optionListContainer.offset().top-a)>i.maxTop){var n=this.$optionListContainer.height()+a,s=this.$optionListContainer.position().top-a;n>i.fullHeight?n=i.fullHeight:this.$optionListContainer.css({top:s}),this.$optionListContainer.css({height:n}),this.$optionList[0].scrollTop+=a,this.__refreshScrollers(this.$dropdown)}else void 0===t&&(this.$optionList[0].scrollTop+=this.AUTO_SCROLL_BY)},__onScrollDownMouseenter:function(e){this.timer.clearInterval(this.__autoScrollDownInterval),this.__autoScrollDownIntervalCounter=0,this.__autoScrollDownInterval=this.timer.setInterval(function(){this.__doScrollDown(e)}.bind(this),1)},__onScrollDownMouseleave:function(e){this.timer.clearInterval(this.__autoScrollDownInterval)}})}({UiCore:e["@UiCore"],template:I,NextUtil:e["@NextUtil"]}),P=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e){var t=this.escapeExpression;return'\n                        <option value="'+t("function"==typeof e?e.apply(e):e)+'">'+t("function"==typeof e?e.apply(e):e)+"</option>\n                        "},3:function(){return' checked="checked" '},5:function(e,t,i,a){var n;return'\n                    <option value="'+(t=this.escapeExpression)("function"==typeof(n=null==a||!1===a?a:a.key)?n.apply(e):n)+'">'+t("function"==typeof e?e.apply(e):e)+"</option>\n                    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="content-container">\n    <div class="error-block">\n        <ul>\n            <li class="error-message field-missing">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_field_missing",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message cardnumber-invalid">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_card_number_invalid",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message exp-date-expired">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_exp_date_expired",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message security-code-invalid">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_security_code_invalid",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message zip-invalid">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_zip_invalid",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message postal-invalid">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_postal_invalid",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message vip-checkbox-missing">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n            <li class="error-message cardname-invalid">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"error_invalid_cc_name",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</li>\n        </ul>\n    </div>\n    <div class="payment-block">\n        <legend class="system-info-header">\n            ',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Payment Method",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n        </legend>\n\n        <div class="input-row card-number-container">\n            <div class="input-label">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Credit Card Number",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n            <input class=\'cardnumber\' tabindex=\'1\' required maxlength=\'20\' placeholder=\'XXXX-XXXX-XXXX-XXXX\'> \n            <div class="cardimages-container">\n                <div class="cardimage mastercard icon icon-cc-mastercard"></div> \n                <div class="cardimage visa icon icon-cc-visa"></div> \n                <div class="cardimage americanexpress icon icon-cc-amex"></div> \n                <div class="cardimage discover icon icon-cc-discover"></div> \n                <div class="cardimage jcb icon icon-cc-jcb"></div>\n            </div>\n        </div>\n        <div class="input-row">\n            <div class="half-row">\n                <div class="exp-date input-container">\n                    <div class="input-label">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Expiration",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</div>\n                    <div class='exp-date-container input-container'>\n                        <select class='exp-month' tabindex='2' required >\n                        <option selected value=\"\">",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Month",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</option>\n                        ",((n=t.each.call(e,e&&e.monthRange,{name:"each",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+="\n                        </select>\n                    </div>\n                    <div class='exp-date-container input-container'>\n                        <select class='exp-year' tabindex='3' required >\n                        <option selected value=\"\">",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Year",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</option>\n                        ",((n=t.each.call(e,e&&e.yearRange,{name:"each",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+="\n                        </select>\n                    </div>\n                </div>\n            </div>\n            <div class='input-container'>\n                <div class=\"input-label\">",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Security",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n                <div class="security-code-row">\n                    <input class=\'security-code\' tabindex=\'4\' required maxlength=\'4\' placeholder="CSC">\n                    <div class="icon icon-tooltip-icon security-code-help-link"></div>\n                    <div class="security-code-tooltip">\n                        <div class="tooltip-header">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"security_code_help_title",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n                        <div class="tooltip-body">\n                            <div class="icon icon-payment-csc"></div>\n                            <div>',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"security_code_help_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="input-row">\n            <input id=\'save-for-later-checkbox\' class="save-for-later checkbox" tabindex=\'13\' type="checkbox" \n            ',((n=t.if.call(e,e&&e.saveCard,{name:"if",hash:{},fn:this.program(3,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+=" ><label for='save-for-later-checkbox'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Save For Later",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</label>\n        </div>\n    </div>\n    <div class="billing-address-block">\n        <legend class="system-info-header">\n            ',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Billing Information",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="\n        </legend>\n        <div class=\"input-row\">\n            <input class='name-on-card' maxlength='50' tabindex='5' required placeholder='",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Name on Card",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='address' maxlength='50' tabindex='6' required placeholder='",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Address",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='city' maxlength='20' tabindex='7' required placeholder='",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"City",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="'>\n            <div class='us-fields state-province-container input-container'>\n                <select class='state' tabindex='8' >\n                    <option selected value=\"\">",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"State",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</option>\n                    ",((n=t.each.call(e,e&&e.states,{name:"each",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+="\n                </select>\n            </div>\n            <div class='non-us-fields ca-province state-province-container input-container'>\n                <select class='province' tabindex='10'>\n                    <option selected value=\"\">",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Province",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</option>\n                    ",((n=t.each.call(e,e&&e.provinces,{name:"each",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+="\n                </select>\n            </div>\n            <input class='us-fields zip' maxlength='5' tabindex='9' placeholder='",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Zipcode",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="'>\n            <input class='non-us-fields postal' maxlength='12' tabindex='11' placeholder='",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Postal Code",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="'>\n            <div class='country-container input-container us'>\n                <select class='country' tabindex='12' required>\n                    <option value=''>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Country",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</option>\n                    ",((n=t.each.call(e,e&&e.countries,{name:"each",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+='\n                </select>\n            </div>\n        </div>\n    </div>\n</div>    \n\n<footer class="dialog-footer">\n    <button class="btn btn-primary continue-checkout">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Continue to Checkout",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</button>\n</footer>\n"},useData:!0})}(),S=function(e){var t=[{name:"americanexpress",pattern:/^3[47]/},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/},{name:"visa",pattern:/^4/},{name:"mastercard",pattern:/^5[1-5]/},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/}];return{getType:function(e){for(var i=0;i<t.length;i++){var a=t[i];if(e.match(a.pattern))return a.name}return null},passesChecksum:function(e){for(var t=0,i=!1,a=e.length-1;0<=a;a--){var n=e.charAt(a);n=parseInt(n,10);i&&(9<(n*=2)&&(n-=9)),t+=n,i=!i}return 0==t%10}}}(),E=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="back-button"></div>'},useData:!0})}(),U=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="content-container">\n    <div class="content-container-content">\n        <legend class="system-info-header">\n            ';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Payment Method",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n        </legend>\n        <div class="info-block">\n            <div class="billing-info"></div>\n        </div>\n        <legend class="system-info-header">\n            ',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Cart",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n        </legend>\n        <div class="order-block">\n            <div class="order-list"></div>\n        </div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BUY",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+=' <span class="item-count"></span> ',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ITEM FOR",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+' $<span class="order-total"></span></button>\n<\/script>'},useData:!0})}(),D=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n,s,o='\n<div class="info-line address">'+(i=this.escapeExpression)("function"==typeof(s=t.address||e&&e.address)?s.call(e,{name:"address",hash:{},data:a}):s)+'</div>\n<div class="info-line">'+i("function"==typeof(s=t.city||e&&e.city)?s.call(e,{name:"city",hash:{},data:a}):s)+", ";return((n=t.if.call(e,e&&e.state,{name:"if",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+=" ",((n=t.if.call(e,e&&e.postal_code,{name:"if",hash:{},fn:this.program(4,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+i("function"==typeof(s=t.country||e&&e.country)?s.call(e,{name:"country",hash:{},data:a}):s)+"</div>\n"},2:function(e,t,i,a){var n;return" "+(0,this.escapeExpression)("function"==typeof(n=t.state||e&&e.state)?n.call(e,{name:"state",hash:{},data:a}):n)+" "},4:function(e,t,i,a){var n;return" "+(0,this.escapeExpression)("function"==typeof(n=t.postal_code||e&&e.postal_code)?n.call(e,{name:"postal_code",hash:{},data:a}):n)+", "},6:function(e,t,i,a){var n,s;i=this.escapeExpression;var o=t.helperMissing,l='\n<div class="info-line card-type">'+i("function"==typeof(s=t.card_type||e&&e.card_type)?s.call(e,{name:"card_type",hash:{},data:a}):s)+" ";return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"ending in",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+" -"+i("function"==typeof(s=t.last_four_digits||e&&e.last_four_digits)?s.call(e,{name:"last_four_digits",hash:{},data:a}):s)+"</div>\n"},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;return i='<div class="info-line name-on-card">'+(i=this.escapeExpression)("function"==typeof(s=t.name||e&&e.name)?s.call(e,{name:"name",hash:{},data:a}):s)+"</div>\n",((n=t.if.call(e,e&&e.address,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n",((n=t.if.call(e,e&&e.last_four_digits,{name:"if",hash:{},fn:this.program(6,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i},useData:!0})}(),A=function(e){var t=e.UiCore.UiContext;return t.extend("BillingInfo",{className:"billing-info",uiContextName:"billing_info",dependencies:["globalStringManager"],initialize:function(i){t.prototype.initialize.call(this,i),this.__billingInfo=IMVU.requireProperty(i,"billingInfo"),this.__CCValidator=e.CCValidator,this.addToDOM()},render:function(){var t="",i="";this.__billingInfo.credit_card&&(t=this.__CCValidator.getType(this.__billingInfo.credit_card),i=this.__billingInfo.credit_card.substring(this.__billingInfo.credit_card.length-4)),this.$el.html(e.template({name:this.__billingInfo.name,address:this.__billingInfo.address,city:this.__billingInfo.city,state:this.__billingInfo.state,postal_code:this.__billingInfo.postal_code,country:this.__billingInfo.country,card_type:this.__globalStringManager.get("card_type_"+(t||"other")),last_four_digits:i}))}})}({UiCore:e["@UiCore"],template:D,CCValidator:S}),N=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s="<div class='alert-message'>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_pending_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+=" <a target='_blank' href='/next/settings/order'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_pending_link_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</a>.</div>\n<div class='alert-message'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_pending_after_link_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n"},useData:!0})}(),V=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s="<div class='alert-message'>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_unknown_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+=" <a target='_blank' href='/next/settings/order'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_unknown_link_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</a>.</div>\n<div class='alert-message'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_unknown_after_link_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n"},useData:!0})}(),O=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='<div class="content-container">\n    <div class="info-block message">\n        <div class="title">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"order_thankyou",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</div>\n        <div class="text">'+o("function"==typeof(s=t.status_message||e&&e.status_message)?s.call(e,{name:"status_message",hash:{},data:a}):s)+'</div>\n    </div>\n    <legend class="system-info-header">\n        ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BILLED TO",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='\n    </legend>\n    <div class="info-block">\n        <div class="billing-info"></div>\n    </div>\n    <legend class="system-info-header">\n        ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"YOUR ORDER",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='\n    </legend>\n    <div class="order-block">\n        <div class="order-list"></div>\n    </div>\n    <div class="info-block">\n        <div>',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Order",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+=" #"+o("function"==typeof(s=t.order_id||e&&e.order_id)?s.call(e,{name:"order_id",hash:{},data:a}):s)+"</div>\n        <div>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Purchase date",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+=": "+o("function"==typeof(s=t.order_date||e&&e.order_date)?s.call(e,{name:"order_date",hash:{},data:a}):s)+'</div>\n        <div class="order-total">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"TOTAL",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+" $"+o("function"==typeof(s=t.order_total||e&&e.order_total)?s.call(e,{name:"order_total",hash:{},data:a}):s)+"</div>\n    </div>\n</div>"},useData:!0})}(),L=function(e){var t=e.Dialogs.AlloyAlertDialog;return t.extend("PaymentSuccessDialog",{uiContextName:"payment_success_dialog",className:"payment-success-dialog dialog-type-B",dependencies:"billingInfo globalStringManager loginManager orderResponse originalCart timestampHelper".split(" "),__recordShown:!0,initialize:function(i){this.__stringManager=i.globalStringManager,this.__billingInfo=i.billingInfo,this.__orderResponse=i.orderResponse,this.__originalCart=i.originalCart,i.title=this.__stringManager.get("payment_success_title"),i.ok=this.__stringManager.get("payment_success_button"),this.__CCValidator=e.CCValidator,t.prototype.initialize.call(this,i),this.$el.removeClass("can-dismiss"),this.__loginManager.getCurrentUser().invalidate()},postRender:function(){t.prototype.postRender.call(this),this.__orderResponse.populated().then(function(){this.__cart=this.__filterCart();var t=this.__timestampHelper.orderDate(this.__orderResponse.get("order_date"));this.$(".id-body-contents").html(e.template({order_date:t,order_id:this.__orderResponse.get("order_id"),order_total:this.__orderTotal.toFixed(2),status_message:this.__stringManager.get("order_status_message",{product:this.__getProduct()})})),this.createChildContext(e.BillingInfo,{$replaceElement:this.$(".billing-info"),billingInfo:this.__billingInfo}),this.createChildContext(e.OrderList,{$replaceElement:this.$(".order-list"),cart:this.__originalCart}),this.$(".content-container").scrollbar()}.bind(this))},__filterCart:function(){var e=[];return this.__orderTotal=0,_.each(this.__originalCart,function(t){var i={};i.price=t.price,i.name=t.name,e.push(i),this.__orderTotal+=parseFloat(i.price)}.bind(this)),e},__getProduct:function(){var e=!1,t=!1;return _.each(this.__orderResponse.get("cart"),function(i){-1<i.product_name.toLowerCase().indexOf("credit")&&(t=!0),-1<i.product_name.toLowerCase().indexOf("vip")&&(e=!0)}.bind(this)),e&&t?this.__stringManager.get("Credits")+this.__stringManager.get("and")+this.__stringManager.get("VIP"):e&&!t?this.__stringManager.get("VIP"):!e&&t?this.__stringManager.get("Credits"):void 0}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:O,CCValidator:S,OrderList:k,BillingInfo:A}),z=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s="<div class='alert-message'>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_processing_error_text_1",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</div>\n<div class='alert-message'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_processing_error_text_2",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</div>\n<div class='alert-message'>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"payment_processing_error_text_3",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+" <a target='_blank' href='https://help.imvu.com'>www.imvu.com/help</a>.</div>\n"},useData:!0})}(),F=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PaymentBaseDialog",{uiContextName:"payment_base_dialog",className:"payment-base-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager leanplum loginManager prefsManager restModelFactory window".split(" "),initialize:function(e){t.prototype.initialize.call(this,e),this.__context=IMVU.optionalProperty(e,"context",null),this.__orderPostUrl=this.__globalStartupModel.get("accountOrdersUrl"),this.__loginManager.isLoggedIn()||(this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot),this.__orderSuccess=!1},delete:function(){this.__closePaypalWindow(),this.promiseResolver&&this.promiseResolver.resolve(this.__orderSuccess),t.prototype.delete.call(this)},__destroy:function(){this.hide(),this.delete()},__filterCart:function(){var e=[];return _.each(this.__cart,function(t){var i={};i.price=t.price,i.sku=t.sku,i.pid=t.pid,i.type=t.type,e.push(i)}.bind(this)),e},__setProcessing:function(e){this.$(".buy-now").prop("disabled",e),this.$(".add-credit-card").prop("disabled",e),this.$(".paypal-checkout").prop("disabled",e),this.$el.toggleClass("loading",e),this.$(".payment-input").prop("disabled",e),this.$(".dialog-x").prop("disabled",e)},__openPaypalWindow:function(){this.__closePaypalWindow(),this.__paypalWindow=this.__window.open("/paypal/loading/","_blank")},__closePaypalWindow:function(){this.__paypalWindow&&(this.__paypalWindow.close(),this.__paypalWindow=null)},__displayPaypalOrderUpdate:function(){if(this.stopListening(this.__paypalOrderResponse),this.__closePaypalWindow(),!this.__orderStatus)switch(this.__orderStatus=this.__paypalOrderResponse.get("status"),this.__orderStatus){case"attempted":case"abandoned":break;case"external review":case"review":this.__displayPendingOrderDialog();break;case"validating":case"waiting for payment":case"being delivered":case"approved":case"paid":case"delivered":this.__displayPaypalSuccessDialog();break;case"rejected":case"failed cc check":case"blocked":this.__displayProcessingErrorDialog();break;default:this.__displayUnknownOrderDialog()}},__submitOrder:function(t){this.__restModelFactory.createModel(this.__orderPostUrl,e.UiCore.NodeModel,t).then(function(e){this.__setProcessing(!1),t.paypal_payment?"review"!==e.get("status")&&e.get("paypal_url")?this.__paypalWindow&&!this.__paypalWindow.closed&&(this.__paypalOrderResponse=e,this.__paypalWindow.location.href="https://www.paypal.com/cgi-bin/webscr?cmd=_express-checkout&useraction=commit&token="+e.get("paypal_url"),this.listenTo(this.__paypalOrderResponse,"change",this.__displayPaypalOrderUpdate)):(this.__leanplum.recordEvent("payment_error",{error:"paypal_error",type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__displayProcessingErrorDialog(),this.__closePaypalWindow()):(this.__displayPaymentSuccessDialog(t,e),t.cc_payment&&this.__prefsManager.populated().then(function(){var e=this.__prefsManager.getBool("next.payment.creditcard.save_card.disable"),i=!t.cc_payment.save_card;i!==e&&this.__prefsManager.setBool("next.payment.creditcard.save_card.disable",i)}.bind(this)))}.bind(this)).catch(function(e){switch(this.__setProcessing(!1),this.__closePaypalWindow(),e.error&&"Not authorized for request"===e.error.message&&(this.__leanplum.recordEvent("payment_error",{error:"not authorized",type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot),this.__errorType="Unknown",e.error&&e.error.error&&(this.__errorType=e.error.error,this.__errorMessage=e.error.message),this.__leanplum.recordEvent("payment_error",{error:this.__errorType,type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__errorType){case"ACCOUNT_ORDER_PENDING":t.paypal_payment?this.__displayProcessingErrorDialog():this.__displayPendingOrderDialog();break;case"ACCOUNT_ORDER_PRICE_DISCREPANCY":case"ACCOUNT_ORDER_INVALID_STORE_PRODUCT":case"ACCOUNT_ORDER_EMPTY_CART":this.__displayInvalidPriceDialog();break;case"ACCOUNT_ORDER_FAILURE":case"ACCOUNT_ORDER_INVALID_COUNTRY_CODE":case"INBOUND VALIDATION-001":case"ACCOUNT_ORDER_INVALID_CARD_NUMBER":this.__displayFailedOrderDialog();break;case"ACCOUNT_ORDER_BLOCKED":case"ACCOUNT_ORDER_PAYPAL_SUBMIT_PAYMENT":case"ACCOUNT_ORDER_PAYPAL_PAYMENT_INFO":this.__displayProcessingErrorDialog();break;default:this.__displayUnknownOrderDialog()}}.bind(this))},__displayPaypalSuccessDialog:function(){this.__displayPaymentSuccessDialog({paypal_payment:!0},this.__paypalOrderResponse)},__displayPaymentSuccessDialog:function(t,i){var a;return this.__leanplum.recordEvent("payment_success",{type:t.cart[0].type,sku:t.cart[0].sku,price:t.cart[0].price,pid:t.cart[0].pid}),this.__orderSuccess=!0,t.cc_payment?a=t.cc_payment:t.paypal_payment?a={name:"Paypal"}:t.saved_cc_payment&&(a={card_type:this.__selectedCard.get("card_type"),name:this.__selectedCard.get("name"),last_four_digits:this.__selectedCard.get("card_last_digits")}),this.__dialogManager.showDialog(e.PaymentSuccessDialog,{billingInfo:a,orderResponse:i,originalCart:this.__cart}).finished.then(function(e){this.__checkForVerifiedEmailAndExit()}.bind(this)).catch(function(e){this.__checkForVerifiedEmailAndExit()}.bind(this))},__checkForVerifiedEmailAndExit:function(){this.__loginManager.getCurrentUser().populated().then(function(e){e.get("is_email_verified")?this.__destroy():this.__displayEmailVerificationDialog()}.bind(this))},__displayEmailVerificationDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("verify_email_dialog_title"),text:this.__globalStringManager.get("verify_email_dialog_text")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayInvalidPriceDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_invalid_price_title"),text:this.__globalStringManager.get("payment_invalid_price_text"),ok:this.__globalStringManager.get("payment_invalid_price_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayFailedOrderDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_failed_title"),text:this.__globalStringManager.get("payment_failed_text"),ok:this.__globalStringManager.get("payment_failed_button")}).finished},__displayUnknownOrderDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_unknown_title"),html:e.UnknownOrderDialog({}),ok:this.__globalStringManager.get("payment_unknown_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayProcessingErrorDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_processing_error_title"),html:e.ProcessingErrorDialog({}),ok:this.__globalStringManager.get("payment_processing_error_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))},__displayPendingOrderDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_pending_title"),html:e.PendingOrderDialog({}),ok:this.__globalStringManager.get("payment_pending_button")}).finished.then(function(e){this.__destroy()}.bind(this)).catch(function(e){this.__destroy()}.bind(this))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],PaymentSuccessDialog:L,PendingOrderDialog:N,ProcessingErrorDialog:z,UnknownOrderDialog:V}),H=function(e){var t=e.PaymentBaseDialog;return t.extend("CreditCardPaymentReviewDialog",{uiContextName:"credit_card_payment_review_dialog",className:"credit-card-payment-review-dialog dialog-type-B",dependencies:"globalStartupModel globalStringManager dialogManager channel billingInfo cart orderTotal itemCount restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-now",name:"buy_now",handler:this.__creditCardCheckout},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(e){t.prototype.initialize.call(this,e),this.$el.removeClass("can-dismiss"),this.title=this.__globalStringManager.get("credit_card_review_title"),this.addToDOM()},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend(e.backButtonTemplate({})),this.setContent("body",e.template),this.setContent("footer",this.$(".dialog-footer-template").text()),this.createChildContext(e.BillingInfo,{$replaceElement:this.$(".billing-info"),billingInfo:this.__billingInfo}),this.createChildContext(e.OrderList,{$replaceElement:this.$(".order-list"),cart:this.__cart}),this.$(".order-total").text(this.__orderTotal.toFixed(2)),this.$(".item-count").text(this.__itemCount),this.$(".content-container").scrollbar()},__creditCardCheckout:function(){this.__setProcessing(!0);var e={cart:this.__filterCart(),channel:this.__channel,payment_method:"cc_payment",cc_payment:this.__billingInfo};this.__submitOrder(e)},__goBack:function(){this.hide(),this.promiseResolver.reject()}})}({UiCore:e["@UiCore"],PaymentBaseDialog:F,template:U,CCValidator:S,OrderList:k,BillingInfo:A,backButtonTemplate:E}),B=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s="<div class='alert-message'><img src='/catalog/web_images/veri_code.gif'></div>\n\n<div class='alert-message'>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"security_code_help_text",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</div>\n"},useData:!0})}(),R=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("AddCreditCardDialog",{uiContextName:"add_credit_card_dialog",className:"add-credit-card-dialog dialog-type-B",dependencies:"channel cart dialogManager featureAccessManager globalStringManager itemCount leanplum loginManager orderTotal prefsManager timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:".continue-checkout",name:"continue_checkout",handler:this.__continueCheckout},{type:"keyup",selector:".cardnumber",name:"changing_cardnumber",handler:this.__isBlankCardNumber},{type:"blur",selector:".cardnumber",name:"changed_cardnumber",handler:this.__validateCardNumber},{type:"change",selector:".exp-month",name:"change_exp_month_select",handler:this.__validateExpMonth},{type:"change",selector:".exp-year",name:"change_exp_year_select",handler:this.__validateExpYear},{type:"keyup",selector:".security-code",name:"changing_security_code",handler:this.__isBlankSecurityCode},{type:"blur",selector:".security-code",name:"changed_security_code",handler:this.__validateSecurityCode},{type:"keyup",selector:".name-on-card",name:"changing_name",handler:this.__isBlankNameOnCard},{type:"blur",selector:".name-on-card",name:"changed_name",handler:this.__validateNameOnCard},{type:"keyup",selector:".address",name:"changing_address",handler:this.__isBlankAddress},{type:"blur",selector:".address",name:"changed_address",handler:this.__validateAddress},{type:"keyup",selector:".city",name:"change_city",handler:this.__isBlankCity},{type:"blur",selector:".city",name:"change_city",handler:this.__validateCity},{type:"change",selector:".state",name:"change_state_select",handler:this.__validateState},{type:"keyup",selector:".zip",name:"changing_zip",handler:this.__isBlankZip},{type:"blur",selector:".zip",name:"changed_zip",handler:this.__validateZip},{type:"change",selector:".province",name:"change_province_select",handler:this.__validateProvince},{type:"keyup",selector:".postal",name:"changing_postal",handler:this.__isBlankPostal},{type:"blur",selector:".postal",name:"changed_postal",handler:this.__validatePostal},{type:"change",selector:".country",name:"change_country_select",handler:this.__validateCountry},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(i){t.prototype.initialize.call(this,i),this.shouldFocusOnPrimaryButton=!1,i.loginManager.isLoggedIn()||(this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot),this.title=this.__globalStringManager.get("Add New Credit Card"),this.__monthRange="01 02 03 04 05 06 07 08 09 10 11 12".split(" "),this.__getYearRange(),this.__states=e.StateMap,this.__provinces=e.ProvinceMap,this.__countries=e.CountryMap,this.__CCValidator=e.CCValidator,this.__missingFields=[],this.addToDOM()},delete:function(){t.prototype.delete.call(this),this.__tooltip&&this.__tooltip.delete()},__destroy:function(){this.hide(),this.delete()},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend(e.backButtonTemplate({})),this.__prefsManager.populated().then(function(){this.setContent("body",e.template,{monthRange:this.__monthRange,yearRange:this.__yearRange,states:this.__states,provinces:this.__provinces,countries:this.__countries,saveCard:!this.__prefsManager.getBool("next.payment.creditcard.save_card.disable")}),this.$(".non-us-fields").hide(),this.$('.country option[value="US"]').prop("selected",!0),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".exp-month")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".exp-year")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".state")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".province")}),this.createChildContext(e.Dropdown,{$replaceElement:this.$(".country")}),this.$(".content-container").scrollbar(),this.__tooltip=this.serviceProvider.create(e.Tooltip,{$replaceElement:this.$(".security-code-tooltip"),$tooltipTarget:this.$(".security-code-help-link")})}.bind(this))},__getYearRange:function(){this.__yearRange=[];for(var e=this.__timer.getDate().getFullYear(),t=0;20>t;t++)this.__yearRange.push(t+e)},__validateInputs:function(){this.__validateCardNumber(),this.__validateSecurityCode(),this.__validateExpMonth(),this.__validateExpYear(),this.__validateNameOnCard(),this.__validateCardName(),this.__validateAddress(),this.__validateCity(),this.__validateCountry(),"US"===this.$(".country select").val()?(this.__validateZip(),this.__validateState()):"CA"===this.$(".country select").val()&&(this.__validatePostal(),this.__validateProvince())},__errorIfBlank:function(e,t){var i=t?""===this.$("."+e+" select").val():""===this.$("."+e).val().trim();return this.__updateMissingFields(e,i),i},__updateMissingFields:function(e,t){this.$("."+e).toggleClass("payment-error",t);var i=this.__missingFields.indexOf(e);t&&0>i?this.__missingFields.push(e):!t&&-1<i&&this.__missingFields.splice(i,1),this.$(".field-missing").toggleClass("error-visible",0!==this.__missingFields.length)},__isBlankCardNumber:function(e){-1<this.__missingFields.indexOf("cardnumber")&&this.__errorIfBlank("cardnumber"),this.__displayCardIcon(this.$(".cardnumber").val()),this.__updateErrorStatus()},__validateCardNumber:function(){if(this.__errorIfBlank("cardnumber"))this.$(".cardnumber-invalid").removeClass("error-visible");else{this.__leanplum.recordEvent("add_cc_cc_change");var e=this.$(".cardnumber").val().replace(/[ \-]/g,"");e.match(/^\d{13,16}$/)&&this.__CCValidator.passesChecksum(e)?(this.$(".cardnumber-invalid").removeClass("error-visible"),this.$(".cardnumber").removeClass("payment-error")):(this.$(".cardnumber-invalid").addClass("error-visible"),this.$(".cardnumber").addClass("payment-error"))}this.__updateErrorStatus()},__validateCardName:function(){var e=this.$(".name-on-card").val().trim(),t=e.trim().split(/\s+/).length;/\d/.test(e)||2>t?(this.$(".cardname-invalid").addClass("error-visible"),this.$(".name-on-card").addClass("payment-error")):(this.$(".cardname-invalid").removeClass("error-visible"),this.$(".name-on-card").removeClass("payment-error")),this.__updateErrorStatus()},__displayCardIcon:function(e){(e=this.__CCValidator.getType(e))?(this.$(".cardimage").addClass("card-number-present"),this.$(".cardimage."+e).addClass("card-type-active")):(this.$(".cardimage").removeClass("card-number-present"),this.$(".cardimage").removeClass("card-type-active")),this.__updateErrorStatus()},__isBlankSecurityCode:function(){-1<this.__missingFields.indexOf("security-code")&&this.__errorIfBlank("security-code"),this.__updateErrorStatus()},__validateSecurityCode:function(){this.__errorIfBlank("security-code")?this.$(".security-code-invalid").removeClass("error-visible"):(this.__leanplum.recordEvent("add_cc_security_code_change"),this.$(".security-code").val().trim().match(/^\d\d\d\d?$/)?(this.$(".security-code-invalid").removeClass("error-visible"),this.$(".security-code").removeClass("payment-error")):(this.$(".security-code-invalid").addClass("error-visible"),this.$(".security-code").addClass("payment-error"))),this.__updateErrorStatus()},__validateExpMonth:function(){this.__errorIfBlank("exp-month",!0)||(this.__leanplum.recordEvent("add_cc_exp_month_change"),this.__validateExpDate()),this.__updateErrorStatus()},__validateExpYear:function(){this.__errorIfBlank("exp-year",!0)||(this.__leanplum.recordEvent("add_cc_exp_year_change"),this.__validateExpDate()),this.__updateErrorStatus()},__validateExpDate:function(){var e=parseInt(this.$(".exp-year select").val(),10),t=parseInt(this.$(".exp-month select").val(),10);if(0<e&&0<t){var i=(a=this.__timer.getDate()).getFullYear(),a=a.getMonth()+1;i>e||i===e&&a>t?(this.$(".exp-date-expired").addClass("error-visible"),this.$(".exp-month").addClass("payment-error"),this.$(".exp-year").addClass("payment-error")):(this.$(".exp-date-expired").removeClass("error-visible"),this.$(".exp-month").removeClass("payment-error"),this.$(".exp-year").removeClass("payment-error"))}else this.$(".exp-date-expired").removeClass("error-visible");this.__updateErrorStatus()},__isBlankNameOnCard:function(){-1<this.__missingFields.indexOf("name-on-card")&&this.__errorIfBlank("name-on-card"),this.__updateErrorStatus()},__validateNameOnCard:function(){this.__errorIfBlank("name-on-card"),this.__updateErrorStatus()},__isBlankAddress:function(){-1<this.__missingFields.indexOf("address")&&this.__errorIfBlank("address"),this.__updateErrorStatus()},__validateAddress:function(){this.__errorIfBlank("address"),this.__leanplum.recordEvent("add_cc_address_change"),this.__updateErrorStatus()},__isBlankCity:function(){-1<this.__missingFields.indexOf("city")&&this.__errorIfBlank("city"),this.__updateErrorStatus()},__validateCity:function(){this.__errorIfBlank("city"),this.__updateErrorStatus()},__validateState:function(){this.__errorIfBlank("state",!0),this.__leanplum.recordEvent("add_cc_state_change"),this.__updateErrorStatus()},__validateProvince:function(){this.__errorIfBlank("province",!0),this.__leanplum.recordEvent("add_cc_province_change"),this.__updateErrorStatus()},__isBlankZip:function(){-1<this.__missingFields.indexOf("zip")&&this.__errorIfBlank("zip"),this.__updateErrorStatus()},__validateZip:function(){this.__errorIfBlank("zip")?this.$(".zip-invalid").removeClass("error-visible"):(this.__leanplum.recordEvent("add_cc_zip_change"),this.$(".zip").val().trim().match(/^\d\d\d\d\d$/)?(this.$(".zip-invalid").removeClass("error-visible"),this.$(".zip").removeClass("payment-error")):(this.$(".zip-invalid").addClass("error-visible"),this.$(".zip").addClass("payment-error"))),this.__updateErrorStatus()},__isBlankPostal:function(){"CA"===this.$(".country select").val()&&-1<this.__missingFields.indexOf("postal")&&this.__errorIfBlank("postal"),this.__updateErrorStatus()},__validatePostal:function(){"CA"===this.$(".country select").val()&&(this.__leanplum.recordEvent("add_cc_postal_change"),this.__errorIfBlank("postal")?this.$(".postal-invalid").removeClass("error-visible"):this.$(".postal").val().trim().match(/^[A-Za-z]\d[A-Za-z]\s*\d[A-Za-z]\d$/)?(this.$(".postal-invalid").removeClass("error-visible"),this.$(".postal").removeClass("payment-error")):(this.$(".postal-invalid").addClass("error-visible"),this.$(".postal").addClass("payment-error"))),this.__updateErrorStatus()},__validateCountry:function(){this.__leanplum.recordEvent("add_cc_country_change"),this.$(".zip-invalid").removeClass("error-visible"),this.$(".postal-invalid").removeClass("error-visible"),this.__updateMissingFields("zip",!1),this.__updateMissingFields("state",!1),this.__updateMissingFields("postal",!1),this.__updateMissingFields("province",!1),this.__errorIfBlank("country",!0),"US"===this.$(".country select").val()?(this.$(".us-fields").show(),this.$(".non-us-fields").hide(),this.$(".country-container").addClass("us"),this.$(".postal").val(""),this.$('.ca-province option[value=""]').prop("selected",!0)):(this.$(".country-container").removeClass("us"),this.$(".us-fields").hide(),this.$(".zip").val(""),this.$('.state option[value=""]').prop("selected",!0),this.$(".non-us-fields").show(),"CA"===this.$(".country select").val()?(this.$(".ca-province").show(),this.$(".country-container").addClass("canada"),this.$(".postal").removeClass("intl")):(this.$(".postal").addClass("intl"),this.$(".ca-province").hide(),this.$('.ca-province option[value=""]').prop("selected",!0),this.$(".country-container").removeClass("canada"))),this.__updateErrorStatus()},__updateErrorStatus:function(){this.$(".error-block").toggleClass("has-error",0<this.$(".error-visible").length)},__continueCheckout:function(){this.__validateInputs(),0<this.$(".payment-error").length?this.$(".dialog-body").scrollTop(0):this.__dialogManager.showDialog(e.CreditCardPaymentReviewDialog,{billingInfo:this.__getBillingInfo(),channel:this.__channel,cart:this.__cart,orderTotal:this.__orderTotal,itemCount:this.__itemCount}).finished.then(function(e){this.promiseResolver.accept(),this.__destroy()}.bind(this)).catch(function(e){}.bind(this))},__getBillingInfo:function(){var e=this.$(".country select").val(),t=this.$(".state select").val(),i=this.$(".zip").val().trim();return"CA"===e?(t=this.$(".province select").val(),i=this.$(".postal").val().trim()):"US"!==e&&(t="",i=this.$(".postal").val().trim()),{name:this.$(".name-on-card").val().trim(),address:this.$(".address").val().trim(),city:this.$(".city").val().trim(),state:t,postal_code:i,country:e,credit_card:this.$(".cardnumber").val().replace(/[ \-]/g,""),exp_month:this.$(".exp-month select").val(),exp_year:this.$(".exp-year select").val(),cvc:this.$(".security-code").val().trim(),save_card:this.$("#save-for-later-checkbox").prop("checked")}},__goBack:function(){this.hide(),this.promiseResolver.reject()}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:P,SecurityCodeHelpDialog:B,CountryMap:e["json!/common/js/JSON/Countries.json"],StateMap:e["json!/common/js/JSON/States.json"],ProvinceMap:e["json!/common/js/JSON/Provinces.json"],Dropdown:T,CCValidator:S,Tooltip:r,CreditCardPaymentReviewDialog:H,backButtonTemplate:E}),q=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s,o=this.escapeExpression;return i=t.helperMissing,o='<div class="card-row">\n    <div class="card-wrap">\n        <div class="card-info">\n            <div class="number">XXXX-XXXX-XXXX-'+o("function"==typeof(s=t.cardNumber||e&&e.cardNumber)?s.call(e,{name:"cardNumber",hash:{},data:a}):s)+'</div>\n            <div><span class="type">'+o("function"==typeof(s=t.type||e&&e.type)?s.call(e,{name:"type",hash:{},data:a}):s)+'</span></div>\n        </div>\n        <div class="primary">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Primary",{name:"i18n-g",hash:{},data:a}))||0===n)&&(o+=n),o+='</div>\n        <div class="context">\n            <span class="icon icon-action-more context-menu-button"></span>\n        </div>\n    </div>\n    <div class="primary">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Primary",{name:"i18n-g",hash:{},data:a}))||0===n)&&(o+=n),o+"</div>\n</div>"},useData:!0})}(),j=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("ContextMenu",{uiContextName:"context_menu",tagName:"ul",className:"context-menu",trackedEvents:function(){return[{type:"click",selector:"li",name:"context_menu_item",handler:"__chooseMenuItem",attributes:function(e){return{which:e.attr("data-menu-item")}}}]},initialize:function(e){i.prototype.initialize.call(this,e),this.__items=IMVU.requireProperty(e,"items"),this.location=IMVU.requireProperty(e,"location"),this.__closeOnScroll=void 0===e.closeOnScroll||e.closeOnScroll,this.addToDOM()},render:function(){_.each(this.__items,function(e){var t=$("<li />");t.attr("data-menu-item",e.name).text(e.text).addClass(e.classNames).toggleClass("divider",!!e.divider),this.$el.append(t)}.bind(this))},__chooseMenuItem:function(e){var t=$(e.currentTarget).data("menu-item"),i=_.find(this.__items,function(e){return e.name===t}).handler;i&&i.call(this,e),this.trigger("item-chosen")},shouldCloseOnScroll:function(){return!this.__closeOnScroll}})}(),W=function(e){var t=e.UiCore.UiContext;return t.extend("SavedCreditCardListItem",{className:"saved-credit-card-list-item",uiContextName:"saved_credit_card_list_item",tagName:"li",dependencies:"context contextMenuManager dialogManager globalStringManager rest selectedCard".split(" "),trackedEvents:function(){return[{type:"click",name:"select_card",handler:this.__selectCard},{type:"click",name:"show_context_menu",selector:".context-menu-button",handler:this.__showContextMenu}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM(),this.listenTo(this.model,"select",this.__selectCard)},render:function(){this.model.populated().then(function(){var t=this.model.get("card_type")?this.model.get("card_type"):"other";this.__cardTypeString=this.__globalStringManager.get("card_type_"+t),this.$el.html(e.template({cardNumber:this.model.get("card_last_digits"),type:this.__cardTypeString})),this.model.get("is_primary")&&this.$el.addClass("is-primary"),null!==this.__selectedCard&&this.model.get("is_primary")&&this.__selectCard()}.bind(this))},__showContextMenu:function(t){var i=this.model.get("is_primary")?[{name:"delete_card",text:this.__globalStringManager.get("Delete"),handler:this.__deleteCard.bind(this)}]:[{name:"make_primary",text:this.__globalStringManager.get("Make Primary"),handler:this.__makePrimary.bind(this)},{name:"delete_card",text:this.__globalStringManager.get("Delete"),handler:this.__deleteCard.bind(this)}];this.__contextMenuManager.showMenu(t,e.ContextMenu,{items:i,displayOptions:{above:!1,right:!1}})},__selectCard:function(){e.NextUtil.DomHelper.radioClass(this.$el,"selected-card"),null!==this.__selectedCard&&(this.__selectedCard.set({id:parseInt(this.model.id.match(/\d+/)[0].replace("saved_card-","")),card_type:this.__cardTypeString,name:this.model.get("name"),card_last_digits:this.model.get("card_last_digits")}),this.__selectedCard.trigger("selected"))},__makePrimary:function(){this.$el.hasClass("is-primary")||this.model.save({default:!0}).then(function(){this.$el.addClass("is-primary")}.bind(this))},__deleteCard:function(){this.__dialogManager.confirm({title:this.__globalStringManager.get("Delete Payment Method"),text:this.__globalStringManager.get("Are you sure you want to delete this payment method?"),yes:this.__globalStringManager.get("Delete"),no:this.__globalStringManager.get("Cancel")}).finished.then(function(){this.__selectedCard&&null!==this.__selectedCard.get("id")&&this.__selectedCard.get("id")===parseInt(this.model.id.match(/\d+/)[0].replace("saved_card-",""))&&(this.__selectedCard=new IMVU.NamedModel({id:null}),this.__context.trigger("selected_card_deleted")),this.__rest.delete(this.model.id),this.__context.trigger("card_deleted"),this.delete()}.bind(this))}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:q,ContextMenu:j}),G=function(e){var t=e.UiCore.ListPresenter;return t.extend("SavedCreditCardList",{className:"saved-credit-card-list",uiContextName:"saved_credit_card_list",tagName:"ul",itemFactory:e.SavedCreditCardListItem,dependencies:["globalStringManager"],initialize:function(e){t.prototype.initialize.call(this,e),this.__showEmptyText=IMVU.optionalProperty(e,"showEmptyText",!1)},__emptyText:function(){if(this.$el.addClass("is-empty"),this.__showEmptyText)return{standard:this.__globalStringManager.get("No Saved Card"),concise:this.__globalStringManager.get("No Saved Card")}}})}({UiCore:e["@UiCore"],SavedCreditCardListItem:W}),Y=function(e){var t=e.PaymentBaseDialog;return t.extend("PaymentDialog",{uiContextName:"payment_dialog",className:"payment-dialog dialog-type-B",dependencies:"cart dialogManager globalStringManager globalStartupModel googleAnalytics leanplum platform restModelFactory".split(" "),trackedEvents:function(){return[{type:"change",selector:".vip",name:"vip_checkbox_changed",handler:"__validateVipCheckbox"},{type:"click",selector:".core-store-link",name:"go_to_core_store",handler:"__goToCoreStore",allowBubble:!0},{type:"click",selector:".add-credit-card",name:"add_credit_card",handler:"__addCreditCard"},{type:"click",selector:".paypal-checkout",name:"paypal_checkout",handler:"__paypalCheckout"},{type:"click",selector:".buy-now",name:"buy_now",handler:"__creditCardCheckout"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("payment_dialog_title"),this.shouldFocusOnPrimaryButton=!1,this.__channel=IMVU.optionalProperty(e,"channel","unknown"),this.__platformId=(this.__isMobile="mobile"===this.__platform)?10:9,this.__selectedCard=new IMVU.NamedModel({id:null}),this.listenTo(this.__selectedCard,"selected",this.__toggleCheckoutButton.bind(this,!0)),this.listenTo(this,"selected_card_deleted",this.__toggleCheckoutButton.bind(this,!1)),this.addToDOM()},postRender:function(){this.__validateCart(),this.setContent("body",e.template,{hasVip:this.__hasVip,platformId:this.__platformId,itemCount:this.__cart.length,showTotal:1<this.__cart.length}),this.setContent("footer",this.$(".dialog-footer-template").text()),this.__invalidProduct?(this.$(".buy-now").prop("disabled",!0),this.$(".invalid-product").addClass("error-visible")):this.createChildContext(e.OrderList,{$replaceElement:this.$(".order-list-placeholder"),cart:this.__cart}),this.__toggleCheckoutButton(!1),this.__savedCreditCards=this.track(this.__restModelFactory.readCollection(this.__globalStartupModel.get("savedCreditCardUrl"),e.UiCore.NodeCollection)),this.listenTo(this.__savedCreditCards,"reset",this.__loadSavedCard),this.__loadSavedCard(),this.$(".order-total").text(this.__orderTotal.toFixed(2)),this.$(".item-count").text(this.__itemCount),this.__hasVip&&this.createChildContext(e.Tooltip,{$replaceElement:this.$(".vip-toc-tooltip"),$tooltipTarget:this.$(".vip-toc-link")}),this.$(".content-container").scrollbar()},__toggleCheckoutButton:function(e){this.$(".buy-now").prop("disabled",!e)},__validateCart:function(){return this.__itemCount=this.__orderTotal=0,this.__invalidProduct=this.__hasVip=!1,0===this.__cart.length&&(this.__invalidProduct=!0),_.each(this.__cart,function(e){!e.name||!e.sku||!e.price||0>e.price?this.__invalidProduct=!0:0<e.sku.indexOf(".vip.")&&(this.__hasVip=!0),this.__itemCount++,this.__orderTotal+=e.price,e.price=e.price.toFixed(2)}.bind(this)),!this.__invalidProduct},__validateVipCheckbox:function(){this.$(".vip").prop("checked")?(this.$(".vip-checkbox-missing").removeClass("error-visible"),this.$(".vip-block label").removeClass("payment-error")):(this.$(".vip-checkbox-missing").addClass("error-visible"),this.$(".vip-block label").addClass("payment-error")),this.__updateErrorStatus()},__updateErrorStatus:function(){this.$(".error-block").toggleClass("has-error",0<this.$(".error-visible").length)},__scrollTop:function(){this.$(".content-container").scrollTop(0)},__creditCardCheckout:function(){this.__hasVip&&this.__validateVipCheckbox(),0<this.$(".payment-error").length?this.__scrollTop():(this.__leanplum.recordEvent("dollar_store_buy_start",{type:this.__cart[0].type,sku:this.__cart[0].sku,price:this.__cart[0].price,pid:this.__cart[0].pid}),this.__googleAnalytics.recordDollarStore("buy",this.__cart[0].sku),this.__setProcessing(!0),this.__submitOrder(this.__createSavedCreditCardOrder()))},__createSavedCreditCardOrder:function(){return{cart:this.__filterCart(),channel:this.__channel,payment_method:"saved_cc_payment",saved_cc_payment:{id:this.__selectedCard.get("id")}}},__paypalCheckout:function(){this.__hasVip&&this.__validateVipCheckbox(),0<this.$(".payment-error").length?this.__scrollTop():(this.__setProcessing(!0),this.__openPaypalWindow(),this.__submitOrder({cart:this.__filterCart(),channel:this.__channel,payment_method:"paypal_payment",paypal_payment:{}}))},__goToCoreStore:function(){},__loadSavedCard:function(){this.__savedCreditCards.populated().then(function(){this.$(".savedcard-container").html("");var t=_.filter(this.__savedCreditCards.models,function(e){return"co"!==e.attributes.system}.bind(this));t=new IMVU.NamedCollection(t);this.__savedCard=this.createChildContext(e.SavedCreditCardList,{$parentElement:this.$(".savedcard-container"),collection:t,context:this,selectedCard:this.__selectedCard});var i=!1;_.each(t.models,function(e){e.get("is_primary")&&(i=!0)}),!i&&0<t.models.length&&t.models[0].trigger("select")}.bind(this))},__addCreditCard:function(){if(this.__hasVip&&this.__validateVipCheckbox(),!(0<this.$(".payment-error").length))return this.__dialogManager.showDialog(e.AddCreditCardDialog,{channel:this.__channel,cart:this.__cart,orderTotal:this.__orderTotal,itemCount:this.__itemCount}).finished.then(function(e){this.promiseResolver.accept(),this.__destroy()}.bind(this)).catch(function(e){}.bind(this));this.__scrollTop()}})}({UiCore:e["@UiCore"],PaymentBaseDialog:F,AddCreditCardDialog:R,Dropdown:T,OrderList:k,SavedCreditCardList:G,Tooltip:r,template:x}),X={getTimeFormat:function(e,t){var i=Math.floor(e/3600),a=Math.floor(e/60)-60*i,n=e%60;t&&(n=n.toFixed(t));var s=10>n?"0":"";return i?i+":"+(10>a?"0":"")+a+":"+s+n:a+":"+s+n},formatCredits:function(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},zeroPad:function(e,t){return(Array(t).join("0")+e).substr(-t,t)},formatMini:function(e){for(var t=[{base:1e3,letter:"K"},{base:1e6,letter:"M"},{base:1e9,letter:"B"}],i=t.length-1;0<=i;i--){var a=t[i],n=a.base;if(e>=n)return(t=Math.floor(e/n))+((e=Math.floor((e-n*t)/(n/10)))?"."+e:"")+a.letter}return""+e}},J=function(e){var t=e.UiCore.UiContext;return t.extend("CheckoutButton",{uiContextName:"checkout_button",className:"inline-purchase-checkout-button",dependencies:["globalStringManager","dialogManager","loginManager"],trackedEvents:function(){return[{type:"click",selector:".buy-now",name:"store_checkout",handler:this.__storeCheckout}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__stringManager=i.globalStringManager,this.__formatNumber=e.FormatNumber,this.dialogManager=i.dialogManager,this.__selectedCredit=IMVU.optionalProperty(i,"selectedCredit",new IMVU.NamedModel({price:0})),this.__selectedVip=IMVU.optionalProperty(i,"selectedVip",new IMVU.NamedModel({price:0})),this.__context=IMVU.optionalProperty(i,"context",null),this.listenTo(this.__selectedCredit,"change",this.__updateCheckoutButton),this.listenTo(this.__selectedVip,"change",this.__updateCheckoutButton),this.addToDOM(),this.__myself=this.track(i.loginManager.getCurrentUser()),this.__updateCheckoutButton()},render:function(){this.$el.html(e.template())},__updateCheckoutButton:function(){var e;this.__getNumber()?(this.$("button.buy-now").prop("disabled",!1),e=1===this.__getNumber()?this.__stringManager.get("checkout_dialog_buy_now_message_singular",{totalCredits:"$"+this.__formatNumber.formatCredits(this.__getTotalPrice())}):this.__stringManager.get("checkout_dialog_buy_now_message_plural",{howMany:this.__getNumber(),totalCredits:"$"+this.__formatNumber.formatCredits(this.__getTotalPrice())}),this.$("button.buy-now").text(e)):(this.$("button.buy-now").prop("disabled",!0),this.$("button.buy-now").text(this.__stringManager.get("CHECKOUT")))},__getNumber:function(){var e=0;return 0<this.__selectedCredit.get("price")&&e++,0<this.__selectedVip.get("price")&&e++,e},__getTotalPrice:function(){return(this.__selectedCredit.get("price")+this.__selectedVip.get("price")).toFixed(2)},__storeCheckout:function(){this.$("button.buy-now").prop("disabled",!0),this.__myself.populated().then(function(t){if(t.get("is_on_hold"))return this.dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("payment_failed_account_holdon_title"),text:this.__stringManager.get("payment_failed_account_holdon_text"),ok:this.__stringManager.get("payment_failed_account_holdon_button")}).finished.then(function(){this.__context&&this.__context.destroy()}.bind(this));0<this.__selectedVip.get("price")&&this.__myself.get("is_vip")?this.__myself.getEdgeCollection("vip_subscriptions").populated().then(function(t){for(var i=!1,a=0;a<t.models.length;a++){var n=t.models[a].node;n.get("date_stopped")||n.relations.buyer!==this.__myself.id||n.relations.recipient!==this.__myself.id||(i=!0)}if(i)return this.dialogManager.showDialog(e.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("already_have_vip_subscription_title"),html:e.AlreadyHaveVipDialog({}),ok:this.__stringManager.get("already_have_vip_subscription_button")}).finished.then(function(){this.__context&&this.__context.destroy()}.bind(this));this.__checkout()}.bind(this)):this.__checkout()}.bind(this))},__checkout:function(){var t=[];return _.each([this.__selectedCredit,this.__selectedVip],function(e){e.get("price")&&t.push({pid:e.get("pid"),sku:e.get("sku"),name:e.get("name"),original_price:e.get("original_price"),price:e.get("price"),type:e.get("type"),frequency_code:e.get("frequency_code"),image:e.get("image")})}),this.dialogManager.showDialog(e.PaymentDialog,{cart:t,channel:"next-inline",context:this.__context}).finished.then(function(){this.__context&&(this.__context.purchaseComplete=!0,this.__context.destroy())}.bind(this)).catch(function(){this.__context&&this.__context.includeBuyCredits&&this.__context.trigger("refresh_items",!0),this.$("button.buy-now").prop("disabled",!1)}.bind(this))}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],template:C,AlreadyHaveVipDialog:w,FormatNumber:X,PaymentDialog:Y}),K=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<a class="back-button">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Back",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</a>"},useData:!0})}(),Z=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n;return'\n    <legend class="system-info-header">'+(0,this.escapeExpression)("function"==typeof(n=t.titleText||e&&e.titleText)?n.call(e,{name:"titleText",hash:{},data:a}):n)+"</legend>\n"},3:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <div class="vip-description">\n        <div class="crown-icon">\n            <svg class="image" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 80 80" class="color-gold" fill-rule="evenodd"><path d="M58 17.272a2.218 2.218 0 0 0-4.434 0c0 .594.234 1.128.612 1.524l-6.216 6.108a.422.422 0 0 1-.681-.129l-6.033-13.698a2.212 2.212 0 0 0 1.017-1.86 2.218 2.218 0 0 0-4.437 0c0 .78.405 1.464 1.017 1.86l-6.033 13.698a.422.422 0 0 1-.681.129l-6.267-6.156c.351-.393.57-.906.57-1.476a2.218 2.218 0 0 0-4.434 0 2.21 2.21 0 0 0 1.992 2.196c.351 2.916 1.941 16.161 1.98 16.212.549 1.272 6.633 2.274 14.076 2.274 7.44 0 13.524-1.002 14.073-2.274.039-.051 1.632-13.326 1.98-16.224A2.208 2.208 0 0 0 58 17.272M24.71 70.81h-3.836L10.633 46h4.786l7.426 18.933L30.235 46h4.68L24.71 70.81zm14.674-.177V46h4.329v24.633h-4.329zm20.13-7.917h-4.892v7.918h-4.328V46h9.712c5.772 0 9.36 3.272 9.36 8.305 0 5.525-4.433 8.41-9.852 8.41zm.14-12.774h-5.032v8.868h5.033c3.272 0 5.313-1.83 5.313-4.4v-.07c0-2.885-2.076-4.398-5.313-4.398z"/></svg>\n        </div>\n        <div class="title">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_title",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n        <div class="sentence">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_sentence",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</div>\n        ",((n=t.if.call(e,e&&e.showLearnLink,{name:"if",hash:{},fn:this.program(4,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+"\n    </div>\n"},4:function(e,t,i,a){var n;i=t.helperMissing;var s='\n            <div class="learn-link-outer">\n                <div class="learn-link-inner">\n                    ';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"vip_description_learn_link",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"\n                </div>\n            </div>\n        "},6:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <legend class="system-info-header">\n        ';return((n=t.if.call(e,e&&e.isInCreditDialog,{name:"if",hash:{},fn:this.program(7,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+="\n        ",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"UPGRADES",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"\n    </legend>\n"},7:function(e,t,i,a){var n;i=t.helperMissing;var s="\n            ";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"RECOMMENDED",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i="",((n=t.if.call(e,e&&e.titleShow,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n",((n=t.if.call(e,e&&e.clubSubscriptionShow,{name:"if",hash:{},fn:this.program(3,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n",((n=t.unless.call(e,e&&e.titleShow,{name:"unless",hash:{},fn:this.program(6,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n"},useData:!0})}(),Q=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <div class="promo-banner sale">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"SALE",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+'<div class="triangle"></div></div>\n'},3:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <div class="promo-banner most-popular">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"MOST POPULAR",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+'<div class="triangle"></div></div>\n'},5:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <div class="promo-banner best-value">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"BEST VALUE",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+'<div class="triangle"></div></div>\n'},7:function(e,t,i,a){var n,s;i=this.escapeExpression;var o=t.helperMissing,l='\n    <div class="item-info">\n        <div class="image-container"><span class="helper"></span><img></div>\n    </div>\n    <div class="item-price">\n        <div class="subscription-title">'+i("function"==typeof(s=t.description||e&&e.description)?s.call(e,{name:"description",hash:{},data:a}):s)+'</div>\n        <div class="prices">\n            <div class="show-price">\n            ';return((n=t.if.call(e,e&&e.has_discount,{name:"if",hash:{},fn:this.program(8,a),inverse:this.noop,data:a}))||0===n)&&(l+=n),l+="\n            $"+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:a}):s)+'\n            </div>\n            <div class="show-active">\n                ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"ACTIVE",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+"\n            </div>\n        </div>\n    </div>\n"},8:function(e,t,i,a){var n;return'\n                <span class="original-price">$'+(0,this.escapeExpression)("function"==typeof(n=t.original_price||e&&e.original_price)?n.call(e,{name:"original_price",hash:{},data:a}):n)+"</span>\n            "},10:function(e,t,i,a){var n,s;i=this.escapeExpression;var o=t.helperMissing,l='\n    <div class="item-info">\n        <div class="image-container"><img></div>\n        '+i("function"==typeof(s=t.itemLabels||e&&e.itemLabels)?s.call(e,{name:"itemLabels",hash:{},data:a}):s)+'\n        <div class="check-mark check-mark-hidden">\n            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25">\n                <path fill="#404040" fill-rule="evenodd" d="M11.082 15.579l-3.536-3.536-1.414 1.414 4.243 4.243.707.707 8.485-8.485-1.414-1.415-7.071 7.072zM12.5 22.5c-5.523 0-10-4.477-10-10s4.477-10 10-10 10 4.477 10 10-4.477 10-10 10z"/>\n            </svg>\n        </div>\n    </div>\n    <div class="item-price">\n        <div class="show-price">\n        ';return((n=t.if.call(e,e&&e.has_discount,{name:"if",hash:{},fn:this.program(11,a),inverse:this.noop,data:a}))||0===n)&&(l+=n),l+="\n        $"+i("function"==typeof(s=t.price||e&&e.price)?s.call(e,{name:"price",hash:{},data:a}):s)+'\n        </div>\n        <div class="show-active">\n            ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||o).call(e,"ACTIVE",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+"\n        </div>\n    </div>\n"},11:function(e,t,i,a){var n;return'\n            <span class="original-price">$'+(0,this.escapeExpression)("function"==typeof(n=t.original_price||e&&e.original_price)?n.call(e,{name:"original_price",hash:{},data:a}):n)+"</span>\n        "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i='<div class="wrapper">  \n\n',((n=t.if.call(e,e&&e.is_sale,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.if.call(e,e&&e.is_popular,{name:"if",hash:{},fn:this.program(3,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.if.call(e,e&&e.is_best,{name:"if",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.if.call(e,e&&e.showRows,{name:"if",hash:{},fn:this.program(7,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n",((n=t.unless.call(e,e&&e.showRows,{name:"unless",hash:{},fn:this.program(10,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n</div>\n"},useData:!0})}(),ee=function(e){var t=e.UiCore.UiContext;return t.extend("BuyUpgradeListItem",{uiContextName:"buy_upgrade_list_item",tagName:"article",className:"buy-upgrade-list-item",dependencies:"globalStringManager imageManager loginManager model googleAnalytics window".split(" "),trackedEvents:function(){return[{type:"click",name:"choose_upgrade_item",handler:"__onClickItem"}]},initialize:function(e){this.__width=void 0===e.width?"":e.width,""!==this.__width&&(this.__width="width-"+this.__width),this.__selectedVip=IMVU.requireProperty(e,"selectedVip"),this.__style=IMVU.optionalProperty(e,"style",""),this.__model=e.model,this.__globalStringManager=e.globalStringManager,this.__imageManager=e.imageManager,this.__isInStore=IMVU.optionalProperty(e,"isInStore",!1),this.__context=IMVU.optionalProperty(e,"context",null),this.__isResponsive=IMVU.optionalProperty(e,"isResponsive",!1),t.prototype.initialize.call(this,e),this.__itemLabels=void 0===e.itemLabels?"SUBSCRIPTION":e.itemLabels,this.__itemLabels=this.__globalStringManager.get(this.__itemLabels),this.__scheme=void 0===e.scheme?"":e.scheme,this.__width=void 0===e.width?"":e.width,this.__platform=this.__serviceProvider.get("platform"),this.__myself=this.__loginManager.getCurrentUser(),this.__isActive=!1,this.$el.toggleClass("is-responsive-tile-list-item",this.__isResponsive),this.addToDOM()},render:function(){t.prototype.render.call(this),this.__myself.populated().then(function(){return this.__model.populated()}.bind(this)).then(function(){this.__hasDiscount=this.__model.get("original_price")>this.__model.get("independent_purchase_price");var t=!1;switch("in-dialog"!==this.__style||"mobile"!==this.__platform||this.__isResponsive||(t=!0,this.__scheme="rows"),this.$el.html(e.template({has_discount:this.__hasDiscount,original_price:this.__model.get("original_price").toFixed(2),price:this.__model.get("independent_purchase_price").toFixed(2),is_sale:this.__hasDiscount,is_best:!this.__hasDiscount&&this.__model.get("best"),is_popular:!this.__hasDiscount&&!this.__model.get("best")&&this.__model.get("popular"),showRows:t,description:this.__globalStringManager.get("vip_sbuscription_freq_"+this.__model.get("frequency_code")),itemLabels:this.__itemLabels})),this.__imageManager.load(this.$(".image-container > img"),this.__getImageSrc(this.__model.get("image"))),(this.__hasDiscount||this.__model.get("best")||this.__model.get("popular"))&&this.$el.addClass("has-promo"),this.__myself.get("is_vip")&&this.$el.addClass("clickblocked"),this.__setChecked(!1),"width140"!==this.__width||this.__isResponsive||(this.$el.addClass("width140"),this.$el.addClass("height180"),this.$(".item-info").addClass("width140"),this.$(".item-info").addClass("height140")),this.__modelFrequency="",this.__model.get("frequency_code")){case this.constructor.VIP_MONTHLY:this.__modelFrequency="monthly";break;case this.constructor.VIP_QUARTERLY:this.__modelFrequency="quarterly";break;case this.constructor.VIP_YEARLY:this.__modelFrequency="yearly"}this.__checkForActiveSubscription(),this.listenTo(this.__myself,"change:vip_expires",this.__checkForActiveSubscription)}.bind(this))},__checkForActiveSubscription:function(){this.__myself.get("is_vip")?(this.__vipSubscriptions||(this.__vipSubscriptions=this.__myself.getEdgeCollection("vip_subscriptions")),this.__vipSubscriptions.populated().then(function(e){this.__vipNode=null,this.__isActive=!1,this.__subscriptionFrequency="";for(var t=0;t<e.models.length;t++){var i=e.models[t].node;i.get("date_stopped")||i.relations.buyer!==this.__myself.id||i.relations.recipient!==this.__myself.id||i.get("frequency")!==this.__modelFrequency||(this.__vipNode=i,this.__isActive=!0)}this.$el.toggleClass("active",this.__isActive),this.$el.removeClass("clickblocked"),this.__vipNode&&this.listenTo(this.__vipNode,"change:date_stopped",this.__subscriptionCancelled)}.bind(this))):(this.$el.removeClass("active"),this.$el.removeClass("clickblocked"))},__subscriptionCancelled:function(){this.stopListening(this.__vipNode),this.__vipNode=null,this.__isActive=!1,this.$el.removeClass("active"),this.$el.removeClass("clickblocked")},__getImageSrc:function(e){return"/common/withme/img/store/"+e},__setChecked:function(e){if(this.$el.toggleClass("selected-item",e),"white_charcoal"===this.__scheme){this.$el.siblings().find(".check-mark").addClass("check-mark-hidden"),this.$el.siblings().removeClass("selected-item"),this.$el.siblings().find(".item-price").removeClass("item-price-charcoal"),this.$el.siblings().find(".item-price").addClass("item-price-white");var t=this.$(".item-price");!0===e?(this.$(".check-mark").removeClass("check-mark-hidden"),t.hasClass("item-price-white")&&t.removeClass("item-price-white"),t.addClass("item-price-charcoal")):(this.$(".check-mark").addClass("check-mark-hidden"),t.hasClass("item-price-charcoal")&&t.removeClass("item-price-charcoal"),t.addClass("item-price-white"))}},__onClickItem:function(){this.__isActive||this.$el.hasClass("clickblocked")||"vip"!==this.__model.get("type")||(this.__isInStore?(this.__selectedVip.set({name:this.__model.get("title"),price:this.__model.get("independent_purchase_price"),original_price:this.__model.get("original_price"),sku:this.__model.get("sku"),pid:this.__model.get("pid"),frequency_code:this.__model.get("frequency_code"),type:this.__model.get("type"),image:this.__model.get("image")}),this.__googleAnalytics.recordDollarStore("view",this.__model.get("sku")),this.__selectedVip.trigger("click")):(this.$el.toggleClass("selected-item"),this.$el.hasClass("selected-item")?(this.__setChecked(!0),e.NextUtil.DomHelper.radioClass(this.$el,"selected-item"),this.__selectedVip.set({name:this.__model.get("title"),price:this.__model.get("independent_purchase_price"),original_price:this.__model.get("original_price"),sku:this.__model.get("sku"),pid:this.__model.get("pid"),frequency_code:this.__model.get("frequency_code"),type:this.__model.get("type"),image:this.__model.get("image")}),this.__context&&this.__context.trigger("add_vip_item",!0)):(this.__setChecked(!1),this.__selectedVip.set({price:0}),this.__context&&this.__context.trigger("add_vip_item",!1))))}},{VIP_MONTHLY:2,VIP_QUARTERLY:4,VIP_YEARLY:5})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:Q}),te=function(e){var t=e.UiCore.ListPresenter;return t.extend("BuyUpgradeList",{uiContextName:"buy_upgrade_list",className:"buy-upgrade-list",tagName:"section",dependencies:["featureAccessManager","globalStringManager","modeManager"],trackedEvents:function(){return[{type:"click",selector:".learn-link-inner",name:"vip_description_learn_link",handler:"__onClickLearnLink"}]},itemFactory:e.BuyUpgradeListItem,initialize:function(i){t.prototype.initialize.call(this,i),this.__width=void 0===i.width?"":i.width,this.__style=IMVU.optionalProperty(i,"style",""),this.__isResponsive=IMVU.optionalProperty(i,"isResponsive",!1),this.__titleShow=-1===["in-dialog","in-credit-dialog"].indexOf(this.__style)||void 0!==i.titleText,this.__titleText=void 0===i.titleText?"UPGRADE TO VIP":i.titleText,this.__titleText=this.__globalStringManager.get(this.__titleText),this.__clubSubscriptionShow=(-1===["in-dialog","in-credit-dialog"].indexOf(this.__style)||!0===i.clubSubscriptionShow)&&!1!==i.clubSubscriptionShow,this.__showLearnLink=this.__featureAccessManager.canSeeVipUpsell(),this.__scheme=void 0===i.scheme?"":i.scheme,this.__bottomPadding=!0===i.bottomPadding,this.$el.toggleClass("is-responsive-tile-list",this.__isResponsive),this.$el.toggleClass("two-columns",400>this.$el.width()),this.$el.prepend(e.template({width:this.__width,titleShow:this.__titleShow,titleText:this.__titleText,clubSubscriptionShow:this.__clubSubscriptionShow,showLearnLink:this.__showLearnLink,itemLabels:i.itemLabels,isInCreditDialog:"in-credit-dialog"===this.__style,scheme:this.__scheme})),this.__bottomPadding&&this.$el.addClass("bottom-padding")},__onClickLearnLink:function(e){this.__modeManager.openMode({mode:{id:"store"},submode:{id:"vip"}})}})}({UiCore:e["@UiCore"],BuyUpgradeListItem:ee,template:Z}),ie=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("BuyUpgradeDialog",{uiContextName:"buyupgrade_dialog",className:"buyupgrade-dialog dialog-type-B",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager Promise restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-upgrade-now",name:"buy_upgrade",handler:this.__buyUpgradeNow},{type:"click",selector:".back-button",name:"go_back",handler:this.__goBack}]},initialize:function(i){t.prototype.initialize.call(this,i),this.purchaseComplete=!1,this.Promise=i.Promise,this.serviceProvider=i.serviceProvider,this.dialogManager=i.dialogManager,this.__stringManager=i.globalStringManager,this.restModelFactory=i.restModelFactory,this.__platform=this.__serviceProvider.get("platform"),this.__formatNumber=e.FormatNumber,this.__storeCatalogUrl=i.globalStartupModel.get("storeCatalogUrl"),this.__storeCatalog=this.restModelFactory.readModel(this.__storeCatalogUrl,e.UiCore.NodeModel),this.title=this.__stringManager.get("buyupgrade_title"),this.__selectedProduct=new IMVU.NamedModel,this.addToDOM()},destroy:function(){this.promiseResolver&&this.promiseResolver.resolve(this.purchaseComplete),this.hide(),this.delete()},postRender:function(){this.setContent("body",e.template),this.createChildContext(e.CheckoutButton,{$parentElement:this.$(".dialog-footer"),selectedVip:this.__selectedProduct,globalStringManager:this.__stringManager,context:this}),this.__storeCatalog.populated().then(function(e){return e.getEdgeCollection("items").populated()}.bind(this)).then(function(t){var i=new IMVU.NamedCollection;_.each(t.models,function(e){"vip"===(e=e.edge).get("type")&&i.add(e)}.bind(this)),("mobile"!==this.__platform||this.__featureAccessManager.canSeeResponsiveList())&&this.$(".dialog-body").addClass("list-like-submode"),this.createChildContext(e.BuyUpgradeList,{$parentElement:this.$(".products"),collection:i,selectedVip:this.__selectedProduct,clubSubscriptionShow:!0,itemLabels:"MEMBERSHIP",scheme:"white_charcoal",width:"width140",style:"in-dialog",isResponsive:!!this.__featureAccessManager.canSeeResponsiveList()}),this.$(".upgrade-products").scrollbar()}.bind(this))},__goBack:function(){this.destroy()}})}({UiCore:e["@UiCore"],Dialogs:e["@Dialogs"],Model:e["@Model"],template:b,backButtonTemplate:K,FormatNumber:X,BuyUpgradeList:te,CheckoutButton:J}),ae=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="vip-badge-tooltip tooltip-header"><a class="vip-badge-tooltip-cta cta">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"VIP Member",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</a></div>"},useData:!0})}(),ne=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return' <div class="vip-badge">\n    <svg class="badge-image" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">\n        <g fill="none" fill-rule="evenodd">\n        <ellipse fill="#DEB359" cx="9" cy="9" rx="9" ry="9"/>\n        <path d="M14.87 7.303a.723.723 0 1 0-1.247.497l-2.027 1.992a.138.138 0 0 1-.222-.042L9.407 5.283a.72.72 0 0 0-.39-1.33.723.723 0 0 0-.394 1.33L6.656 9.75a.138.138 0 0 1-.222.042L4.39 7.784a.72.72 0 0 0-.537-1.204.72.72 0 1 0-.073 1.44c.114.95.633 5.27.646 5.286.18.414 2.163.74 4.59.74 2.426 0 4.41-.326 4.59-.74.01-.017.53-4.346.644-5.29a.72.72 0 0 0 .62-.713" fill="#FFF"/>\n        </g>\n    </svg>\n</div>'},useData:!0})}(),se=function(e){var t=e.UiCore.UiContext;return t.extend("DisplayName",{className:"display-name enable-text-selection",uiContextName:"display_name",dependencies:"cardManager dialogManager featureAccessManager globalStringManager loginManager modeManager user window".split(" "),trackedEvents:function(){return[{type:"click",selector:".display-name-text",name:"display_name_lhs_click",handler:this.__onClickInner.bind(this),allowBubble:!0}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__window=i.window,this.__modeManager=i.modeManager,this.__serviceProvider=i.serviceProvider,this.__stringManager=i.globalStringManager,this.__user=this.track(i.user),this.__cardManager=i.cardManager,this.__loginManager=i.loginManager,this.__showErrorView=!!i.showErrorView,this.__ignoreClicks=void 0!==i.ignoreClicks?!!i.ignoreClicks:!this.__loginManager.isLoggedIn(),this.__isLoggedIn=this.__loginManager.isLoggedIn(),this.__ignoreClicks&&this.$el.addClass("ignore-clicks"),this.__showVipBadge=IMVU.optionalProperty(i,"showVipBadge",!0),this.__showVipBadgeTooltip=IMVU.optionalProperty(i,"showVipBadgeTooltip",!0),this.__showVipBadge||(this.__showVipBadgeTooltip=!1),this.__showVipBadgeTooltip&&(this.__showVipBadge=!0),this.__shouldRemoveTruncate=IMVU.optionalProperty(i,"shouldRemoveTruncate",!1),this.__showAsMe=IMVU.optionalProperty(i,"showAsMe",!1),this.__nameOverride=IMVU.optionalProperty(i,"nameOverride",null),this.__hoverOn=IMVU.optionalProperty(i,"hoverOn",!1),this.__size=IMVU.optionalProperty(i,"size","small"),this.__color=IMVU.optionalProperty(i,"color","dark"),this.__display=IMVU.optionalProperty(i,"display",null),this.__prefix=IMVU.optionalProperty(i,"prefix",null),this.__suffix=IMVU.optionalProperty(i,"suffix",null),this.__width=IMVU.optionalProperty(i,"width",null),this.__lineHeightMatch=IMVU.optionalProperty(i,"lineHeightMatch",!1),null!==this.__nameOverride&&(this.__showAsMe=this.__showVipBadgeTooltip=this.__showVipBadge=!1,this.__ignoreClicks=!0),"string"==typeof this.__suffix&&""!==this.__suffix&&(this.__showVipBadgeTooltip=this.__showVipBadge=!1),this.__allowClickProp=i.allowClickProp,!1===this.__ignoreClicks&&(this.__allowClickProp=!1),this.addToDOM(),this.listenTo(this.__user,"change:display_name",e.NextUtil.mirrorModelChange(".display-name-text"))},assignNameOverride:function(e){void 0!==e&&(this.__nameOverride=e),this.$(".display-name-text").text(this.__nameOverride)},assignSize:function(e){switch(void 0!==e&&(this.__size=e),this.$el.removeClass("dn-s-tiny"),this.$el.removeClass("dn-s-small"),this.$el.removeClass("dn-s-medium"),this.$el.removeClass("dn-s-large"),this.$el.removeClass("dn-s-big"),this.__size){case"tiny":case"small":case"medium":case"large":case"big":this.$el.addClass("dn-s-"+this.__size)}},assignColor:function(e){switch(void 0!==e&&(this.__color=e),this.$el.removeClass("dn-fc-white"),this.$el.removeClass("dn-fc-light-gray"),this.$el.removeClass("dn-fc-dark-gray"),this.__color){case"light":this.$el.addClass("dn-fc-white");break;case"medium":this.$el.addClass("dn-fc-light-gray");break;case"medium-dark":this.$el.addClass("dn-fc-medium-dark-gray");break;case"dark":this.$el.addClass("dn-fc-dark-gray")}},assignDisplay:function(e){switch(void 0!==e&&(this.__display=e),this.$el.removeClass("dn-d-inline"),this.$el.removeClass("dn-d-inline-block"),this.$el.removeClass("dn-d-block"),this.$el.removeClass("dn-d-flex"),this.$el.removeClass("dn-d-hidden"),this.__display){case"inline":this.$el.addClass("dn-d-inline");break;case"inline-block":this.$el.addClass("dn-d-inline-block");break;case"block":this.$el.addClass("dn-d-block");break;case"hidden":this.$el.addClass("dn-d-hidden");break;case"flex":this.$el.addClass("dn-d-flex")}},__showBadges:function(){return this.__showVipBadge},render:function(){if(this.$el.html(e.template),null!==this.__nameOverride?this.$el.html(e.template({displayName:this.__nameOverride})):this.__user.populated().then(function(){var t="";"string"==typeof this.__prefix&&""!==this.__prefix&&(t+=this.__prefix+" "),t=this.__showAsMe?t+this.__stringManager.get("You"):t+this.__user.get("display_name"),"string"==typeof this.__suffix&&""!==this.__suffix&&(t=t.trim(),t+=" "+this.__suffix),this.$el.html(e.template({displayName:t})),(t=this.__featureAccessManager.canSeeVipUpsell()&&this.__user.get("is_vip")&&this.__showVipBadge)&&(this.$(".display-name-badges").append(e.templateVipBadge),t&&this.__showVipBadgeTooltip&&(this.$(".display-name-badges").append(e.templateVipBadgeToolTip),this.__tooltip=this.createChildContext(e.Tooltip,{$replaceElement:this.$(".vip-badge-tooltip"),$tooltipTarget:this.$(".vip-badge"),title:" ",tooltipStyle:"snug",trackedEvents:[{type:"click",selector:".cta",name:"vip_badge_tooltip_click",handler:this.__vipBadgeClick.bind(this)}]})))}.bind(this)).catch(function(){this.__showErrorView&&(this.__ignoreClicks=!0,this.$el.html("...").addClass("ignore-clicks"))}.bind(this)),this.__shouldRemoveTruncate){var t=this.$(".display-name-text");t.removeClass("is-truncated"),t.addClass("wrap-it")}this.assignSize(),this.assignColor(),this.assignDisplay(),this.__showBadges()||this.$(".display-name-badges").addClass("display-name-badges-hidden")},__onClickInner:function(e){this.__ignoreClicks||(this.__isLoggedIn?this.__featureAccessManager.canSeeProfileLightbox()?this.__dialogManager.showProfileLightbox(this.__user):this.__cardManager.showUserProfileCard({user:this.__user,context:"username",activeChat:this.__activeChat,openContext:this}):(this.__window.console.log("DisplayName::__onClickInner - directing click to user perma link"),this.__modeManager.openMode({mode:{id:"profile"},submode:{id:this.__user.get("id")}})),this.__allowClickProp||e.stopPropagation())},__vipBadgeClick:function(){this.__dialogManager.showDialog(e.BuyUpgradeDialog,{})},addHovering:function(){this.$el.addClass("hovering")},removeHovering:function(){this.$el.removeClass("hovering")}})}({NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],BuyUpgradeDialog:ie,Tooltip:r,template:y,templateVipBadge:ne,templateVipBadgeToolTip:ae}),oe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<button class="btn share-button">\n    <svg class="share-on-button icon" viewBox="0 0 32 32"><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-action_share_on"></svg>\n    <svg class="share-off-button icon" viewBox="0 0 32 32"><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-action_share_off"></svg>\n</button>'},useData:!0})}(),le=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s,o=this.escapeExpression;return i=t.helperMissing,o='<div class="copy-to-clipboard">\n    <div class="share-text">\n        '+o("function"==typeof(s=t.linkToCopy||e&&e.linkToCopy)?s.call(e,{name:"linkToCopy",hash:{},data:a}):s)+'\n    </div>\n    <div class="clipboard-tooltip">\n        <button class="btn btn-primary copy-btn btn-small">\n            <span class="tooltiptext hidden"></span>\n            ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"copy",{name:"i18n-g",hash:{},data:a}))||0===n)&&(o+=n),o+"\n        </button>\n    </div>\n</div>"},useData:!0})}(),re=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("SharePanelDialog",{uiContextName:"share_panel_dialog",className:"share-panel-dialog dialog-type-B text-close",dependencies:["globalStringManager","window","linkToCopy"],trackedEvents:function(){return[{type:"click",selector:".copy-btn",name:"copy_to_clipboard",handler:this.__copyToClilpboard.bind(this)},{type:"mouseout",selector:".copy-btn",name:"mouseout_copy_to_clipboard",handler:this.__onMouseout.bind(this)}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("share"),this.addToDOM()},postRender:function(){this.setContent("body",e.template({linkToCopy:this.__linkToCopy})),this.__$tooltipText=this.$(".tooltiptext"),this.__refreshSize(),this.__selectText()},__copyToClilpboard:function(e){(e=document.createElement("input")).style="position: absolute; left: -1000px; top: -1000px",e.value=this.__linkToCopy,this.$el.append(e),e.select(),document.execCommand("copy")?this.__showTooltip(!0):this.__showTooltip(!1),e.remove()},__onMouseout:function(){this.__hideTooltip()},__showTooltip:function(e){e=e?this.__globalStringManager.get("share_widget_copy_success"):this.__globalStringManager.get("share_widget_copy_fail"),this.__$tooltipText.text(e),this.__$tooltipText.removeClass("hidden")},__hideTooltip:function(){this.__$tooltipText.addClass("hidden")},__refreshSize:function(){var e=this.$(".copy-to-clipboard").width()-this.$(".clipboard-tooltip").outerWidth(!0);this.$(".share-text").css("width",e)},__selectText:function(){this.__window.getSelection().removeAllRanges();var e=document.createRange();e.setStartBefore(this.$(".share-text")[0]),e.setEndAfter(this.$(".share-text")[0]),this.__window.getSelection().addRange(e)}})}({Dialogs:e["@Dialogs"],template:le}),de=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='<div class="share-title">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"share",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</div>\n<div class="share-text">\n    '+o("function"==typeof(s=t.linkToCopy||e&&e.linkToCopy)?s.call(e,{name:"linkToCopy",hash:{},data:a}):s)+'\n</div>\n<div class="share-icons">\n    <div class="clipboard-tooltip">\n        <button class="btn btn-primary copy-btn btn-small">\n            <span class="tooltiptext hidden"></span>\n            ',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"copy",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+"\n        </button>\n    </div>\n</div>\n"},useData:!0})}(),he=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("LayerAbovePage",{className:"layer-above-page",uiContextName:"layer_above_page",initialize:function(e){i.prototype.initialize.call(this,e),this.addToDOM()}})}(),ce=function(t){var i={UiCore:e["@UiCore"]}.UiCore.UiContext;return i.extend("LayerAboveDialog",{className:"layer-above-dialog",uiContextName:"layer_above_dialog",initialize:function(e){i.prototype.initialize.call(this,e),this.addToDOM()}})}(),_e=function(e){var t=e.UiCore.UiContext;return t.extend("SharePanel",{className:"share-panel",uiContextName:"share_panel",dependencies:["$shareButton","linkToCopy","modeManager","globalStringManager","window"],trackedEvents:function(){return[{type:"click",selector:".copy-btn",name:"copy_to_clipboard",handler:this.__copyToClilpboard.bind(this)},{type:"mouseout",selector:".copy-btn",name:"mouseout_copy_to_clipboard",handler:this.__onMouseout.bind(this)}]},initialize:function(i){t.prototype.initialize.call(this,i),this.$body=$("body"),this.__$dialog=this.__$shareButton.parents(".dialog-container"),this.__sharePanelLayerFactory=(this.__isInDialog=0<this.__$dialog.length)?e.LayerAboveDialog:e.LayerAbovePage,this.__sharePanelLayer=this.__modeManager.createChildContext(this.__sharePanelLayerFactory,{$parentElement:this.__modeManager.$el}),this.__$parentElement=this.__sharePanelLayer.$el,this.setParentUiContext(this.__sharePanelLayer),this.addToDOM()},render:function(){this.$el.html(e.template({linkToCopy:this.__linkToCopy})),this.__$tooltipText=this.$(".tooltiptext"),this.__trackSharePanel(),this.__selectText(),$(this.__window).on("scroll.socialshare",function(){this.__trackSharePanel()}.bind(this)),$(this.__window).on("resize.socialshare",function(){this.__trackSharePanel()}.bind(this)),this.$body.find(".transparent-overlay").on("scroll.socialshare",function(){this.__trackSharePanel()}.bind(this)),e.NextUtil.DomHelper.dismissible({openerEl:this.__$shareButton,dismissibleEl:this.$el,dismissHandler:this.delete.bind(this)})},delete:function(){this.trigger("delete"),$(this.__window).off("scroll.socialshare"),$(this.__window).off("resize.socialshare"),this.$body.find(".transparent-overlay").off("scroll.socialshare"),t.prototype.delete.call(this),this.__sharePanelLayer.delete()},__copyToClilpboard:function(e){(e=document.createElement("input")).style="position: absolute; left: -1000px; top: -1000px",e.value=this.__linkToCopy,this.$el.append(e),e.select(),document.execCommand("copy")?this.__showTooltip(!0):this.__showTooltip(!1),e.remove()},__onMouseout:function(){this.__hideTooltip()},__showTooltip:function(e){e=e?this.__globalStringManager.get("share_widget_copy_success"):this.__globalStringManager.get("share_widget_copy_fail"),this.__$tooltipText.text(e),this.__$tooltipText.removeClass("hidden")},__hideTooltip:function(){this.__$tooltipText.addClass("hidden")},__trackSharePanel:function(){var e=(e=this.__$shareButton[0].getBoundingClientRect().top+this.__$shareButton.outerHeight())-15,t=(t=this.__$shareButton[0].getBoundingClientRect().left)-15,i=this.$el[0].offsetWidth,a=t+i,n=this.__isInDialog?this.__$dialog[0].getBoundingClientRect().right:$(this.__window).innerWidth();a>n&&(t=n-i-20),this.$el.css({top:e,left:t})},__selectText:function(){if(void 0!==this.__window.getSelection){this.__window.getSelection().removeAllRanges();var e=document.createRange();e.setStartBefore(this.$(".share-text")[0]),e.setEndAfter(this.$(".share-text")[0]),this.__window.getSelection().addRange(e)}}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],LayerAbovePage:he,LayerAboveDialog:ce,template:de}),pe=function(e){var t=e.UiCore.UiContext;return t.extend("SocialShare",{className:"social-share",uiContextName:"social_share",dependencies:["dialogManager","platform","linkToCopy"],trackedEvents:function(){return[{type:"click",selector:"svg.share-off-button",name:"open_share_panel",handler:this.__openSharePanel.bind(this)},{type:"click",selector:"svg.share-on-button",name:"close_share_panel",handler:this.__closeSharePanel.bind(this)}]},initialize:function(e){t.prototype.initialize.call(this,e),this.addToDOM()},render:function(){this.$el.html(e.template()),this.__$shareOnButton=this.$("svg.share-on-button"),this.__$shareOffButton=this.$("svg.share-off-button"),this.__$shareButton=this.$(".share-button"),this.__toggleShareButtonState(!1)},__openSharePanel:function(){"mobile"===this.__platform?this.__sharePanel=this.__openSharePanelDialog():(this.__toggleShareButtonState(!0),this.__sharePanel||(this.__sharePanel=this.createChildContext(e.SharePanel,{$shareButton:this.__$shareButton,linkToCopy:this.__linkToCopy}),this.listenTo(this.__sharePanel,"delete",this.__onSharePanelDelete)))},__closeSharePanel:function(){this.__sharePanel.delete()},__onSharePanelDelete:function(){this.__toggleShareButtonState(!1),this.__sharePanel=null},__toggleShareButtonState:function(e){e?(this.__$shareOnButton.show(),this.__$shareOffButton.hide()):(this.__$shareOnButton.hide(),this.__$shareOffButton.show())},__openSharePanelDialog:function(){return this.__dialogManager.showDialog(e.SharePanelDialog,{linkToCopy:this.__linkToCopy})}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],SharePanel:_e,SharePanelDialog:re,template:oe}),ge=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a,n){var s,o;return i="\n    <fieldset>\n        <legend class='system-info-header'>"+(i=this.escapeExpression)("function"==typeof(o=t.title||e&&e.title)?o.call(e,{name:"title",hash:{},data:a}):o)+"</legend>\n        <div class='filter-options' data-filter='"+i("function"==typeof(o=t.name||e&&e.name)?o.call(e,{name:"name",hash:{},data:a}):o)+"' >\n\n        ",((s=t.if.call(e,e&&e.checkbox,{name:"if",hash:{},fn:this.programWithDepth(2,a,n),inverse:this.noop,data:a}))||0===s)&&(i+=s),i+="\n\n        ",((s=t.if.call(e,e&&e.toggle,{name:"if",hash:{},fn:this.program(5,a),inverse:this.noop,data:a}))||0===s)&&(i+=s),i+"\n\n        </div>\n    </fieldset>\n"},2:function(e,t,i,a,n){var s;return i="\n            ",((s=t.each.call(e,e&&e.options,{name:"each",hash:{},fn:this.programWithDepth(3,a,e,n),inverse:this.noop,data:a}))||0===s)&&(i+=s),i+"\n        "},3:function(e,t,i,a,n,s){var o,l;return"\n                <input data-value='"+(i=this.escapeExpression)("function"==typeof(l=t.value||e&&e.value)?l.call(e,{name:"value",hash:{},data:a}):l)+"' id='"+i("function"==typeof(o=s&&s.cid)?o.apply(e):o)+"-filter-"+i("function"==typeof(o=n&&n.name)?o.apply(e):o)+"-"+i("function"==typeof(l=t.value||e&&e.value)?l.call(e,{name:"value",hash:{},data:a}):l)+"' type='checkbox' class=\"checkbox\">\n                <label for='"+i("function"==typeof(o=s&&s.cid)?o.apply(e):o)+"-filter-"+i("function"==typeof(o=n&&n.name)?o.apply(e):o)+"-"+i("function"==typeof(l=t.value||e&&e.value)?l.call(e,{name:"value",hash:{},data:a}):l)+"'>"+i("function"==typeof(l=t.title||e&&e.title)?l.call(e,{name:"title",hash:{},data:a}):l)+"</label>\n            "},5:function(e,t,i,a){var n;return'\n            <div class="segmented-control-placeholder-'+(0,this.escapeExpression)("function"==typeof(n=t.name||e&&e.name)?n.call(e,{name:"name",hash:{},data:a}):n)+'"></div>\n        '},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i="<form>\n",((n=t.each.call(e,e&&e.filters,{name:"each",hash:{},fn:this.programWithDepth(1,a,e),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n\n</form>"},useData:!0})}(),ue=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n;return'\n    <li class="segmented-control-item" data-value="'+(t=this.escapeExpression)("function"==typeof(n=null==a||!1===a?a:a.key)?n.apply(e):n)+'">\n        '+t("function"==typeof e?e.apply(e):e)+"\n    </li>\n    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i='<ul class="disable-text-selection">\n    ',((n=t.each.call(e,e&&e.options,{name:"each",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n</ul>\n"},useData:!0})}(),me=function(e){var t=e.UiCore.UiContext;return t.extend("SegmentedControl",{className:"segmented-control",uiContextName:"segmented_control",dependencies:["loginManager","name","options","window"],trackedEvents:function(){return[{type:"click",selector:".segmented-control-item",name:"segmented_control_item_click",handler:this.__onClickItem.bind(this),allowBubble:!0}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__name=e.name,this.__options=e.options,this.__loginManager=e.loginManager,this.__isLoggedIn=this.__loginManager.isLoggedIn(),this.addToDOM(),this.$(".segmented-control-item").first().addClass("is-selected")},render:function(){this.$el.html(e.template({name:this.__name,options:this.__options}))},__select:function(t){if(!this.__isLoggedIn){var i=this.$(".segmented-control-item[data-value=comments] .counter .count");i.removeClass("count"),i.addClass("hidden"),(i=this.$(".segmented-control-item[data-value=likes] .counter .count")).removeClass("count"),i.addClass("hidden"),(i=this.$(".segmented-control-item[data-value=tags] .counter .count")).removeClass("count"),i.addClass("hidden")}(t=$(t)).hasClass("is-selected")||(e.NextUtil.DomHelper.radioClass(t,"is-selected"),t.trigger("change"))},__onClickItem:function(e){this.__select(e.currentTarget)},toggleOption:function(e,t){this.$(".segmented-control-item[data-value="+e+"]").prop("disabled",!t)},val:function(e){if(!e)return this.$(".segmented-control-item.is-selected").attr("data-value");this.__select(this.$(".segmented-control-item[data-value="+e+"]"))}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:ue}),ve=function(e){var t=e.UiCore.UiContext;return t.extend("SimpleFilter",{uiContextName:"simple_filter",className:"simple-filter id-filter",dependencies:["localStorage"],trackedEvents:function(){return[{type:"click",selector:".segmented-control-item",name:"toggle",handler:"__onClickToggle",attributes:function(e){return{value:e.attr("data-value")}}},{type:"change",selector:"input[type=checkbox]",name:"check",handler:"__onChangeCheckbox",attributes:function(e){return{value:e.attr("data-value")}}}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__localStorage=e.localStorage,this.__filters=e.filters,this.__storeAt=e.storeAt,this.__segmentedControls={},this.model=e.serviceProvider.create(IMVU.NamedModel,{}),this.__populateModel(),this.addToDOM()},__populateModel:function(){_.each(this.__filters,function(e){var t=this.__storeAt?this.__localStorage.getItem(this.__storageName(e.name)):null;e.checkbox&&t&&(t=t.split(",")),this.model.set(e.name,t||e.default)}.bind(this))},syncWithStorage:function(){this.__storeAt&&(this.__populateModel(),this.__refreshUI())},__refreshUI:function(){_.each(this.__filters,function(e){var t=this.model.get(e.name),i=this.$("[data-filter="+e.name+"]");_.each(e.options,function(a){var n=i.find("[data-value="+a.value+"]");e.checkbox?n.prop("checked",_.contains(t,a.value)):n.toggleClass("is-selected",t===a.value)}.bind(this))}.bind(this))},render:function(){this.$el.html(e.template({filters:this.__filters,cid:this.model.cid})),_.each(this.__filters,function(t){if(t.toggle){var i=this.$(".segmented-control-placeholder-"+t.name);if(!this.__segmentedControls[t.name]){var a=_.pluck(t.options,"value");this.__segmentedControls[t.name]=this.createChildContext(e.SegmentedControl,{$replaceElement:i,name:"",options:_.object(a,[])})}}}.bind(this)),this.__refreshUI()},__onClickToggle:function(t){t=$(t.currentTarget),e.NextUtil.DomHelper.radioClass(t,"is-selected"),this.__write(t.closest("[data-filter]").attr("data-filter"),t.data("value"))},__storageName:function(e){return this.__storeAt+"."+e},__write:function(e,t){this.model.set(e,t),this.__storeAt&&this.__localStorage.setItem(this.__storageName(e),_.isArray(t)?t.join(","):t)},__onChangeCheckbox:function(e){var t=(e=$(e.currentTarget).closest("[data-filter]")).find(":checked").map(function(){return $(this).attr("data-value")});this.__write(e.attr("data-filter"),t.get())}})}({UiCore:e["@UiCore"],NextUtil:e["@NextUtil"],template:ge,SegmentedControl:me}),fe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <fieldset>\n        <legend class="system-info-header-no-divider">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"LANGUAGE",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</legend>\n        <div class="filter-options">\n            <select class="id-language">\n                ',((n=t.each.call(e,e&&e.languageMap,{name:"each",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+"\n            </select>\n        </div>\n    </fieldset>\n    "},2:function(e,t,i,a){var n;return'\n                <option value="'+(t=this.escapeExpression)("function"==typeof(n=null==a||!1===a?a:a.key)?n.apply(e):n)+'">'+t("function"==typeof e?e.apply(e):e)+"</option>\n                "},4:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <fieldset>\n        <legend class="system-info-header-no-divider">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"OCCUPANCY",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</legend>\n        <div class="filter-options">\n            <select class="id-occupancy">\n                ',((n=t.each.call(e,e&&e.occupancyMap,{name:"each",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+"\n            </select>\n        </div>\n    </fieldset>\n    "},6:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='\n    <fieldset>\n        <legend class="system-info-header">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"GENDER",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</legend>\n        <div class="filter-options">\n            <input id=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-female\' class="checkbox id-female id-gender" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-female'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Female",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+="</label>\n            <input id='"+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-male\' class="checkbox id-male id-gender" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-male'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Male",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+"</label>\n        </div>\n    </fieldset>\n    "},8:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='\n    <fieldset>\n        <legend class="system-info-header">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"RATING",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='\n            <a class="rating-icon">',((n=(s=t.icon||e&&e.icon||i).call(e,"icon-tooltip-icon",{name:"icon",hash:{},data:a}))||0===n)&&(l+=n),l+='</a>\n        </legend>\n        <div class="filter-options">\n            <input id=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-ap\' class="checkbox id-ap" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-ap'>Access Pass</label>\n            <input id='"+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-ga\' class="checkbox id-ga" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-ga\'>General Access</label>\n        </div>\n\n        <div class="rating-tooltip">\n            <div class="tooltip-body">\n                <p>',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Rating_Tooltip_1",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</p>\n                <p class="tooltip-last-paragraph">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Rating_Tooltip_2",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='\n                    <a class="ap-tooltip-cta cta">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Rating_Tooltip_Link",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+"</a>\n                </p>\n            </div>\n        </div>\n\n    </fieldset>\n    "},10:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='\n    <fieldset>\n        <legend class="system-info-header">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"STATUS",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+'</legend>\n        <div class="filter-options">\n            <input id=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-vip\' class="checkbox id-vip" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-vip'>VIP</label>\n            <input id='"+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-age_verified\' class="checkbox id-age_verified" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-age_verified'>Age Verified</label>\n        </div>\n    </fieldset>\n    "},12:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='\n    <fieldset>\n        <legend class="system-info-header">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ONLINE",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+'</legend>\n        <div class="filter-options">\n            <input id=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-online\' class="checkbox id-online" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-online'>Online</label>\n        </div>\n    </fieldset>\n    "},14:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <fieldset>\n        <legend class="system-info-header-no-divider">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"PRICING",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</legend>\n        <div class="filter-options">\n            <select class="id-pricing">\n                ',((n=t.each.call(e,e&&e.pricingMap,{name:"each",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+"\n            </select>\n        </div>\n    </fieldset>\n    "},16:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='\n    <fieldset>\n        <legend class="system-info-header">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"PLATFORM",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</legend>\n        <div class="filter-options">\n            <input id=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-web\' class="checkbox id-web" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-web'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Web",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+="</label>\n            <input id='"+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-ios\' class="checkbox id-ios" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-ios'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"iOS",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+="</label>\n            <input id='"+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-android\' class="checkbox id-android" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-android'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Android",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+"</label>\n        </div>\n    </fieldset>\n    "},18:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='\n    <fieldset>\n        <legend class="system-info-header">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Filters",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</legend>\n        <div class="filter-options">\n            <input id=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-likes\' class="checkbox id-likes" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-likes'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Likes",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+="</label>\n            <input id='"+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-comments\' class="checkbox id-comments" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-comments'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Comments",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+="</label>\n            <input id='"+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-eci\' class="checkbox id-eci" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-eci'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Chat Invites",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+="</label>\n            ",((n=t.if.call(e,e&&e.canSeeFollow,{name:"if",hash:{},fn:this.program(19,a),inverse:this.noop,data:a}))||0===n)&&(l+=n),l+"\n        </div>\n    </fieldset>\n    "},19:function(e,t,i,a){var n,s,o=this.escapeExpression;return i=t.helperMissing,o="\n            <input id='"+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-follows\' class="checkbox id-follows" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-follows'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Follows",{name:"i18n-g",hash:{},data:a}))||0===n)&&(o+=n),o+"</label>\n            "},21:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <fieldset>\n        <legend class="system-info-header-no-divider">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Prepaid Card Value",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</legend>\n         <div class="filter-options">\n            <select class="id-prepaid_card_value">\n                ',((n=t.each.call(e,e&&e.ppcValueMap,{name:"each",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+"\n            </select>\n        </div>\n    </fieldset>\n    "},23:function(e,t,i,a){var n;i=t.helperMissing;var s='\n    <fieldset>\n        <legend class="system-info-header-no-divider">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Country",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</legend>\n        <div class="filter-options">\n            <select class="id-prepaid_card_country">\n                ',((n=t.each.call(e,e&&e.ppcCountryMap,{name:"each",hash:{},fn:this.program(2,a),inverse:this.noop,data:a}))||0===n)&&(s+=n),s+"\n            </select>\n        </div>\n    </fieldset>\n    "},25:function(e,t,i,a){var n;return i="\n        ",((n=t.if.call(e,e&&e.isAdult,{name:"if",hash:{},fn:this.program(26,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n    "},26:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='\n            <fieldset>\n                <legend class="system-info-header">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"RATING",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</legend>\n                <div class="filter-options">\n                    <input id=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-ga\' class="checkbox id-ga" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-ga'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"GA",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+="</label>\n                    <input id='"+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-ap\' class="checkbox id-ap" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-ap'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"AP",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+"</label>\n                </div>\n            </fieldset>\n        "},28:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='\n        <fieldset>\n            <legend class="system-info-header">';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"ENTRY REQUIREMENT",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</legend>\n            <div class="filter-options">\n                <input id=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-vip\' class="checkbox id-vip" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-vip'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"VIP",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+="</label>\n                <input id='"+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+'-checkbox-friends-only\' class="checkbox id-friends-only" type="checkbox"><label for=\''+o("function"==typeof(s=t.uniqueFilterId||e&&e.uniqueFilterId)?s.call(e,{name:"uniqueFilterId",hash:{},data:a}):s)+"-checkbox-friends-only'>",((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"friends_only",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+"</label>\n            </div>\n        </fieldset>\n    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i='<form class="id-filter">\n    ',((n=t.if.call(e,e&&e.language,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n    ",((n=t.if.call(e,e&&e.occupancy,{name:"if",hash:{},fn:this.program(4,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n    ",((n=t.if.call(e,e&&e.gender,{name:"if",hash:{},fn:this.program(6,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.ap_ga,{name:"if",hash:{},fn:this.program(8,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.special_user_status,{name:"if",hash:{},fn:this.program(10,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.online_status,{name:"if",hash:{},fn:this.program(12,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.pricing,{name:"if",hash:{},fn:this.program(14,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.platform,{name:"if",hash:{},fn:this.program(16,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.activities,{name:"if",hash:{},fn:this.program(18,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.prepaid_card_value,{name:"if",hash:{},fn:this.program(21,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.prepaid_card_country,{name:"if",hash:{},fn:this.program(23,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.rating,{name:"if",hash:{},fn:this.program(25,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+="\n\n    ",((n=t.if.call(e,e&&e.entry_requirement,{name:"if",hash:{},fn:this.program(28,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"\n\n</form>\n"},useData:!0})}(),ye=function(e){var t=e.UiCore.UiContext,i=0,a=function(e){return-1<_.indexOf(["checkbox","radio"],e.prop("type"))},n=function(e,t){this.model.set(e,a($(t.target))?!!$(t.target).prop("checked"):$(t.target).val())};return t.extend("FilterWidget",{uiContextName:"filter_widget",className:"filter-widget filter-widget",dependencies:["featureAccessManager","globalStringManager","loginManager","window"],initialize:function(a){this.template=a.template||e.template,a.prefix&&(this.uiContextName=a.prefix+"_"+this.uiContextName,this.className=a.prefix+"-"+this.className),this.__window=a.window,this.__filterList=a.filterList,this.__forceApGa=a.forceApGa||!1,this.__uniqueFilterId="filter"+i++,this.__loginManager=a.loginManager,this.__globalStringManager=a.globalStringManager,this.__isAdult=a.isAdult?1:0,this.model=a.model||a.serviceProvider.create(e.Model.FilterModel,a.filterList,{}),this.listenTo(this.model.disabledFilters,"change",this.SetInputsToReflectModel.bind(this)),t.prototype.initialize.call(this,a),this.__loginManager.isLoggedIn()?(this.__myself=this.__loginManager.getCurrentUser(),this.__myself.populated().then(function(){this.__postInit()}.bind(this))):this.__postInit()},__postInit:function(){this.addToDOM(),this.SetInputsToReflectModel()},trackedEvents:function(){return _.map(_.keys(this.model.attributes),function(e){return{type:"change",handler:$.proxy(n,this,e),selector:".id-"+e,name:this.uiContextName+"_filter_set_"+e,attributes:function(e){var t={};return"select"===e[0].tagName.toLowerCase()?t.value=e.val():e.attr("type")&&"checkbox"===e.attr("type").toLowerCase()&&(t.value=!!e.prop("checked")),t}.bind(this)}}.bind(this))},clearInputs:function(){this.$("input").prop("checked",!1)},SetInputsToReflectModel:function(){var e=this.model.toJSON();_.each(e,function(e,t){if(0===t.indexOf("disabled."))return this.$(".id-"+t.replace("disabled.","")).prop("disabled",e);var i=this.$(".id-"+t).not("div");a(i)?i.prop("checked",e):i.val(e).trigger("change")}.bind(this))},validFilters:function(){return _.filter(this.__filterList,function(e){return"ap_ga"!==e||!!this.__myself.get("is_adult")&&!(!this.__forceApGa&&!this.__myself.get("is_ap"))}.bind(this))},__translateStrings:function(e){var t={};return _.each(e,function(e,i){for(var a=e.split(" "),n=0;n<a.length;n++)a[n]=Number(a[n])?a[n]:this.__globalStringManager.get(a[n]);t[i]=a.join(" ")}.bind(this)),t},render:function(){var t=this.validFilters(),i=this.__translateStrings(e.PricingMap);this.$el.html(this.template(_.extend({isAdult:this.__isAdult,languageMap:e.LanguageMap,occupancyMap:e.OccupancyMap,pricingMap:i,uniqueFilterId:this.__uniqueFilterId,ppcValueMap:e.PPCValueMap,ppcCountryMap:e.PPCCountryMap,pricingHeader:"system-info-header-no-divider",canSeeFollow:this.__featureAccessManager.canSeeFollowUnfollow()},_.object(t,t)))),this.$("select").each(function(t,i){this.createChildContext(e.Dropdown,{$replaceElement:$(i)})}.bind(this)),this.__tooltip=this.createChildContext(e.Tooltip,{$replaceElement:this.$(".rating-tooltip"),$tooltipTarget:this.$(".rating-icon"),trackedEvents:[{type:"click",selector:".cta",name:"rating_tooltip",handler:this.__onTooltipClick.bind(this)}]})},__onTooltipClick:function(e){e.stopPropagation(),this.__window.open("https://www.imvu.com/catalog/web_info.php?topic=virtual_goods_policy","_blank")}})}({UiCore:e["@UiCore"],template:fe,Model:e["@Model"],LanguageMap:e["json!/common/js/JSON/LanguageMap.json"],OccupancyMap:e["json!/common/js/JSON/RoomsOccupancy.json"],PricingMap:e["json!/common/js/JSON/ProductPricing.json"],PPCValueMap:e["json!/common/js/JSON/PPCValue.json"],PPCCountryMap:e["json!/common/js/JSON/PPCCountries.json"],Dropdown:T,Tooltip:r}),be=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<div class="dual-name-icon"></div><div class="dual-name-names"></div>'},useData:!0})}(),Ce=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(e,t,i,a){var n;return'\n            <div class="number-actor-mask"></div>\n            <div class="number-actor">'+(0,this.escapeExpression)("function"==typeof(n=t.numberOfActor||e&&e.numberOfActor)?n.call(e,{name:"numberOfActor",hash:{},data:a}):n)+"</div>\n    "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;i=this.escapeExpression;var o='<a class="profile-icon-image">\n    <img src="/common/withme/img/loading_avatar.png">\n    ';return((n=t.if.call(e,e&&e.isMultipleActor,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(o+=n),o+'\n</a>\n<div class="online-status '+i("function"==typeof(s=t.showOnline||e&&e.showOnline)?s.call(e,{name:"showOnline",hash:{},data:a}):s)+'"></div>'},useData:!0})}(),we=function(e){var t=e.UiCore.UiContext;return t.extend("ProfileIcon",{className:"profile-icon new-profile-icon",uiContextName:"profile_icon",tagName:"a",dependencies:"cardManager dialogManager featureAccessManager imageManager loginManager modeManager user window".split(" "),trackedEvents:function(){return[{type:"click",selector:"",name:"profile_icon_click",handler:this.__onClick.bind(this),allowBubble:!0}]},initialize:function(e){t.prototype.initialize.call(this,e),this.__window=e.window,this.__modeManager=e.modeManager,this.__feedType=e.feedType,this.__serviceProvider=e.serviceProvider,this.__imageManager=e.imageManager,this.__cardManager=e.cardManager,this.__loginManager=e.loginManager,this.__user=e.user,this.__openContext=e.openContext,this.__isLoggedIn=this.__loginManager.isLoggedIn(),this.__activeChat=IMVU.optionalProperty(e,"activeChat",null),this.__ignoreClicks=void 0!==e.ignoreClicks?!!e.ignoreClicks:!this.__loginManager.isLoggedIn(),this.__showErrorView=!!e.showErrorView,this.__numberOfActor=IMVU.optionalProperty(e,"numberOfActor",1),this.__useLargeProfile=IMVU.optionalProperty(e,"useLargeProfile",!1),e.ignoreClicks&&this.$el.addClass("ignore-clicks"),this.__useLargeProfile&&this.$el.addClass("large-profile"),this.addToDOM(),this.__isMe=!1,this.listenTo(this.__user,"change:thumbnail_url",this.__refreshThumbnailUrl),this.listenTo(this.__user,"change:online",this.__refreshOnline)},render:function(){this.$el.html(e.template({showOnline:this.__user.get("online")&&1==this.__numberOfActor?"is-online":"",numberOfActor:this.__numberOfActor,isMultipleActor:1<this.__numberOfActor})),this.__user.populated().then(function(){this.__loginManager.isLoggedIn()&&(this.__isMe=this.__user.id===this.__loginManager.getCurrentUser().id)&&this.__user.on("change:availability",this.__refreshOnlineOnMyAvailability,this);var e=void 0===this.__user.get("username")?"":this.__user.get("username").replace("Guest_","");this.$el.attr("title",e),this.__refreshThumbnailUrl(),this.__refreshOnline()}.bind(this)).catch(function(){this.__showErrorView&&(this.__ignoreClicks=!0,this.$el.html("...").addClass("ignore-clicks"))}.bind(this))},__refreshOnline:function(){1==this.__numberOfActor&&(this.__isMe?this.$(".online-status").toggleClass("is-online",!!this.__user.get("online")&&!0===this.__userShowOnlineIndicator()):this.$(".online-status").toggleClass("is-online",!!this.__user.get("online")))},__onClick:function(e){this.__ignoreClicks||(this.__isLoggedIn?this.__featureAccessManager.canSeeProfileLightbox()?this.__dialogManager.showProfileLightbox(this.__user):this.__cardManager.showUserProfileCard({user:this.__user,context:"username",activeChat:this.__activeChat,openContext:this}):(this.__window.console.log("ProfileIcon::__onClick - directing click to user perma link"),this.__modeManager.openMode({mode:{id:"profile"},submode:{id:this.__user.get("id")}})),e.stopPropagation())},__refreshThumbnailUrl:function(){this.__imageManager.load(this.$("img"),this.__user.get("thumbnail_url"),{})},__refreshOnlineOnMyAvailability:function(){1==this.__numberOfActor&&(this.__user.get("online")&&!0===this.__userShowOnlineIndicator()&&this.$(".online-status").toggleClass("is-online",!0),!1===this.__userShowOnlineIndicator()&&this.$(".online-status").toggleClass("is-online",!1))},__userShowOnlineIndicator:function(){return"DoNotDisturb"!==this.__user.get("availability")&&("Available"===this.__user.get("availability")||""===this.__user.get("availability")||void 0)}})}({UiCore:e["@UiCore"],template:Ce}),xe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return'<span class="display-name-wrap-text">'+(0,this.escapeExpression)("function"==typeof(n=t.displayName||e&&e.displayName)?n.call(e,{name:"displayName",hash:{},data:a}):n)+'</span><div class="vip-badge"></div>'},useData:!0})}(),Me=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="vip-badge-tooltip tooltip-header"><a class="vip-badge-tooltip-cta cta">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"VIP Member",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</a></div>"},useData:!0})}(),ke=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<svg class="badge-image" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">\n    <g fill="none" fill-rule="evenodd">\n        <ellipse fill="#DEB359" cx="9" cy="9" rx="9" ry="9"/>\n        <path d="M14.87 7.303a.723.723 0 1 0-1.247.497l-2.027 1.992a.138.138 0 0 1-.222-.042L9.407 5.283a.72.72 0 0 0-.39-1.33.723.723 0 0 0-.394 1.33L6.656 9.75a.138.138 0 0 1-.222.042L4.39 7.784a.72.72 0 0 0-.537-1.204.72.72 0 1 0-.073 1.44c.114.95.633 5.27.646 5.286.18.414 2.163.74 4.59.74 2.426 0 4.41-.326 4.59-.74.01-.017.53-4.346.644-5.29a.72.72 0 0 0 .62-.713" fill="#FFF"/>\n    </g>\n</svg>'},useData:!0})}(),$e=function(e){var t=e.UiCore.UiContext;return t.extend("DisplayNameWrap",{className:"display-name-wrap enable-text-selection",uiContextName:"display_name_wrap",dependencies:"cardManager dialogManager featureAccessManager globalStringManager loginManager user".split(" "),trackedEvents:function(){return[{type:"click",selector:".display-name-wrap-text",name:"display_name_wrap_text_click",handler:this.__onClickText.bind(this),allowBubble:!0}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__serviceProvider=i.serviceProvider,this.__stringManager=i.globalStringManager,this.__user=this.track(i.user),this.__cardManager=i.cardManager,this.__loginManager=i.loginManager,this.__showErrorView=!!i.showErrorView,(this.__ignoreClicks=i.ignoreClicks||!this.__loginManager.isLoggedIn())&&this.$el.addClass("ignore-clicks"),this.__showVipBadge=IMVU.optionalProperty(i,"showVipBadge",!0),this.__showVipBadgeTooltip=IMVU.optionalProperty(i,"showVipBadgeTooltip",!0),this.__showVipBadge||(this.__showVipBadgeTooltip=!1),this.__showVipBadgeTooltip&&(this.__showVipBadge=!0),this.__showAsMe=IMVU.optionalProperty(i,"showAsMe",!1),this.__size=IMVU.optionalProperty(i,"size","small"),this.__color=IMVU.optionalProperty(i,"color","dark"),this.__marginTop=IMVU.optionalProperty(i,"marginTop",null),this.__marginLeft=IMVU.optionalProperty(i,"marginLeft",null),this.__nameOverride=IMVU.optionalProperty(i,"nameOverride",null),this.__width=IMVU.optionalProperty(i,"width",null),null!==this.__nameOverride&&(this.__showAsMe=this.__showVipBadgeTooltip=this.__showVipBadge=!1,this.__ignoreClicks=!0),this.addToDOM(),this.listenTo(this.__user,"change:display_name",e.NextUtil.mirrorModelChange(".display-name-wrap-text"))},assignSize:function(e){switch(void 0!==e&&(this.__size=e),this.$el.removeClass("dnw-s-tiny"),this.$el.removeClass("dnw-s-small"),this.$el.removeClass("dnw-s-medium"),this.$el.removeClass("dnw-s-large"),this.$el.removeClass("dnw-s-big"),this.__size){case"tiny":case"small":case"medium":case"large":case"big":this.$el.addClass("dnw-s-"+this.__size)}},assignColor:function(e){switch(void 0!==e&&(this.__color=e),this.$el.removeClass("dnw-fc-white"),this.$el.removeClass("dnw-fc-light-gray"),this.$el.removeClass("dnw-fc-dark-gray"),this.__color){case"light":this.$el.addClass("dnw-fc-white");break;case"medium":this.$el.addClass("dnw-fc-light-gray");break;case"dark":this.$el.addClass("dnw-fc-dark-gray")}},assignDisplay:function(e){},render:function(){this.$el.html(e.template),null!==this.__nameOverride?this.$el.html(e.template({displayName:this.__nameOverride})):this.__user.populated().then(function(){this.__showAsMe?this.$el.html(e.template({displayName:this.__stringManager.get("You")})):this.$el.html(e.template({displayName:this.__user.get("display_name")}));var t=this.__featureAccessManager.canSeeVipUpsell()&&this.__user.get("is_vip")&&this.__showVipBadge;t&&(this.$(".vip-badge").append(e.templateVipBadge),t&&this.__showVipBadgeTooltip&&(this.$(".vip-badge").append(e.templateVipBadgeToolTip),this.__tooltip=this.createChildContext(e.Tooltip,{$replaceElement:this.$(".vip-badge-tooltip"),$tooltipTarget:this.$(".vip-badge"),title:" ",tooltipStyle:"snug",trackedEvents:[{type:"click",selector:".cta",name:"vip_badge_tooltip_click",handler:this.__vipBadgeClick.bind(this)}]})))}.bind(this)).catch(function(){this.__showErrorView&&(this.__ignoreClicks=!0,this.$el.html("...").addClass("ignore-clicks"))}.bind(this)),this.assignSize(),this.assignColor(),this.__showVipBadge||this.$(".vip-badge").addClass("vip-badge-hidden")},__onClickText:function(e){this.__ignoreClicks||(this.__featureAccessManager.canSeeProfileLightbox()?this.__dialogManager.showProfileLightbox(this.__user):(this.__cardManager.showUserProfileCard({user:this.__user,context:"username",activeChat:this.__activeChat,openContext:this}),e.stopPropagation()))},__vipBadgeClick:function(){this.__dialogManager.closeAll(),this.__dialogManager.showDialog(e.BuyUpgradeDialog,{})}})}({NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],Tooltip:r,template:xe,templateVipBadge:ke,templateVipBadgeToolTip:Me}),Ie=function(e){var t=e.UiCore.UiContext;return t.extend("DualName",{className:"dual-name enable-text-selection",uiContextName:"dual_name",dependencies:"cardManager dialogManager featureAccessManager globalStringManager loginManager modeManager user window".split(" "),trackedEvents:function(){return[{type:"click",selector:".dual-name",name:"dual_name_click",handler:this.__onClickWidget.bind(this),allowBubble:!0},{type:"click",selector:".dual-name-icon",name:"dual_name_icon_click",handler:this.__onClickWidget.bind(this),allowBubble:!0},{type:"click",selector:".dual-name-names",name:"dual_name_names_click",handler:this.__onClickWidget.bind(this),allowBubble:!0}]},setConfiguration:function(e){switch(void 0!==e&&(this.__configuration=e),this.__configuration){case"large-dual-lightbg":this.__hideIcon=!1,this._size="medium",this.__orient="horizontal",this.__hideDisplay=!1,$.extend(this.__displayArgs,{size:"medium",color:"dark"}),this.__hideAtAvatar=!1,$.extend(this.__atAvatarArgs,{size:"small",color:"medium"});break;case"large-dual-darkbg":this.__hideIcon=!1,this._size="medium",this.__orient="horizontal",this.__hideDisplay=!1,$.extend(this.__displayArgs,{size:"medium",color:"light"}),this.__hideAtAvatar=!1,$.extend(this.__atAvatarArgs,{size:"small",color:"medium"});break;case"large-single-lightbg":this.__hideIcon=!1,this.__size="medium",this.__orient="horizontal",this.__hideDisplay=!1,$.extend(this.__displayArgs,{size:"small",color:"dark"}),this.__hideAtAvatar=!0;break;case"large-single-darkbg":this.__hideIcon=!1,this.__size="medium",this.__orient="horizontal",this.__hideDisplay=!1,$.extend(this.__displayArgs,{size:"small",color:"light"}),this.__hideAtAvatar=!0;break;case"small-dual-lightbg":this.__hideIcon=!1,this.__size="small",this.__orient="horizontal",this.__hideDisplay=!1,$.extend(this.__displayArgs,{size:"small",color:"dark"}),this.__hideAtAvatar=!1,$.extend(this.__atAvatarArgs,{size:"small",color:"medium"});break;case"small-dual-darkbg":this.__hideIcon=!1,this.__size="small",this.__orient="horizontal",this.__hideDisplay=!1,$.extend(this.__displayArgs,{size:"small",color:"light"}),this.__hideAtAvatar=!1,$.extend(this.__atAvatarArgs,{size:"small",color:"medium"});break;case"small-single-lightbg":this.__hideIcon=!1,this.__size="small",this.__orient="horizontal",this.__hideDisplay=!1,$.extend(this.__displayArgs,{size:"small",color:"dark"}),this.__hideAtAvatar=!0;break;case"small-single-darkbg":this.__hideIcon=!1,this.__size="small",this.__orient="horizontal",this.__hideDisplay=!1,$.extend(this.__displayArgs,{size:"small",color:"light"}),this.__hideAtAvatar=!0;break;case"small-noicon-darkbg":this.__hideIcon=!0,this.__size="small",this.__orient="horizontal",this.__hideDisplay=!1,$.extend(this.__displayArgs,{size:"small",color:"light"}),this.__hideAtAvatar=!0;break;case"small-single-split-darkbg":this.__hideIcon=!1,this.__size="small",this.__orient="vertical",this.__hideDisplay=!1,$.extend(this.__displayArgs,{size:"small",color:"light"}),this.__hideAtAvatar=!0}},setParameters:function(e){this.__size=IMVU.optionalProperty(e,"size","medium"),this.__orient=IMVU.optionalProperty(e,"orientation","horizontal"),this.__hoverOn=IMVU.optionalProperty(e,"hoverOn",!1),this.__displayArgs=IMVU.optionalProperty(e,"displayArgs",{}),this.__atAvatarArgs=IMVU.optionalProperty(e,"atAvatarArgs",{}),this.__hideIcon=IMVU.optionalProperty(e,"hideIcon",!1),this.__hideDisplay=IMVU.optionalProperty(e,"hideDisplay",!1),this.__hideAtAvatar=IMVU.optionalProperty(e,"hideAtAvatar",!1),this.setConfiguration(IMVU.optionalProperty(e,"configuration",null)),this.__hideDisplay&&this.__hideAtAvatar&&(this.__hideAtAvatar=this.__hideDisplay=!1),"vertical"==this.__orient&&(this.__hideIcon=!1)},initialize:function(e){t.prototype.initialize.call(this,e),this.__window=e.window,this.__modeManager=e.modeManager,this.__serviceProvider=e.serviceProvider,this.__stringManager=e.globalStringManager,this.__featureAccessManager=e.featureAccessManager,this.__user=this.track(e.user),this.__cardManager=e.cardManager,this.__loginManager=e.loginManager,this.__showErrorView=!!e.showErrorView,this.__ignoreClicks=void 0!==e.ignoreClicks?!!e.ignoreClicks:!this.__loginManager.isLoggedIn(),this.__shouldRemoveTruncate=IMVU.optionalProperty(e,"shouldRemoveTruncate",!1),this.__shouldWrap=IMVU.optionalProperty(e,"shouldWrap",!1),this.__isLoggedIn=this.__loginManager.isLoggedIn(),this.__ignoreClicks&&this.$el.addClass("ignore-clicks"),this.__shouldRemoveTruncate&&(this.__shouldWrap=!1),this.setParameters(e),this.addToDOM()},assignSize:function(e){switch(void 0!==e&&(this.__size=e),this.$el.removeClass("dln-s-tiny"),this.$el.removeClass("dln-s-small"),this.$el.removeClass("dln-s-medium"),this.$el.removeClass("dln-s-large"),this.$el.removeClass("dln-s-big"),this.__size){case"tiny":case"small":case"medium":case"large":case"big":this.$el.addClass("dln-s-"+this.__size)}},assignOrientation:function(e){switch(void 0!==e&&(this.__orient=e),this.$el.removeClass("dln-o-horiz"),this.$el.removeClass("dln-o-vert"),this.__orient){case"horizontal":this.$el.addClass("dln-o-horiz");break;case"vertical":this.$el.addClass("dln-o-vert")}},positionNameWidgets:function(){"vertical"==this.__orient?this.__hideDisplay||this.__hideAtAvatar||(this.$(".display-name").hasClass("display-name-spacer")?this.$(".display-name").removeClass("display-name-spacer"):this.$(".display-name").addClass("display-name-spacer")):this.__hideIcon&&this.$(".dual-name-names").css({"padding-top":"0","padding-bottom":"0"})},assignHideIcon:function(e){void 0!==e&&(this.__hideIcon=!!e),this.__hideIcon?this.$el.hasClass("dual-name-icon-hidden")||this.$el.addClass("dual-name-icon-hidden"):this.$el.removeClass("dual-name-icon-hidden")},assignHideDisplay:function(e){void 0!==e&&(this.__hideDisplay=!!e),void 0!==this.__displayName&&this.__displayName.assignDisplay(this.__hideDisplay?"hidden":"flex")},assignHideAtAvatar:function(e){void 0!==e&&(this.__hideAtAvatar=!!e),void 0!==this.__atAvatarName&&this.__atAvatarName.assignDisplay(this.__hideAtAvatar?"hidden":"flex")},drawIt:function(){this.__displayName&&(this.__displayName.assignSize(this.__displayArgs.size),this.__displayName.assignColor(this.__displayArgs.color)),this.__atAvatarName&&(this.__atAvatarName.assignSize(this.__atAvatarArgs.size),this.__atAvatarName.assignColor(this.__atAvatarArgs.color)),this.assignSize(),this.assignOrientation(),this.positionNameWidgets(),this.assignHideIcon(),this.assignHideDisplay(),this.assignHideAtAvatar()},render:function(){this.$el.html(e.template),this.__user.populated().then(function(){this.$el.html(e.template);var t=this.__ignoreClicks?{ignoreClicks:!0}:{};if(!this.__hideIcon){var i={$parentElement:this.$(".dual-name-icon"),user:this.__user,modeManager:this.__modeManager};$.extend(i,t),this.__profileIcon=this.createChildContext(e.ProfileIcon,i)}i={$parentElement:this.$(".dual-name-names"),user:this.__user,display:"flex",modeManager:this.__modeManager},$.extend(i,t),$.extend(this.__displayArgs,i),$.extend(this.__atAvatarArgs,i),this.__shouldWrap?this.__displayName=this.createChildContext(e.DisplayNameWrap,this.__displayArgs):($.extend(this.__displayArgs,{shouldRemoveTruncate:this.__shouldRemoveTruncate}),this.__displayName=this.createChildContext(e.DisplayName,this.__displayArgs)),this.__atAvatarName=this.createChildContext(e.AtAvatarName,this.__atAvatarArgs),this.drawIt()}.bind(this)).catch(function(){this.__showErrorView&&(this.__ignoreClicks=!0,this.$el.html("...").addClass("ignore-clicks"))}.bind(this))},getDisplayName:function(){return this.__displayName},__onClickWidget:function(e){this.__ignoreClicks||(this.__isLoggedIn?this.__featureAccessManager.canSeeProfileLightbox()?this.__dialogManager.showProfileLightbox(this.__user):this.__cardManager.showUserProfileCard({user:this.__user,context:"username",activeChat:this.__activeChat,openContext:this}):this.__modeManager.openMode({mode:{id:"profile"},submode:{id:this.__user.get("id")}}),e.stopPropagation())},onMouseover:function(e){this.__hoverOn&&(void 0!==this.__displayName&&this.__displayName.addHovering(),void 0!==this.__atAvatarName&&this.__displayName.addHovering())},onMouseleave:function(e){this.__hoverOn&&(void 0!==this.__displayName&&this.__displayName.removeHovering(),void 0!==this.__atAvatarName&&this.__displayName.removeHovering())}})}({NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],AtAvatarName:m,DisplayName:se,DisplayNameWrap:$e,ProfileIcon:we,template:be}),Te=(e["@UiCore"],a).extend("ChatDrawerTimestamp",{className:"timestamp-widget chat-drawer-timestamp system-info-drawer",uiContextName:"chat_drawer_timestamp",render:function(){this.$el.text(this.__timestampHelper.chatDrawerTimestamp())}}),Pe=function(e){var t=function(e,t,i,a,n){if("string"!=typeof e)throw"Composables must have a name";this.name=e,this.dependencies=t,this.mustImplement=i,this.obj=a,this.api=n};return t.compose=function(e,i){if(this===t)throw"Cannot compose base composable";e.mustImplement&&_.each(e.mustImplement,function(t){if("function"!=typeof this.prototype[t])throw Error("Composable: "+e.name+" requires that "+t+" be implemented")}.bind(this)),e.dependencies&&(this.prototype.hasOwnProperty("dependencies")||(this.prototype.dependencies=[]),this.prototype.dependencies.push.apply(this.prototype.dependencies,e.dependencies));var a=i||e.api;return a&&_.each(a,function(t){this.prototype[t]=function(){return e.obj[t].apply(this,arguments)}}.bind(this)),this.prototype.hasOwnProperty("composables")||(this.prototype.composables=[]),this.prototype.composables.push(e),this},t}((e["@UiCore"],e["@NextUtil"])),Se=function(e){var t=e.UiCore.UiContext,i=function(){var e=function(e){e.preventDefault()};return function(){this.$el.on(_.map(arguments,function(e,t){return t+"."+e}.bind(this,this._listenerId)).join(" "),e)}}();return function(){var e=function(e){e.stopPropagation()}}(),t.extend("WithmeContext",{"static compose":e.Composable.compose,"static preventScroll":function(){return window.jQueryScrollbarOptions&&window.jQueryScrollbarOptions.disableBodyScroll&&(this.prototype.initialize=_.wrap(this.prototype.initialize,function(e,t){e.call(this,t),i.call(this,"wheel","mousewheel","MozMousePixelScroll")})),this},dependencies:["timer"],initialize:function(e){(function(){for(var e=this,i=function(e){this["__"+e.name]=e}.bind(this);e&&e.constructor!==t;)e.hasOwnProperty.composables&&_.each(e.composables,i),e=Object.getPrototypeOf(e)}).call(this),t.prototype.initialize.call(this,e)},__recoverFromLoadError:function(e,t,i){this.__loadFailureTimeout=this.__timer.setTimeout(this.__recoverFromLoadFail.bind(this,e,t,i,0),5e3)},__recoverFromLoadFail:function(e,t,i,a){e.invalidate(),e.populated().then(function(){t()}.bind(this)).catch(function(){i();var n=a&&0<a?15===a?45:180<=a?180:2*a:15;window.console.log("Waiting "+n+" seconds to reload"),this.__loadFailureTimeout=this.__timer.setTimeout(this.__recoverFromLoadFail.bind(this,e,t,i,n),1e3*n)}.bind(this))},delete:function(){this.$el.off("."+this._listenerId),this.__loadFailureTimeout&&this.__timer.clearTimeout(this.__loadFailureTimeout),t.prototype.delete.call(this)}})}({UiCore:e["@UiCore"],Composable:Pe}),Ee=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return'<div class="header">\n    <span class="date">'+(i=this.escapeExpression)("function"==typeof(n=t.dateText||e&&e.dateText)?n.call(e,{name:"dateText",hash:{},data:a}):n)+'</span>\n    <span class="time">'+i("function"==typeof(n=t.timeText||e&&e.timeText)?n.call(e,{name:"timeText",hash:{},data:a}):n)+"</span>\n</div>\n\n"},useData:!0})}(),Ue=function(e){return e.Timestamp.extend("MessageHeaderTimestamp",{className:"timestamp-widget message-header-timestamp",uiContextName:"message_header_timestamp",render:function(){this.$el.html(e.template({dateText:this.__timestampHelper.messageHeaderDay(),timeText:this.__timestampHelper.formatTime()}))}})}({UiCore:e["@UiCore"],Timestamp:a,template:Ee}),De=void($.event.special.destroyed={remove:function(e){e.handler&&e.handler.apply(this,arguments)}}),Ae=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return" square "},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i='<div class="thumbnail-wrap">\n    <div class="thumbnail ',((n=t.if.call(e,e&&e.useSquareThumbnail,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+'"></div>\n</div>\n<div class="text">\n    <div class="line-1 text-line"></div>\n    <div class="line-2 text-line"></div>\n    <div class="line-3 text-line"></div>\n    <div class="line-4 text-line"></div>\n</div>\n'},useData:!0})}(),Ne=function(e){var t=e.UiCore.UiContext;return t.extend("LoadingPlaceholderListItem",{uiContextName:"loading_placeholder_list_item",className:"loading-placeholder-list-item",tagName:"li",initialize:function(e){t.prototype.initialize.call(this,e),this.__useSquareThumbnail=IMVU.optionalProperty(e,"useSquareThumbnail",!1),this.addToDOM()},render:function(){t.prototype.render.call(this),this.$el.html(e.template({useSquareThumbnail:this.__useSquareThumbnail}))}})}({UiCore:e["@UiCore"],template:Ae}),Ve=function(e){var t=e.UiCore.UiContext;return t.extend("LoadingPlaceholderList",{uiContextName:"loading_placeholder_list",tagName:"ul",className:"loading-placeholder-list",itemCount:6,initialize:function(e){t.prototype.initialize.call(this,e),this.__useSquareThumbnail=IMVU.optionalProperty(e,"useSquareThumbnail",!1),this.itemCount=IMVU.optionalProperty(e,"itemCount",6),this.addToDOM()},render:function(){t.prototype.render.call(this),_(this.itemCount).times(function(){this.createChildContext(e.LoadingPlaceholderListItem,{$parentElement:this.$el,useSquareThumbnail:this.__useSquareThumbnail})}.bind(this))}})}({UiCore:e["@UiCore"],LoadingPlaceholderListItem:Ne}),Oe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(){return'<span class="following-txt">Following</span><span class="follow-txt">Follow</span>'},useData:!0})}(),Le=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return'<div class="icon-container"></div>\r\n<div class="unfollow-txt">Unfollow '+(0,this.escapeExpression)("function"==typeof(n=t.userName||e&&e.userName)?n.call(e,{name:"userName",hash:{},data:a}):n)+"?</div>"},useData:!0})}(),ze=function(e){var t=e.Dialogs.AlloyConfirmDialog;return t.extend("unfollowDialog",{uiContextName:"unfollow_dialog",className:"unfollow-dialog",dependencies:["globalStringManager","modeManager"],initialize:function(i){this.hasCloseButton=!1,this.__stringManager=i.globalStringManager,this.__profile=i.profile,i.yes=this.__stringManager.get("Unfollow"),i.no=this.__stringManager.get("Cancel"),this.__profile.populated().then(function(){i.html=e.template({userName:this.__profile.attributes.avatar_name})}.bind(this)),t.prototype.initialize.call(this,i)},postRender:function(){t.prototype.postRender.call(this),this.__profileIcon=this.createChildContext(e.ProfileIcon,{$parentElement:this.$(".icon-container"),user:this.__profile.getSingleEdge("restgraph_entity"),modeManager:this.__modeManager})}})}({UiCore:e["@UiCore"],Model:e["@Model"],Dialogs:e["@Dialogs"],ProfileIcon:we,template:Le}),Fe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n,s;i=t.helperMissing;var o=this.escapeExpression,l='<form name="login_form" method="GET" action="#" class="login">\n    <div class="label login_avatarname label-first" data-holder="';return((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='">\n        <input type="text" tabindex="1" name="avatarname" placeholder=\'',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='\'  autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" value="'+o("function"==typeof(s=t.username||e&&e.username)?s.call(e,{name:"username",hash:{},data:a}):s)+'" />\n    </div>\n    <div class="label login_password label-second" data-holder="',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='">\n        <div style="position:relative">\n            <input tabindex="1" type="password" name="password" placeholder=\'',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='\'/>\n            <div class="toggle-password-visibility icon icon-password-show"></div>\n        </div>\n    </div>\n\n    <div class="label label-forgot">\n        <a class="forgot-password-link" href="/next/forgotpassword">'+o("function"==typeof(s=t.passwordHolderContent||e&&e.passwordHolderContent)?s.call(e,{name:"passwordHolderContent",hash:{},data:a}):s)+'</a>\n    </div>\n    <div class="label label-log-in">\n        <button class="btn btn-primary" >',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_signin_button",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</button>\n    </div>\n    <div class="label label-or">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_or",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</div>\n    <div class="label label-fb">\n        <a class="btn btn-fb id-fb">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_frontpage_fb_cta",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</a>\n    </div>\n\n    <div class="label signup">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_no_account",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='&nbsp;<a class="id-signup">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"welcome_dialog_signup",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</a></div>\n    <div class="label need-help">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_need_help",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='<a data-external href="https://help.imvu.com/">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_help_center",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</a></div>\n\n    <p class="app-store-buttons text-spacing">\n        <a data-external href="https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8" class="ios-button" target="_blank">\n            <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon-app-store" viewBox="0 0 135 40">\n                <title>Available on the App Store</title>\n                <path fill="#A6A6A6" d="M130.197 40H4.73C2.12 40 0 37.872 0 35.267V4.727C0 2.12 2.122 0 4.73 0h125.467C132.803 0 135 2.12 135 4.726v30.54c0 2.606-2.197 4.734-4.803 4.734z"/><path d="M134.032 35.268c0 2.116-1.714 3.83-3.834 3.83H4.728c-2.118 0-3.838-1.714-3.838-3.83V4.725C.89 2.61 2.61.89 4.73.89h125.467c2.12 0 3.834 1.72 3.834 3.835l.01 30.543z"/><path d="M30.128 19.784c-.03-3.223 2.64-4.79 2.76-4.864-1.51-2.203-3.852-2.504-4.675-2.528-1.967-.207-3.875 1.177-4.877 1.177-1.022 0-2.565-1.16-4.228-1.13-2.14.03-4.142 1.27-5.24 3.19-2.266 3.92-.576 9.69 1.595 12.86 1.086 1.55 2.355 3.28 4.016 3.22 1.62-.07 2.23-1.04 4.19-1.04 1.94 0 2.51 1.03 4.2.99 1.74-.03 2.84-1.56 3.89-3.13 1.25-1.78 1.76-3.53 1.78-3.62-.04-.01-3.39-1.29-3.42-5.15zm-3.2-9.478c.874-1.093 1.472-2.58 1.306-4.09-1.265.057-2.847.876-3.758 1.945-.806.95-1.526 2.49-1.34 3.94 1.42.11 2.88-.71 3.792-1.79zm26.717 21.198h-2.27l-1.245-3.91h-4.324l-1.185 3.91h-2.21l4.29-13.308h2.65l4.31 13.308zm-3.89-5.55L48.63 22.48c-.12-.355-.342-1.19-.67-2.507h-.04c-.132.566-.343 1.402-.633 2.507l-1.105 3.475h3.573zm14.907.634c0 1.632-.44 2.922-1.323 3.87-.79.842-1.78 1.263-2.95 1.263-1.27 0-2.17-.45-2.73-1.36h-.04v5.06H55.5V25.07c0-1.026-.027-2.08-.08-3.16h1.876l.12 1.522h.04c.71-1.15 1.79-1.72 3.237-1.72 1.132 0 2.077.447 2.833 1.34.758.898 1.136 2.076 1.136 3.537zm-2.172.078c0-.934-.21-1.704-.632-2.31-.46-.632-1.08-.948-1.856-.948-.526 0-1.004.176-1.43.523-.43.35-.71.81-.84 1.38-.066.27-.1.48-.1.65v1.6c0 .7.215 1.29.643 1.77s.984.72 1.668.72c.803 0 1.428-.31 1.875-.92.448-.62.672-1.43.672-2.45zm13.21-.078c0 1.632-.442 2.922-1.325 3.87-.79.842-1.77 1.263-2.94 1.263-1.265 0-2.173-.45-2.725-1.36h-.04v5.06h-2.132V25.07c0-1.026-.027-2.08-.08-3.16h1.876l.12 1.522h.04c.71-1.15 1.788-1.72 3.237-1.72 1.14 0 2.08.447 2.84 1.34.76.898 1.14 2.076 1.14 3.537zm-2.173.078c0-.934-.21-1.704-.633-2.31-.46-.632-1.078-.948-1.855-.948-.53 0-1.01.176-1.44.523-.43.35-.71.81-.84 1.38-.07.27-.1.48-.1.65v1.6c0 .7.21 1.29.64 1.77.43.48.98.72 1.67.72.8 0 1.43-.31 1.87-.92.45-.62.67-1.43.67-2.45zm14.513 1.106c0 1.132-.394 2.053-1.183 2.764-.867.777-2.074 1.165-3.625 1.165-1.432 0-2.58-.27-3.45-.82l.495-1.77c.936.57 1.963.85 3.082.85.8 0 1.42-.18 1.87-.54.44-.36.67-.84.67-1.45 0-.54-.19-.99-.56-1.36-.37-.37-.98-.71-1.84-1.03-2.33-.87-3.5-2.14-3.5-3.81 0-1.09.41-1.99 1.22-2.69.81-.69 1.9-1.04 3.26-1.04 1.21 0 2.21.21 3.02.63l-.54 1.74c-.75-.41-1.6-.61-2.55-.61-.75 0-1.34.18-1.76.55-.36.33-.54.73-.54 1.21 0 .53.2.96.61 1.31.35.32 1 .66 1.94 1.03 1.14.46 1.98 1 2.53 1.62.54.62.81 1.39.81 2.31zm7.048-4.264h-2.35v4.66c0 1.184.414 1.776 1.244 1.776.38 0 .697-.033.947-.1l.05 1.62c-.42.157-.98.236-1.66.236-.85 0-1.5-.257-1.98-.77-.48-.514-.71-1.376-.71-2.587v-4.837h-1.4v-1.6h1.4V20.15l2.09-.633v2.39h2.35v1.6zm10.602 3.12c0 1.474-.42 2.685-1.263 3.632-.883.975-2.055 1.46-3.516 1.46-1.4 0-2.52-.466-3.36-1.4s-1.25-2.113-1.25-3.534c0-1.487.43-2.705 1.3-3.652.86-.948 2.03-1.422 3.49-1.422 1.41 0 2.54.467 3.4 1.402.82.907 1.23 2.078 1.23 3.513zm-2.21.07c0-.887-.19-1.646-.573-2.28-.447-.766-1.086-1.15-1.914-1.15-.857 0-1.508.385-1.955 1.15-.383.634-.572 1.405-.572 2.317 0 .885.19 1.644.572 2.276.46.77 1.105 1.15 1.936 1.15.814 0 1.453-.39 1.914-1.17.393-.64.59-1.41.59-2.29zm9.14-2.915c-.21-.04-.435-.06-.67-.06-.75 0-1.33.284-1.74.85-.354.5-.532 1.133-.532 1.896v5.03h-2.13l.02-6.58c0-1.11-.028-2.12-.08-3.02h1.856l.078 1.83h.06c.224-.63.58-1.14 1.065-1.52.475-.35.988-.52 1.54-.52.198 0 .376.01.534.04v2.03zm9.536 2.47c0 .38-.025.703-.078.966h-6.396c.025.94.334 1.67.928 2.17.54.44 1.236.67 2.092.67.947 0 1.81-.15 2.588-.46l.334 1.48c-.908.39-1.98.59-3.217.59-1.488 0-2.656-.44-3.506-1.32-.84-.88-1.27-2.05-1.27-3.53 0-1.45.4-2.65 1.19-3.62.83-1.03 1.95-1.54 3.36-1.54 1.39 0 2.43.51 3.14 1.54.57.81.85 1.82.85 3.02zm-2.033-.554c.014-.64-.125-1.18-.414-1.64-.37-.6-.94-.89-1.7-.89-.7 0-1.27.29-1.7.87-.36.46-.57 1.01-.63 1.65h4.44zM49.05 10.01c0 1.176-.353 2.062-1.058 2.657-.653.55-1.58.824-2.783.824-.6 0-1.11-.02-1.54-.07V6.99c.55-.09 1.15-.138 1.8-.138 1.14 0 2.01.25 2.59.747.65.56.98 1.36.98 2.41zm-1.105.028c0-.763-.202-1.348-.606-1.756-.41-.407-1-.61-1.78-.61-.33 0-.61.02-.85.067v4.88c.13.02.36.03.71.03.8 0 1.42-.23 1.85-.67s.65-1.1.65-1.95zm6.965 1c0 .724-.208 1.32-.622 1.784-.434.48-1.01.718-1.727.718-.69 0-1.24-.23-1.65-.69-.41-.458-.61-1.037-.61-1.735 0-.73.21-1.33.64-1.794s1-.69 1.71-.69c.69 0 1.25.23 1.67.69.4.45.6 1.03.6 1.73zm-1.088.033c0-.43-.094-.8-.28-1.11-.22-.37-.534-.56-.94-.56-.422 0-.742.19-.962.57-.188.31-.28.69-.28 1.14 0 .44.093.81.28 1.12.227.38.543.57.95.57.4 0 .715-.19.94-.57.195-.31.292-.69.292-1.13zm8.943-2.35l-1.475 4.72h-.96l-.61-2.04c-.156-.51-.282-1.02-.38-1.52h-.02c-.09.52-.216 1.03-.378 1.53l-.65 2.05h-.97l-1.387-4.72h1.077l.533 2.24c.13.53.235 1.04.32 1.52h.02c.077-.39.206-.89.388-1.5l.67-2.25h.853l.64 2.21c.156.54.282 1.05.38 1.55h.028c.07-.48.178-1 .32-1.55l.572-2.2h1.03zm5.433 4.72H67.15v-2.7c0-.83-.316-1.25-.95-1.25-.31 0-.562.12-.757.35-.193.23-.29.5-.29.81v2.8h-1.05v-3.37c0-.41-.012-.86-.037-1.35h.92l.05.74h.03c.12-.23.303-.42.542-.57.284-.17.602-.26.95-.26.44 0 .806.15 1.097.43.362.35.543.87.543 1.56v2.83zm2.89 0H70.04V6.56h1.048v6.877zm6.17-2.39c0 .73-.207 1.32-.62 1.79-.435.48-1.01.72-1.728.72-.693 0-1.244-.23-1.654-.69-.41-.45-.615-1.03-.615-1.73 0-.73.22-1.33.64-1.79s1-.7 1.71-.7c.7 0 1.25.23 1.67.69.4.45.6 1.02.6 1.73zm-1.088.04c0-.43-.094-.8-.28-1.11-.22-.37-.534-.56-.94-.56-.422 0-.742.19-.96.57-.19.31-.282.69-.282 1.14 0 .44.094.81.28 1.12.228.38.544.57.952.57.4 0 .713-.19.94-.57.194-.32.29-.694.29-1.13zm6.16 2.37h-.94l-.08-.54h-.028c-.322.43-.78.65-1.377.65-.445 0-.805-.14-1.076-.43-.25-.26-.37-.58-.37-.96 0-.57.24-1.01.72-1.32.48-.3 1.16-.45 2.03-.44v-.09c0-.62-.33-.93-.98-.93-.47 0-.88.12-1.23.35l-.22-.69c.44-.27.98-.4 1.61-.4 1.23 0 1.85.65 1.85 1.95v1.74c0 .47.02.85.07 1.12zm-1.088-1.62v-.73c-1.156-.02-1.734.3-1.734.95 0 .25.066.43.2.55.136.12.308.19.513.19.23 0 .45-.07.65-.22.2-.14.32-.33.37-.56.01-.05.02-.11.02-.18zm7.043 1.62h-.93l-.05-.75h-.028c-.297.58-.803.86-1.514.86-.568 0-1.04-.22-1.416-.67s-.562-1.02-.562-1.73c0-.76.203-1.38.61-1.85.396-.44.88-.66 1.456-.66.64 0 1.08.22 1.33.64h.02V6.56h1.05v5.608c0 .46.01.882.04 1.27zm-1.085-2v-.78c0-.14-.01-.25-.03-.33-.06-.25-.186-.46-.38-.63-.194-.17-.43-.25-.7-.25-.39 0-.697.15-.922.46-.223.31-.336.71-.336 1.19 0 .47.107.85.322 1.14.227.31.533.47.916.47.344 0 .62-.13.828-.39.202-.24.3-.52.3-.86zm10.048-.41c0 .73-.207 1.32-.62 1.79-.435.48-1.01.72-1.728.72-.69 0-1.242-.23-1.654-.69-.41-.45-.615-1.03-.615-1.73 0-.73.22-1.33.64-1.79s1-.69 1.72-.69c.69 0 1.25.23 1.67.69.4.45.6 1.02.6 1.73zm-1.086.04c0-.43-.094-.8-.28-1.11-.222-.37-.534-.56-.942-.56-.42 0-.74.19-.96.56-.19.31-.282.69-.282 1.14 0 .44.094.81.28 1.12.228.38.544.57.952.57.4 0 .715-.19.94-.57.194-.316.292-.692.292-1.13zm6.72 2.37h-1.046v-2.7c0-.83-.316-1.25-.95-1.25-.312 0-.563.12-.757.35s-.3.5-.3.81v2.8h-1.05V10.1c0-.417-.01-.866-.04-1.35h.92l.05.735h.03c.12-.23.3-.416.54-.57.28-.173.6-.262.95-.262.44 0 .8.145 1.1.43.36.35.54.87.54 1.57v2.82zm7.054-3.93h-1.154v2.29c0 .59.205.88.61.88.19 0 .345-.01.468-.05l.027.8c-.207.07-.48.11-.814.11-.414 0-.736-.13-.97-.38-.233-.25-.35-.68-.35-1.27v-2.4h-.688v-.79h.69v-.86l1.026-.31v1.17h1.16v.79zm5.548 3.93h-1.05v-2.68c0-.84-.315-1.27-.948-1.27-.486 0-.818.25-1 .74-.03.1-.05.23-.05.38v2.84h-1.046v-6.9h1.047V9.4h.02c.33-.517.803-.775 1.416-.775.434 0 .793.142 1.078.427.36.35.54.88.54 1.58v2.8zm5.723-2.58c0 .19-.014.35-.04.48h-3.142c.014.47.164.82.455 1.07.266.22.61.33 1.03.33.464 0 .888-.07 1.27-.22l.164.73c-.447.2-.973.29-1.582.29-.73 0-1.305-.21-1.72-.64-.42-.43-.626-1.01-.626-1.73 0-.71.193-1.3.582-1.77.406-.5.955-.75 1.648-.75.678 0 1.193.256 1.54.76.282.4.42.9.42 1.488zm-1-.27c.008-.31-.06-.58-.203-.8-.182-.29-.46-.43-.834-.43-.342 0-.62.15-.834.43-.174.23-.277.5-.31.82h2.18z" fill="#FFF"/>\n            </svg>\n        </a>\n        <a data-external href="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova" class="last android-button" target="_blank">\n            <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon-google-play" viewBox="0 0 135 40">\n                <title>Get it on Google Play</title>\n                <defs><linearGradient id="a" x1="21.8" y1="418.71" x2="5.02" y2="435.49" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#00a0ff"/><stop offset=".01" stop-color="#00a1ff"/><stop offset=".26" stop-color="#00beff"/><stop offset=".51" stop-color="#00d2ff"/><stop offset=".76" stop-color="#00dfff"/><stop offset="1" stop-color="#00e3ff"/></linearGradient><linearGradient id="b" x1="33.83" y1="430" x2="9.64" y2="430" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ffe000"/><stop offset=".41" stop-color="#ffbd00"/><stop offset=".78" stop-color="orange"/><stop offset="1" stop-color="#ff9c00"/></linearGradient><linearGradient id="c" x1="24.83" y1="432.3" x2="2.07" y2="455.05" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ff3a44"/><stop offset="1" stop-color="#c31162"/></linearGradient><linearGradient id="d" x1="7.3" y1="410.18" x2="17.46" y2="420.34" gradientTransform="translate(0 -410)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#32a071"/><stop offset=".07" stop-color="#2da771"/><stop offset=".48" stop-color="#15cf74"/><stop offset=".8" stop-color="#06e775"/><stop offset="1" stop-color="#00f076"/></linearGradient></defs>\n                <rect width="135" height="40" rx="5" ry="5"/><path d="M130 .8a4.2 4.2 0 0 1 4.2 4.2v30a4.2 4.2 0 0 1-4.2 4.2H5A4.2 4.2 0 0 1 .8 35V5A4.2 4.2 0 0 1 5 .8h125m0-.8H5a5 5 0 0 0-5 5v30a5 5 0 0 0 5 5h125a5 5 0 0 0 5-5V5a5 5 0 0 0-5-5z" fill="#a6a6a6"/><path d="M47.42 10.24a2.71 2.71 0 0 1-.75 2 2.91 2.91 0 0 1-2.2.89 3.15 3.15 0 0 1-2.21-5.37 3 3 0 0 1 2.21-.9 3.1 3.1 0 0 1 1.23.25 2.47 2.47 0 0 1 .94.67l-.53.53a2 2 0 0 0-1.64-.71 2.32 2.32 0 0 0-2.33 2.31V10a2.36 2.36 0 0 0 4 1.73 1.89 1.89 0 0 0 .5-1.22h-2.17v-.72h2.91a2.54 2.54 0 0 1 .04.45zM52 7.74h-2.7v1.9h2.46v.72H49.3v1.9H52V13h-3.5V7H52v.74zM55.28 13h-.77V7.74h-1.68V7H57v.74h-1.72V13zm4.66 0V7h.77v6h-.77zm4.19 0h-.77V7.74h-1.68V7h4.12v.74h-1.67V13zm9.48-.78a3.12 3.12 0 0 1-4.4 0 3.24 3.24 0 0 1 0-4.45 3.1 3.1 0 0 1 4.38 0 3.23 3.23 0 0 1 .02 4.45zm-3.83-.5a2.31 2.31 0 0 0 3.26 0 2.56 2.56 0 0 0 0-3.44 2.31 2.31 0 0 0-3.26 0 2.56 2.56 0 0 0 0 3.44zm5.8 1.28V7h.94l2.92 4.67V7h.76v6h-.8l-3.05-4.89V13h-.77z" fill="#fff" stroke="#fff" stroke-miterlimit="10" stroke-width=".2"/><path d="M68.14 21.75A4.25 4.25 0 1 0 72.41 26a4.19 4.19 0 0 0-4.13-4.25h-.14zm0 6.83a2.58 2.58 0 1 1 2.39-2.75V26a2.46 2.46 0 0 1-2.34 2.58h-.05zm-9.31-6.83A4.25 4.25 0 1 0 63.09 26 4.19 4.19 0 0 0 59 21.75h-.17zm0 6.83a2.58 2.58 0 1 1 2.38-2.76V26a2.46 2.46 0 0 1-2.34 2.58h-.04zm-11.09-5.52v1.8h4.32a3.77 3.77 0 0 1-1 2.27 4.42 4.42 0 0 1-3.33 1.32 4.8 4.8 0 0 1 0-9.6A4.6 4.6 0 0 1 51 20.14l1.27-1.27A6.29 6.29 0 0 0 47.74 17a6.61 6.61 0 1 0-.51 13.21h.51a5.84 5.84 0 0 0 6.17-6.07 5.87 5.87 0 0 0-.1-1.13h-6.07v.05zm45.31 1.4a3.92 3.92 0 0 0-7.65 1.28V26a4.16 4.16 0 0 0 4.07 4.25h.15a4.23 4.23 0 0 0 3.54-1.88l-1.45-1a2.43 2.43 0 0 1-2.09 1.18 2.16 2.16 0 0 1-2.06-1.29l5.69-2.35zm-5.8 1.42a2.33 2.33 0 0 1 2.17-2.48 1.65 1.65 0 0 1 1.58.9zM82.63 30h1.87V17.5h-1.87V30zm-3.06-7.3h-.07a3 3 0 0 0-2.24-1 4.26 4.26 0 0 0 0 8.51 2.9 2.9 0 0 0 2.24-1h.06v.69c0 1.63-.87 2.5-2.27 2.5a2.35 2.35 0 0 1-2.14-1.51l-1.63.68a4.05 4.05 0 0 0 3.77 2.51c2.19 0 4-1.29 4-4.43V22h-1.72v.7zm-2.14 5.88a2.59 2.59 0 0 1 0-5.16 2.4 2.4 0 0 1 2.27 2.52V26a2.38 2.38 0 0 1-2.17 2.57h-.1zm24.38-11.08h-4.47V30h1.87v-4.74h2.61a3.89 3.89 0 1 0-.01-7.76zm0 6H99.2v-4.26h2.65a2.14 2.14 0 0 1 0 4.28zm11.53-1.8a3.5 3.5 0 0 0-3.34 1.91l1.66.69a1.77 1.77 0 0 1 1.7-.92 1.8 1.8 0 0 1 2 1.58v.16a4.13 4.13 0 0 0-1.95-.48c-1.79 0-3.6 1-3.6 2.81a2.89 2.89 0 0 0 3 2.75h.08a2.63 2.63 0 0 0 2.4-1.2h.06v1h1.8v-4.81c0-2.19-1.66-3.46-3.79-3.46zm-.23 6.85a1.3 1.3 0 0 1-1.46-1.06c0-1 1.06-1.33 2-1.33a3.32 3.32 0 0 1 1.7.42 2.26 2.26 0 0 1-2.19 2zM123.74 22l-2.14 5.42h-.06L119.32 22h-2l3.33 7.58-1.9 4.21h1.95L125.82 22h-2.08zm-16.81 8h1.87V17.5h-1.87V30z" fill="#fff"/><path d="M10.44 7.54a2 2 0 0 0-.44 1.4v22.12a2 2 0 0 0 .46 1.4l.07.07L22.9 20.15v-.3L10.51 7.47z" fill="url(#a)"/><path d="M27 24.28l-4.1-4.13v-.3l4.1-4.13h.09L32 18.56c1.4.79 1.4 2.09 0 2.89l-4.89 2.78z" fill="url(#b)"/><path d="M27.12 24.22L22.9 20 10.44 32.46a1.63 1.63 0 0 0 2.08.06l14.61-8.3" fill="url(#c)"/><path d="M27.12 15.78l-14.61-8.3a1.63 1.63 0 0 0-2.08.06L22.9 20z" fill="url(#d)"/><path d="M27 24.13l-14.49 8.25a1.67 1.67 0 0 1-2 0l-.07.07.07.07a1.66 1.66 0 0 0 2 0l14.61-8.3z" style="isolation:isolate" opacity=".2"/><path d="M10.44 32.32a2 2 0 0 1-.46-1.4v.15a2 2 0 0 0 .46 1.4l.07-.07zM32 21.3l-5 2.83.09.09L32 21.44A1.75 1.75 0 0 0 33 20a1.86 1.86 0 0 1-1 1.3z" style="isolation:isolate" opacity=".12"/><path d="M12.51 7.62L32 18.7a1.86 1.86 0 0 1 1 1.3 1.75 1.75 0 0 0-1-1.44L12.51 7.48C11.11 6.69 10 7.35 10 8.95v.15c0-1.61 1.12-2.27 2.51-1.48z" style="isolation:isolate" fill="#fff" opacity=".25"/>\n            </svg>\n        </a>\n    </p>\n    <label class="submit">\n        <div class="error-message-container">\n            <div class="error-message try-again-later">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_try_again_later_error",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</div>\n            <div class="error-message credentials">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_credentials_error",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</div>\n            <div class="error-message disabled">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_disabled_error",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+='</div>\n            <div class="error-message unknown">',((n=(s=t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"login_dialog_unknown_login_error",{name:"i18n-g",hash:{},data:a}))||0===n)&&(l+=n),l+"</div>\n        </div>\n    </label>\n</form>\n"},useData:!0})}(),He=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="content">\n    <div class="privacy-policy-minors-body">';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_dialog_body",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n    <div class="privacy-policy-minors-form">\n        <div class="privacy-policy-minors-form-title">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_dialog_form_title",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n        <div class="fieldset">\n            <label>',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Name",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</label>\n            <input type="text" class="privacy-policy-minors-avatarname full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"your name",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</label>\n            <input type="text" class="privacy-policy-minors-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"email address",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="<span> (",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_email_note",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+=')</span></label>\n            <input type="text" class="privacy-policy-minors-email full-width"></input>\n            <div class="input-error"></div>\n        </div>\n        <div class="fieldset">\n            <label>',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_name",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_email",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-email full-width"></input>\n            <div class="input-note">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_email_note",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</div>\n            <div class="input-error"></div>\n        </div>\n    </div>\n    <div class="privacy-policy-link"><a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_privacy_policy",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</a></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary minors-guardian-form-submit full-width disabled">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"submit",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</button>\n<\/script>"},useData:!0})}(),Be={validateEmail:function(e){return/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(e)}},Re=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s="<div>\n    <p>";return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_dialog_body_1",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</p>\n    <p>",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_minors_guardian_dialog_body_2",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</p>\n</div>\n<div class="privacy-policy-link"><a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_privacy_policy",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</a></div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary ok full-width">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"OK",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</button>\n<\/script>"},useData:!0})}(),qe=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyMinorsGuardianDialog",{uiContextName:"privacy_policy_minors_guardian_dialog",className:"privacy-policy-minors-guardian-dialog dialog-type-B",dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_minors_okay",handler:"__onClose"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("privacy_policy_minors_guardian_dialog_title"),this.addToDOM()},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text())}})}({Dialogs:e["@Dialogs"],template:Re}),je=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyMinorsDialog",{uiContextName:"privacy_policy_minors_dialog",className:"privacy-policy-minors-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","rest"],trackedEvents:function(){return[{type:"keyup",selector:"input.privacy-policy-minors-avatarname",name:"change_avatarname",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-name",name:"change_username",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-email",name:"change_email",handler:"__validateMinorsEmail"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-name",name:"change_guardian_name",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-email",name:"change_guardian_email",handler:"__validateGuardiansEmail"},{type:"click",selector:"button",name:"submit_privacy_policy_minors_form",handler:"__submit"}]},initialize:function(i){t.prototype.initialize.call(this,i),this.__GUARDIAN_VERIFICATION_URL=this.__serviceProvider.get("root")+"/guardian_verification",this.title=this.__globalStringManager.get("privacy_policy_minors_dialog_title"),this.__formValidator=e.FormValidator,this.addToDOM(),this.$(".dialog-x").remove(),this.__hasError=!1},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text()),this.$(".content").scrollbar()},__toggleButton:function(){var e=!1;this.$("input").each(function(t){$(this).val()||(e=!0)});var t=this.__minorsEmailError||this.__guardiansEmailError;this.$(".minors-guardian-form-submit").toggleClass("disabled",e||t)},__validateMinorsEmail:function(e){this.__minorsEmailError=!1;var t=$(e.currentTarget);(e=t.siblings(".input-error")).text(""),null!==(t=this.__validateEmail(t.val()))&&(this.__minorsEmailError=!0,e.text(t)),this.__toggleButton()},__validateGuardiansEmail:function(e){this.__guardiansEmailError=!1,(e=$(e.currentTarget)).siblings(".input-note").toggleClass("hidden",!1);var t=e.siblings(".input-error");t.text("");var i=this.__validateEmail(e.val());null===i&&this.$("input.privacy-policy-minors-email").val()===this.$("input.privacy-policy-minors-guardian-email").val()&&(i=this.__globalStringManager.get("privacy_policy_minors_guardian_email_note")),null!==i&&(this.__guardiansEmailError=!0,t.text(i),e.siblings(".input-note").toggleClass("hidden",!0)),this.__toggleButton()},__validateEmail:function(e){return e?this.__formValidator.validateEmail(e)?null:this.__globalStringManager.get("error_message_email_invalide_format"):this.__globalStringManager.get("error_message_email_empty")},__submit:function(t){this.__rest.post(this.__GUARDIAN_VERIFICATION_URL,{avatarname:this.$("input.privacy-policy-minors-avatarname").val(),user_name:this.$("input.privacy-policy-minors-name").val(),user_email:this.$("input.privacy-policy-minors-email").val(),guardian_name:this.$("input.privacy-policy-minors-guardian-name").val(),guardian_email:this.$("input.privacy-policy-minors-guardian-email").val()}).then(function(e){}),this.__onClose(t),this.__dialogManager.showDialog(e.PrivacyPolicyMinorsGuardianDialog)}})}({Dialogs:e["@Dialogs"],PrivacyPolicyMinorsGuardianDialog:qe,FormValidator:Be,template:He}),We={mixin:function(e){_.isArray(e)||(e=[].slice.call(arguments));var t=e[0],i=[],a=[];return _.each(e,function(e){if(e.initialize&&i.push(e.initialize),e.trackedEvents&&a.push(e.trackedEvents),e!==t){var n=t.dependencies||[];_.each(e.dependencies,function(e){-1===_.indexOf(n,e)&&n.push(e)}),_.extend(t,e,{dependencies:n})}}),i.length&&(t.initialize=1<i.length?function(){for(var e=Array.prototype.slice.call(arguments),t=i.length;0<t--;)i[t].apply(this,e)}:i[0]),a.length&&(t.trackedEvents=1<a.length?function(){for(var e=Array.prototype.slice.call(arguments),t=[],i=a.length;0<i--;)t=t.concat(a[i].apply(this,e));return t}:a[0]),t}},Ge=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({1:function(){return"show-label"},3:function(e,t,i,a){var n,s;return(n="function"==typeof(s=t.defaultLabel||e&&e.defaultLabel)?s.call(e,{name:"defaultLabel",hash:{},data:a}):s)||0===n?n:""},5:function(){return"&nbsp"},7:function(e,t,i,a){var n,s;return(n="function"==typeof(s=t.content||e&&e.content)?s.call(e,{name:"content",hash:{},data:a}):s)||0===n?n:""},compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;return i='<div class="holder-label">\n    <div class="info ',((n=t.if.call(e,e&&e.defaultLabel,{name:"if",hash:{},fn:this.program(1,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+='">',((n=t.if.call(e,e&&e.defaultLabel,{name:"if",hash:{},fn:this.program(3,a),inverse:this.program(5,a),data:a}))||0===n)&&(i+=n),i+='</div>\n    <div class="content">',((n=t.if.call(e,e&&e.content,{name:"if",hash:{},fn:this.program(7,a),inverse:this.noop,data:a}))||0===n)&&(i+=n),i+"</div>\n</div>\n"},useData:!0})}(),Ye=function(e){return Handlebars.registerPartial("InputMixinHolderLabel",e.HolderLabelTemplate),{dependencies:[],trackedEvents:function(){return[{type:"focus",selector:".label[data-holder] input",name:"focus_input",handler:"__onHolderInputFocus"},{type:"blur",selector:".label[data-holder] input",name:"blur_input",handler:"__onHolderInputBlur"}]},initialize:function(){var e;this.render=(e=this.render,function(){e.apply(this,arguments),this.__insertLabelTemplate(this.$(".label[data-holder]"))})},__insertLabelTemplate:function(t){(t=(t instanceof $?t:this.$(t)).not(":has(>.holder-label)")).prepend(e.HolderLabelTemplate()),t.filter("[data-dropdown]").each(function(e,t){this.__setInputLabelMsg(t,$(t).attr("data-holder"))}.bind(this))},__onHolderInputFocus:function(e){(e=$(e.currentTarget)).attr("placeholder",""),e=e.closest(".label[data-holder]").removeClass("error"),this.__insertLabelTemplate(e),e.find(">.holder-label >.info").html(e.attr("data-holder")).addClass("show-label")},__onHolderInputBlur:function(e){if(!(e=$(e.currentTarget)).val()){var t=e.closest(".label[data-holder]");e.attr("placeholder",t.attr("data-holder")),t.hasClass("error")||t.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label")}},__clearError:function(e){var t=(e=$(e).closest(".label[data-holder]").removeClass("error")).find("input");!t[0]||t.val()?this.__setInputLabelMsg(e,e.attr("data-holder")):(t.attr("placeholder",e.attr("data-holder")),e.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label"))},__setInputLabelMsg:function(e,t){var i=e instanceof $?e:this.$(e);i.find(">.holder-label >.info").html(t).toggleClass("show-label",!!i.attr("data-holder")||i.hasClass("error"))},__setInputErrorLabelMsg:function(e,t){this.__setInputLabelMsg(this.$(e).addClass("error"),t)}}}({UiCore:e["@UiCore"],HolderLabelTemplate:Ge}),Xe=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="copy-body">\n    ';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_pending_guardian_approval_1",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="\n    ",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_pending_guardian_approval_2",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="\n    ",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_pending_guardian_approval_3",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n    <a href="https://help.imvu.com" target="_blank">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"Help Center",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='.</a></div>\n</div>\n<div class="privacy-policy-link"><a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"view_privacy_policy",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='</a></div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary full-width">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"close pending policy",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+"</button>\n<\/script>\n\n"},useData:!0})}(),Je=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyMinorsPendingDialog",{uiContextName:"privacy_policy_minors_pending_dialog",className:"privacy-policy-minors-pending-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("privacy_pending_guardian_approval_title"),this.addToDOM(),this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",e.template,{}),this.setContent("footer",this.$(".dialog-footer-template").text())},__onClose:function(e){t.prototype.__onClose.call(this,e)}})}({Dialogs:e["@Dialogs"],Tooltip:r,template:Xe}),Ke=function(){var e=Handlebars.template;return Handlebars.templates=Handlebars.templates||{},e({compiler:[5,">= 2.0.0"],main:function(e,t,i,a){var n;i=t.helperMissing;var s='<div class="copy-body">\n    ';return((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_1",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n    <a href="#" class="tooltip-target">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_2",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</a>\n    ",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_3",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n    <a href="https://www.imvu.com/catalog/web_info.php?topic=privacy">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_4",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="</a>\n    ",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_5",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+="\n    <br>\n    ",((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"privacy_policy_adult_dialog_body_6",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+='\n\n    <div class="accept-button">\n        <button class="btn btn-primary accept-cookies">',((n=(t["i18n-g"]||e&&e["i18n-g"]||i).call(e,"accept all cookies",{name:"i18n-g",hash:{},data:a}))||0===n)&&(s+=n),s+'</button>\n    </div> \n</div>\n\n\n<div class="tooltip-content cookie-tooltip">\n    <div class="tooltip-body">\n        To give you the best possible experience, personalize content and ads, this site uses Cookies. Continuing to use the site you agree we may place these cookies on your device. You can view our Privacy Policy for more details.\n\n        <div class="tooltip-header">Strictly Necessary Cookies:</div>\n            <div>These cookies are necessary for the website to function and cannot be switched off in our systems. </div>\n            <ul>\n                <li>prefer_alloy - Used to determine if you see IMVU Next or Core.</li>\n                <li>alloy_landing_cookie - Used to determine if you see IMVU Next or Core.</li>\n                <li>in_ux - Assigned to a "unique user" experiment.</li>\n                <li>osCsid - Session cookie; required for login to function.</li>\n            </ul>\n        <div class="tooltip-header">Performance Cookies:</div>\n            <div>These cookies allow us to count visits and traffic sources, so we can measure and improve the performance of our site. They help us know which pages are the most and least popular and see how visitors move around the site.</div>\n            <ul>\n                <li>browser_session - Tracks statistics about your IMVU session.</li>\n                <li>window_session - Tracks statistics about a specific IMVU window.</li>\n                <li>Targeting Cookies</li>\n                <li>These cookies are set through our site by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant ads on other sites. They work by uniquely identifying your browser and device.</li>\n                <li>login_interstitial_seen - tracks the last time you saw an interstitial, for aggregate analytics purposes.</li>\n                <li>sncd - Tracks CIDs you have logged into, for detecting if a new account is an alt.</li>\n                <li>nunu - Tracks if we believe you are a new new user.</li>\n                <li>preLogID - Used to connect incoming users with their subsequent login or registration.</li>\n                <li>imvua - Tracks which acquisition partner you came from.</li>\n                <li>datetime_entered - Tracks when you first landed on our site.</li>\n                <li>linkshare_site_id - If acquired through a specific partner, tracks which ad you followed.</li>\n                <li>lpip - Stores the IP you hit a landing page with.</li>\n            </ul>\n        <div class="tooltip-header">Presentation Cookies:</div>\n            <div>These cookies are set to help enhance your experience and for example, allow us to show you IMVU in the language of your choice.</div>\n            <ul>\n                <li>imvu_avnm - stores your avatarname for display purposes.</li>\n                <li>saved_locale - stores which language you prefer to see IMVU in.</li>\n            </ul>\n        <div class="tooltip-header">Third Party Partners:</div>\n            <div>We also have third party partners who may set cookies including this list below:</div>\n            <ul>\n                <li>Amazon</li>\n                <li>Doubleverify</li>\n                <li>Facebook</li>\n                <li>Google</li>\n                <li>Peanutlabs</li>\n                <li>Revenue Universe</li>\n                <li>AppNexus</li>\n                <li>Google Analytics</li>\n                <li>Threat Metrix</li>​\n            </ul>\n    </div>\n</div>'},useData:!0})}(),Ze=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("PrivacyPolicyAdultDialog",{uiContextName:"privacy_policy_adult_dialog",className:"privacy-policy-adult-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(e){t.prototype.initialize.call(this,e),this.title=this.__globalStringManager.get("privacy_policy_adult_dialog_title"),this.addToDOM(),this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",e.template,{}),this.tooltip=this.createChildContext(e.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".tooltip-target")}),this.tooltip.$el.addClass("tooltip-wide")},__onClose:function(e){this.__cookieManager.set("accepted_all_cookies",!0),t.prototype.__onClose.call(this,e)}})}({Dialogs:e["@Dialogs"],Tooltip:r,template:Ke}),Qe=function(e){var t=e.Dialogs.AlloyModalDialog;return t.extend("LoginDialog",e.Mixin.mixin({uiContextName:"login_dialog",className:"login-dialog dialog-type-B-flexible",dependencies:"cookieManager dialogManager globalStringManager googleAnalytics leanplum loginManager modeManager restModelFactory window".split(" "),trackedEvents:function(){return[{type:"submit",selector:"form.login",name:"login",handler:"__onLogin"},{type:"click",selector:".id-signup",name:"signup",handler:"__onClickSignup"},{type:"click",selector:".id-fb",name:"fb_login",handler:this.__onClickFB},{type:"click",selector:".toggle-password-visibility",name:"toggle_password_visibility",handler:"__togglePasswordVisibility"},{type:"click",selector:".forgot-password-link",name:"forgot_password",handler:"__forgotPassword"},{type:"click",selector:".ios-button",name:"download_ios",handler:"__downloadIos"},{type:"click",selector:".android-button",name:"download_android",handler:"__downloadAndroid"}]},initialize:function(e){this.title=e.globalStringManager.get("welcome_login_dialog_signin"),void 0!==e.globalStringManager&&(this.__globalStringManager=e.globalStringManager),this.hasCloseButton=!!_.isUndefined(e.hasCloseButton)||e.hasCloseButton,this.__loginMode=e.loginMode,t.prototype.initialize.call(this,e),this.__loginCookieName=this.__serviceProvider.get("loginCookieName"),this.__cookieManager=this.__serviceProvider.get("cookieManager"),this.__hasSignupButton=!!_.isUndefined(e.hasSignupButton)||e.hasSignupButton,this.__loginUsername=this.__cookieManager.get("login_username")?this.__cookieManager.get("login_username"):"",this.__refreshOnLogin=e.refreshOnLogin||"mobile"===this.__serviceProvider.get("platform"),this.__loginDestination=e.loginDestination,this.shouldFocusOnPrimaryButton=!1,this.__socialLogin=this.__loginManager.getSocialLogin(),this.__socialLogin.checkLoginState(),this.__hadSocialLogin=this.__socialLogin.isLoggedIn(),this.__socialLogin.logout(),this.addToDOM()},postRender:function(){if(this.__loginUsername=void 0===this.__loginUsername?"":this.__loginUsername,this.__loginUsername="undefined"===this.__loginUsername?"":this.__loginUsername,this.__loginUsername=null===this.__loginUsername?"":this.__loginUsername,this.setContent("body",e.template,{username:this.__loginUsername,passwordHolderContent:this.__globalStringManager.get("login_dialog_forgot_credentials")}),this.$(".login_avatarname input").focus(),this.__loginUsername&&this.$(".login_password input").focus(),this.$(".login").toggleClass("can-signup",this.__hasSignupButton),this.__loginUsername){var t=this.$('input[name="avatarname"]').closest(".label[data-holder]");this.__insertLabelTemplate(t),t.hasClass("ignore-placeholder-behavior")||t.find(">.holder-label >.info").html(t.attr("data-holder"))}},__onLogin:function(t){null!==t&&t.preventDefault(),this.__leanplum.recordEvent("login_click",{mode:this.__loginMode}),t="true"===this.__cookieManager.get("accepted_all_cookies");var i=this.__socialLogin.isLoggedIn()?{email:this.__socialLogin.getProfileItem("email"),platform:"facebook_web",platform_token:this.__socialLogin.__fbAuthResponse.accessToken,platform_uid:this.__socialLogin.__fbAuthResponse.userID,gdpr_cookie_acceptance:t}:{username:this.$('[name="avatarname"]').val(),password:this.$('[name="password"]').val(),gdpr_cookie_acceptance:t};this.$("label.submit").addClass("loading"),this.__loginManager.performLoginFromCredentials(this.__serviceProvider,i).then(function(t){if(this.__restModelFactory.readModel(t.relations.user,e.UiCore.NodeModel).populated().then(function(e){this.__leanplum.recordEvent("welcome_login_success",{cid:e.get("legacy_cid").toString()})}.bind(this)),this.__googleAnalytics.recordSuccessfulAuthentication("true"),this.$("label.submit").removeClass("loading"),this.$(".error-message").removeClass("active").css("height",""),this.__cookieManager.set(this.__loginCookieName,"true"),this.__cookieManager.set("prefer_alloy","1"),this.__cookieManager.set("login_username",i.username),this.__cookieManager.set("password_changed","0"),this.__loginDestination)this.__window.location.href=this.__loginDestination;else if(this.__loginManager.getLoginDestination())this.__window.location.href=this.__loginManager.getLoginDestination();else if(this.__serviceProvider.services.overrideMode&&"ftux"!==this.__serviceProvider.services.overrideMode)t=this.__serviceProvider.get("siteRoot"),t+=this.__serviceProvider.get("startMode")+"/",this.__serviceProvider.services.startSubmode&&(t+=this.__urlId(this.serviceProvider.get("startSubmode"))+"/"),this.__window.location.href=t;else if(this.__refreshOnLogin)this.__window.location.reload();else{var a=this.__restModelFactory.readModel(t.relations.user,e.UiCore.NodeModel);a.populated().then(function(){return a.getEdgeCollection("preferences",e.UiCore.RestCollection)}.bind(this)).then(function(e){return this.__prefs=e,this.__prefs.populated()}.bind(this)).then(function(){for(var e=!1,t=0;t<this.__prefs.length;t++){var i=this.__prefs.at(t);"registered_through_alloy"!==i.get("name")&&"registered_through_mobile"!==i.get("name")&&"pure_mobile_access"!==i.get("name")||!i.get("value")||(e=!0,this.__window.location.reload())}e||(this.__window.location.href="/switch_to/classic/")}.bind(this))}}.bind(this),function(t){var i="credentials";t===this.__loginManager.ERROR_TRY_AGAIN_LATER?i="try-again-later":t===this.__loginManager.ERROR_DISABLED?i="disabled":t!==this.__loginManager.ERROR_UNDERAGE&&t!==this.__loginManager.ERROR_COOKIE_UNACCEPT&&t!==this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT||(i="disabled",this.__showPrivacyPolicyDialog(t)),this.__leanplum.recordEvent("welcome_login_error",{error:i}),e.NextUtil.DomHelper.radioClass(this.$(".error-message."+i),"active"),t=this.$(".error-message.active").height(),this.$(".error-message.active").css("height",0),this.$("label.submit").removeClass("loading"),this.$(".error-message.active").height(),this.$(".error-message.active").css("height",t)}.bind(this))},__onClickSignup:function(e){e.preventDefault(),this.__googleAnalytics.recordSignUpClick("login"),this.promiseResolver.resolve("signup"),this.__window.location.href="/welcome/ftux/gender/"},__onClickFB:function(){var e=function(){this.__onLogin(null)}.bind(this);this.hide(),this.__socialLogin.login(e)},__togglePasswordVisibility:function(){var e=this.$(".login_password input"),t="password"==e.attr("type");e[0].setAttribute("type",t?"text":"password"),this.$(".toggle-password-visibility").toggleClass("icon-password-show",!t).toggleClass("icon-password-hide",t),e.focus()},__forgotPassword:function(){this.__leanplum.recordEvent("welcome_login_forgot_password_click"),this.__window.location="/next/forgotpassword/"},__downloadIos:function(){this.__leanplum.recordEvent("welcome_login_download_ios_click")},__downloadAndroid:function(){this.__leanplum.recordEvent("welcome_login_download_android_click")},__onClose:function(e){t.prototype.__onClose.call(this,e),(!(e=-1!==this.__window.location.pathname.search("/welcome/ftux"))||e&&this.__hadSocialLogin)&&this.__modeManager.openMode({mode:{id:"ftux"},submode:{id:"__default__"}})},__showPrivacyPolicyDialog:function(t){var i=e.PrivacyPolicyAdultDialog;return t===this.__loginManager.ERROR_UNDERAGE?i=e.PrivacyPolicyMinorsDialog:t===this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT&&(i=e.PrivacyPolicyMinorsPendingDialog),this.__dialogManager.showDialog(i)}},e.InputMixin))}({Dialogs:e["@Dialogs"],NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],InputMixin:Ye,Mixin:We,PrivacyPolicyMinorsDialog:je,PrivacyPolicyAdultDialog:Ze,PrivacyPolicyMinorsPendingDialog:Je,template:Fe});return{ActivityDetailTimestamp:f,ActivityHeaderTimestamp:n,AdsListPresenter:g,AtAvatarName:m,ChatDrawerTimestamp:Te,DisplayName:se,DisplayNameWrap:$e,DualName:Ie,EdgeCollectionPresenter:p,Filter:ye,FollowButton:function(e){var t=e.UiCore.UiContext;return t.extend("FollowButton",{className:"follow-button btn-simple",uiContextName:"follow_button",tagName:"button",dependencies:["dialogManager","featureAccessManager","globalStringManager","loginManager","window"],trackedEvents:function(){return[{type:"click",selector:"",name:"follow_button_click",handler:this.__onClick.bind(this)}]},initialize:function(i){t.prototype.initialize.call(this,i),this.$el.addClass("hidden"),this.__profileNode=i.profileNode,(this.__isLoggedIn=this.__loginManager.isLoggedIn())?(this.__myself=this.__loginManager.getCurrentUser(),this.__myProfile=this.__myself.getSingleEdge("profile"),this.__myProfile.populated().then(function(){this.__onChange(),this.__myFollowingCollection=this.__myProfile.searchEdgeCollection("subscriptions",{},e.UiCore.EdgeCollection),this.listenTo(this.__profileNode,"change:relations",this.__onChange.bind(this)),this.addToDOM()}.bind(this))):this.addToDOM()},render:function(){this.__profileNode.populated().then(function(){this.$el.removeClass("hidden"),this.$el.html(e.template({}))}.bind(this))},__onChange:function(){this.$el.toggleClass("following",!!this.__profileNode.relations.viewer_subscription)},__onClick:function(){this.__isLoggedIn?this.$el.hasClass("following")?this.__handleFollowingClick():this.__handleFollowClick():this.__showLoginDialog()},__handleFollowingClick:function(){this.__dialogManager.showDialog(e.UnfollowDialog,{profile:this.__profileNode}).finished.then(function(){this.__profileNode.getSingleEdge("viewer_subscription",e.UiCore.EdgeModel).destroy().then(function(){this.__profileNode.invalidate()}.bind(this))}.bind(this),function(){}.bind(this))},__handleFollowClick:function(){this.__myFollowingCollection.create({id:this.__profileNode.id}).then(function(){this.__profileNode.invalidate()}.bind(this)).catch(this.__onFollowFailure.bind(this))},__onFollowFailure:function(){},__showLoginDialog:function(){this.__dialogManager.showDialog(e.LoginDialog,{stringManager:this.__globalStringManager,loginDestination:this.__window.location.href})}})}({NextUtil:e["@NextUtil"],UiCore:e["@UiCore"],UnfollowDialog:ze,LoginDialog:Qe,template:Oe}),JQSpecialEvents:De,LoadingPlaceholderList:Ve,MessageDrawerTimestamp:v,MessageHeaderTimestamp:Ue,ProfileIcon:we,SimpleFilter:ve,SocialShare:pe,Timestamp:a,WithmeContext:Se}});
module({"@UiCore":"@UiCore","css!/build/withme/model.css":"css!/asset/d41d8cd98f00b204/build/withme/model.css"},function(e){var t,i,o=(i={UiCore:e["@UiCore"]}.UiCore.NodeModel).extend("ProductNode",{initialize:function(){i.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:relations",this.__triggerChanges.bind(this))},__triggerChanges:function(e,t){t=t||{},(e=e||{}).viewer_inventory!=t.viewer_inventory&&this.trigger("change:is_owned",this,t.viewer_inventory),e.viewer_wishlist!=t.viewer_wishlist&&this.trigger("change:is_wished",this,t.viewer_wishlist)},isAvatar:function(){return _.contains(this.get("categories"),"Avatars")},isCompatibleWithBodyPatterns:function(e){var t=_.contains(this.get("is"),"clothing_product"),i=_.contains(this.get("is"),"avatar_attachment");return e=0<_.intersection(e,this.get("compatible_body_patterns")).length,t&&(i||e)},getPrices:function(){return{full:this.get("product_price"),discounted:this.get("discount_price")?this.get("discount_price"):this.get("product_price")}},get:function(e){switch(e){case"is_owned":return!!this.relations.viewer_inventory;case"is_wished":return!!this.relations.viewer_wishlist;default:return i.prototype.get.apply(this,arguments)}}}),n=(t={UiCore:e["@UiCore"],ProductNode:o}).UiCore.EdgeDerefModel.extend("ProductEdgeDeref",{nodeFactory:t.ProductNode}),r=function(e){var t=e.UiCore.EdgeCollection;return t.extend("CartProductCollection",{model:e.ProductEdgeDeref,populated:function(e){return(e=e||{}).ignoreBadProducts?this.enumerated().then(function(){return this.Promise.every(this.map(function(e){return e.populated().catch(function(){})}))}.bind(this)).then(function(){return this}.bind(this)):t.prototype.populated.call(this)},checkCartContains:function(e){return this.populated({ignoreBadProducts:!0}).then(function(){var t=_.any(this.models,function(t){return t.node&&t.node.id==e});return this.Promise.resolve(t)}.bind(this))}})}({UiCore:e["@UiCore"],ProductEdgeDeref:n}),s=function(e){var t=e.UiCore.NodeModel;return e=e.UiCore.EdgeCollection.extend("MessageCollection",{comparator:function(e){if(e.edge&&e.edge.get("message_order"))return e.edge.get("message_order")}}),t.extend("ConversationNode",{initialize:function(e,i){t.prototype.initialize.call(this,e,i)},collectionFactories:{messages:e}})}({UiCore:e["@UiCore"]}),a=function(e){return e.UiCore.EdgeDerefModel.extend("ConversationEdgeDerefModel",{nodeFactory:e.ConversationNode})}({UiCore:e["@UiCore"],ConversationNode:s}),l=e["@UiCore"].NodeModel.extend("NotificationNode",{}),c=function(e){return e.UiCore.EdgeDerefModel.extend("NotificationEdgeDeref",{nodeFactory:e.NotificationNode,sorted:function(){return this.isPopulated()}})}({UiCore:e["@UiCore"],NotificationNode:l}),d=function(e){return e.UiCore.EdgeCollection.extend("ConversationCollection",{model:e.ConversationEdgeDerefModel,initialize:function(){e.UiCore.EdgeCollection.prototype.initialize.apply(this,arguments),this.on("edge:change:last_message.created",function(){this.sort()},this)},comparator:function(e,t){var i=e.edge.get("last_message.created"),o=t.edge.get("last_message.created");return i===o?0:i<o?1:-1}})}({UiCore:e["@UiCore"],ConversationEdgeDerefModel:a}),h=function(e){return e.UiCore.NodeCollection.extend("ProductCollection",{model:e.ProductNode})}({UiCore:e["@UiCore"],ProductNode:o}),u=function(e){return e.UiCore.NodeModel.extend("FeedNode",{like:function(){return this.waitForLikedBy(!0).then(function(e){if(null===e.getMyEdge())return e.create({})})},unlike:function(){return this.whenHasLikedByEdge(!0).then(function(e){if(e)return e.populated().then(function(){return e.edge.destroy()})})},waitForLikedBy:function(e){return this.populated().then(function(){var t=this.getLikedBy();return e&&t.invalidate(),t.populated()}.bind(this))},getLikedBy:function(){return this.searchEdgeCollection("liked_by",{limit:0},e.UiCore.EdgeCollection)},whenHasLikedByEdge:function(e){return this.waitForLikedBy(e).then(function(e){return e.getMyEdge()})}})}({UiCore:e["@UiCore"]}),g=function(e){return e.UiCore.EdgeDerefModel.extend("FeedEdgeDeref",{nodeFactory:e.FeedNode,sorted:function(){return this.isPopulated()}})}({UiCore:e["@UiCore"],FeedNode:u}),f=e["@UiCore"].EdgeCollection.extend("FeedCommentCollection",{comparator:function(e){return e.node?-new Date(e.node.get("time")).getTime():-Number.MAX_VALUE}}),p=e["@UiCore"].NodeModel.extend("OutfitNode",{}),m=(p=function(e){return e.UiCore.EdgeDerefModel.extend("OutfitEdgeDeref",{nodeFactory:e.UiCore.NodeModel,sorted:function(){return this.isPopulated()}})}({UiCore:e["@UiCore"],OutfitNode:p}),function(e){var t=e.UiCore.EdgeCollection;return t.extend("OutfitCollection",{model:e.OutfitEdgeDeref,initialize:function(e,i){t.prototype.initialize.call(this,e,i),this.on("add",this.__checkSort.bind(this)),this.on("reset",function(){this.each(this.__checkSort.bind(this))}.bind(this))},__checkSort:function(e){e.sorted()||e.populated().then(this.sort.bind(this))},comparator:function(e){return e.node?-new Date(e.node.get("created")).getTime():0}})}({UiCore:e["@UiCore"],OutfitEdgeDeref:p})),C=function(t){var i={UiCore:e["@UiCore"]}.UiCore.RestCollection;return i.extend("MetaCollection",{dependencies:["Promise","collections","restModelFactory"],initialize:function(e){this.__Promise=e.Promise,this.__filters=Array(e.collections.length),this.setCollections(e.collections),_.each(this.__collections,function(e){e.on("add reset remove",this.__setModels,this)}.bind(this))},delete:function(){_.each(this.__collections,function(e){e.off("add reset remove",null,this)}.bind(this))},__findPageCollection:function(){return _.findIndex(this.__collections,function(e){return e.hasNextPage()}.bind(this))},__setModels:function(){var e=this.__findPageCollection(),t=[];_.each(_.range(0,-1===e?this.__collections.length:e+1),function(e){this.__filters[e]?t.push(_.filter(this.__collections[e].models,this.__filters[e])):t.push(this.__collections[e].models)}.bind(this)),i.prototype.reset.call(this,_.flatten(t))},setCollections:function(e){this.__collections&&_.each(this.__collections,function(e){e.off("add reset remove",null,this)}.bind(this)),this.models=[],this.__collections=e,this.__setModels(),this.url="meta_"+_.pluck(this.__collections.url).join("_")},setFilter:function(e,t){var i=_.findIndex(this.__collections,function(t){return t.url===e}.bind(this));if(0>i)throw Error('No collection found for "'+e+'"');this.__filters[i]=t,this.__setModels()},reset:function(e,t){throw Error("Reset meta collection not allowed.")},isSyncing:function(){for(var e=0;e<this.__collections.length;e++){if(this.__collections[e].isSyncing())return!0;if(this.__collections[e].hasNextPage())break}return!1},hasNextPage:function(){return-1!==this.__findPageCollection()},getNextPage:function(e){if(!this.isSyncing()&&this.hasNextPage()){e=this.__findPageCollection();var t=this.__Promise.accept();return-1!==e&&(t=this.__collections[e].getNextPage()),t.then(function(){this.__setModels()}.bind(this)),t}},getPreviousPage:function(e){throw Error("getPreviousPage on meta collection not allowed")},fetch:function(e){throw Error("fetch on meta collection not allowed")},invalidate:function(){throw Error("invalidate on meta collection not allowed")},release:function(){throw Error("release on meta collection not allowed")},sync:function(){throw Error("sync on meta collection not allowed")},populated:function(){return this.__Promise.every(_.map(this.__collections,function(e){return e.populated()}.bind(this)))},enumerated:function(){return this.__Promise.every(_.map(this.__collections,function(e){return e.enumerated()}.bind(this)))}})}(),y=function(t){var i={UiCore:e["@UiCore"]}.UiCore.NodeModel;return i.extend("RoomNode",{initialize:function(){i.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:relations",this.__triggerChanges.bind(this))},__triggerChanges:function(e,t){},get:function(e){return i.prototype.get.apply(this,arguments)}})}(),v=function(e){var t=e.UiCore.EdgeCollection;return t.extend("ProductCollection",{model:e.ProductEdgeDeref,get:function(e){switch(e){case"is_owned":return this.all(function(e){return e.node&&e.node.relations&&e.node.get("is_owned")});default:return t.prototype.get.apply(this,arguments)}}})}({UiCore:e["@UiCore"],ProductEdgeDeref:n}),b=function(e){var t=e.UiCore.EdgeCollection;return t.extend("FeedCollection",{model:e.FeedEdgeDeref,initialize:function(e,i){t.prototype.initialize.call(this,e,i),this.on("add",this.__checkSort.bind(this)),this.on("reset",function(){this.each(this.__checkSort.bind(this))}.bind(this))},__checkSort:function(e){e.sorted()||e.populated().then(this.sort.bind(this))},comparator:function(e){return e.node?-new Date(e.node.get("time")).getTime():0}})}({UiCore:e["@UiCore"],FeedEdgeDeref:g});return e=function(e){var t=e.UiCore.EdgeCollection;return t.extend("NotificationCollection",{model:e.UiCore.EdgeDerefModel,initialize:function(e,i){t.prototype.initialize.call(this,e,i),this.on("add",this.__checkSort.bind(this)),this.on("reset",function(){this.each(this.__checkSort.bind(this))}.bind(this))},__checkSort:function(e){e.isPopulated()||e.populated().then(this.sort.bind(this))},comparator:function(e){return e.node?-new Date(e.node.get("timestamp")).getTime():0}})}({UiCore:e["@UiCore"],NotificationEdgeDeref:c}),{CartProductCollection:r,ConversationCollection:d,ConversationEdgeDerefModel:a,ConversationNode:s,FeedCollection:b,FeedCommentCollection:f,FeedNode:u,FeedEdgeDeref:g,FilterModel:function(e){var t={language:{language:"all"},occupancy:{occupancy:""},gender:{female:!1,male:!1},ap_ga:{ap:!1,ga:!1},filter_text:{filter_text:""},dressup_category:{category:"outfits"},dressup_supercategory:{supercategory:"dna"},shop_category:{category:"tops"},online_status:{online:!1},special_user_status:{vip:!1,age_verified:!1},pricing:{pricing:"0"},platform:{web:!1,ios:!1,android:!1},activities:{likes:!1,comments:!1,eci:!1,follows:!1},prepaid_card_value:{prepaid_card_value:"0"},prepaid_card_country:{prepaid_card_country:"AE"}},i={dna:{supercategory:"dna",category:"skins"},outfits:{supercategory:"outfits",category:"outfits"},clothes:{supercategory:"clothes",category:"tops"}},o={tops:"69,128",bottoms:"70,78",shoes:"101,102",accessories:"71,153,425,1877,2057,1646,1719,2362,1648,97,98",hairstyles:"67,75",eyes:"89,90,91,92",heads:"295,296",skins:"68,76,3096,3097",skin:"68,76,3096,3097",avatars:"108",wishlist:"106,108,425",rooms:"366",furniture:"1027",seating:"906,909",tables:"1199",lighting:"949",televisions:"917",positions:"3102",looks:"3088"},n=["316","324"],r=IMVU.NamedModel;return r.extend("FilterModel",{dependencies:["Promise"],initialize:function(e,o){this.Promise=o.Promise,this.disabledFilters=new Backbone.Model,this.__populatedPromise=new this.Promise(function(e){this.__populatedResolver=e}.bind(this)),this.__categoryBlacklist=IMVU.optionalProperty(o,"categoryBlacklist",n),e=_.extend.apply(_,[{}].concat(_.map(e,function(e){return e.match(/_supercategory/)?i[t[e].supercategory]:t[e]}))),r.prototype.initialize.call(this,e,o),this.on("change:supercategory",this.__updateFromSupercategory,this),o.dressUpAvatarManager?o.dressUpAvatarManager.getGender().then(function(e){"female"===e?this.set({female:!0,male:!1}):"male"===e&&this.set({male:!0,female:!1}),this.__populatedResolver.accept()}.bind(this)):this.__populatedResolver.accept()},delete:function(){this.off(null,null,this),r.prototype.delete.call(this)},populated:function(){return this.__populatedPromise},disableFilter:function(e){this.disabledFilters.set(e,!0)},enableFilter:function(e){this.disabledFilters.set(e,!1)},toggleDisabled:function(e,t){this.disabledFilters.set(e,void 0!==t?t:!this.disabledFilters.get(e))},isDisabled:function(e){return!!this.disabledFilters.get(e)},setCategoryByProduct:function(e){e.populated().then(function(){var t,i=_.map(_.pluck(e.get("category_path"),"id"),String),n=0;_.each(o,function(e,o){var r=_.intersection(i,e.split(",")).length;r>n&&"wishlist"!==o&&(t=o,n=r)}),t&&this.set({category:t})}.bind(this))},toQueryParamsMap:function(){var e={};if("language"in this.attributes&&"all"!==this.get("language")&&(e.language=this.get("language")),"occupancy"in this.attributes&&this.get("occupancy")){var t=this.get("occupancy").split("-");e.low=t[0],e.high=t[1]}return"female"in this.attributes&&!this.isDisabled("gender")&&this.get("female")!==this.get("male")&&(this.get("female")&&!this.isDisabled("female")?(e.gender="female",e.no_cat="41"):this.get("male")&&!this.isDisabled("male")&&(e.gender="male",e.no_cat="40")),"ap"in this.attributes&&this.get("ap")!==this.get("ga")&&(e.ap=this.get("ap")?1:0,e.rating=this.get("ap")?"ap":"ga",e.product_rating=this.get("ap")?1:0,this.get("ap")?e.has_access_pass=this.get("ap")?1:0:this.get("ga")&&(e.ga_only=this.get("ga")?1:0)),"vip"in this.attributes&&this.get("vip")&&(e.has_vip_pass=!0),"age_verified"in this.attributes&&this.get("age_verified")&&(e.age_verified=!0),"online"in this.attributes&&this.get("online")&&(e.status="online",e.online=!0),"filter_text"in this.attributes&&this.get("filter_text")&&(e.filter_text=this.get("filter_text"),e.name_filter=this.get("filter_text"),e.partial_avatar_name=this.get("filter_text"),e.keywords=this.get("filter_text")),"category"in this.attributes&&"outfits"!==this.get("category")&&(e.cat=o[this.get("category")]||"106,108,3088,425",this.__categoryBlacklist&&(e.no_cat=this.__categoryBlacklist.join(",")+(e.no_cat?","+e.no_cat:""))),"pricing"in this.attributes&&this.get("pricing")&&0<this.get("pricing")&&(e.product_price=this.get("pricing")),"limit"in this.attributes&&(e.limit=this.get("limit")),t=[],"web"in this.attributes&&this.get("web")&&t.push("webgl"),"ios"in this.attributes&&this.get("ios")&&t.push("ios"),"android"in this.attributes&&this.get("android")&&t.push("android"),_.isEmpty(t)||(e.platform=t.join(",")),"likes"in this.attributes&&this.get("likes")&&(e.feed_like=this.get("likes")),"comments"in this.attributes&&this.get("comments")&&(e.feed_comment=this.get("comments")),"eci"in this.attributes&&this.get("eci")&&(e.chat_invite=this.get("eci")),"friends-only"in this.attributes&&this.get("friends-only")&&(e.friends_only=this.get("friends-only")),"follows"in this.attributes&&this.get("follows")&&(e.timelines_follow=this.get("follows")),e},toJSON:function(){return _.extend(r.prototype.toJSON.apply(this,arguments),_.reduce(this.disabledFilters.toJSON(),function(e,t,i){return e["disabled."+i]=t,e},{}))},rawToJSON:function(){return r.prototype.toJSON.apply(this,arguments)},__updateFromSupercategory:function(){var e=this.get("supercategory");this.set(i[e])}})}(),OutfitCollection:m,OutfitEdgeDeref:p,ProductEdgeCollection:v,ProductEdgeDeref:n,ProductCollection:h,ProductNode:o,RoomNode:y,MetaCollection:C,NotificationCollection:e,NotificationNode:l,NotificationEdgeDeref:c}});